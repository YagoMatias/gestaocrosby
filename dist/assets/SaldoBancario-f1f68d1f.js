import{r as l,h as oa,u as ra,j as e,c as re,H as Me,g as la,s as na}from"./index-a2563983.js";import{b as ca,s as Te,r as ia,f as da,a as ma,c as xa}from"./retornoBancario-49cfa95d.js";import{C as le,a as ne,b as ce,c as ie,d as de}from"./cards-fd94db0b.js";import{s as ua}from"./CaretUp.es-b369da07.js";import{m as ga}from"./CurrencyDollar.es-0edca053.js";import{n as ha}from"./Plus.es-81fa0dc9.js";import{p as me}from"./Spinner.es-3c850cda.js";import{s as pa}from"./TrendDown.es-4f66c864.js";const ba=new Map([["bold",l.createElement(l.Fragment,null,l.createElement("path",{d:"M228,128a12,12,0,0,1-12,12H40a12,12,0,0,1,0-24H216A12,12,0,0,1,228,128Z"}))],["duotone",l.createElement(l.Fragment,null,l.createElement("path",{d:"M216,56V200a16,16,0,0,1-16,16H56a16,16,0,0,1-16-16V56A16,16,0,0,1,56,40H200A16,16,0,0,1,216,56Z",opacity:"0.2"}),l.createElement("path",{d:"M224,128a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,128Z"}))],["fill",l.createElement(l.Fragment,null,l.createElement("path",{d:"M208,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM184,136H72a8,8,0,0,1,0-16H184a8,8,0,0,1,0,16Z"}))],["light",l.createElement(l.Fragment,null,l.createElement("path",{d:"M222,128a6,6,0,0,1-6,6H40a6,6,0,0,1,0-12H216A6,6,0,0,1,222,128Z"}))],["regular",l.createElement(l.Fragment,null,l.createElement("path",{d:"M224,128a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,128Z"}))],["thin",l.createElement(l.Fragment,null,l.createElement("path",{d:"M220,128a4,4,0,0,1-4,4H40a4,4,0,0,1,0-8H216A4,4,0,0,1,220,128Z"}))]]),Pe=l.forwardRef((u,v)=>l.createElement(oa,{ref:v,...u,weights:ba}));Pe.displayName="MinusIcon";const fa=Pe,S=u=>{if(!u)return null;if(u.includes("T")){const v=u.split("T")[0],[$,D,q]=v.split("-");return new Date(parseInt($),parseInt(D)-1,parseInt(q))}if(u.includes("/")){const[v,$,D]=u.split("/");return new Date(parseInt(D),parseInt($)-1,parseInt(v))}return new Date(u)},ja=u=>{if(!u)return"";if(u.includes("T")){const v=u.split("T")[0],[$,D,q]=v.split("-");return`${q}/${D}/${$}`}return u},_a=()=>{var Ae;const{user:u}=ra(),v=a=>({JAN:31,FEV:28,MAR:31,ABR:30,MAI:31,JUN:30,JUL:31,AGO:31,SET:30,OUT:31,NOV:30,DEZ:31})[a]||0,$=()=>{const a=["JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ"],t=new Date().getMonth();return a[t]},D=()=>new Date().getDate(),q=()=>{const a=D(),t=$(),n=v(t);return Math.min(a,n)},[C,qe]=l.useState(new Date().getFullYear()),[j,ke]=l.useState($()),[y,V]=l.useState(q()),[m,xe]=l.useState("TODOS"),[U,ue]=l.useState(!1),[ge,he]=l.useState(""),[R,Ie]=l.useState([]),[J,ze]=l.useState(!1),[p,pe]=l.useState([]),[N,Le]=l.useState({campo:null,direcao:"asc"}),[h,be]=l.useState("atual"),[E,Z]=l.useState({}),[k,G]=l.useState(""),[T,fe]=l.useState(null),[Q,je]=l.useState(!1),[Ue,Y]=l.useState(!1),[K,ve]=l.useState(null),[Re,Ne]=l.useState(!1),[x,_]=l.useState({banco:"",agencia:"",conta:"",saldo:"",chqEspecial:""}),[W,ye]=l.useState(!1),[Be,X]=l.useState(!1),[g,I]=l.useState(null),[He,ee]=l.useState(!1),[ae,we]=l.useState(!1),A=a=>typeof a=="number"?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a):"R$ 0,00",Ve=a=>a?parseInt(a,10).toString():"N/A",B=async()=>{try{const a={};(F||[]).forEach(t=>{a[`${t.banco}_${t.numero}`]=null});for(const t of Object.keys(a)){const[n,o]=t.split("_"),s=(F||[]).find(r=>r.banco===n&&r.numero===o),c=s==null?void 0:s.agencia,d=await ca(n,c,o);d.success&&(!d.conta||d.conta===o&&(!d.agencia||d.agencia===c))&&(a[t]=d.data)}Z(a)}catch(a){console.error("Erro ao carregar limites de cheque especial:",a)}},Je=(a,t,n="")=>{const o=`${a}_${t}`;fe(o),G(n.toString())},Se=()=>{fe(null),G("")},Ze=(a,t,n,o)=>{if(a.key==="Enter"){a.preventDefault();const s=parseFloat(k);if(!s||isNaN(s)){alert("Por favor, insira um valor válido.");return}const c=o&&o>0;ve(c?"atualizar":"criar"),Y(!0)}},Ge=async()=>{var o;if(!T)return;const[a,t]=T.split("_"),n=(o=(F||[]).find(s=>s.banco===a&&s.numero===t))==null?void 0:o.agencia;je(!0);try{const s=parseFloat(k),c=await Te(a,s,t,n);c.success?(Z(d=>({...d,[T]:s})),Se(),Y(!1),console.log("✅ Limite salvo com sucesso:",c.message),setTimeout(()=>{B()},500)):alert("Erro ao salvar limite: "+c.message)}catch(s){console.error("Erro ao salvar limite:",s),alert("Erro ao salvar limite. Tente novamente.")}finally{je(!1)}},Qe=()=>{Y(!1),ve(null)},Ye=()=>{_({banco:"",agencia:"",conta:"",saldo:"",chqEspecial:""}),Ne(!0)},Ce=()=>{Ne(!1),_({banco:"",agencia:"",conta:"",saldo:"",chqEspecial:""})},Ke=a=>{I(a),X(!0)},$e=()=>{X(!1),I(null)},Ee=()=>{ee(!0)},We=()=>{ee(!1),I(null)},Xe=async()=>{if(!g){console.error("Nenhum saldo selecionado para exclusão");return}console.log("Tentando excluir saldo:",g),console.log("ID do saldo:",g.id),console.log("Nome do arquivo:",g.nome_arquivo),we(!0);try{let a=await ia(g.id);console.log("Resultado da exclusão normal:",a),a.success||(console.log("Tentando remoção forçada..."),a=await da(g.id),console.log("Resultado da exclusão forçada:",a)),a.success?(console.log("Saldo excluído com sucesso, recarregando dados..."),await se(),ee(!1),X(!1),I(null),alert("Saldo excluído com sucesso!")):(console.error("Erro na exclusão:",a.message),alert("Erro ao excluir saldo: "+a.message))}catch(a){console.error("Erro ao excluir saldo:",a),alert("Erro ao excluir saldo: "+a.message)}finally{we(!1)}},ea=async()=>{if(!x.banco||!x.agencia||!x.conta||!x.saldo){alert("Por favor, preencha todos os campos obrigatórios.");return}const a=parseFloat(x.saldo);if(isNaN(a)){alert("Por favor, insira um valor válido para o saldo.");return}if(p.find(n=>n.banco_nome===x.banco&&n.agencia===x.agencia&&n.conta===x.conta)){alert("Já existe uma conta com este banco, agência e número. Não é possível adicionar duplicatas.");return}ye(!0);try{const n=a>=0,o={nome_arquivo:"saldo_manual",data_upload:new Date().toISOString(),valor:a,banco_nome:x.banco,banco_codigo:"000",banco_layout:"manual",agencia:x.agencia,conta:x.conta,saldo_formatado:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a),data_processamento:new Date().toISOString(),data_geracao:new Date().toISOString(),operacao_tipo:"saldo_manual",operacao_descricao:`Saldo inserido manualmente por ${(u==null?void 0:u.name)||"Usuário"}`,operacao_sinal:n?"+":"-",operacao_is_positive:n,operacao_valor_absoluto:Math.abs(a),chq_especial:x.chqEspecial?parseFloat(x.chqEspecial):null,usuario_inseriu:(u==null?void 0:u.name)||"Usuário",created_at:new Date().toISOString()},s=await ma(o);if(s.success){if(x.chqEspecial)try{const c=parseFloat(x.chqEspecial);await Te(x.banco,c,x.conta,x.agencia),Z(d=>({...d,[`${x.banco}_${x.conta}`]:c}))}catch(c){console.error("Erro ao salvar limite junto com saldo manual:",c)}alert("Saldo adicionado com sucesso!"),Ce(),se(),x.chqEspecial&&setTimeout(()=>{B()},500)}else alert("Erro ao salvar saldo: "+s.message)}catch(n){console.error("Erro ao salvar novo saldo:",n),alert("Erro ao salvar saldo. Tente novamente.")}finally{ye(!1)}},P=l.useMemo(()=>{if(p.length===0)return[];const a=[...new Set(p.map(t=>t.banco))].filter(Boolean).sort();return console.log("Bancos únicos encontrados:",a),a},[p]),F=l.useMemo(()=>{if(p.length===0)return[];const a={};p.forEach(o=>{const s=o.banco,c=o.agencia,d=o.numero;if(!s||!c||!d)return;const r=S(o.data_geracao);if(!r)return;const i=`${s}|${c}|${d}`;(!a[i]||r>a[i].dataGeracao)&&(a[i]={...o,dataGeracao:r,chaveConta:i})});let t=Object.values(a);m&&m!=="TODOS"&&(t=t.filter(o=>{const s=(o.banco||"").toUpperCase(),c=m.toUpperCase();return s.includes(c)||c.includes(s)})),t.sort((o,s)=>{const c=(o.banco||"").localeCompare(s.banco||"");if(c!==0)return c;const d=(o.agencia||"").localeCompare(s.agencia||"");return d!==0?d:(o.numero||"").localeCompare(s.numero||"")});const n=t.map(o=>{const s=`${o.banco}_${o.numero}`,c=E[s]||0;return{...o,limiteChequeEspecial:c}});return console.log("Saldos atuais por conta (banco + agência + conta) com limite CHQ:",n.length,"registros"),n},[p,m,E]),aa=a=>{if(ke(a),a!==j){const t=v(a);if(y>t)V(t);else{const n=new Date().getDate();V(Math.min(n,t))}}},De=(a,t,n=null,o=null,s=null)=>{console.log("Aplicando filtro:",{filtro:t,diaFiltro:n,anoFiltro:o,bancoFiltro:s,totalDados:a.length});const c=o||new Date().getFullYear(),d=a.filter(i=>{const f=i.data_geracao;if(!f)return console.log("Item sem data_geracao:",i),!1;const b=S(f);if(!b)return!1;const w=b.getFullYear(),O=b.getMonth()+1,M=b.getDate();console.log(`Item ${i.numero}: data=${f}, ano=${w}, mes=${O}, dia=${M}`);const oe={JAN:1,FEV:2,MAR:3,ABR:4,MAI:5,JUN:6,JUL:7,AGO:8,SET:9,OUT:10,NOV:11,DEZ:12}[t];if(oe){if(w!==c)return console.log(`Item ${i.numero}: ano ${w} diferente do ano selecionado ${c}`),!1;if(n!==null){const Oe=O===oe&&M===n;return console.log(`Filtro ${t} dia ${n}: ano=${w}, mes=${O}, dia=${M}, match=${Oe}`),Oe}const Fe=O===oe;return console.log(`Filtro ${t}: ano=${w}, mes=${O}, match=${Fe}`),Fe}return!0});let r=d;if(s&&s!=="TODOS"&&(console.log(`Aplicando filtro de banco: ${s}`),r=d.filter(i=>{const f=(i.banco||"").toUpperCase(),b=s.toUpperCase(),w=f.includes(b)||b.includes(f);return console.log(`Filtro banco ${s}: ${f} -> ${w}`),w}),console.log(`Filtro de banco aplicado: ${r.length} registros encontrados`)),console.log("Dados filtrados:",r.length),r.length>0){const i=[...new Set(r.map(f=>{const b=S(f.data_geracao);return`${b.getDate()}/${b.getMonth()+1}/${b.getFullYear()}`}))].sort();console.log("Datas dos dados filtrados:",i)}return r},se=async()=>{ue(!0),he("");try{const a=await xa({});if(a.success){console.log("📊 Dados brutos recebidos:",a.data);const t=[];a.data.forEach(r=>{r.registros.forEach(i=>{t.push({numero:r.numero,nome:r.nome,saldo:parseFloat(i.valor),banco:i.banco_nome,agencia:i.agencia,ultimaAtualizacao:S(i.data_geracao),operacao:{tipo:i.operacao_tipo,descricao:i.operacao_descricao,sinal:i.operacao_sinal,isPositive:i.operacao_is_positive,valorAbsoluto:i.operacao_valor_absoluto},registros:[i],totalRegistros:1,data_geracao:i.data_geracao,id:i.id,nome_arquivo:i.nome_arquivo,usuario_inseriu:i.usuario_inseriu})})}),console.log("Dados processados:",t.length,"registros individuais");let n=0;const o=[],s=new Set;t.sort((r,i)=>{const f=S(r.data_geracao),b=S(i.data_geracao);return f-b}),t.forEach(r=>{const i=(r.banco||"").trim().toUpperCase(),f=(r.agencia||"").toString().trim(),b=(r.numero||"").toString().trim(),w=r.data_geracao?S(r.data_geracao).toISOString().split("T")[0]:"",O=typeof r.saldo=="number"?r.saldo.toFixed(2):r.saldo,M=`${i}|${f}|${b}|${w}|${O}`;s.has(M)?(n++,console.log("Duplicata removida:",{banco:r.banco,agencia:r.agencia,conta:r.numero,data:r.data_geracao,saldo:r.saldo,chaveUnica:M})):(s.add(M),o.push(r))}),console.log("Dados após remoção de duplicatas:",o.length,"registros únicos"),console.log("Duplicatas removidas:",n);const c=[...new Set(o.map(r=>{const i=S(r.data_geracao);return`${i.getDate()}/${i.getMonth()+1}/${i.getFullYear()}`}))].sort();console.log("Datas disponíveis:",c);const d=o.filter(r=>r.banco&&r.banco.toUpperCase().includes("BRADESCO")&&r.data_geracao&&r.data_geracao.includes("2025-08-11"));console.log("BRADESCO 11/08 encontrados:",d.length,"registros"),d.length>0&&console.log("Detalhes BRADESCO 11/08:",d.map(r=>({banco:r.banco,agencia:r.agencia,conta:r.numero,data:r.data_geracao,saldo:r.saldo}))),pe(o),ze(!0)}else throw new Error(a.message||"Erro ao buscar dados")}catch(a){console.error("Erro ao buscar dados:",a),he("Erro ao buscar dados do banco de dados."),pe([])}finally{ue(!1)}};l.useEffect(()=>{se()},[]),l.useEffect(()=>{(async()=>{P.length>0&&(console.log("🔄 Carregamento inicial de limites..."),await B())})()},[P]),l.useEffect(()=>{p.length>0&&P.length>0&&(console.log("🚀 Carregando limites de cheque especial..."),B())},[p,P]);const H=l.useMemo(()=>{if(p.length===0)return{saldoTotal:0,contasPositivas:0,contasNegativas:0};let a=[];h==="atual"?a=F:a=De(p,j,y,C,m),console.log("Dados para cálculo de estatísticas:",a.length,"registros");const t=a.reduce((s,c)=>{const d=parseFloat(c.saldo)||0,r=parseFloat(c.limiteChequeEspecial)||0,i=d+r;return s+i},0),n=a.filter(s=>{var d,r;if(((d=s.operacao)==null?void 0:d.isPositive)!==void 0&&((r=s.operacao)==null?void 0:r.isPositive)!==null)return console.log(`Conta ${s.numero}: operacao.isPositive = ${s.operacao.isPositive}`),s.operacao.isPositive===!0;const c=s.saldo>0;return console.log(`Conta ${s.numero}: saldo = ${s.saldo}, isPositive = ${c}`),c}).length,o=a.filter(s=>{var c,d;return((c=s.operacao)==null?void 0:c.isPositive)!==void 0&&((d=s.operacao)==null?void 0:d.isPositive)!==null?s.operacao.isPositive===!1:s.saldo<0}).length;return console.log("Estatísticas calculadas (Saldo Total = Soma de Saldo+CHQ):",{saldoTotal:t,contasPositivas:n,contasNegativas:o,tipoVisualizacao:h,bancoFiltro:m}),{saldoTotal:t,contasPositivas:n,contasNegativas:o}},[p,j,y,C,m,h,F]);l.useEffect(()=>{if(p.length>0){const a=De(p,j,y,C,m);Ie(a)}},[p,j,y,C,m]);const sa=a=>a>0?"text-green-600":a<0?"text-red-600":"text-gray-600",_e=a=>{var t,n,o;return console.log(`getSaldoColor para conta ${a.numero}:`,{operacao:a.operacao,saldo:a.saldo,operacaoIsPositive:(t=a.operacao)==null?void 0:t.isPositive}),((n=a.operacao)==null?void 0:n.isPositive)===!0?(console.log(`Conta ${a.numero}: usando operacao.isPositive=true -> verde`),"text-green-600"):((o=a.operacao)==null?void 0:o.isPositive)===!1?(console.log(`Conta ${a.numero}: usando operacao.isPositive=false -> vermelho`),"text-red-600"):a.saldo>0?(console.log(`Conta ${a.numero}: usando saldo=${a.saldo} > 0 -> verde`),"text-green-600"):a.saldo<0?(console.log(`Conta ${a.numero}: usando saldo=${a.saldo} < 0 -> vermelho`),"text-red-600"):(console.log(`Conta ${a.numero}: saldo=${a.saldo} -> cinza`),"text-gray-600")},ta=a=>a>0?e.jsx(la,{size:20,className:"text-green-600"}):a<0?e.jsx(pa,{size:20,className:"text-red-600"}):null,z=a=>{Le(t=>({campo:a,direcao:t.campo===a&&t.direcao==="asc"?"desc":"asc"}))},L=a=>N.campo!==a?null:N.direcao==="asc"?e.jsx(ua,{size:12,className:"ml-1"}):e.jsx(na,{size:12,className:"ml-1"}),te=l.useMemo(()=>{const a=h==="atual"?F:R;return N.campo?[...a].sort((t,n)=>{let o=t[N.campo],s=n[N.campo];return N.campo==="saldo"&&(o=parseFloat(o)||0,s=parseFloat(s)||0),N.campo==="data_geracao"&&(o=S(o),s=S(s)),typeof o=="string"&&N.campo!=="data_geracao"&&(o=o.toLowerCase(),s=s.toLowerCase()),o<s?N.direcao==="asc"?-1:1:o>s?N.direcao==="asc"?1:-1:0}):a},[R,F,h,N]);return e.jsx("div",{className:"w-full max-w-6xl mx-auto flex flex-col items-stretch justify-start py-8 px-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 font-barlow",children:"Saldo Bancário"}),e.jsx("p",{className:"text-gray-600 mt-2 font-barlow",children:"Acompanhe o saldo das contas bancárias a partir dos arquivos .RET processados."})]}),e.jsx("div",{className:"mb-6 flex justify-center items-center gap-4",children:e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-1 shadow-sm",children:e.jsxs("div",{className:"flex",children:[e.jsx("button",{onClick:()=>be("atual"),className:`px-6 py-2 text-sm font-medium rounded-md transition-colors ${h==="atual"?"bg-[#000638] text-white shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:"Saldo Atual"}),e.jsx("button",{onClick:()=>be("historico"),className:`px-6 py-2 text-sm font-medium rounded-md transition-colors ${h==="historico"?"bg-[#000638] text-white shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:"Histórico de Saldo"})]})})}),h==="historico"&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200 mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(re,{size:18,className:"text-[#000638]"}),e.jsx("h3",{className:"font-bold text-sm text-[#000638]",children:"Filtro por Período (Data Geração)"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(re,{size:16,className:"text-[#000638]"}),e.jsx("h4",{className:"font-bold text-sm text-[#000638]",children:"Ano"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Array.from({length:5},(a,t)=>new Date().getFullYear()-t).map(a=>e.jsx("button",{onClick:()=>qe(a),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${C===a?"bg-[#000638] text-white":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-300"}`,children:a},a))})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ"].map(a=>e.jsx("button",{onClick:()=>aa(a),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${j===a?"bg-[#000638] text-white":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-300"}`,children:a},a))}),e.jsxs("div",{className:"mt-3 text-xs text-gray-500",children:[e.jsx("span",{className:"font-medium",children:h==="atual"?"Visualização:":"Filtro ativo:"}),h==="atual"?e.jsxs(e.Fragment,{children:["Saldo por Conta",m!=="TODOS"&&` - ${m}`,e.jsxs("span",{className:"ml-2",children:["(",te.length," conta",te.length!==1?"s":"",")"]})]}):e.jsxs(e.Fragment,{children:[C," - ",j," - Dia ",y,m!=="TODOS"&&` - ${m}`,e.jsxs("span",{className:"ml-2",children:["(",R.length," registro",R.length!==1?"s":"",")"]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(re,{size:16,className:"text-[#000638]"}),e.jsxs("h4",{className:"font-bold text-sm text-[#000638]",children:["Filtro por Dia - ",j]})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Array.from({length:v(j)},(a,t)=>t+1).map(a=>e.jsx("button",{onClick:()=>V(a),className:`px-2 py-1 text-xs font-medium rounded-md transition-colors ${y===a?"bg-[#000638] text-white":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-300"}`,children:a},a))})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200 mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Me,{size:18,className:"text-[#000638]"}),e.jsx("h3",{className:"font-bold text-sm text-[#000638]",children:"Filtro por Banco"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>xe("TODOS"),className:`px-3 py-2 text-sm font-medium rounded-md transition-colors ${m==="TODOS"?"bg-[#000638] text-white":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-300"}`,children:"TODOS"}),P.map(a=>e.jsx("button",{onClick:()=>xe(a),className:`px-3 py-2 text-sm font-medium rounded-md transition-colors ${m===a?"bg-[#000638] text-white":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-300"}`,children:a},a))]})]}),ge&&e.jsx("div",{className:"mb-8 bg-red-100 border border-red-300 text-red-700 px-4 py-2 rounded text-center font-barlow",children:ge}),J&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-8 max-w-7xl mx-auto",children:[e.jsxs(le,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl bg-white",children:[e.jsx(ne,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ga,{size:18,className:"text-blue-600"}),e.jsx(ce,{className:"text-sm font-bold text-blue-700",children:h==="atual"?"Saldo + Limite CHQ Total":"Saldo Total do Dia"})]})}),e.jsxs(ie,{className:"pt-0 px-4 pb-4",children:[e.jsx("div",{className:`text-lg font-extrabold mb-1 break-words ${sa(H.saldoTotal)}`,children:U?e.jsx(me,{size:24,className:"animate-spin text-blue-600"}):A(H.saldoTotal)}),e.jsx(de,{className:"text-xs text-gray-500",children:h==="atual"?e.jsxs(e.Fragment,{children:["Soma de Saldo + Limite CHQ",m!=="TODOS"&&` - ${m}`]}):e.jsxs(e.Fragment,{children:[C," - ",j," - Dia ",y,m!=="TODOS"&&` - ${m}`]})})]})]}),e.jsxs(le,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl bg-white",children:[e.jsx(ne,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ha,{size:18,className:"text-green-600"}),e.jsx(ce,{className:"text-sm font-bold text-green-700",children:"Contas Positivas"})]})}),e.jsxs(ie,{className:"pt-0 px-4 pb-4",children:[e.jsx("div",{className:"text-2xl font-extrabold text-green-600 mb-1",children:U?e.jsx(me,{size:24,className:"animate-spin text-green-600"}):H.contasPositivas}),e.jsx(de,{className:"text-xs text-gray-500",children:h==="atual"?e.jsxs(e.Fragment,{children:["Contas com Saldo Positivo",m!=="TODOS"&&` - ${m}`]}):e.jsxs(e.Fragment,{children:[C," - ",j," - Dia ",y,m!=="TODOS"&&` - ${m}`]})})]})]}),e.jsxs(le,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl bg-white",children:[e.jsx(ne,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fa,{size:18,className:"text-red-600"}),e.jsx(ce,{className:"text-sm font-bold text-red-700",children:"Contas Negativas"})]})}),e.jsxs(ie,{className:"pt-0 px-4 pb-4",children:[e.jsx("div",{className:"text-2xl font-extrabold text-red-600 mb-1",children:U?e.jsx(me,{size:24,className:"animate-spin text-red-600"}):H.contasNegativas}),e.jsx(de,{className:"text-xs text-gray-500",children:h==="atual"?e.jsxs(e.Fragment,{children:["Contas com Saldo Negativo",m!=="TODOS"&&` - ${m}`]}):e.jsxs(e.Fragment,{children:[C," - ",j," - Dia ",y,m!=="TODOS"&&` - ${m}`]})})]})]})]}),J&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 font-barlow",children:h==="atual"?"Saldos Atuais por Conta":"Saldos por Conta"}),e.jsxs("button",{onClick:Ye,className:"px-4 py-2 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 shadow-sm",title:"Adicionar novo saldo manualmente",children:[e.jsx("span",{children:"+"}),"Adicionar Saldo"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-2 px-2 text-xs font-semibold text-gray-900 font-barlow cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>z("banco"),children:e.jsxs("div",{className:"flex items-center",children:["Banco",L("banco")]})}),e.jsx("th",{className:"text-left py-2 px-2 text-xs font-semibold text-gray-900 font-barlow cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>z("numero"),children:e.jsxs("div",{className:"flex items-center",children:["Conta",L("numero")]})}),e.jsx("th",{className:"text-center py-2 px-2 text-xs font-semibold text-gray-900 font-barlow cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>z("agencia"),children:e.jsxs("div",{className:"flex items-center justify-center",children:["Agência",L("agencia")]})}),e.jsx("th",{className:"text-center py-2 px-2 text-xs font-semibold text-gray-900 font-barlow cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>z("data_geracao"),children:e.jsxs("div",{className:"flex items-center justify-center",children:["Data",L("data_geracao")]})}),e.jsx("th",{className:"text-right py-2 px-2 text-xs font-semibold text-gray-900 font-barlow cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>z("saldo"),children:e.jsxs("div",{className:"flex items-center justify-end",children:["Saldo",L("saldo")]})}),e.jsx("th",{className:"text-center py-2 px-2 text-xs font-semibold text-gray-900 font-barlow",children:"Limite CHQ"}),e.jsx("th",{className:"text-right py-2 px-2 text-xs font-semibold text-gray-900 font-barlow",children:"Saldo + CHQ"}),e.jsx("th",{className:"text-center py-2 px-2 text-xs font-semibold text-gray-900 font-barlow",children:"Status"}),e.jsx("th",{className:"text-center py-2 px-2 text-xs font-semibold text-gray-900 font-barlow",children:"Tipo"}),e.jsx("th",{className:"text-center py-2 px-2 text-xs font-semibold text-gray-900 font-barlow",children:"Ações"})]})}),e.jsx("tbody",{children:te.map(a=>{var o;const t=a.registros&&a.registros.some(s=>s.nome_arquivo==="saldo_manual"),n=(o=a.registros)==null?void 0:o.find(s=>s.nome_arquivo==="saldo_manual");if(a.registros&&a.registros.length>0){const s=a.registros[0];s.hasOwnProperty("nome_arquivo")||console.error("❌ Campo nome_arquivo não encontrado no registro:",s)}return t&&n&&console.log("💰 Saldo manual encontrado:",{conta:a.numero,banco:a.banco,id:n.id,nome_arquivo:n.nome_arquivo}),a.registros&&a.registros.length>0&&console.log("📋 Registros da conta:",a.numero,a.registros.map(s=>({id:s.id,nome_arquivo:s.nome_arquivo,valor:s.valor}))),e.jsxs("tr",{className:`border-b border-gray-100 hover:bg-gray-50 ${t?"cursor-pointer bg-blue-50 hover:bg-blue-100":""}`,onClick:t?()=>Ke(n):void 0,children:[e.jsx("td",{className:"py-2 px-2 text-xs font-medium text-gray-900 font-barlow",children:a.banco||"N/A"}),e.jsx("td",{className:"py-2 px-2 text-xs text-gray-600 font-barlow",children:Ve(a.numero)}),e.jsx("td",{className:"py-2 px-2 text-xs text-center text-gray-600 font-barlow",children:a.agencia||"N/A"}),e.jsx("td",{className:"py-2 px-2 text-xs text-center text-gray-600 font-barlow",children:ja(a.data_geracao)||"N/A"}),e.jsx("td",{className:"py-2 px-2 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("span",{className:`font-semibold text-sm ${_e(a)} font-barlow`,children:A(a.saldo)}),ta(a.saldo)]})}),e.jsx("td",{className:"py-2 px-2 text-center",children:T===`${a.banco}_${a.numero}`?e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:k,onChange:s=>G(s.target.value),onClick:s=>s.stopPropagation(),onKeyPress:s=>Ze(s,a.banco,a.numero,E[`${a.banco}_${a.numero}`]),className:"w-24 px-2 py-1 text-xs border-2 border-blue-500 rounded focus:outline-none focus:ring-1 focus:ring-blue-300 focus:border-blue-600 bg-white shadow-sm",placeholder:"0,00",step:"0.01",min:"0",autoFocus:!0}),e.jsx("div",{className:"absolute -top-4 left-0 text-xs text-blue-600 font-medium",children:"Valor"})]}),e.jsx("div",{className:"flex gap-1",children:e.jsx("button",{onClick:s=>{s.stopPropagation(),Se()},className:"px-2 py-1 text-xs bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"Cancelar"})})]}):e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("button",{onClick:s=>{s.stopPropagation(),Je(a.banco,a.numero,E[`${a.banco}_${a.numero}`])},className:"text-sm font-bold text-yellow-600 hover:text-yellow-700 hover:underline transition-all duration-200 cursor-pointer",title:"Clique para editar o limite de cheque especial",children:E[`${a.banco}_${a.numero}`]?A(E[`${a.banco}_${a.numero}`]):"R$ 0,00"})})}),e.jsx("td",{className:"py-2 px-2 text-right",children:(()=>{const s=E[`${a.banco}_${a.numero}`]||0,c=(parseFloat(a.saldo)||0)+(parseFloat(s)||0);return e.jsx("span",{className:`font-semibold text-sm ${_e({saldo:c})} font-barlow`,children:A(c)})})()}),e.jsx("td",{className:"py-2 px-2 text-center",children:(()=>{const s=E[`${a.banco}_${a.numero}`]||0,c=(parseFloat(a.saldo)||0)+(parseFloat(s)||0);let d="",r="";return c>0?(d="bg-green-100 text-green-800",r="Positivo"):c<0?(d="bg-red-100 text-red-800",r="Negativo"):(d="bg-gray-100 text-gray-800",r="Zerado"),e.jsx("span",{className:`inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium ${d} font-barlow`,children:r})})()}),e.jsx("td",{className:"py-2 px-2 text-center",children:e.jsx("span",{className:`inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium ${t?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"} font-barlow`,children:t?"Manual":".RET"})}),e.jsx("td",{className:"py-2 px-2 text-center",children:t&&e.jsx("button",{onClick:s=>{s.stopPropagation(),I(n),Ee()},className:"text-red-600 hover:text-red-800 text-base font-bold",title:"Excluir saldo manual",children:"✕"})})]},a.numero)})})]})})]}),!J&&!U&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx(Me,{size:64,className:"text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2 font-barlow",children:"Nenhum saldo carregado"}),e.jsxs("p",{className:"text-gray-600 font-barlow",children:["Os dados são carregados automaticamente da tabela retorno_bancario.",h==="atual"?' Use o modo "Saldo Atual" para ver os saldos mais recentes de cada conta.':" Use os filtros acima para filtrar por período."]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg max-w-md mx-auto",children:e.jsxs("p",{className:"text-sm text-blue-700 font-barlow",children:[e.jsx("strong",{children:"Dica:"})," Os dados são extraídos dos arquivos .RET processados e armazenados no Supabase."]})})]}),Ue&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",children:e.jsx("div",{className:"bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4 transform transition-all",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 mb-4",children:e.jsx("span",{className:"text-2xl",children:"💰"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:K==="criar"?"Definir Limite":"Atualizar Limite"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:K==="criar"?`Deseja definir o limite de cheque especial para ${T} como ${A(parseFloat(k))}?`:`Deseja atualizar o limite de cheque especial para ${T} para ${A(parseFloat(k))}?`}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:Qe,disabled:Q,className:"px-4 py-2 text-sm bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:Ge,disabled:Q,className:"px-4 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 flex items-center gap-2",children:Q?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"✓"}),K==="criar"?"Definir":"Atualizar"]})})]})]})})}),Be&&g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",children:e.jsx("div",{className:"bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4 transform transition-all",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 mb-4",children:e.jsx("span",{className:"text-2xl",children:"📊"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Detalhes do Saldo Manual"}),e.jsxs("div",{className:"text-left space-y-3 mb-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Banco:"}),e.jsx("span",{className:"text-gray-900",children:g.banco_nome})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Agência:"}),e.jsx("span",{className:"text-gray-900",children:g.agencia})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Conta:"}),e.jsx("span",{className:"text-gray-900",children:g.conta})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Saldo:"}),e.jsx("span",{className:"text-gray-900 font-bold",children:A(g.valor)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Inserido por:"}),e.jsx("span",{className:"text-gray-900 font-medium",children:g.usuario_inseriu||((Ae=g.operacao_descricao)==null?void 0:Ae.replace("Saldo inserido manualmente por ",""))||"Usuário"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Data de Inclusão:"}),e.jsx("span",{className:"text-gray-900",children:new Date(g.created_at).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Hora de Inclusão:"}),e.jsx("span",{className:"text-gray-900",children:new Date(g.created_at).toLocaleTimeString("pt-BR")})]})]}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:$e,className:"px-4 py-2 text-sm bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors",children:"Fechar"}),e.jsx("button",{onClick:()=>{$e(),Ee()},className:"px-4 py-2 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Excluir Saldo"})]})]})})}),He&&g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",children:e.jsx("div",{className:"bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4 transform transition-all",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4",children:e.jsx("span",{className:"text-2xl",children:"⚠️"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"Confirmar Exclusão"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-6",children:["Tem certeza que deseja excluir o saldo manual de ",e.jsx("strong",{children:g.banco_nome})," - Agência ",e.jsx("strong",{children:g.agencia})," - Conta ",e.jsx("strong",{children:g.conta}),"?"]}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:We,disabled:ae,className:"px-4 py-2 text-sm bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:Xe,disabled:ae,className:"px-4 py-2 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 flex items-center gap-2",children:ae?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Excluindo..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"🗑️"}),"Excluir"]})})]})]})})}),Re&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-4 max-w-md w-full transform transition-all max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-10 w-10 rounded-full bg-blue-100 mb-3",children:e.jsx("span",{className:"text-xl",children:"🏦"})}),e.jsx("h3",{className:"text-base font-bold text-gray-900",children:"Adicionar Novo Saldo"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Preencha os dados da conta bancária"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Banco *"}),e.jsxs("select",{value:x.banco,onChange:a=>_(t=>({...t,banco:a.target.value})),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-600",required:!0,children:[e.jsx("option",{value:"",children:"Selecione um banco"}),P.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Agência *"}),e.jsx("input",{type:"text",value:x.agencia,onChange:a=>_(t=>({...t,agencia:a.target.value})),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-600",placeholder:"0000",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Número da Conta *"}),e.jsx("input",{type:"text",value:x.conta,onChange:a=>_(t=>({...t,conta:a.target.value})),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-600",placeholder:"00000000",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Saldo *"}),e.jsx("input",{type:"number",value:x.saldo,onChange:a=>_(t=>({...t,saldo:a.target.value})),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-600",placeholder:"0,00",step:"0.01",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Use valores negativos para saldos negativos"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Limite de Cheque Especial"}),e.jsx("input",{type:"number",value:x.chqEspecial,onChange:a=>_(t=>({...t,chqEspecial:a.target.value})),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-600",placeholder:"0,00 (opcional)",step:"0.01",min:"0"})]})]}),e.jsxs("div",{className:"flex gap-2 justify-center mt-4",children:[e.jsx("button",{onClick:Ce,disabled:W,className:"px-3 py-1 text-xs bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:ea,disabled:W,className:"px-3 py-1 text-xs bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 flex items-center gap-1",children:W?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"✓"}),"Salvar Saldo"]})})]})]})})]})})};export{_a as default};
