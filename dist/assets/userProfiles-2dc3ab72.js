import{I as o}from"./index-a2563983.js";const f=async e=>{try{const{id:r,...a}=e;l(a.level);const{data:t,error:s}=await o.from("user_profiles").insert([a]).select("*").single();if(s)throw s;return t}catch(r){throw r}},u=()=>({min:1,max:99}),l=e=>{const r=u();if(e<r.min||e>r.max)throw new Error(`Level inválido: ${e}. Deve estar entre ${r.min} e ${r.max}`);return!0},_=async()=>{try{const{data:e,error:r}=await o.auth.admin.listUsers();if(r)throw r;return e.users.map(a=>{var t,s;return{id:a.id,email:a.email,name:((t=a.user_metadata)==null?void 0:t.name)||"Sem nome",role:((s=a.user_metadata)==null?void 0:s.role)||"guest",active:!!a.email_confirmed_at,created_at:a.created_at,last_sign_in_at:a.last_sign_in_at}})}catch(e){throw e}},p=async e=>{var r,a;try{const{data:t,error:s}=await o.auth.admin.createUser({email:e.email,password:e.password,email_confirm:!0,user_metadata:{name:e.name,role:e.role}});if(s)throw s;return{id:t.user.id,email:t.user.email,name:(r=t.user.user_metadata)==null?void 0:r.name,role:(a=t.user.user_metadata)==null?void 0:a.role,active:!0,created_at:t.user.created_at}}catch(t){throw t}},y=async(e,r)=>{var a,t;try{const{data:s,error:n}=await o.auth.admin.listUsers();if(n)throw n;if(!s.users.find(m=>m.id===e))throw new Error("Usuário não encontrado");const c={user_metadata:{name:r.name,role:r.role}};r.password&&(c.password=r.password);const{data:i,error:d}=await o.auth.admin.updateUserById(e,c);if(d)throw d;return{id:i.user.id,email:i.user.email,name:(a=i.user.user_metadata)==null?void 0:a.name,role:(t=i.user.user_metadata)==null?void 0:t.role,active:!!i.user.email_confirmed_at,created_at:i.user.created_at}}catch(s){throw s}},U=async e=>{try{const{error:r}=await o.auth.admin.deleteUser(e);if(r)throw r;return!0}catch(r){throw r}},v=async(e,r=null)=>{try{const{data:a,error:t}=await o.auth.admin.listUsers();if(t)throw t;const s=a.users.find(n=>n.email===e);return!(!s||r&&s.id===r)}catch(a){throw a}},g=async(e,r,a)=>{try{const{data:t,error:s}=await o.auth.admin.updateUserById(e,{password:a});if(s)throw s;return{success:!0,message:"Senha alterada com sucesso"}}catch(t){throw t}};export{p as a,g as b,v as c,U as d,f as e,_ as f,y as u};
