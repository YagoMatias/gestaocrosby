import{I as c,r as u,j as e}from"./index-a2563983.js";import{e as f}from"./userProfiles-2dc3ab72.js";const p=async()=>{try{console.log("üîÑ Criando perfis padr√£o...");const o=[{name:"owner",label:"Propriet√°rio",color:"#4a59ff",description:"Acesso propriet√°rio",level:1},{name:"admin",label:"Administrador",color:"#ff4747",description:"Acesso total ao sistema",level:2},{name:"manager",label:"Gerente",color:"#59b65e",description:"Acesso a recursos de gest√£o",level:3},{name:"user",label:"Usu√°rio",color:"#f5b14c",description:"Acesso b√°sico ao sistema",level:4},{name:"guest",label:"Convidado",color:"#757575",description:"Acesso limitado para convidados",level:5}],l={success:[],errors:[],skipped:[]};for(const a of o)try{console.log(`üîÑ Criando perfil: ${a.name}`);const r=await f(a);l.success.push({name:a.name,action:"created",id:r.id}),console.log(`‚úÖ Perfil ${a.name} criado com sucesso`)}catch(r){r.message.includes("duplicate key")?(console.log(`‚ö†Ô∏è Perfil ${a.name} j√° existe, pulando...`),l.skipped.push({name:a.name,reason:"j√° existe"})):(console.error(`‚ùå Erro ao criar perfil ${a.name}:`,r),l.errors.push({name:a.name,error:r.message}))}return console.log(`
üìã Relat√≥rio de Cria√ß√£o de Perfis:`),console.log(`‚úÖ Sucessos: ${l.success.length}`),console.log(`‚ùå Erros: ${l.errors.length}`),console.log(`‚è≠Ô∏è Pulados: ${l.skipped.length}`),{success:!0,results:l,summary:{total:o.length,success:l.success.length,errors:l.errors.length,skipped:l.skipped.length}}}catch(o){return console.error("‚ùå Erro na cria√ß√£o de perfis:",o),{success:!1,error:o.message}}},b=async()=>{try{console.log("üîÑ Iniciando migra√ß√£o de usu√°rios..."),console.log("üìã Criando perfis padr√£o primeiro...");const o=await p();o.success||console.warn("‚ö†Ô∏è Erro ao criar perfis padr√£o, mas continuando...");const{data:l,error:a}=await c.from("user_profiles_antiga").select("*").eq("active",!0);if(a)throw new Error(`Erro ao buscar usu√°rios: ${a.message}`);console.log(`üìä Encontrados ${l.length} usu√°rios para migrar`);const r={success:[],errors:[],skipped:[]};for(const s of l)try{console.log(`üîÑ Migrando usu√°rio: ${s.email}`);const{data:t}=await c.auth.admin.getUserByEmail(s.email);if(t.user){console.log(`‚ö†Ô∏è Usu√°rio ${s.email} j√° existe no auth.users, atualizando metadata...`);const{error:n}=await c.auth.admin.updateUserById(t.user.id,{user_metadata:{name:s.name,role:s.role}});n?r.errors.push({email:s.email,error:`Erro ao atualizar metadata: ${n.message}`}):r.success.push({email:s.email,action:"updated"})}else{const{data:n,error:d}=await c.auth.admin.createUser({email:s.email,password:s.password||"senha123",email_confirm:!0,user_metadata:{name:s.name,role:s.role}});d?r.errors.push({email:s.email,error:`Erro ao criar usu√°rio: ${d.message}`}):r.success.push({email:s.email,action:"created",id:n.user.id})}}catch(t){console.error(`‚ùå Erro ao migrar usu√°rio ${s.email}:`,t),r.errors.push({email:s.email,error:t.message})}return console.log(`
üìã Relat√≥rio de Migra√ß√£o:`),console.log(`‚úÖ Sucessos: ${r.success.length}`),console.log(`‚ùå Erros: ${r.errors.length}`),console.log(`‚è≠Ô∏è Pulados: ${r.skipped.length}`),r.errors.length>0&&(console.log(`
‚ùå Erros detalhados:`),r.errors.forEach(s=>{console.log(`  - ${s.email}: ${s.error}`)})),{success:!0,results:r,profilesResult:o,summary:{total:l.length,success:r.success.length,errors:r.errors.length,skipped:r.skipped.length}}}catch(o){return console.error("‚ùå Erro na migra√ß√£o:",o),{success:!1,error:o.message}}},j=async(o,l,a,r="admin")=>{try{console.log(`üîÑ Criando usu√°rio de teste: ${o}`);const{data:s,error:t}=await c.auth.admin.createUser({email:o,password:l,email_confirm:!0,user_metadata:{name:a,role:r}});if(t)throw t;return console.log("‚úÖ Usu√°rio criado com sucesso:",s.user.id),{success:!0,user:s.user}}catch(s){return console.error("‚ùå Erro ao criar usu√°rio:",s),{success:!1,error:s.message}}},y=async()=>{try{console.log("üìã Listando usu√°rios do auth.users...");const{data:o,error:l}=await c.auth.admin.listUsers();if(l)throw l;return console.log(`‚úÖ Encontrados ${o.users.length} usu√°rios:`),o.users.forEach(a=>{var r;console.log(`  - ${a.email} (${((r=a.user_metadata)==null?void 0:r.role)||"sem role"})`)}),{success:!0,users:o.users}}catch(o){return console.error("‚ùå Erro ao listar usu√°rios:",o),{success:!1,error:o.message}}},N=()=>{const[o,l]=u.useState(!1),[a,r]=u.useState(null),[s,t]=u.useState({email:"",password:"",name:"",role:"admin"}),n=async()=>{l(!0),r(null);try{const i=await p();r(i)}catch(i){r({success:!1,error:i.message})}finally{l(!1)}},d=async()=>{l(!0),r(null);try{const i=await b();r(i)}catch(i){r({success:!1,error:i.message})}finally{l(!1)}},h=async()=>{l(!0),r(null);try{const i=await j(s.email,s.password,s.name,s.role);r(i),i.success&&t({email:"",password:"",name:"",role:"admin"})}catch(i){r({success:!1,error:i.message})}finally{l(!1)}},g=async()=>{l(!0),r(null);try{const i=await y();r(i)}catch(i){r({success:!1,error:i.message})}finally{l(!1)}};return e.jsxs("div",{className:"p-8 max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Teste de Autentica√ß√£o - Auth.Users"}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Criar Perfis Padr√£o"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Cria os perfis padr√£o (owner, admin, manager, user, guest) na tabela user_profiles"}),e.jsx("button",{onClick:n,disabled:o,className:"bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 disabled:opacity-50",children:o?"Criando...":"Criar Perfis Padr√£o"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Migra√ß√£o de Usu√°rios"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Migra usu√°rios da tabela user_profiles_antiga para o sistema auth.users do Supabase"}),e.jsx("button",{onClick:d,disabled:o,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:opacity-50",children:o?"Migrando...":"Migrar Usu√°rios"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Criar Novo Usu√°rio"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsx("input",{type:"email",placeholder:"Email",value:s.email,onChange:i=>t({...s,email:i.target.value}),className:"border border-gray-300 rounded px-3 py-2"}),e.jsx("input",{type:"password",placeholder:"Senha",value:s.password,onChange:i=>t({...s,password:i.target.value}),className:"border border-gray-300 rounded px-3 py-2"}),e.jsx("input",{type:"text",placeholder:"Nome",value:s.name,onChange:i=>t({...s,name:i.target.value}),className:"border border-gray-300 rounded px-3 py-2"}),e.jsxs("select",{value:s.role,onChange:i=>t({...s,role:i.target.value}),className:"border border-gray-300 rounded px-3 py-2",children:[e.jsx("option",{value:"owner",children:"Propriet√°rio"}),e.jsx("option",{value:"admin",children:"Administrador"}),e.jsx("option",{value:"manager",children:"Gerente"}),e.jsx("option",{value:"user",children:"Usu√°rio"}),e.jsx("option",{value:"guest",children:"Convidado"})]})]}),e.jsx("button",{onClick:h,disabled:o||!s.email||!s.password||!s.name,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:opacity-50",children:o?"Criando...":"Criar Usu√°rio"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Listar Usu√°rios"}),e.jsx("button",{onClick:g,disabled:o,className:"bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 disabled:opacity-50",children:o?"Listando...":"Listar Usu√°rios"})]}),a&&e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Resultado"}),e.jsx("div",{className:`p-4 rounded ${a.success?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a.success?e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"‚úÖ Sucesso!"}),a.summary&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{children:["Total: ",a.summary.total]}),e.jsxs("p",{children:["Sucessos: ",a.summary.success]}),e.jsxs("p",{children:["Erros: ",a.summary.errors]}),e.jsxs("p",{children:["Pulados: ",a.summary.skipped]})]}),a.profilesResult&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"font-semibold",children:"Perfis criados:"}),e.jsxs("p",{children:["Total: ",a.profilesResult.summary.total]}),e.jsxs("p",{children:["Sucessos: ",a.profilesResult.summary.success]}),e.jsxs("p",{children:["Erros: ",a.profilesResult.summary.errors]}),e.jsxs("p",{children:["Pulados: ",a.profilesResult.summary.skipped]})]}),a.users&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"font-semibold",children:"Usu√°rios encontrados:"}),e.jsx("ul",{className:"list-disc list-inside",children:a.users.map((i,x)=>{var m;return e.jsxs("li",{children:[i.email," (",((m=i.user_metadata)==null?void 0:m.role)||"sem role",")"]},x)})})]}),a.user&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{children:["Usu√°rio criado: ",a.user.email]}),e.jsxs("p",{children:["ID: ",a.user.id]})]})]}):e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"‚ùå Erro!"}),e.jsx("p",{children:a.error})]})})]})]})};export{N as default};
