import{r as n,j as e,P as Z,p as C,L as J,$ as X,b as ee,g as ae}from"./index-a2563983.js";import{u as se}from"./useApiClient-0bf86fc1.js";import{C as x,a as m,b as u,c as h,d as b}from"./cards-fd94db0b.js";import{C as te,a as re,L as oe,B as le,p as ie,b as ne,c as de,A as ce,h as xe,l as me,P as I,d as ue}from"./index-d0e9a633.js";import{p as he}from"./chartjs-plugin-datalabels.esm-5b853c4b.js";import{c as be}from"./ArrowDown.es-b2258871.js";import{s as R}from"./ChartPieSlice.es-9a55dc44.js";import{s as pe}from"./Funnel.es-cd3339ac.js";import{c as T}from"./Handshake.es-48d6d235.js";te.register(re,oe,le,ie,ne,de,ce,xe,me,he);const De=()=>{const E=se(),[w,S]=n.useState(null),F=new Date,P=new Date(F.getFullYear(),F.getMonth(),1),[v,O]=n.useState(P.toISOString().split("T")[0]),[j,G]=n.useState(F.toISOString().split("T")[0]),[p,U]=n.useState([]),[q,W]=n.useState([]),[B,M]=n.useState(!1),[z,D]=n.useState(""),l=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2,maximumFractionDigits:2}).format(a||0),H=async()=>{if(!v||!j){D("Por favor, selecione as datas de in√≠cio e fim");return}M(!0),D("");try{const a=await E.sales.faturamentoFranquias({dataInicio:v,dataFim:j}),s=c=>{if(!c)return[];if(Array.isArray(c))return c;if(Array.isArray(c.data))return c.data;if(c.data&&Array.isArray(c.data.data))return c.data.data;const V=Object.values(c).find(Y=>Array.isArray(Y));return V||[]},o=s(a);U(o);const i=new Date(v),r=new Date(j),d=Math.abs(r-i),g=Math.ceil(d/(1e3*60*60*24)),_=new Date(i);_.setDate(i.getDate()-g-1);const N=new Date(i);N.setDate(i.getDate()-1);const y=await E.sales.faturamentoFranquias({dataInicio:_.toISOString().split("T")[0],dataFim:N.toISOString().split("T")[0]}),Q=s(y);W(Q)}catch(a){console.error("Erro ao buscar dados de franquias:",a),D("Erro ao carregar dados de faturamento de franquias")}finally{M(!1)}},t=n.useMemo(()=>{if(!p.length)return null;console.log("üìä Consolidando dados de Franquias...");const a=p.reduce((s,o)=>{const i=parseFloat(o.valor_sem_desconto_saida)||0,r=parseFloat(o.valor_sem_desconto_entrada)||0,d=parseFloat(o.valor_com_desconto_saida)||0,g=parseFloat(o.valor_com_desconto_entrada)||0;return s.valor_bruto_saida+=i,s.valor_bruto_entrada+=r,s.valor_liquido_saida+=d,s.valor_liquido_entrada+=g,s},{valor_bruto_saida:0,valor_bruto_entrada:0,valor_liquido_saida:0,valor_liquido_entrada:0});return a.valor_bruto_total=a.valor_bruto_saida+a.valor_bruto_entrada,a.valor_liquido_total=a.valor_liquido_saida+a.valor_liquido_entrada,a.desconto_saida=a.valor_bruto_saida-a.valor_liquido_saida,a.desconto_entrada=a.valor_bruto_entrada-a.valor_liquido_entrada,a.desconto_total=a.desconto_saida+a.desconto_entrada,a.receita_liquida=a.valor_liquido_saida-Math.abs(a.valor_liquido_entrada),a},[p]),L=n.useMemo(()=>{if(!q.length)return null;const a=q.reduce((s,o)=>{const i=parseFloat(o.valor_com_desconto_saida)||0,r=parseFloat(o.valor_com_desconto_entrada)||0;return s.valor_liquido_saida+=i,s.valor_liquido_entrada+=r,s},{valor_liquido_saida:0,valor_liquido_entrada:0});return a.receita_liquida=a.valor_liquido_saida-Math.abs(a.valor_liquido_entrada),a},[q]),f=(()=>{if(!t||!L)return{variacao:null,anterior:0};const a=t.receita_liquida,s=L.receita_liquida;return s===0?{variacao:a>0?100:0,anterior:s}:{variacao:(a-s)/Math.abs(s)*100,anterior:s}})(),A=n.useMemo(()=>{if(!p.length)return null;const a=new Map;p.forEach(r=>{const d=r.cd_grupoempresa||r.cd_empresa,g=r.nm_grupoempresa||r.cd_grupoempresa||`Empresa ${r.cd_empresa}`,_=parseFloat(r.valor_com_desconto_saida)||0,N=parseFloat(r.valor_com_desconto_entrada)||0,y=_-Math.abs(N);a.has(d)?a.get(d).valor+=y:a.set(d,{nome:g,valor:y})});const s=Array.from(a.values()),o=s.map(r=>r.nome),i=s.map(r=>r.valor);return{labels:o,datasets:[{data:i,backgroundColor:["#F59E0B","#3B82F6","#10B981","#EF4444","#6366F1","#F472B6","#F87171","#34D399","#A78BFA","#FBBF24","#6EE7B7","#F9A8D4","#FDE68A","#C7D2FE","#FCA5A5","#A3E635","#FCD34D","#818CF8","#FECACA","#F3F4F6"],borderWidth:2,borderColor:"#fff"}]}},[p]),k=n.useMemo(()=>t?{labels:["Vendas (Sa√≠da)","Devolu√ß√µes (Entrada)"],datasets:[{label:"Valor Bruto",data:[t.valor_bruto_saida,Math.abs(t.valor_bruto_entrada)],backgroundColor:"#F59E0B"},{label:"Valor L√≠quido",data:[t.valor_liquido_saida,Math.abs(t.valor_liquido_entrada)],backgroundColor:"#D97706"},{label:"Descontos",data:[t.desconto_saida,Math.abs(t.desconto_entrada)],backgroundColor:"#FBBF24"}]}:null,[t]),$={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{boxWidth:15,padding:10,font:{size:11}}},datalabels:{color:"#fff",font:{weight:"bold",size:11},formatter:(a,s)=>{const o=s.chart.data.datasets[0].data.reduce((r,d)=>r+d,0),i=(a/o*100).toFixed(1);return i>3?`${i}%`:""}},tooltip:{callbacks:{label:a=>{const s=a.label||"",o=l(a.parsed);return`${s}: ${o}`}}}}},K={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},datalabels:{display:!1},tooltip:{callbacks:{label:a=>{const s=a.dataset.label||"",o=l(a.parsed.y);return`${s}: ${o}`}}}},scales:{y:{beginAtZero:!0,ticks:{callback:a=>l(a)}}}};return e.jsxs("div",{className:"w-full max-w-7xl mx-auto p-4",children:[e.jsx(Z,{title:"Dashboard Franquias",subtitle:"An√°lise completa do faturamento do canal Franquias",icon:T,iconColor:"text-yellow-600"}),e.jsx("div",{className:"mb-4",children:e.jsxs("form",{className:"flex flex-col bg-white p-3 rounded-lg shadow-lg w-full max-w-4xl mx-auto border border-[#000638]/10 gap-5 p-5",children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("span",{className:"text-lg font-bold text-[#000638] flex items-center gap-1",children:[e.jsx(pe,{size:18,weight:"bold"}),"Filtros"]}),e.jsx("span",{className:"text-xs text-gray-500 mt-1",children:"Selecione o per√≠odo para an√°lise"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-5 mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-0.5 text-[#000638]",children:"Data In√≠cio"}),e.jsx("input",{type:"date",value:v,onChange:a=>O(a.target.value),className:"border border-[#000638]/30 rounded-lg px-2 py-1.5 w-full focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] placeholder:text-gray-400 text-xs"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-0.5 text-[#000638]",children:"Data Fim"}),e.jsx("input",{type:"date",value:j,onChange:a=>G(a.target.value),className:"border border-[#000638]/30 rounded-lg px-2 py-1.5 w-full focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] placeholder:text-gray-400 text-xs"})]}),e.jsx("div",{className:"mt-4 flex gap-2",children:e.jsxs("button",{onClick:H,disabled:B,type:"button",className:"flex items-center gap-1 bg-[#000638] text-white px-3 py-1 rounded-lg hover:bg-[#fe0000] disabled:opacity-50 disabled:cursor-not-allowed font-medium transition-colors h-7 text-xs font-bold shadow-md tracking-wide uppercase",children:[e.jsx(C,{size:16}),"Buscar Dados"]})})]})]})}),z&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md mb-6",children:z}),B?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(J,{})}):t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs(x,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl bg-white",children:[e.jsx(m,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{size:18,className:"text-green-600"}),e.jsx(u,{className:"text-sm font-bold text-green-700",children:"Receita L√≠quida"})]})}),e.jsxs(h,{className:"pt-0 px-4 pb-4",children:[e.jsx("div",{className:"text-xl font-extrabold text-green-600 mb-0.5",children:l(t.receita_liquida)}),e.jsxs(b,{className:"text-xs text-gray-500",children:["Per√≠odo anterior: ",l(f.anterior)]}),f.variacao!==null&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("span",{className:`font-bold ${f.variacao>=0?"text-green-600":"text-red-600"} text-base`,children:[f.variacao>=0?"+":"",f.variacao.toFixed(1),"%"]}),e.jsx("span",{className:"text-xs text-gray-500",children:"vs. anterior"})]})]})]}),e.jsxs(x,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl bg-white",children:[e.jsx(m,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{size:18,className:"text-blue-600"}),e.jsx(u,{className:"text-sm font-bold text-blue-700",children:"Faturamento Bruto"})]})}),e.jsxs(h,{className:"pt-0 px-4 pb-4",children:[e.jsx("div",{className:"text-xl font-extrabold text-blue-600 mb-0.5",children:l(t.valor_bruto_saida)}),e.jsx(b,{className:"text-xs text-gray-500",children:"Sem descontos (sa√≠das)"})]})]}),e.jsxs(x,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl bg-white",children:[e.jsx(m,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{size:18,className:"text-orange-600"}),e.jsx(u,{className:"text-sm font-bold text-orange-700",children:"Descontos Dados"})]})}),e.jsxs(h,{className:"pt-0 px-4 pb-4",children:[e.jsx("div",{className:"text-xl font-extrabold text-orange-600 mb-0.5",children:l(t.desconto_total)}),e.jsx(b,{className:"text-xs text-gray-500",children:"Total de descontos"})]})]}),e.jsxs(x,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl bg-white",children:[e.jsx(m,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{size:18,className:"text-red-600"}),e.jsx(u,{className:"text-sm font-bold text-red-700",children:"Devolu√ß√µes"})]})}),e.jsxs(h,{className:"pt-0 px-4 pb-4",children:[e.jsx("div",{className:"text-xl font-extrabold text-red-600 mb-0.5",children:l(Math.abs(t.valor_liquido_entrada))}),e.jsx(b,{className:"text-xs text-gray-500",children:"Valores devolvidos"})]})]})]}),e.jsxs(x,{className:"shadow-lg transition-all duration-200 hover:shadow-xl rounded-xl bg-white mb-6",children:[e.jsxs(m,{className:"pb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{size:20,className:"text-[#000638]"}),e.jsx(u,{className:"text-lg font-bold text-[#000638]",children:"Detalhamento Franquias"})]}),e.jsx(b,{children:"Resumo financeiro completo do canal Franquias"})]}),e.jsx(h,{className:"bg-white",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"flex justify-between items-center mb-1",children:e.jsx("span",{className:"text-sm font-semibold text-blue-700",children:"VENDAS (SA√çDA)"})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Valor Bruto:"}),e.jsx("span",{className:"font-bold text-blue-600 text-sm",children:l(t.valor_bruto_saida)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Valor L√≠quido:"}),e.jsx("span",{className:"font-bold text-green-600 text-sm",children:l(t.valor_liquido_saida)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Descontos:"}),e.jsx("span",{className:"font-bold text-orange-600 text-sm",children:l(t.desconto_saida)})]})]}),e.jsxs("div",{className:"border-b pb-2",children:[e.jsx("div",{className:"flex justify-between items-center mb-1",children:e.jsx("span",{className:"text-sm font-semibold text-red-700",children:"DEVOLU√á√ïES (ENTRADA)"})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Valor Bruto:"}),e.jsx("span",{className:"font-bold text-red-600 text-sm",children:l(Math.abs(t.valor_bruto_entrada))})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Valor L√≠quido:"}),e.jsx("span",{className:"font-bold text-red-500 text-sm",children:l(Math.abs(t.valor_liquido_entrada))})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Descontos:"}),e.jsx("span",{className:"font-bold text-orange-600 text-sm",children:l(Math.abs(t.desconto_entrada))})]})]}),e.jsxs("div",{className:"border-t pt-2",children:[e.jsx("div",{className:"flex justify-between items-center mb-1",children:e.jsx("span",{className:"text-sm font-bold text-gray-800",children:"RECEITA L√çQUIDA"})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Vendas - Devolu√ß√µes:"}),e.jsx("span",{className:"font-bold text-green-600 text-lg",children:l(t.receita_liquida)})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[A&&e.jsxs(x,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl bg-white cursor-pointer",onClick:()=>S({title:"Franquias - Faturamento por Empresa",data:A}),children:[e.jsxs(m,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{size:20,className:"text-[#000638]"}),e.jsx(u,{className:"text-lg font-bold text-[#000638]",children:"Franquias - Faturamento por Empresa"})]}),e.jsx(b,{children:"Distribui√ß√£o do faturamento por empresa (Franquias)"})]}),e.jsx(h,{children:e.jsx("div",{className:"h-80 bg-white rounded",children:e.jsx(I,{data:A,options:$})})})]}),k&&e.jsxs(x,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl bg-white",children:[e.jsxs(m,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{size:20,className:"text-[#000638]"}),e.jsx(u,{className:"text-lg font-bold text-[#000638]",children:"Comparativo de Valores"})]}),e.jsx(b,{children:"Bruto vs L√≠quido vs Descontos"})]}),e.jsx(h,{children:e.jsx("div",{className:"h-80 bg-white rounded",children:e.jsx(ue,{data:k,options:K})})})]})]}),w&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-3xl w-full flex flex-col items-center relative",children:[e.jsx("button",{onClick:()=>S(null),className:"absolute top-4 right-4 text-gray-500 hover:text-red-600 text-2xl font-bold","aria-label":"Fechar",children:"√ó"}),e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx(R,{size:28,className:"text-[#000638]"}),e.jsx("span",{className:"text-2xl font-bold text-[#000638]",children:w.title})]}),e.jsx("div",{className:"w-full flex items-center justify-center",style:{height:"480px"},children:e.jsx(I,{data:w.data,options:$})})]})})]}):e.jsx("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:e.jsxs("div",{className:"bg-gray-50 rounded-xl p-8 max-w-md",children:[e.jsx(C,{size:48,className:"text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"Nenhum dado encontrado"}),e.jsx("p",{className:"text-gray-500 text-sm mb-4",children:'Selecione um per√≠odo e clique em "Buscar Dados" para visualizar o dashboard de Franquias.'})]})})]})};export{De as default};
