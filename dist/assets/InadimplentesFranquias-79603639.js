import{r as n,j as e,P as ne,v as P,q as ie,b as oe,L as $}from"./index-a2563983.js";import{F as ce,a as de,p as xe}from"./FiltroClientes-5e02171e.js";import{u as me}from"./useApiClient-0bf86fc1.js";import{C as x,a as m,b as p,c as h,d as u}from"./cards-fd94db0b.js";import{C as pe,a as he,L as ue,B as fe,p as be,b as ge,c as je,A as Ne,d as q}from"./index-d0e9a633.js";import{s as ye}from"./CircleNotch.es-295869f9.js";import{m as ve}from"./CurrencyDollar.es-0edca053.js";pe.register(he,ue,fe,be,ge,je,Ne);const Ee=()=>{const D=me(),[d,M]=n.useState([]),[v,S]=n.useState(!1),[_,V]=n.useState("2024-04-01"),W=new Date().toISOString().slice(0,10),[w,Z]=n.useState(W),[f,H]=n.useState([]),[b,J]=n.useState([]),[G,E]=n.useState(!1),[o,k]=n.useState(null),[K,L]=n.useState([]),[Q,g]=n.useState(!1),[C,I]=n.useState([]),[U,B]=n.useState(!1),A=async()=>{try{S(!0);const s={dt_vencimento_ini:"2024-01-01"};_&&(s.dt_inicio=_),w&&(s.dt_fim=w);const a=await D.financial.inadimplentesFranquias(s);let t=[];a!=null&&a.success&&(a!=null&&a.data)?t=Array.isArray(a.data)?a.data:[]:Array.isArray(a)&&(t=a),console.log("ðŸ“Š Dados recebidos de inadimplentes Franquias:",t),M(t)}catch(s){console.error("Erro ao buscar dados de inadimplentes:",s),M([])}finally{S(!1)}};n.useEffect(()=>{A()},[]);const j=n.useMemo(()=>d.filter(s=>{const a=f.length===0||f.includes(String(s.cd_cliente)),t=s.pp&&s.pp.ds_uf?String(s.pp.ds_uf).trim():(s.ds_uf||"").trim(),l=b.length===0||b.includes(t);if(!s.dt_vencimento)return!1;const r=new Date,i=new Date(s.dt_vencimento),y=r-i,re=Math.floor(y/(1e3*60*60*24))>=1;return a&&re&&l}),[d,f,b]),X=n.useMemo(()=>{const s=new Set;return d.forEach(a=>{const t=a.pp&&a.pp.ds_uf?String(a.pp.ds_uf).trim():(a.ds_uf||"").trim();t&&s.add(t)}),Array.from(s).filter(Boolean).sort()},[d]),Y=n.useMemo(()=>{const s=new Map;return(d||[]).forEach(a=>{if(a.cd_cliente){const t=String(a.cd_cliente);if(!s.has(t)){const l=a.nm_fantasia||a.nm_cliente||t;s.set(t,{cd_cliente:t,nm_cliente:l})}}}),Array.from(s.values()).sort((a,t)=>a.nm_cliente>t.nm_cliente?1:-1)},[d]),c=n.useMemo(()=>{const s=j.reduce((a,t)=>{const l=t.cd_cliente;return a[l]||(a[l]={cd_cliente:l,nm_fantasia:t.nm_fantasia||null,nm_cliente:t.nm_cliente||null,ds_uf:t.pp&&t.pp.ds_uf?String(t.pp.ds_uf).trim():t.ds_uf||null,valor_total:0,faturas:[]}),a[l].valor_total+=parseFloat(t.vl_fatura)||0,a[l].faturas.push(t),a},{});return Object.values(s)},[j]),T=n.useMemo(()=>{const s=c.length,a=c.reduce((t,l)=>t+l.valor_total,0);return{totalClientes:s,valorTotal:a}},[c]),z=n.useMemo(()=>{const s=j.reduce((l,r)=>{const i=(r.pp&&r.pp.ds_uf?String(r.pp.ds_uf).trim():r.ds_uf||"").trim()||"NÃ£o informado";return l[i]||(l[i]={clientes:0,valor:0}),l[i].clientes+=1,l[i].valor+=parseFloat(r.vl_fatura)||0,l},{}),a=Object.keys(s),t=a.map(l=>s[l].clientes);return{estados:a,clientesPorEstado:t}},[j]),F=n.useMemo(()=>!c||c.length===0?[]:[...c].sort((a,t)=>t.valor_total-a.valor_total).slice(0,10).map(a=>{const t=(a.faturas||[]).reduce((l,r)=>{if(!r.dt_vencimento)return l;const i=Math.floor((new Date-new Date(r.dt_vencimento))/(1e3*60*60*24));return Math.max(l,i)},0);return{...a,diasAtrasoMax:t}}),[c]),ee={labels:F.map(s=>s.nm_cliente?s.nm_cliente:s.cd_cliente),datasets:[{label:"Valor Inadimplente (R$)",data:F.map(s=>Number(s.valor_total||0)),backgroundColor:"#000638",borderColor:"#000638",borderWidth:1}]},se={labels:z.estados,datasets:[{label:"Clientes",data:z.clientesPorEstado,backgroundColor:"#000638",borderColor:"#000638",borderWidth:1}]},N=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s||0),R=s=>s?new Date(s).toLocaleDateString("pt-BR"):"N/A",ae=s=>{if(!s)return"N/A";const a=new Date,t=new Date(s),l=a-t,r=Math.floor(l/(1e3*60*60*24));if(r<=0)return"0 dias";if(r===1)return"1 dia";if(r<30)return`${r} dias`;if(r<365){const y=Math.floor(r/30);return y===1?"1 mÃªs":`${y} meses`}const i=Math.floor(r/365);return i===1?"1 ano":`${i} anos`},te=s=>{k(s),L(s.faturas),E(!0)},le=async s=>{try{B(!0);const a=(o==null?void 0:o.cd_cliente)||s.cd_cliente||"",t=s.nr_fat||s.nr_fatura||"",l=await D.financial.obsFati({cd_cliente:a,nr_fat:t});let r=[];l&&l.success&&Array.isArray(l.data)?r=l.data:Array.isArray(l)&&(r=l),I(r),g(!0)}catch(a){console.error("Erro ao carregar observaÃ§Ãµes da fatura",a),I([]),g(!0)}finally{B(!1)}},O=()=>{E(!1),k(null),L([])};return e.jsxs("div",{className:"w-full max-w-7xl mx-auto py-6 px-4 space-y-6",children:[e.jsx(ne,{title:"InadimplÃªncia Franquias",subtitle:"Acompanhe os clientes inadimplentes das Franquias",icon:P,iconColor:"text-purple-600"}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border mb-6",children:e.jsxs("form",{onSubmit:s=>{s.preventDefault(),A()},children:[e.jsx("div",{className:"text-sm font-semibold text-[#000638] mb-2",children:"ConfiguraÃ§Ãµes para anÃ¡lise de InadimplÃªncia - Franquias"}),e.jsx("span",{className:"text-xs text-gray-500 mt-1",children:"Filtros para consulta de clientes inadimplentes"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 mb-3 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-0.5 text-[#000638]",children:"Data Inicial"}),e.jsx("input",{type:"date",value:_,onChange:s=>V(s.target.value),className:"border border-[#000638]/30 rounded-lg px-2 py-1.5 w-full focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] text-xs"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-0.5 text-[#000638]",children:"Data Final"}),e.jsx("input",{type:"date",value:w,onChange:s=>Z(s.target.value),className:"border border-[#000638]/30 rounded-lg px-2 py-1.5 w-full focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] text-xs"})]}),e.jsx("div",{className:"col-span-1",children:e.jsx(ce,{clientes:Y,selected:f,onChange:H})}),e.jsx("div",{className:"col-span-1",children:e.jsx(de,{estados:X,selected:b,onChange:J})})]}),e.jsx("div",{className:"mt-4 flex gap-2",children:e.jsx("button",{onClick:A,disabled:v,className:"flex items-center gap-1 bg-[#000638] text-white px-3 py-1 rounded-lg hover:bg-[#fe0000] disabled:opacity-50 disabled:cursor-not-allowed font-medium transition-colors h-7 text-xs font-bold shadow-md tracking-wide uppercase",children:v?e.jsxs("div",{className:"inline-flex items-center gap-2",children:[e.jsx(ye,{size:16,className:"animate-spin"}),e.jsx("span",{children:"Carregando..."})]}):"Buscar Dados"})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs(x,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl bg-white",children:[e.jsx(m,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{size:18,className:"text-blue-600"}),e.jsx(p,{className:"text-sm font-bold text-blue-700",children:"Total de Clientes"})]})}),e.jsxs(h,{className:"pt-0 px-4 pb-4",children:[e.jsx("div",{className:"text-base font-extrabold text-blue-600 mb-0.5",children:T.totalClientes}),e.jsx(u,{className:"text-xs text-gray-500",children:"Clientes inadimplentes"})]})]}),e.jsxs(x,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl bg-white",children:[e.jsx(m,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{size:18,className:"text-green-600"}),e.jsx(p,{className:"text-sm font-bold text-green-700",children:"Valor Total"})]})}),e.jsxs(h,{className:"pt-0 px-4 pb-4",children:[e.jsx("div",{className:"text-base font-extrabold text-green-600 mb-0.5",children:N(T.valorTotal)}),e.jsx(u,{className:"text-xs text-gray-500",children:"Valor em aberto"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs(x,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl bg-white",children:[e.jsx(m,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{size:18,className:"text-blue-600"}),e.jsx(p,{className:"text-sm font-bold text-blue-700",children:"TOP CLIENTES INADIMPLENTES"})]})}),e.jsxs(h,{className:"pt-0 px-4 pb-4",children:[e.jsx(u,{className:"text-xs text-gray-500 mb-3",children:"VisÃ£o geral dos dados de inadimplÃªncia"}),e.jsx("div",{className:"h-64",children:e.jsx(q,{data:ee,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(s){const a=s.dataIndex,t=F[a],l=s.dataset.data[a]||0,r=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(l),i=(t==null?void 0:t.diasAtrasoMax)??0;return`${r} â€” ${i} dias em atraso`}}}},scales:{y:{beginAtZero:!0}}}})})]})]}),e.jsxs(x,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl bg-white",children:[e.jsx(m,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{size:18,className:"text-green-600"}),e.jsx(p,{className:"text-sm font-bold text-green-700",children:"Clientes por Estado"})]})}),e.jsxs(h,{className:"pt-0 px-4 pb-4",children:[e.jsx(u,{className:"text-xs text-gray-500 mb-3",children:"DistribuiÃ§Ã£o de inadimplentes por estado"}),e.jsx("div",{className:"h-64",children:e.jsx(q,{data:se,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}})})]})]})]}),e.jsxs(x,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl bg-white",children:[e.jsx(m,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{size:18,className:"text-purple-600"}),e.jsx(p,{className:"text-sm font-bold text-purple-700",children:"Lista de Clientes Inadimplentes"})]})}),e.jsxs(h,{className:"pt-0 px-4 pb-4",children:[e.jsx(u,{className:"text-xs text-gray-500 mb-4",children:"Detalhes completos dos clientes em situaÃ§Ã£o de inadimplÃªncia"}),v?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx($,{size:"md",text:"Carregando dados..."})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"CÃ³digo Cliente"}),e.jsx("th",{className:"px-4 py-3",children:"Nome Fantasia"}),e.jsx("th",{className:"px-4 py-3",children:"Nome Cliente"}),e.jsx("th",{className:"px-4 py-3",children:"Estado"}),e.jsx("th",{className:"px-4 py-3",children:"Valor Total"})]})}),e.jsx("tbody",{children:c.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-8 text-center text-gray-500",children:"Nenhum cliente inadimplente encontrado"})}):c.map((s,a)=>e.jsxs("tr",{className:"bg-white border-b hover:bg-blue-50 cursor-pointer transition-colors",onClick:()=>te(s),children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:s.cd_cliente||"N/A"}),e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:s.nm_fantasia||"---"}),e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:s.nm_cliente||"N/A"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded",children:s.ds_uf||"N/A"})}),e.jsx("td",{className:"px-4 py-3 font-medium text-green-600",children:N(s.valor_total)})]},a))})]})})]})]}),G&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Detalhes das Faturas -"," ",(o==null?void 0:o.nm_fantasia)||(o==null?void 0:o.nm_cliente)]}),e.jsx("button",{onClick:O,className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Empresa"}),e.jsx("th",{className:"px-4 py-3",children:"NÂº Fatura"}),e.jsx("th",{className:"px-4 py-3",children:"EmissÃ£o"}),e.jsx("th",{className:"px-4 py-3",children:"Vencimento"}),e.jsx("th",{className:"px-4 py-3",children:"Valor Fatura"}),e.jsx("th",{className:"px-4 py-3",children:"Juros"}),e.jsx("th",{className:"px-4 py-3",children:"Parcela"}),e.jsx("th",{className:"px-4 py-3",children:"Tempo InadimplÃªncia"})]})}),e.jsx("tbody",{children:K.map((s,a)=>e.jsxs("tr",{className:"bg-white border-b hover:bg-gray-50 cursor-pointer",onClick:()=>le(s),children:[e.jsx("td",{className:"px-4 py-3",children:s.cd_empresa||"N/A"}),e.jsx("td",{className:"px-4 py-3",children:s.nr_fat||s.nr_fatura||"N/A"}),e.jsx("td",{className:"px-4 py-3",children:R(s.dt_emissao)}),e.jsx("td",{className:"px-4 py-3",children:R(s.dt_vencimento)}),e.jsx("td",{className:"px-4 py-3 font-medium text-green-600",children:N(s.vl_fatura)}),e.jsx("td",{className:"px-4 py-3 font-medium text-red-600",children:N(s.vl_juros)}),e.jsx("td",{className:"px-4 py-3",children:s.nr_parcela||"N/A"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"bg-yellow-100 text-yellow-800 text-xs font-medium px-2 py-1 rounded",children:ae(s.dt_vencimento)})})]},a))})]})}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:O,className:"px-4 py-2 bg-[#000638] text-white rounded hover:bg-[#fe0000] transition-colors",children:"Fechar"})})]})}),Q&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",style:{zIndex:99999},children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-3xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"ObservaÃ§Ãµes da Fatura"}),e.jsx("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"mb-4",children:U?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx($,{size:"sm",text:"Carregando observaÃ§Ãµes..."})}):C&&C.length>0?e.jsx("ul",{className:"list-disc pl-5 space-y-2",children:C.map((s,a)=>e.jsx("li",{className:"text-sm text-gray-700",children:s.ds_observacao},a))}):e.jsx("div",{className:"text-sm text-gray-500",children:"Nenhuma observaÃ§Ã£o encontrada para esta fatura."})}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:()=>g(!1),className:"px-4 py-2 bg-[#000638] text-white rounded hover:bg-[#fe0000] transition-colors",children:"Fechar"})})]})})]})};export{Ee as default};
