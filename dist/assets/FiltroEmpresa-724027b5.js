import{r as t,j as e}from"./index-a2563983.js";const _=({empresasSelecionadas:o=[],onSelectEmpresas:n,apenasEmpresa101:j=!1})=>{const[i,u]=t.useState(!1),[m,v]=t.useState(""),[x,g]=t.useState([]),[d,h]=t.useState(!0),p=t.useRef(null),f=j?["1","2","5","6","7","11","31","55","65","75","85","90","91","92","93","94","95","96","97","98","99","100","101","111","200","311","500","550","600","650","700","750","850","890","910","920","930","940","950","960","970","980","990","12","13","14","15","16"]:["1","2","5","6","7","11","31","55","65","75","85","90","91","92","93","94","95","96","97","98","99","100","101","111","200","311","500","550","600","650","700","750","850","890","910","920","930","940","950","960","970","980","990","12","13","14","15","16"];t.useEffect(()=>{(async()=>{h(!0);try{console.log("ðŸ” Buscando empresas da API...");const a=await fetch("https://apigestaocrosby-bw2v.onrender.com/api/company/empresas");if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const s=await a.json();if(console.log("ðŸ“Š Resposta da API:",s),s.data&&typeof s.data=="object"){console.log("ðŸ“Š Estrutura do data:",s.data);let l=[];if(s.data.data&&Array.isArray(s.data.data))l=s.data.data,console.log(`âœ… Recebidas ${l.length} empresas da API`);else if(Array.isArray(s.data))l=s.data,console.log(`âœ… Recebidas ${l.length} empresas da API (data direto)`);else throw console.log("ðŸ“Š Propriedades disponÃ­veis em data:",Object.keys(s.data)),new Error("Estrutura de dados nÃ£o reconhecida");const y=l.filter(c=>f.includes(c.cd_empresa.toString()));console.log(`ðŸ” Empresas filtradas: ${y.length} de ${l.length}`);const w=y.sort((c,C)=>parseInt(c.cd_empresa)-parseInt(C.cd_empresa));g(w),console.log("âœ… Empresas carregadas com sucesso:",w.map(c=>`${c.cd_empresa} - ${c.nm_grupoempresa}`))}else throw new Error("Formato de resposta invÃ¡lido da API")}catch(a){console.error("âŒ Erro ao buscar empresas:",a),g(f.map(s=>({cd_empresa:s,nm_grupoempresa:`CROSBY FILIAL ${s}`})))}finally{h(!1)}})()},[]);const b=x.filter(r=>r.cd_empresa.toLowerCase().includes(m.toLowerCase())||r.nm_grupoempresa.toLowerCase().includes(m.toLowerCase())),N=r=>{let a;o.some(s=>s.cd_empresa===r.cd_empresa)?a=o.filter(s=>s.cd_empresa!==r.cd_empresa):a=[...o,r],n&&n(a)};return t.useEffect(()=>{const r=a=>{p.current&&!p.current.contains(a.target)&&u(!1)};return document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r)}},[]),e.jsxs("div",{className:"flex flex-col relative",ref:p,children:[e.jsx("label",{className:"block text-xs font-semibold mb-0.5 text-[#000638]",children:"Empresas"}),e.jsxs("button",{type:"button",onClick:()=>u(!i),disabled:d,className:"border border-[#000638]/30 rounded-lg px-2 py-1.5 w-full focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] text-left flex items-center justify-between disabled:opacity-50 disabled:cursor-not-allowed text-xs",children:[e.jsx("span",{className:"truncate",children:d?"Carregando empresas...":o.length===0?"Selecione as empresas":`${o.length} empresa(s) selecionada(s)`}),d?e.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):e.jsx("svg",{className:`w-4 h-4 transition-transform ${i?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),i&&e.jsxs("div",{className:"w-full absolute top-full left-0 right-0 z-50 bg-white border border-gray-300 rounded-lg shadow-lg mt-1 max-h-100 overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-gray-200",children:e.jsx("input",{type:"text",placeholder:"Buscar empresa...",value:m,onChange:r=>v(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#000638] text-sm"})}),e.jsxs("div",{className:"p-3 border-b border-gray-200 bg-gray-50 flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{n&&n([...x])},className:"text-xs px-2 py-1 bg-[#000638] text-white rounded hover:bg-[#fe0000] transition-colors",children:"Selecionar Todas"}),e.jsx("button",{type:"button",onClick:()=>{n&&n([])},className:"text-xs px-2 py-1 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"Limpar"})]}),e.jsx("div",{className:"w-full max-h-48 overflow-y-auto",children:d?e.jsxs("div",{className:"p-3 text-gray-500 text-sm text-center",children:[e.jsxs("svg",{className:"w-6 h-6 animate-spin mx-auto mb-2",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Carregando empresas..."]}):b.length===0?e.jsx("div",{className:"p-3 text-gray-500 text-sm text-center",children:"Nenhuma empresa encontrada"}):b.map(r=>{const a=o.some(s=>s.cd_empresa===r.cd_empresa);return e.jsxs("div",{className:`px-2 py-2 hover:bg-gray-50 cursor-pointer flex items-start mb-1 ${a?"bg-blue-50":""}`,onClick:()=>N(r),children:[e.jsx("div",{className:"flex flex-row w-full",children:e.jsxs("span",{className:"text-xs font-medium text-gray-900",children:[r.cd_empresa," - ",r.nm_grupoempresa]})}),e.jsx("input",{type:"checkbox",checked:a,readOnly:!0,className:"rounded border-gray-300 text-[#000638] focus:ring-[#000638] mr-1 w-4 h-4",onClick:s=>s.stopPropagation()})]},r.cd_empresa)})})]})]})};export{_ as F};
