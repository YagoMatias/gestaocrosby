import{r,j as e,P as Y,v as A,q as ee,b as se,L as te}from"./index-a2563983.js";import{F as ae,a as le,p as ne}from"./FiltroClientes-5e02171e.js";import{u as re}from"./useApiClient-0bf86fc1.js";import{C as x,a as m,b as p,c as h,d as u}from"./cards-fd94db0b.js";import{C as ie,a as oe,L as de,B as ce,p as xe,b as me,c as pe,A as he,d as B}from"./index-d0e9a633.js";import{s as ue}from"./CircleNotch.es-295869f9.js";import{m as ge}from"./CurrencyDollar.es-0edca053.js";ie.register(oe,de,ce,xe,me,pe,he);const Ce=()=>{const z=re(),[c,D]=r.useState([]),[N,M]=r.useState(!1),[v,P]=r.useState("2024-04-01"),$=new Date().toISOString().slice(0,10),[y,V]=r.useState($),[g,O]=r.useState([]),[f,W]=r.useState([]),[Z,E]=r.useState(!1),[w,S]=r.useState(null),[q,F]=r.useState([]),_=async()=>{try{M(!0);const s={dt_vencimento_ini:"2024-01-01"};v&&(s.dt_inicio=v),y&&(s.dt_fim=y);const t=await z.financial.inadimplentesRevenda(s);let a=[];t!=null&&t.success&&(t!=null&&t.data)?a=Array.isArray(t.data)?t.data:[]:Array.isArray(t)&&(a=t),console.log("ðŸ“Š Dados recebidos de inadimplentes Revenda:",a),D(a)}catch(s){console.error("Erro ao buscar dados de inadimplentes:",s),D([])}finally{M(!1)}};r.useEffect(()=>{_()},[]);const j=r.useMemo(()=>c.filter(s=>{var T;const t=g.length===0||g.includes(String(s.cd_cliente)),a=((T=s.ds_siglaest)==null?void 0:T.trim())||"",l=f.length===0||f.includes(a);if(!s.dt_vencimento)return!1;const n=new Date,i=new Date(s.dt_vencimento),d=n-i,X=Math.floor(d/(1e3*60*60*24))>=1;return t&&X&&l}),[c,g,f]),H=r.useMemo(()=>{const s=new Set;return c.forEach(t=>{t.ds_siglaest&&s.add(t.ds_siglaest.trim())}),Array.from(s).filter(Boolean).sort()},[c]),J=r.useMemo(()=>{const s=new Map;return(c||[]).forEach(t=>{if(t.cd_cliente){const a=String(t.cd_cliente);s.has(a)||s.set(a,{cd_cliente:a,nm_cliente:t.nm_cliente||a})}}),Array.from(s.values()).sort((t,a)=>t.nm_cliente>a.nm_cliente?1:-1)},[c]),o=r.useMemo(()=>{const s=j.reduce((t,a)=>{const l=a.cd_cliente;return t[l]||(t[l]={cd_cliente:l,nm_cliente:a.nm_cliente,ds_siglaest:a.ds_siglaest,valor_total:0,faturas:[]}),t[l].valor_total+=parseFloat(a.vl_fatura)||0,t[l].faturas.push(a),t},{});return Object.values(s)},[j]),k=r.useMemo(()=>{const s=o.length,t=o.reduce((a,l)=>a+l.valor_total,0);return{totalClientes:s,valorTotal:t}},[o]),I=r.useMemo(()=>{const s=j.reduce((l,n)=>{var d;const i=((d=n.ds_siglaest)==null?void 0:d.trim())||"NÃ£o informado";return l[i]||(l[i]={clientes:0,valor:0}),l[i].clientes+=1,l[i].valor+=parseFloat(n.vl_fatura)||0,l},{}),t=Object.keys(s),a=t.map(l=>s[l].clientes);return{estados:t,clientesPorEstado:a}},[j]),C=r.useMemo(()=>!o||o.length===0?[]:[...o].sort((t,a)=>a.valor_total-t.valor_total).slice(0,10).map(t=>{const a=(t.faturas||[]).reduce((l,n)=>{if(!n.dt_vencimento)return l;const i=Math.floor((new Date-new Date(n.dt_vencimento))/(1e3*60*60*24));return Math.max(l,i)},0);return{...t,diasAtrasoMax:a}}),[o]),G={labels:C.map(s=>s.nm_cliente?s.nm_cliente:s.cd_cliente),datasets:[{label:"Valor Inadimplente (R$)",data:C.map(s=>Number(s.valor_total||0)),backgroundColor:"#000638",borderColor:"#000638",borderWidth:1}]},K={labels:I.estados,datasets:[{label:"Clientes",data:I.clientesPorEstado,backgroundColor:"#000638",borderColor:"#000638",borderWidth:1}]},b=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s||0),R=s=>s?new Date(s).toLocaleDateString("pt-BR"):"N/A",Q=s=>{if(!s)return"N/A";const t=new Date,a=new Date(s),l=t-a,n=Math.floor(l/(1e3*60*60*24));if(n<=0)return"0 dias";if(n===1)return"1 dia";if(n<30)return`${n} dias`;if(n<365){const d=Math.floor(n/30);return d===1?"1 mÃªs":`${d} meses`}const i=Math.floor(n/365);return i===1?"1 ano":`${i} anos`},U=s=>{S(s),F(s.faturas),E(!0)},L=()=>{E(!1),S(null),F([])};return e.jsxs("div",{className:"w-full max-w-7xl mx-auto py-6 px-4 space-y-6",children:[e.jsx(Y,{title:"InadimplÃªncia Revenda",subtitle:"Acompanhe os clientes inadimplentes da Revenda",icon:A,iconColor:"text-purple-600"}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border mb-6",children:e.jsxs("form",{onSubmit:s=>{s.preventDefault(),_()},children:[e.jsx("div",{className:"text-sm font-semibold text-[#000638] mb-2",children:"ConfiguraÃ§Ãµes para anÃ¡lise de InadimplÃªncia - Revenda"}),e.jsx("span",{className:"text-xs text-gray-500 mt-1",children:"Filtros para consulta de clientes inadimplentes"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 mb-3 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-0.5 text-[#000638]",children:"Data Inicial"}),e.jsx("input",{type:"date",value:v,onChange:s=>P(s.target.value),className:"border border-[#000638]/30 rounded-lg px-2 py-1.5 w-full focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] text-xs"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-0.5 text-[#000638]",children:"Data Final"}),e.jsx("input",{type:"date",value:y,onChange:s=>V(s.target.value),className:"border border-[#000638]/30 rounded-lg px-2 py-1.5 w-full focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] text-xs"})]}),e.jsx("div",{className:"col-span-1",children:e.jsx(ae,{clientes:J,selected:g,onChange:O})}),e.jsx("div",{className:"col-span-1",children:e.jsx(le,{estados:H,selected:f,onChange:W})})]}),e.jsx("div",{className:"mt-4 flex gap-2",children:e.jsx("button",{onClick:_,disabled:N,className:"flex items-center gap-1 bg-[#000638] text-white px-3 py-1 rounded-lg hover:bg-[#fe0000] disabled:opacity-50 disabled:cursor-not-allowed font-medium transition-colors h-7 text-xs font-bold shadow-md tracking-wide uppercase",children:N?e.jsxs(e.Fragment,{children:[e.jsx(ue,{size:16,className:"animate-spin"}),"Carregando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{size:16}),"Buscar Dados"]})})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs(x,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl bg-white",children:[e.jsx(m,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{size:18,className:"text-blue-600"}),e.jsx(p,{className:"text-sm font-bold text-blue-700",children:"Total de Clientes"})]})}),e.jsxs(h,{className:"pt-0 px-4 pb-4",children:[e.jsx("div",{className:"text-base font-extrabold text-blue-600 mb-0.5",children:k.totalClientes}),e.jsx(u,{className:"text-xs text-gray-500",children:"Clientes inadimplentes"})]})]}),e.jsxs(x,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl bg-white",children:[e.jsx(m,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{size:18,className:"text-green-600"}),e.jsx(p,{className:"text-sm font-bold text-green-700",children:"Valor Total"})]})}),e.jsxs(h,{className:"pt-0 px-4 pb-4",children:[e.jsx("div",{className:"text-base font-extrabold text-green-600 mb-0.5",children:b(k.valorTotal)}),e.jsx(u,{className:"text-xs text-gray-500",children:"Valor em aberto"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs(x,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl bg-white",children:[e.jsx(m,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{size:18,className:"text-blue-600"}),e.jsx(p,{className:"text-sm font-bold text-blue-700",children:"TOP CLIENTES INADIMPLENTES"})]})}),e.jsxs(h,{className:"pt-0 px-4 pb-4",children:[e.jsx(u,{className:"text-xs text-gray-500 mb-3",children:"VisÃ£o geral dos dados de inadimplÃªncia"}),e.jsx("div",{className:"h-64",children:e.jsx(B,{data:G,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(s){const t=s.dataIndex,a=C[t],l=s.dataset.data[t]||0,n=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(l),i=(a==null?void 0:a.diasAtrasoMax)??0;return`${n} â€” ${i} dias em atraso`}}}},scales:{y:{beginAtZero:!0}}}})})]})]}),e.jsxs(x,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl bg-white",children:[e.jsx(m,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{size:18,className:"text-green-600"}),e.jsx(p,{className:"text-sm font-bold text-green-700",children:"Clientes por Estado"})]})}),e.jsxs(h,{className:"pt-0 px-4 pb-4",children:[e.jsx(u,{className:"text-xs text-gray-500 mb-3",children:"DistribuiÃ§Ã£o de inadimplentes por estado"}),e.jsx("div",{className:"h-64",children:e.jsx(B,{data:K,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}})})]})]})]}),e.jsxs(x,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl bg-white",children:[e.jsx(m,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{size:18,className:"text-purple-600"}),e.jsx(p,{className:"text-sm font-bold text-purple-700",children:"Lista de Clientes Inadimplentes"})]})}),e.jsxs(h,{className:"pt-0 px-4 pb-4",children:[e.jsx(u,{className:"text-xs text-gray-500 mb-4",children:"Detalhes completos dos clientes em situaÃ§Ã£o de inadimplÃªncia"}),N?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(te,{size:"md",text:"Carregando dados..."})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"CÃ³digo Cliente"}),e.jsx("th",{className:"px-4 py-3",children:"Nome Cliente"}),e.jsx("th",{className:"px-4 py-3",children:"Estado"}),e.jsx("th",{className:"px-4 py-3",children:"Valor Total"})]})}),e.jsx("tbody",{children:o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-8 text-center text-gray-500",children:"Nenhum cliente inadimplente encontrado"})}):o.map((s,t)=>{var a;return e.jsxs("tr",{className:"bg-white border-b hover:bg-blue-50 cursor-pointer transition-colors",onClick:()=>U(s),children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:s.cd_cliente||"N/A"}),e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:s.nm_cliente||"N/A"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded",children:((a=s.ds_siglaest)==null?void 0:a.trim())||"N/A"})}),e.jsx("td",{className:"px-4 py-3 font-medium text-green-600",children:b(s.valor_total)})]},t)})})]})})]})]}),Z&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Detalhes das Faturas - ",w==null?void 0:w.nm_cliente]}),e.jsx("button",{onClick:L,className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Empresa"}),e.jsx("th",{className:"px-4 py-3",children:"EmissÃ£o"}),e.jsx("th",{className:"px-4 py-3",children:"Vencimento"}),e.jsx("th",{className:"px-4 py-3",children:"Valor Fatura"}),e.jsx("th",{className:"px-4 py-3",children:"Juros"}),e.jsx("th",{className:"px-4 py-3",children:"Parcela"}),e.jsx("th",{className:"px-4 py-3",children:"Tempo InadimplÃªncia"})]})}),e.jsx("tbody",{children:q.map((s,t)=>e.jsxs("tr",{className:"bg-white border-b",children:[e.jsx("td",{className:"px-4 py-3",children:s.cd_empresa||"N/A"}),e.jsx("td",{className:"px-4 py-3",children:R(s.dt_emissao)}),e.jsx("td",{className:"px-4 py-3",children:R(s.dt_vencimento)}),e.jsx("td",{className:"px-4 py-3 font-medium text-green-600",children:b(s.vl_fatura)}),e.jsx("td",{className:"px-4 py-3 font-medium text-red-600",children:b(s.vl_juros)}),e.jsx("td",{className:"px-4 py-3",children:s.nr_parcela||"N/A"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"bg-yellow-100 text-yellow-800 text-xs font-medium px-2 py-1 rounded",children:Q(s.dt_vencimento)})})]},t))})]})}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:L,className:"px-4 py-2 bg-[#000638] text-white rounded hover:bg-[#fe0000] transition-colors",children:"Fechar"})})]})})]})};export{Ce as default};
