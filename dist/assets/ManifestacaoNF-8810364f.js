import{r as l,j as e,c as Ge,b as Je,d as F,n as se,k as pe,e as We,s as fe,f as O,C as He}from"./index-a2563983.js";import{F as Ye}from"./FiltroEmpresa-724027b5.js";import{u as Ke}from"./useApiClient-0bf86fc1.js";import{C as j,a as w,b as _,c as N,d as S}from"./cards-fd94db0b.js";import{T as be,a as ge,b as je,c as Ne}from"./tooltip-7f0eaba7.js";import{c as Qe}from"./ArrowDown.es-b2258871.js";import{s as Xe}from"./ArrowUp.es-3ccbaccd.js";import{s as es}from"./CaretLeft.es-d17586e9.js";import{s as ss}from"./CaretUp.es-b369da07.js";import{n as ve}from"./Clock.es-5bd0a93a.js";import{m as ye}from"./CurrencyDollar.es-0edca053.js";import{s as as}from"./Download.es-dafa4844.js";import{w as ts}from"./FileArrowDown.es-b235db0a.js";import{s as rs}from"./Funnel.es-cd3339ac.js";import{p as f}from"./Spinner.es-3c850cda.js";import{c as we}from"./Warning.es-51a03ee6.js";import{utils as ae,write as os}from"./xlsx-6ed613d4.js";import{F as ns}from"./FileSaver.min-01e85130.js";const As=()=>{const _e=Ke(),[L,te]=l.useState([]),[u,re]=l.useState(!1),[k,oe]=l.useState(!1),[G,ne]=l.useState(""),[J,ce]=l.useState(""),[R,Se]=l.useState("Todos");l.useState("TODAS");const[W,Ce]=l.useState(""),[H,Ae]=l.useState(""),[Y,De]=l.useState(""),[I,ke]=l.useState("NFE"),[E,Ee]=l.useState("AUTORIZADA"),[$,v]=l.useState({}),[cs,B]=l.useState({}),[P,M]=l.useState(null),[p,K]=l.useState({aberto:!1,chave:null,observacao:"",editando:!1}),[Q,U]=l.useState(new Set);l.useEffect(()=>{const s=document.createElement("style");return s.textContent=`
      .table-container {
        overflow-x: auto;
        position: relative;
        max-width: 100%;
      }
      
      .table-container table {
        position: relative;
      }
      
      .manifestacao-table {
        border-collapse: collapse;
        width: 100%;
      }
      
      .manifestacao-table th,
      .manifestacao-table td {
        padding: 6px 8px !important;
        border-right: 1px solid #f3f4f6;
        word-wrap: break-word;
        white-space: normal;
        font-size: 11px;
        line-height: 1.3;
      }
      
      .manifestacao-table th:last-child,
      .manifestacao-table td:last-child {
        border-right: none;
      }
      
      .manifestacao-table th {
        background-color: #000638;
        color: white;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 10px;
        letter-spacing: 0.05em;
      }
      
      .manifestacao-table tbody tr:nth-child(odd) {
        background-color: white;
      }
      
      .manifestacao-table tbody tr:nth-child(even) {
        background-color: #fafafa;
      }
      
      .manifestacao-table tbody tr:hover {
        background-color: #f0f9ff;
        transition: background-color 0.2s ease;
      }
      
      /* CSS para coluna fixa */
      .manifestacao-table thead th:first-child,
      .manifestacao-table tbody td:first-child {
        position: sticky !important;
        left: 0 !important;
        z-index: 10 !important;
        border-right: 2px solid #e5e7eb !important;
        box-shadow: 2px 0 4px rgba(0,0,0,0.1) !important;
      }
      
      .manifestacao-table thead th:first-child {
        background: #000638 !important;
        z-index: 20 !important;
        min-width: 50px !important;
        width: 50px !important;
      }
      
      .manifestacao-table tbody td:first-child {
        background: white !important;
        min-width: 50px !important;
        width: 50px !important;
      }
      
      .manifestacao-table tbody tr:nth-child(even) td:first-child {
        background: #fafafa !important;
      }
      
      .manifestacao-table tbody tr:hover td:first-child {
        background: #f0f9ff !important;
      }
    `,document.head.appendChild(s),()=>{document.head.removeChild(s)}},[]);const Te=s=>{U(a=>{const t=new Set(a);return t.has(s)?t.delete(s):t.add(s),t})},ze=()=>{const s=m.slice(z,he),a=new Set(s.map((t,r)=>z+r));U(a)},le=()=>{U(new Set)};l.useEffect(()=>{U(new Set)},[L]);const[C,Fe]=l.useState([]),[b,V]=l.useState(1),[X]=l.useState(30),[y,Oe]=l.useState({key:"dt_emissao",direction:"desc"}),d=s=>{let a="asc";y.key===s&&y.direction==="asc"&&(a="desc"),Oe({key:s,direction:a})},x=s=>y.key!==s?e.jsx(fe,{size:12,className:"ml-1 opacity-50"}):y.direction==="asc"?e.jsx(ss,{size:12,className:"ml-1"}):e.jsx(fe,{size:12,className:"ml-1"}),Le=async(s=G,a=J)=>{if(!(!s||!a)){if(C.length===0){alert("Selecione pelo menos uma empresa para consultar!");return}re(!0),V(1);try{console.log("üîç Iniciando busca de manifesta√ß√£o de NF..."),console.log("üìÖ Per√≠odo:",{inicio:s,fim:a}),console.log("üè¢ Empresas selecionadas:",C);const t=C.map(async c=>{try{console.log(`üì° Buscando dados para empresa ${c.cd_empresa}...`);const i={dt_inicio:s,dt_fim:a,cd_empresa:c.cd_empresa},h=await _e.financial.nfManifestacao(i);if(h.success){const n=Array.isArray(h.data)?h.data:[];return console.log(`‚úÖ Sucesso para empresa ${c.cd_empresa}:`,{total:n.length,amostra:n.slice(0,2)}),n}else return console.warn(`‚ö†Ô∏è Falha para empresa ${c.cd_empresa}:`,h.message),[]}catch(i){return console.error(`‚ùå Erro para empresa ${c.cd_empresa}:`,i),[]}}),r=await Promise.all(t),o=r.flat();console.log("‚úÖ Dados de manifesta√ß√£o obtidos de todas as empresas:",{totalEmpresas:C.length,totalRegistros:o.length,registrosPorEmpresa:r.map((c,i)=>({empresa:C[i].cd_empresa,registros:c.length}))}),te(o),oe(!0)}catch(t){console.error("‚ùå Erro ao buscar dados:",t),te([]),oe(!1)}finally{re(!1)}}},ie=(s,a=!1)=>{var r;const t=((r=$[s])==null?void 0:r.observacao)||"";K({aberto:!0,chave:s,observacao:a?t:"",editando:a})},q=()=>{K({aberto:!1,chave:null,observacao:"",editando:!1})},Re=async()=>{const{chave:s,observacao:a,editando:t}=p,r=a.trim();if(!r){alert("Digite uma observa√ß√£o antes de salvar.");return}M(s);try{const o=$[s];if(console.log("üíæ Salvando observa√ß√£o via modal...",{chave:s,texto:r,existente:o,editando:t}),o&&o.id){const{data:c,error:i}=await O.from("nf_observacoes").update({observacao:r,updated_at:new Date().toISOString()}).eq("id",o.id).select();console.log("üü¶ Resultado UPDATE nf_observacoes",{data:c,error:i}),i||v(h=>({...h,[s]:{id:o.id,observacao:r}}))}else{const{data:c,error:i}=await O.from("nf_observacoes").insert({ds_chaveacesso:s,observacao:r}).select();console.log("üü© Resultado INSERT nf_observacoes",{data:c,error:i}),!i&&Array.isArray(c)&&c[0]&&v(h=>({...h,[s]:{id:c[0].id,observacao:r}}))}q()}finally{M(null)}},Ie=async()=>{const{chave:s}=p,a=$[s];if(!a||!a.id){alert("Nenhuma observa√ß√£o encontrada para remover.");return}if(confirm("Tem certeza que deseja remover esta observa√ß√£o?")){M(s);try{const{data:t,error:r}=await O.from("nf_observacoes").delete().eq("id",a.id);console.log("üü• Resultado DELETE nf_observacoes",{data:t,error:r,chave:s,existente:a}),r||(v(o=>{const c={...o};return delete c[s],c}),q())}finally{M(null)}}};l.useEffect(()=>{k&&(async()=>{try{const a=Array.from(new Set((L||[]).map(t=>t.ds_chaveacesso).filter(Boolean)));if(console.log("üîé Buscando observa√ß√µes no Supabase",{totalChaves:a.length,chaves:a.slice(0,20)}),a.length>0){console.log("üß™ Teste 1: Buscando TODAS as observa√ß√µes...");const{data:t,error:r}=await O.from("nf_observacoes").select("*");console.log("üìã Todas as observa√ß√µes no banco:",{errorTodas:r,count:t==null?void 0:t.length,data:t}),console.log("üß™ Teste 2: Buscando observa√ß√µes espec√≠ficas...");const{data:o,error:c}=await O.from("nf_observacoes").select("id, ds_chaveacesso, observacao").in("ds_chaveacesso",a);if(console.log("üì• Retorno Supabase (observa√ß√µes espec√≠ficas)",{error:c,obsCount:o==null?void 0:o.length,sample:Array.isArray(o)?o.slice(0,5):o}),!c&&Array.isArray(o)){const i={};o.forEach(n=>{i[n.ds_chaveacesso]={id:n.id,observacao:n.observacao||""}}),console.log("üìå Observa√ß√µes mapeadas por chave",{total:Object.keys(i).length,sample:Object.entries(i).slice(0,5)}),v(i);const h={};a.forEach(n=>{var ue;h[n]=((ue=i[n])==null?void 0:ue.observacao)||""}),B(h)}else console.warn("‚ö†Ô∏è Falha ao carregar observa√ß√µes do Supabase",{error:c}),v({}),B({})}else v({}),B({})}catch(a){console.error("‚ùå Erro inesperado ao carregar observa√ß√µes do Supabase:",a),v({}),B({})}})()},[L,k]);const de=s=>!s||isNaN(s)?"R$ 0,00":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(parseFloat(s)),A=s=>{if(!s)return"";try{return new Date(s).toLocaleDateString("pt-BR")}catch{return s}},T=s=>{var t;switch(((t=s.tp_situacaoman)==null?void 0:t.toString())||""){case"1":return"Confirmada";case"2":return"Desconhecida";case"3":return"N√£o Realizada";case"4":return"Ci√™ncia";default:return"Pendente"}},$e=s=>{switch(s==null?void 0:s.toLowerCase()){case"confirmada":return"bg-green-100 text-green-800";case"desconhecida":return"bg-red-100 text-red-800";case"n√£o realizada":return"bg-yellow-100 text-yellow-800";case"ci√™ncia":return"bg-blue-100 text-blue-800";case"pendente":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},Be=s=>{switch(s==null?void 0:s.toLowerCase()){case"confirmada":return e.jsx(F,{size:16,className:"text-green-600"});case"desconhecida":return e.jsx(we,{size:16,className:"text-red-600"});case"n√£o realizada":return e.jsx(ve,{size:16,className:"text-yellow-600"});case"ci√™ncia":return e.jsx(He,{size:16,className:"text-blue-600"});case"pendente":return e.jsx(Xe,{size:16,className:"text-gray-600"});default:return e.jsx(Qe,{size:16,className:"text-gray-600"})}},xe=s=>{const a=(s==null?void 0:s.toString())||"";switch(a){case"55":return"NFE";case"57":return"CTE";default:return a}},me=s=>{const a=(s==null?void 0:s.toString())||"";switch(a){case"A":return"AUTORIZADA";case"C":return"CANCELADA";case"D":return"DENEGADA";default:return a}},D=s=>s.nr_fatura&&s.nr_fatura.toString().trim()!=="",Pe=s=>D(s)?e.jsx(F,{size:16,className:"text-green-600"}):e.jsx(se,{size:16,className:"text-red-600"}),Me=()=>{try{const s=m.map(n=>({Empresa:n.cd_empresa||"","Chave de Acesso":n.ds_chaveacesso||"","N√∫mero NF":n.nr_nf||"",NSU:n.nr_nsu||"",S√©rie:n.cd_serie||"","Data Emiss√£o":A(n.dt_emissao),"Data Cadastro":A(n.dt_cadastro),"CNPJ Emitente":n.nr_cnpjemi||"","CNPJ Fornecedor":n.cd_cgc||"","Raz√£o Social":n.nm_razaosocial||"","Valor Total":parseFloat(n.vl_totalnota||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),"Status Manifesta√ß√£o":T(n),Lan√ßada:D(n)?"Sim":"N√£o",Opera√ß√£o:n.tp_operacao||"",Operador:n.cd_operador||"","Tipo Documento":xe(n.tp_moddctofiscal),"Situa√ß√£o Documento":me(n.tp_situacao),"N√∫mero Fatura":n.nr_fatura||"","Data Fatura":A(n.dt_fatura),"Valor Fatura":parseFloat(n.vl_fatura||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})),a=ae.json_to_sheet(s),t=ae.book_new();ae.book_append_sheet(t,a,"Manifesta√ß√£o NF");const r=[{wch:10},{wch:50},{wch:15},{wch:12},{wch:10},{wch:12},{wch:12},{wch:20},{wch:20},{wch:40},{wch:15},{wch:18},{wch:10},{wch:12},{wch:12},{wch:15},{wch:18},{wch:15},{wch:12},{wch:15}];a["!cols"]=r;const o=os(t,{bookType:"xlsx",type:"array"}),c=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),h=`manifestacao-nf-${new Date().toLocaleDateString("pt-BR").replace(/\//g,"-")}.xlsx`;ns.saveAs(c,h),console.log("‚úÖ Excel exportado com sucesso!")}catch(s){console.error("‚ùå Erro ao exportar Excel:",s),alert("Erro ao exportar dados para Excel. Tente novamente.")}};l.useEffect(()=>{const s=new Date,a=new Date(s.getFullYear(),s.getMonth(),1),t=new Date(s.getFullYear(),s.getMonth()+1,0);ne(a.toISOString().split("T")[0]),ce(t.toISOString().split("T")[0])},[]);const Ue=L.filter(s=>{var a,t;if(R!=="Todos"){const r=D(s);if(R==="Lan√ßadas"&&!r||R==="N√£o Lan√ßadas"&&r)return!1}if(I!=="TODOS"){const r=((a=s.tp_moddctofiscal)==null?void 0:a.toString())||"";if(I==="NFE"&&r!=="55"||I==="CTE"&&r!=="57")return!1}if(E!=="TODAS"){const r=((t=s.tp_situacao)==null?void 0:t.toString())||"";if(E==="AUTORIZADA"&&r!=="A"||E==="CANCELADA"&&r!=="C"||E==="DENEGADA"&&r!=="D")return!1}if(W&&!(s.nr_nf||"").toString().toLowerCase().includes(W.toLowerCase()))return!1;if(H){const r=s.nr_cnpjemi||"",o=s.nm_razaosocial||"",c=H.toLowerCase();if(!r.toString().toLowerCase().includes(c)&&!o.toLowerCase().includes(c))return!1}return!(Y&&!(s.ds_chaveacesso||"").toLowerCase().includes(Y.toLowerCase()))}),m=(s=>!s||s.length===0?s:[...s].sort((a,t)=>{let r,o;switch(y.key){case"cd_empresa":r=a.cd_empresa||"",o=t.cd_empresa||"";break;case"nr_nf":r=a.nr_nf||"",o=t.nr_nf||"";break;case"cd_serie":r=a.cd_serie||"",o=t.cd_serie||"";break;case"nr_cnpjemi":r=a.nr_cnpjemi||"",o=t.nr_cnpjemi||"";break;case"nm_razaosocial":r=a.nm_razaosocial||"",o=t.nm_razaosocial||"";break;case"vl_totalnota":r=parseFloat(a.vl_totalnota)||0,o=parseFloat(t.vl_totalnota)||0;break;case"tp_situacaoman":r=a.tp_situacaoman||"",o=t.tp_situacaoman||"";break;case"nr_fatura":r=a.nr_fatura||"",o=t.nr_fatura||"";break;case"dt_emissao":r=a.dt_emissao?new Date(a.dt_emissao):new Date(0),o=t.dt_emissao?new Date(t.dt_emissao):new Date(0);break;case"dt_cadastro":r=a.dt_cadastro?new Date(a.dt_cadastro):new Date(0),o=t.dt_cadastro?new Date(t.dt_cadastro):new Date(0);break;case"ds_chaveacesso":r=a.ds_chaveacesso||"",o=t.ds_chaveacesso||"";break;case"tp_moddctofiscal":r=a.tp_moddctofiscal||"",o=t.tp_moddctofiscal||"";break;case"tp_situacao":r=a.tp_situacao||"",o=t.tp_situacao||"";break;default:return 0}return r<o?y.direction==="asc"?-1:1:r>o?y.direction==="asc"?1:-1:0}))(Ue),z=(b-1)*X,he=z+X,Z=m.slice(z,he),g=Math.ceil(m.length/X),ee=Q.size,Ve=Array.from(Q).reduce((s,a)=>{const t=m[a];return s+(parseFloat(t==null?void 0:t.vl_totalnota)||0)},0),qe=s=>{s.preventDefault(),Le()},Ze=s=>{Fe(s)};return e.jsxs("div",{className:"w-full max-w-6xl mx-auto flex flex-col items-stretch justify-start py-8 px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-[#000638] mb-2",children:"Manifesta√ß√£o de Notas Fiscais"}),e.jsx("p",{className:"text-gray-600",children:"Gerencie e manifeste notas fiscais eletr√¥nicas de fornecedores"})]}),e.jsx("div",{className:"mb-8",children:e.jsxs("form",{onSubmit:qe,className:"flex flex-col bg-white p-8 rounded-2xl shadow-lg w-full max-w-5xl mx-auto border border-[#000638]/10",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("span",{className:"text-lg font-bold text-[#000638] flex items-center gap-2",children:[e.jsx(rs,{size:22,weight:"bold"}),"Filtros"]}),e.jsx("span",{className:"text-sm text-gray-500 mt-1",children:"Selecione o per√≠odo e empresa para an√°lise"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-4 mb-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(Ye,{empresasSelecionadas:C,onSelectEmpresas:Ze})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1 text-[#000638]",children:"Data In√≠cio"}),e.jsx("input",{type:"date",value:G,onChange:s=>ne(s.target.value),className:"border border-[#000638]/30 rounded-lg px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] placeholder:text-gray-400"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1 text-[#000638]",children:"Data Fim"}),e.jsx("input",{type:"date",value:J,onChange:s=>ce(s.target.value),className:"border border-[#000638]/30 rounded-lg px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] placeholder:text-gray-400"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1 text-[#000638]",children:"Lan√ßamento"}),e.jsxs("select",{value:R,onChange:s=>Se(s.target.value),className:"border border-[#000638]/30 rounded-lg px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638]",children:[e.jsx("option",{value:"Todos",children:"TODOS"}),e.jsx("option",{value:"Lan√ßadas",children:"LAN√áADAS"}),e.jsx("option",{value:"N√£o Lan√ßadas",children:"N√ÉO LAN√áADAS"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1 text-[#000638]",children:"Doc Fiscal"}),e.jsxs("select",{value:I,onChange:s=>ke(s.target.value),className:"border border-[#000638]/30 rounded-lg px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638]",children:[e.jsx("option",{value:"TODOS",children:"TODOS"}),e.jsx("option",{value:"NFE",children:"NFE"}),e.jsx("option",{value:"CTE",children:"CTE"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1 text-[#000638]",children:"Situa√ß√£o"}),e.jsxs("select",{value:E,onChange:s=>Ee(s.target.value),className:"border border-[#000638]/30 rounded-lg px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638]",children:[e.jsx("option",{value:"TODAS",children:"TODAS"}),e.jsx("option",{value:"AUTORIZADA",children:"AUTORIZADA"}),e.jsx("option",{value:"CANCELADA",children:"CANCELADA"}),e.jsx("option",{value:"DENEGADA",children:"DENEGADA"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1 text-[#000638]",children:"N√∫mero NF"}),e.jsx("input",{type:"text",value:W,onChange:s=>Ce(s.target.value),placeholder:"Buscar por n√∫mero da NF...",className:"border border-[#000638]/30 rounded-lg px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] placeholder:text-gray-400"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1 text-[#000638]",children:"Fornecedor"}),e.jsx("input",{type:"text",value:H,onChange:s=>Ae(s.target.value),placeholder:"Buscar por CNPJ ou raz√£o social...",className:"border border-[#000638]/30 rounded-lg px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] placeholder:text-gray-400"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1 text-[#000638]",children:"Chave de Acesso"}),e.jsx("input",{type:"text",value:Y,onChange:s=>De(s.target.value),placeholder:"Buscar por chave de acesso...",className:"border border-[#000638]/30 rounded-lg px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] placeholder:text-gray-400"})]}),e.jsx("div",{className:"flex items-center",children:e.jsx("button",{type:"submit",className:"w-full flex items-center justify-center gap-2 bg-[#000638] text-white px-6 py-2 rounded-lg hover:bg-[#fe0000] disabled:opacity-50 disabled:cursor-not-allowed font-medium transition-colors h-10 text-sm font-bold shadow-md tracking-wide uppercase",disabled:u||!G||!J,children:u?e.jsxs(e.Fragment,{children:[e.jsx(f,{size:18,className:"animate-spin"}),e.jsx("span",{children:"Buscando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ge,{size:18}),e.jsx("span",{children:"Buscar Dados"})]})})})]})]})}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-8 justify-center",children:[e.jsxs(j,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl w-64 bg-white",children:[e.jsx(w,{className:"pb-0",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{size:18,className:"text-blue-600"}),e.jsx(_,{className:"text-sm font-bold text-blue-700",children:"Total de NFs"})]})}),e.jsxs(N,{className:"pt-0 px-4 pb-4",children:[e.jsx("div",{className:"text-2xl font-extrabold text-blue-600 mb-1",children:u?e.jsx(f,{size:24,className:"animate-spin text-blue-600"}):m.length}),e.jsx(S,{className:"text-xs text-gray-500",children:"Notas no per√≠odo"})]})]}),e.jsxs(j,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl w-64 bg-white",children:[e.jsx(w,{className:"pb-0",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{size:18,className:"text-green-600"}),e.jsx(_,{className:"text-sm font-bold text-green-700",children:"Valor Total"})]})}),e.jsxs(N,{className:"pt-0 px-4 pb-4",children:[e.jsx("div",{className:"text-2xl font-extrabold text-green-600 mb-1 break-words",children:u?e.jsx(f,{size:24,className:"animate-spin text-green-600"}):m.reduce((s,a)=>s+(parseFloat(a.vl_totalnota)||0),0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),e.jsx(S,{className:"text-xs text-gray-500",children:"Valor total das notas"})]})]}),e.jsxs(j,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl w-64 bg-white",children:[e.jsx(w,{className:"pb-0",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{size:18,className:"text-yellow-600"}),e.jsx(_,{className:"text-sm font-bold text-yellow-700",children:"Pendentes"})]})}),e.jsxs(N,{className:"pt-0 px-4 pb-4",children:[e.jsx("div",{className:"text-2xl font-extrabold text-yellow-600 mb-1",children:u?e.jsx(f,{size:24,className:"animate-spin text-yellow-600"}):m.filter(s=>T(s)==="Pendente").length}),e.jsx(S,{className:"text-xs text-gray-500",children:"Aguardando manifesta√ß√£o"})]})]}),e.jsxs(j,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl w-64 bg-white",children:[e.jsx(w,{className:"pb-0",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{size:18,className:"text-green-600"}),e.jsx(_,{className:"text-sm font-bold text-green-700",children:"Confirmadas"})]})}),e.jsxs(N,{className:"pt-0 px-4 pb-4",children:[e.jsx("div",{className:"text-2xl font-extrabold text-green-600 mb-1",children:u?e.jsx(f,{size:24,className:"animate-spin text-green-600"}):m.filter(s=>T(s)==="Confirmada").length}),e.jsx(S,{className:"text-xs text-gray-500",children:"Manifestadas"})]})]}),e.jsxs(j,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl w-64 bg-white",children:[e.jsx(w,{className:"pb-0",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{size:18,className:"text-red-600"}),e.jsx(_,{className:"text-sm font-bold text-red-700",children:"Desconhecidas"})]})}),e.jsxs(N,{className:"pt-0 px-4 pb-4",children:[e.jsx("div",{className:"text-2xl font-extrabold text-red-600 mb-1",children:u?e.jsx(f,{size:24,className:"animate-spin text-red-600"}):m.filter(s=>T(s)==="Desconhecida").length}),e.jsx(S,{className:"text-xs text-gray-500",children:"Requerem aten√ß√£o"})]})]}),e.jsxs(j,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl w-64 bg-white",children:[e.jsx(w,{className:"pb-0",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{size:18,className:"text-green-600"}),e.jsx(_,{className:"text-sm font-bold text-green-700",children:"Lan√ßadas"})]})}),e.jsxs(N,{className:"pt-0 px-4 pb-4",children:[e.jsx("div",{className:"text-2xl font-extrabold text-green-600 mb-1",children:u?e.jsx(f,{size:24,className:"animate-spin text-green-600"}):m.filter(s=>D(s)).length}),e.jsx(S,{className:"text-xs text-gray-500",children:"Com n√∫mero de fatura"})]})]}),e.jsxs(j,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl w-64 bg-white",children:[e.jsx(w,{className:"pb-0",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{size:18,className:"text-red-600"}),e.jsx(_,{className:"text-sm font-bold text-red-700",children:"N√£o Lan√ßadas"})]})}),e.jsxs(N,{className:"pt-0 px-4 pb-4",children:[e.jsx("div",{className:"text-2xl font-extrabold text-red-600 mb-1",children:u?e.jsx(f,{size:24,className:"animate-spin text-red-600"}):m.filter(s=>!D(s)).length}),e.jsx(S,{className:"text-xs text-gray-500",children:"Sem n√∫mero de fatura"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-[#000638]/10 max-w-6xl mx-auto w-full",children:[e.jsx("div",{className:"p-6 border-b border-[#000638]/10 flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("h2",{className:"text-xl font-bold text-[#000638]",children:"Manifesta√ß√£o de Notas Fiscais"}),e.jsxs("div",{className:"flex items-center gap-4",children:[k&&m.length>0&&e.jsxs("button",{onClick:Me,className:"flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium text-sm shadow-md",title:"Exportar dados para Excel",children:[e.jsx(ts,{size:18}),e.jsx("span",{children:"Baixar Excel"})]}),k&&e.jsxs("span",{className:"text-gray-600 text-sm",children:["Exibindo ",Z.length," de ",m.length," registros"]})]})]})}),e.jsx("div",{className:"p-6",children:u?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(f,{size:32,className:"text-blue-600 animate-spin mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando dados..."})]}):k?m.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(pe,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Nenhuma nota fiscal encontrada"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Tente ajustar os filtros ou o per√≠odo de busca"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"manifestacao-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{position:"sticky",left:0,zIndex:20,background:"#000638",minWidth:"50px",width:"50px"},children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("input",{type:"checkbox",checked:ee===Z.length&&Z.length>0,onChange:s=>s.target.checked?ze():le()})})}),e.jsx("th",{className:"cursor-pointer hover:bg-blue-800 transition-colors",onClick:()=>d("cd_empresa"),children:e.jsxs("div",{className:"flex items-center",children:["EMPRESA",x("cd_empresa")]})}),e.jsx("th",{className:"cursor-pointer hover:bg-blue-800 transition-colors",onClick:()=>d("ds_chaveacesso"),children:e.jsxs("div",{className:"flex items-center",children:["CHAVE ACESSO",x("ds_chaveacesso")]})}),e.jsx("th",{className:"cursor-pointer hover:bg-blue-800 transition-colors",onClick:()=>d("nr_nf"),children:e.jsxs("div",{className:"flex items-center",children:["NR NF",x("nr_nf")]})}),e.jsx("th",{className:"cursor-pointer hover:bg-blue-800 transition-colors",onClick:()=>d("cd_serie"),children:e.jsxs("div",{className:"flex items-center",children:["S√âRIE",x("cd_serie")]})}),e.jsx("th",{className:"cursor-pointer hover:bg-blue-800 transition-colors",onClick:()=>d("nr_nsu"),children:e.jsxs("div",{className:"flex items-center",children:["NSU",x("nr_nsu")]})}),e.jsx("th",{className:"cursor-pointer hover:bg-blue-800 transition-colors",onClick:()=>d("dt_emissao"),children:e.jsxs("div",{className:"flex items-center",children:["DT EMISS√ÉO",x("dt_emissao")]})}),e.jsx("th",{className:"cursor-pointer hover:bg-blue-800 transition-colors",onClick:()=>d("nr_cnpjemi"),children:e.jsxs("div",{className:"flex items-center",children:["CNPJ EMITENTE",x("nr_cnpjemi")]})}),e.jsx("th",{className:"cursor-pointer hover:bg-blue-800 transition-colors",onClick:()=>d("nm_razaosocial"),children:e.jsxs("div",{className:"flex items-center",children:["RAZ√ÉO SOCIAL",x("nm_razaosocial")]})}),e.jsx("th",{className:"cursor-pointer hover:bg-blue-800 transition-colors",onClick:()=>d("vl_totalnota"),children:e.jsxs("div",{className:"flex items-center",children:["VALOR TOTAL",x("vl_totalnota")]})}),e.jsx("th",{className:"cursor-pointer hover:bg-blue-800 transition-colors",onClick:()=>d("tp_situacaoman"),children:e.jsxs("div",{className:"flex items-center",children:["STATUS MANIFESTA√á√ÉO",x("tp_situacaoman")]})}),e.jsx("th",{className:"cursor-pointer hover:bg-blue-800 transition-colors",onClick:()=>d("nr_fatura"),children:e.jsxs("div",{className:"flex items-center",children:["LAN√áADA",x("nr_fatura")]})}),e.jsx("th",{className:"cursor-pointer hover:bg-blue-800 transition-colors",onClick:()=>d("tp_operacao"),children:e.jsxs("div",{className:"flex items-center",children:["OPERA√á√ÉO",x("tp_operacao")]})}),e.jsx("th",{className:"cursor-pointer hover:bg-blue-800 transition-colors",onClick:()=>d("cd_operador"),children:e.jsxs("div",{className:"flex items-center",children:["OPERADOR",x("cd_operador")]})}),e.jsx("th",{className:"cursor-pointer hover:bg-blue-800 transition-colors",onClick:()=>d("tp_moddctofiscal"),children:e.jsxs("div",{className:"flex items-center",children:["TIPO DOC",x("tp_moddctofiscal")]})}),e.jsx("th",{className:"cursor-pointer hover:bg-blue-800 transition-colors",onClick:()=>d("tp_situacao"),children:e.jsxs("div",{className:"flex items-center",children:["SITUA√á√ÉO DOC",x("tp_situacao")]})}),e.jsx("th",{className:"cursor-pointer hover:bg-blue-800 transition-colors",onClick:()=>d("nr_fatura"),children:e.jsxs("div",{className:"flex items-center",children:["NR FATURA",x("nr_fatura")]})}),e.jsx("th",{className:"cursor-pointer hover:bg-blue-800 transition-colors",onClick:()=>d("dt_fatura"),children:e.jsxs("div",{className:"flex items-center",children:["DT FATURA",x("dt_fatura")]})}),e.jsx("th",{className:"cursor-pointer hover:bg-blue-800 transition-colors",onClick:()=>d("dt_cadastro"),children:e.jsxs("div",{className:"flex items-center",children:["DT CADASTRO",x("dt_cadastro")]})}),e.jsx("th",{children:e.jsx("div",{className:"flex items-center",children:"OBSERVA√á√ïES"})})]})}),e.jsx("tbody",{children:Z.map((s,a)=>{var i;const t=z+a,r=Q.has(t),o=T(s),c=Be(o);return e.jsxs("tr",{className:r?"bg-blue-50":"",children:[e.jsx("td",{style:{position:"sticky",left:0,zIndex:10,background:r?"#dbeafe":"inherit",minWidth:"50px",width:"50px"},children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("input",{type:"checkbox",checked:r,onChange:()=>Te(t)})})}),e.jsx("td",{className:"text-center font-medium",children:s.cd_empresa||""}),e.jsx("td",{className:"max-w-32 truncate font-mono text-xs",title:s.ds_chaveacesso,children:s.ds_chaveacesso||""}),e.jsx("td",{className:"font-medium text-blue-600",children:s.nr_nf||""}),e.jsx("td",{className:"text-center",children:s.cd_serie||""}),e.jsx("td",{className:"text-center",children:s.nr_nsu||""}),e.jsx("td",{className:"text-center",children:A(s.dt_emissao)}),e.jsx("td",{className:"text-center font-mono text-xs",children:s.nr_cnpjemi||""}),e.jsx("td",{className:"max-w-48 truncate",title:s.nm_razaosocial,children:s.nm_razaosocial||""}),e.jsx("td",{className:"text-right font-medium text-green-600",children:de(s.vl_totalnota)}),e.jsx("td",{className:"text-center",children:e.jsx(be,{children:e.jsxs(ge,{children:[e.jsx(je,{children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${$e(o)}`,children:[c,o]})}),e.jsxs(Ne,{children:[e.jsxs("p",{children:["Status: ",o]}),e.jsxs("p",{children:["C√≥digo: ",s.tp_situacaoman]})]})]})})}),e.jsx("td",{className:"text-center",children:e.jsx(be,{children:e.jsxs(ge,{children:[e.jsx(je,{children:e.jsx("div",{className:"flex items-center justify-center",children:Pe(s)})}),e.jsxs(Ne,{children:[e.jsx("p",{children:D(s)?"Lan√ßada na fatura":"N√£o lan√ßada"}),s.nr_fatura&&e.jsxs("p",{children:["Fatura: ",s.nr_fatura]})]})]})})}),e.jsx("td",{className:"text-center",children:s.tp_operacao||""}),e.jsx("td",{className:"text-center",children:s.cd_operador||""}),e.jsx("td",{className:"text-center font-medium",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${s.tp_moddctofiscal==="55"?"bg-blue-100 text-blue-800":s.tp_moddctofiscal==="57"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:xe(s.tp_moddctofiscal)})}),e.jsx("td",{className:"text-center font-medium",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${s.tp_situacao==="A"?"bg-green-100 text-green-800":s.tp_situacao==="C"?"bg-red-100 text-red-800":s.tp_situacao==="D"?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"}`,children:me(s.tp_situacao)})}),e.jsx("td",{className:"text-center",children:s.nr_fatura||""}),e.jsx("td",{className:"text-center",children:A(s.dt_fatura)}),e.jsx("td",{className:"text-center",children:A(s.dt_cadastro)}),e.jsx("td",{children:e.jsx("div",{className:"flex justify-center",children:(i=$[s.ds_chaveacesso])!=null&&i.observacao?e.jsx("button",{onClick:()=>ie(s.ds_chaveacesso,!0),className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium hover:bg-blue-200 transition-colors cursor-pointer",title:"Clique para ver/editar observa√ß√£o",children:"üìù 1 Observa√ß√£o"}):e.jsx("button",{onClick:()=>ie(s.ds_chaveacesso,!1),className:"px-3 py-1 bg-gray-100 text-gray-700 rounded text-xs font-medium hover:bg-gray-200 transition-colors",title:"Adicionar observa√ß√£o",children:"+ ADICIONAR OBS"})})})]},`${s.cd_empresa}-${s.nr_nf}-${s.cd_serie}-${a}`)})})]})}),g>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6 pt-4 border-t",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-gray-600",children:["P√°gina ",b," de ",g]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>V(s=>Math.max(s-1,1)),disabled:b===1,className:"p-2 border border-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:e.jsx(es,{size:16})}),Array.from({length:Math.min(5,g)},(s,a)=>{let t;return g<=5||b<=3?t=a+1:b>=g-2?t=g-4+a:t=b-2+a,e.jsx("button",{onClick:()=>V(t),className:`px-3 py-1 border rounded-lg ${b===t?"bg-blue-600 text-white border-blue-600":"border-gray-300 hover:bg-gray-50"}`,children:t},t)}),e.jsx("button",{onClick:()=>V(s=>Math.min(s+1,g)),disabled:b===g,className:"p-2 border border-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:e.jsx(We,{size:16})})]})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(pe,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"Nenhuma consulta realizada"}),e.jsx("p",{className:"text-sm text-gray-500",children:'Selecione as empresas e o per√≠odo desejado, depois clique em "Buscar"'})]})})]}),ee>0&&e.jsx(j,{className:"mt-6 bg-blue-50 border-blue-200",children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{size:20,className:"text-blue-600"}),e.jsxs("span",{className:"font-medium text-blue-800",children:[ee," linha(s) selecionada(s)"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{size:20,className:"text-green-600"}),e.jsxs("span",{className:"font-medium text-green-800",children:["Valor Total: ",de(Ve)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:le,className:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors",children:"Limpar Sele√ß√£o"}),e.jsxs("button",{className:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors flex items-center gap-1",children:[e.jsx(as,{size:14}),"Exportar Selecionados"]})]})]})})}),p.aberto&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:p.editando?"Editar Observa√ß√£o":"Adicionar Observa√ß√£o"}),e.jsx("button",{onClick:q,className:"text-gray-400 hover:text-gray-600",children:e.jsx(se,{size:20})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Observa√ß√£o"}),e.jsx("textarea",{value:p.observacao,onChange:s=>K(a=>({...a,observacao:s.target.value})),className:"w-full border border-gray-300 rounded-lg p-3 text-sm resize-none",rows:4,placeholder:"Digite sua observa√ß√£o..."})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[p.editando&&e.jsx("button",{onClick:Ie,disabled:P===p.chave,className:"px-4 py-2 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:P===p.chave?"Removendo...":"Remover"}),e.jsx("button",{onClick:q,className:"px-4 py-2 text-sm bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400",children:"Cancelar"}),e.jsx("button",{onClick:Re,disabled:P===p.chave,className:"px-4 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:P===p.chave?"Salvando...":"Salvar"})]})]})})]})};export{As as default};
