import{r as l,h as _e,j as e,n as qe,d as Ee,P as Re,p as $e}from"./index-a2563983.js";import{u as Be}from"./useApiClient-0bf86fc1.js";import{u as Oe}from"./usePermissions-4c389311.js";import{n as He}from"./Clock.es-5bd0a93a.js";import{s as Te}from"./XCircle.es-fcbde856.js";import{F as ke}from"./FiltroEmpresa-724027b5.js";const Pe=new Map([["bold",l.createElement(l.Fragment,null,l.createElement("path",{d:"M209.88,69.83A115.19,115.19,0,0,0,128,36h-.41C63.85,36.22,12,88.76,12,153.13V176a20,20,0,0,0,20,20H224a20,20,0,0,0,20-20V152A115.25,115.25,0,0,0,209.88,69.83ZM220,172H127.32l46.44-65A12,12,0,1,0,154.24,93L97.82,172H36V153.13c0-1.72,0-3.43.14-5.13H56a12,12,0,0,0,0-24H40.62c10.91-33.39,40-58.52,75.38-63.21V80a12,12,0,0,0,24,0V60.8A92,92,0,0,1,215.66,124H200a12,12,0,0,0,0,24h19.9c.06,1.33.1,2.66.1,4Z"}))],["duotone",l.createElement(l.Fragment,null,l.createElement("path",{d:"M232,152v24a8,8,0,0,1-8,8H32a8,8,0,0,1-8-8V153.13C24,95.65,70.15,48.2,127.63,48A104,104,0,0,1,232,152Z",opacity:"0.2"}),l.createElement("path",{d:"M207.06,72.67A111.24,111.24,0,0,0,128,40h-.4C66.07,40.21,16,91,16,153.13V176a16,16,0,0,0,16,16H224a16,16,0,0,0,16-16V152A111.25,111.25,0,0,0,207.06,72.67ZM224,176H119.71l54.76-75.3a8,8,0,0,0-12.94-9.42L99.92,176H32V153.13c0-3.08.15-6.12.43-9.13H56a8,8,0,0,0,0-16H35.27c10.32-38.86,44-68.24,84.73-71.66V80a8,8,0,0,0,16,0V56.33A96.14,96.14,0,0,1,221,128H200a8,8,0,0,0,0,16h23.67c.21,2.65.33,5.31.33,8Z"}))],["fill",l.createElement(l.Fragment,null,l.createElement("path",{d:"M240,152v24a16,16,0,0,1-16,16H115.93a4,4,0,0,1-3.24-6.35L174.27,101a8.21,8.21,0,0,0-1.37-11.3,8,8,0,0,0-11.37,1.61l-72,99.06A4,4,0,0,1,86.25,192H32a16,16,0,0,1-16-16V153.13c0-1.79,0-3.57.13-5.33a4,4,0,0,1,4-3.8H48a8,8,0,0,0,8-8.53A8.17,8.17,0,0,0,47.73,128H23.92a4,4,0,0,1-3.87-5c12-43.84,49.66-77.13,95.52-82.28a4,4,0,0,1,4.43,4V72a8,8,0,0,0,8.53,8A8.17,8.17,0,0,0,136,71.73V44.67a4,4,0,0,1,4.43-4A112.18,112.18,0,0,1,236.23,123a4,4,0,0,1-3.88,5H208.27a8.17,8.17,0,0,0-8.25,7.47,8,8,0,0,0,8,8.53h27.92a4,4,0,0,1,4,3.86C240,149.23,240,150.61,240,152Z"}))],["light",l.createElement(l.Fragment,null,l.createElement("path",{d:"M205.65,74.08A109.26,109.26,0,0,0,128,42h-.39C67.17,42.21,18,92.06,18,153.13V176a14,14,0,0,0,14,14H224a14,14,0,0,0,14-14V152A109.3,109.3,0,0,0,205.65,74.08ZM226,176a2,2,0,0,1-2,2H115.78l57.07-78.47a6,6,0,0,0-9.7-7.06L100.94,178H32a2,2,0,0,1-2-2V153.13A102.36,102.36,0,0,1,30.62,142H56a6,6,0,0,0,0-12H32.71C42.6,88.4,78.53,56.86,122,54.19V80a6,6,0,0,0,12,0V54.19A98.05,98.05,0,0,1,223.53,130H200a6,6,0,0,0,0,12h25.5c.33,3.3.5,6.64.5,10Z"}))],["regular",l.createElement(l.Fragment,null,l.createElement("path",{d:"M207.06,72.67A111.24,111.24,0,0,0,128,40h-.4C66.07,40.21,16,91,16,153.13V176a16,16,0,0,0,16,16H224a16,16,0,0,0,16-16V152A111.25,111.25,0,0,0,207.06,72.67ZM224,176H119.71l54.76-75.3a8,8,0,0,0-12.94-9.42L99.92,176H32V153.13c0-3.08.15-6.12.43-9.13H56a8,8,0,0,0,0-16H35.27c10.32-38.86,44-68.24,84.73-71.66V80a8,8,0,0,0,16,0V56.33A96.14,96.14,0,0,1,221,128H200a8,8,0,0,0,0,16h23.67c.21,2.65.33,5.31.33,8Z"}))],["thin",l.createElement(l.Fragment,null,l.createElement("path",{d:"M204.23,75.5A107.37,107.37,0,0,0,127.62,44C68.28,44.21,20,93.16,20,153.13V176a12,12,0,0,0,12,12H224a12,12,0,0,0,12-12V152A107.25,107.25,0,0,0,204.23,75.5ZM228,176a4,4,0,0,1-4,4H111.85l59.38-81.65a4,4,0,1,0-6.46-4.7L102,180H32a4,4,0,0,1-4-4V153.13A103.42,103.42,0,0,1,28.84,140H56a4,4,0,0,0,0-8H30.21C39.59,87.66,77.84,53.93,124,52.09V80a4,4,0,0,0,8,0V52.08A100.08,100.08,0,0,1,226,132H200a4,4,0,0,0,0,8h27.29a101.6,101.6,0,0,1,.71,12Z"}))]]),de=l.forwardRef((V,C)=>l.createElement(_e,{ref:C,...V,weights:Pe}));de.displayName="GaugeIcon";const Ie=de,Ue=({isOpen:V,onClose:C,performanceData:j})=>{var E;if(!V)return null;const L=b=>b<1e3?`${b}ms`:`${(b/1e3).toFixed(2)}s`,Y=b=>b?e.jsx(Ee,{className:"w-4 h-4 text-green-500"}):e.jsx(Te,{className:"w-4 h-4 text-red-500"}),N=b=>b?"text-green-600":"text-red-600";return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Performance das Rotas"})]}),e.jsx("button",{onClick:C,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(qe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[(E=j==null?void 0:j.routes)==null?void 0:E.map((b,T)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[Y(b.success),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm text-gray-800",children:b.name}),e.jsx("div",{className:"text-xs text-gray-500",children:b.endpoint})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`font-semibold text-sm ${N(b.success)}`,children:L(b.duration)}),e.jsxs("div",{className:"text-xs text-gray-500",children:[b.recordCount," registros"]})]})]},T)),(j==null?void 0:j.total)&&e.jsx("div",{className:"border-t border-gray-200 pt-3 mt-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Total:"}),e.jsx("span",{className:"font-bold text-blue-600",children:L(j.total)})]})})]}),e.jsx("div",{className:"px-4 pb-4",children:e.jsx("button",{onClick:C,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"Fechar"})})]})})},Ke=()=>{const V=Be(),{isAdmin:C}=Oe(),[j,L]=l.useState(!1),[Y,N]=l.useState(""),[E,b]=l.useState(""),[T,ae]=l.useState([]),[se,W]=l.useState([]),[ce,re]=l.useState(!1),[oe,me]=l.useState(null),G=l.useRef(0),k=l.useRef(null),R="cmvconsolidado_data",[x,z]=l.useState({dt_inicio:"",dt_fim:"",empresas:[]}),[$,ge]=l.useState([]),[y,ue]=l.useState("ANO"),[F,K]=l.useState(null),[Q,X]=l.useState(!1),q=t=>{if(!t)return!1;const a=new Date,o=a.getMonth()+1,n=a.getFullYear(),[i,c]=t.split("-");return Number(i)===n&&Number(c)===o},xe=t=>t?{timestamp:t.timestamp,periodo:t.periodo,totaisPorSegmento:t.totaisPorSegmento}:null,he=()=>{try{console.log("Tentando liberar espaço no localStorage...");const t=Object.keys(localStorage).filter(o=>o.startsWith(R)).sort();if(t.length<=1)return console.warn("Não há dados suficientes para liberar espaço"),!1;const a=t.slice(0,Math.ceil(t.length/2));return console.log(`Removendo ${a.length} chaves antigas para liberar espaço`),a.forEach(o=>{localStorage.removeItem(o),console.log(`Chave removida: ${o}`)}),a.length>0}catch(t){return console.error("Erro ao tentar liberar espaço localStorage:",t),!1}},B=l.useCallback((t,a)=>{if(!t)return null;const[o,n]=t.split("-");return`${R}_${o}${n}`},[]),_=t=>{let a=0,o=0,n=0,i=0,c=0;for(const s of t||[]){const d=f(s==null?void 0:s.qt_faturado)||1,m=f(s==null?void 0:s.vl_freterat)||0,g=f(s==null?void 0:s.vl_unitliquido)*d+m,v=f(s==null?void 0:s.vl_unitbruto)*d+m,p=f(s==null?void 0:s.vl_produto)*d;String(s==null?void 0:s.tp_operacao).trim()==="E"?(a-=Math.abs(g),o-=Math.abs(v),n+=Math.abs(g),i-=Math.abs(p)):(a+=g,o+=v,i+=p),c+=m}return{totalLiquido:a,totalBruto:o,totalDevolucoes:n,totalCMV:i,totalFrete:c}},ee=t=>{let a=0,o=0,n=0,i=0,c=0;for(const s of t||[]){const d=f(s==null?void 0:s.qt_faturado)||1,m=f(s==null?void 0:s.vl_freterat)||0,g=f(s==null?void 0:s.vl_unitliquido)*d+m,v=f(s==null?void 0:s.vl_unitbruto)*d+m,p=f(s==null?void 0:s.vl_produto)*d;String(s==null?void 0:s.tp_operacao).trim()==="E"?(a-=Math.abs(g),o-=Math.abs(v),n+=Math.abs(g),i-=Math.abs(p)):(a+=g,o+=v,i+=p),c+=m}return{totalLiquido:a,totalBruto:o,totalDevolucoes:n,totalCMV:i,totalFrete:c}},P=l.useCallback(()=>{try{if(typeof localStorage>"u"){console.warn("localStorage não está disponível");return}const t=new Date,a=t.getMonth()+1,o=t.getFullYear();let n=a-1,i=o;n===0&&(n=12,i=o-1);const c=n<10?`0${n}`:`${n}`,s=`${R}_${i}${c}`;Object.keys(localStorage).forEach(d=>{d.startsWith(R)&&d!==s&&!d.endsWith(`${o}${a<10?"0":""}${a}`)&&localStorage.removeItem(d)})}catch(t){console.error("Erro ao limpar dados antigos do localStorage:",t)}},[]),be=l.useCallback((t,a,o,n)=>{try{if(typeof localStorage>"u"){console.warn("localStorage não está disponível");return}if(!t||!a||!o)return;if(q(t)||q(a)){console.log("Não salvando dados do mês atual no localStorage");return}const i=B(t,a);if(!i)return;const c={timestamp:new Date().getTime(),periodo:{dataInicio:t,dataFim:a},dados:o,dadosVarejo:n,totaisPorSegmento:{consolidado:{..._(o),...ee(n)},multimarcas:_(o.filter(g=>Number(g==null?void 0:g.cd_classificacao)===2)),revenda:_(o.filter(g=>Number(g==null?void 0:g.cd_classificacao)===3)),franquia:_(o.filter(g=>Number(g==null?void 0:g.cd_classificacao)===4)),varejo:ee(n)}},s=xe(c),d=JSON.stringify(s),m=()=>{try{return console.log("Salvando dados no localStorage com a chave:",i),localStorage.setItem(i,d),console.log("Dados salvos com sucesso!"),!0}catch{return!1}};m()||(console.warn("Falha ao salvar no localStorage, tentando liberar espaço..."),he()&&(m()||console.error("Não foi possível salvar mesmo após liberar espaço"))),P()}catch(i){console.error("Erro ao salvar dados no localStorage:",i)}},[B,P,q]),ve=l.useCallback((t,a)=>{var o,n;try{if(typeof localStorage>"u")return console.warn("localStorage não está disponível"),null;if(!t||!a)return null;if(q(t)||q(a))return console.log("Período inclui o mês atual. Não usando cache."),null;const i=B(t,a);if(!i)return null;console.log("Verificando dados no localStorage com a chave:",i);const c=localStorage.getItem(i);if(!c)return console.log("Nenhum dado encontrado no localStorage para esta chave"),null;console.log("Dados encontrados no localStorage!");try{const s=JSON.parse(c);return((o=s.periodo)==null?void 0:o.dataInicio)!==t||((n=s.periodo)==null?void 0:n.dataFim)!==a?(console.log("Período dos dados no cache não corresponde ao solicitado"),null):s}catch(s){return console.error("Erro ao analisar dados do localStorage:",s),localStorage.removeItem(i),null}}catch(i){return console.error("Erro ao recuperar dados do localStorage:",i),null}},[B,q]);l.useEffect(()=>{const t=new Date,a=new Date(t.getFullYear(),t.getMonth(),1).toISOString().split("T")[0],o=new Date(t.getFullYear(),t.getMonth()+1,0).toISOString().split("T")[0];z(n=>({...n,dt_inicio:a,dt_fim:o})),P()},[P]);const I=async(t,a,o,n,i=2,c=1e3)=>{var m;let s=0,d;for(;s<=i;)try{const g=performance.now(),v=await t(a),p=performance.now(),O={name:o,endpoint:n,duration:Math.round(p-g),success:v.success,recordCount:((m=v.data)==null?void 0:m.length)||0,attempts:s+1};return{result:v,timing:O}}catch(g){d=g,s++,console.log(`Tentativa ${s} para ${o} falhou. Tentando novamente em ${c}ms...`),s<=i&&(await new Promise(v=>setTimeout(v,c)),c*=2)}return{result:{success:!1,message:`Falha após ${i+1} tentativas: ${(d==null?void 0:d.message)||"Erro desconhecido"}`},timing:{name:o,endpoint:n,duration:0,success:!1,recordCount:0,attempts:s,error:d==null?void 0:d.message}}},te=t=>new Promise(a=>setTimeout(a,t)),fe=(t,a)=>{const o=new Date,n=o.getFullYear(),i=o.getMonth()+1,c=`${n}-${i<10?"0"+i:i}-01`;if(a<c)return{periodoAnterior:{inicio:t,fim:a},periodoAtual:null};if(t>=c)return{periodoAnterior:null,periodoAtual:{inicio:t,fim:a}};const s=new Date(n,i-1,0).toISOString().split("T")[0];return{periodoAnterior:{inicio:t,fim:s},periodoAtual:{inicio:c,fim:a}}},pe=async()=>{var t,a,o,n;try{L(!0),b(""),X(!1);const i=fe(x.dt_inicio,x.dt_fim);if(i.periodoAnterior&&!i.periodoAtual){const h=ve(i.periodoAnterior.inicio,i.periodoAnterior.fim);if(h)if(console.log("Usando dados do cache para o período:",i.periodoAnterior.inicio,"a",i.periodoAnterior.fim),h.totaisPorSegmento&&(!h.dados||h.dados.length===0)){console.log("Usando totais pré-calculados do cache"),X(!0),N(""),L(!1),k.current=h.totaisPorSegmento;return}else{ae(h.dados||[]),W(h.dadosVarejo||[]),X(!0),N(""),L(!1);return}}const c={dt_inicio:x.dt_inicio,dt_fim:x.dt_fim,cd_classificacao:[2,3,4]},s=$.length>0?$.map(h=>Number(h.cd_empresa)):[1,2,6,11,31,75,85,92,99];c.cd_empresa=s;const d=s,m=s,g={dt_inicio:x.dt_inicio,dt_fim:x.dt_fim,cd_empresa:d,cd_classificacao:[4]},v={dt_inicio:x.dt_inicio,dt_fim:x.dt_fim,cd_empresa:d,cd_classificacao:[2]},p={dt_inicio:x.dt_inicio,dt_fim:x.dt_fim,cd_empresa:d,cd_classificacao:[3]},O={dt_inicio:x.dt_inicio,dt_fim:x.dt_fim,cd_empresa:m},ne=++G.current,ye=performance.now(),H=[];console.log("Iniciando requisições sequenciais..."),N("Carregando dados de Franquia (1/4)...");const{result:we,timing:Me}=await I(V.sales.cmvfranquia,g,"Franquia","/api/sales/cmvfranquia");H.push(Me),await te(500),N("Carregando dados de Multimarcas (2/4)...");const{result:Ae,timing:Se}=await I(V.sales.cmvmultimarcas,v,"Multimarcas","/api/sales/cmvmultimarcas");H.push(Se),await te(500),N("Carregando dados de Revenda (3/4)...");const{result:Ce,timing:De}=await I(V.sales.cmvrevenda,p,"Revenda","/api/sales/cmvrevenda");H.push(De),await te(500),N("Carregando dados de Varejo (4/4)...");const{result:Ve,timing:Fe}=await I(V.sales.cmvvarejo,O,"Varejo","/api/sales/cmvvarejo");H.push(Fe),N("Processando dados...");const Le=Math.round(performance.now()-ye);C()&&me({routes:H,total:Le,timestamp:new Date().toISOString()});const w=we,M=Ae,A=Ce,S=Ve;let D=[],J=!1;if(w.success){const h=Array.isArray((t=w==null?void 0:w.data)==null?void 0:t.data)?w.data.data:Array.isArray(w==null?void 0:w.data)?w.data:[];D=D.concat(h)}else console.warn("Falha ao carregar franquia:",w.message),J=!0;if(M.success){const h=Array.isArray((a=M==null?void 0:M.data)==null?void 0:a.data)?M.data.data:Array.isArray(M==null?void 0:M.data)?M.data:[];D=D.concat(h)}else console.warn("Falha ao carregar multimarcas:",M.message),J=!0;if(A.success){const h=Array.isArray((o=A==null?void 0:A.data)==null?void 0:o.data)?A.data.data:Array.isArray(A==null?void 0:A.data)?A.data:[];D=D.concat(h)}else console.warn("Falha ao carregar revenda:",A.message),J=!0;if(J&&b("Algumas consultas falharam, mas dados disponíveis serão exibidos"),ne===G.current&&ae(D),!S.success)console.warn("Falha ao carregar varejo:",S.message),W([]);else{const h=Array.isArray((n=S==null?void 0:S.data)==null?void 0:n.data)?S.data.data:Array.isArray(S==null?void 0:S.data)?S.data:[];ne===G.current&&(W(h),(D.length>0||h.length>0)&&be(x.dt_inicio,x.dt_fim,D,h))}}catch(i){b("Erro ao buscar dados"),console.error(i)}finally{N(""),L(!1)}},f=t=>{if(t==null)return 0;if(typeof t=="number")return t;const a=Number(String(t).trim());return Number.isNaN(a)?0:a},u=t=>f(t).toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),je=t=>{if(!t)return null;try{const[a]=String(t).split("T"),[o,n,i]=a.split("-").map(c=>parseInt(c,10));return!o||!n||!i?null:new Date(o,n-1,i)}catch{return null}},Ne=t=>({JAN:31,FEV:28,MAR:31,ABR:30,MAI:31,JUN:30,JUL:31,AGO:31,SET:30,OUT:31,NOV:30,DEZ:31})[t]||0,ie=t=>{ue(t),K(null)},le=(t,a,o=null)=>t.filter(n=>{const i=n.dt_transacao;if(!i)return!1;const c=je(i),s=c.getFullYear(),d=c.getMonth()+1,m=c.getDate();if(a==="ANO"){const p=new Date().getFullYear();return s===p}const v={JAN:1,FEV:2,MAR:3,ABR:4,MAI:5,JUN:6,JUL:7,AGO:8,SET:9,OUT:10,NOV:11,DEZ:12}[a];return!v||d!==v?!1:o!==null?m===o:!0}),U=l.useMemo(()=>le(T,y,F),[T,y,F]),Z=l.useMemo(()=>le(se||[],y,F),[se,y,F]),r=l.useMemo(()=>{if(k.current&&Q)return console.log("Usando totais calculados do cache"),k.current;const t=d=>(U||[]).filter(m=>Number(m==null?void 0:m.cd_classificacao)===Number(d)),a=_(t(2)),o=_(t(3)),n=_(t(4)),i=ee(Z),c=(d,m)=>({totalLiquido:d.totalLiquido+m.totalLiquido,totalBruto:d.totalBruto+m.totalBruto,totalDevolucoes:d.totalDevolucoes+m.totalDevolucoes,totalCMV:d.totalCMV+m.totalCMV,totalFrete:d.totalFrete+m.totalFrete});return{consolidado:c(c(a,o),c(n,i)),multimarcas:a,franquia:n,revenda:o,varejo:i}},[U,Z,Q,k]);return e.jsxs("div",{className:"w-full max-w-7xl mx-auto p-4",children:[e.jsx(Re,{title:"CMV CONSOLIDADO",subtitle:"Consulta do CMV Consolidado dos canais MULTIMARCAS, REVENDA, FRANQUIA e VAREJO",icon:$e,iconColor:"text-indigo-600"}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-3 mb-4 border border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1",children:"Data Início"}),e.jsx("input",{type:"date",value:x.dt_inicio,onChange:t=>z(a=>({...a,dt_inicio:t.target.value})),className:"border rounded px-2 py-1.5 w-full text-xs"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1",children:"Data Fim"}),e.jsx("input",{type:"date",value:x.dt_fim,onChange:t=>z(a=>({...a,dt_fim:t.target.value})),className:"border rounded px-2 py-1.5 w-full text-xs"})]}),e.jsx("div",{children:e.jsx(ke,{empresasSelecionadas:$,onSelectEmpresas:ge,apenasEmpresa101:!1})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:pe,disabled:j||!x.dt_inicio||!x.dt_fim,className:"bg-indigo-600 text-white text-xs px-3 py-2 rounded hover:bg-indigo-700 disabled:opacity-50",children:j?Y||"Buscando...":"Buscar"}),C()&&oe&&e.jsxs("button",{onClick:()=>re(!0),className:"bg-blue-500 text-white text-xs px-3 py-2 rounded hover:bg-blue-600 flex items-center gap-1",title:"Ver performance das rotas",children:[e.jsx(Ie,{className:"w-3 h-3"}),"Performance"]})]})]}),E&&e.jsx("div",{className:"mt-2 text-xs text-red-600",children:E}),Q&&e.jsxs("div",{className:"mt-2 text-xs text-blue-600 flex items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Dados carregados do cache local"]}),C()&&e.jsx("button",{onClick:()=>{console.log("Chaves no localStorage:",Object.keys(localStorage).filter(o=>o.startsWith(R)));const t=B(x.dt_inicio,x.dt_fim),a=localStorage.getItem(t);console.log("Dados para a chave atual:",t,a?"Encontrados":"Não encontrados")},className:"mt-2 text-xs bg-gray-200 text-gray-700 px-2 py-1 rounded hover:bg-gray-300",children:"Debug localStorage"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-3 mb-4 border border-gray-200",children:[e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx("button",{onClick:()=>ie("ANO"),className:`px-3 py-1 text-xs font-medium rounded-md transition-colors ${y==="ANO"?"bg-[#000638] text-white":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-300"}`,children:"ANO"}),["JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ"].map(t=>e.jsx("button",{onClick:()=>ie(t),className:`px-3 py-1 text-xs font-medium rounded-md transition-colors ${y===t?"bg-[#000638] text-white":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-300"}`,children:t},t))]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:[e.jsx("span",{className:"font-medium",children:"Filtro ativo:"})," ",y,F&&e.jsxs("span",{className:"ml-1",children:["- Dia ",F]}),$.length>0&&e.jsxs("span",{className:"ml-2",children:["- Empresas: ",$.length," selecionada(s)"]}),e.jsxs("span",{className:"ml-2",children:["(",U.length+Z.length," registro",U.length+Z.length!==1?"s":"",")"]})]}),y!=="ANO"&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs("h4",{className:"font-bold text-xs text-[#000638] font-barlow",children:["Filtro por Dia - ",y]})}),e.jsxs("div",{className:"flex flex-wrap gap-0.5",children:[e.jsx("button",{onClick:()=>K(null),className:`px-2 py-0.5 text-xs font-medium rounded-md transition-colors ${F===null?"bg-[#000638] text-white":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-300"}`,children:"TODOS"}),Array.from({length:Ne(y)},(t,a)=>a+1).map(t=>e.jsx("button",{onClick:()=>K(t),className:`px-1.5 py-0.5 text-xs font-medium rounded-md transition-colors ${F===t?"bg-[#000638] text-white":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-300"}`,children:t},t))]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"CONSOLIDADO"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-9 gap-3",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Receita Liq + Imp"}),e.jsx("div",{className:"text-lg font-semibold text-green-600",children:u(r.consolidado.totalLiquido)})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Receita Bruta"}),e.jsx("div",{className:"text-lg font-semibold text-blue-600",children:u(r.consolidado.totalBruto)})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Devoluções"}),e.jsx("div",{className:"text-lg font-semibold text-red-600",children:u(r.consolidado.totalDevolucoes)})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"CMV"}),e.jsx("div",{className:"text-lg font-semibold",children:u(r.consolidado.totalCMV)})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"CMV %"}),e.jsx("div",{className:"text-lg font-semibold",children:(()=>{const t=Math.abs(r.consolidado.totalLiquido)||0;return t?`${(r.consolidado.totalCMV/t*100).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}%`:"0,00%"})()})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Margem %"}),e.jsx("div",{className:"text-lg font-semibold",children:(()=>{const t=Math.abs(r.consolidado.totalLiquido)||0;return t?`${((r.consolidado.totalLiquido-r.consolidado.totalCMV)/t*100).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}%`:"0,00%"})()})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Markup"}),e.jsx("div",{className:"text-lg font-semibold",children:(()=>{const t=Math.abs(r.consolidado.totalCMV)||0;return t?`${(r.consolidado.totalLiquido/t).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}x`:"—"})()})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Frete"}),e.jsx("div",{className:"text-lg font-semibold",children:u(r.consolidado.totalFrete)})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"VAREJO"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-9 gap-3",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Receita Liq + Imp"}),e.jsx("div",{className:"text-lg font-semibold text-green-600",children:u(r.varejo.totalLiquido)})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Receita Bruta"}),e.jsx("div",{className:"text-lg font-semibold text-blue-600",children:u(r.varejo.totalBruto)})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Devoluções"}),e.jsx("div",{className:"text-lg font-semibold text-red-600",children:u(r.varejo.totalDevolucoes)})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"CMV"}),e.jsx("div",{className:"text-lg font-semibold",children:u(r.varejo.totalCMV)})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"CMV %"}),e.jsx("div",{className:"text-lg font-semibold",children:(()=>{const t=Math.abs(r.varejo.totalLiquido)||0;return t?`${(r.varejo.totalCMV/t*100).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}%`:"0,00%"})()})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Margem %"}),e.jsx("div",{className:"text-lg font-semibold",children:(()=>{const t=Math.abs(r.varejo.totalLiquido)||0;return t?`${((r.varejo.totalLiquido-r.varejo.totalCMV)/t*100).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}%`:"0,00%"})()})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Markup"}),e.jsx("div",{className:"text-lg font-semibold",children:(()=>{const t=Math.abs(r.varejo.totalCMV)||0;return t?`${(r.varejo.totalLiquido/t).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}x`:"—"})()})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Frete"}),e.jsx("div",{className:"text-lg font-semibold",children:u(r.varejo.totalFrete)})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"REVENDA"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-9 gap-3",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Receita Liq + Imp"}),e.jsx("div",{className:"text-lg font-semibold text-green-600",children:u(r.revenda.totalLiquido)})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Receita Bruta"}),e.jsx("div",{className:"text-lg font-semibold text-blue-600",children:u(r.revenda.totalBruto)})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Devoluções"}),e.jsx("div",{className:"text-lg font-semibold text-red-600",children:u(r.revenda.totalDevolucoes)})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"CMV"}),e.jsx("div",{className:"text-lg font-semibold",children:u(r.revenda.totalCMV)})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"CMV %"}),e.jsx("div",{className:"text-lg font-semibold",children:(()=>{const t=Math.abs(r.revenda.totalLiquido)||0;return t?`${(r.revenda.totalCMV/t*100).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}%`:"0,00%"})()})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Margem %"}),e.jsx("div",{className:"text-lg font-semibold",children:(()=>{const t=Math.abs(r.revenda.totalLiquido)||0;return t?`${((r.revenda.totalLiquido-r.revenda.totalCMV)/t*100).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}%`:"0,00%"})()})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Markup"}),e.jsx("div",{className:"text-lg font-semibold",children:(()=>{const t=Math.abs(r.revenda.totalCMV)||0;return t?`${(r.revenda.totalLiquido/t).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}x`:"—"})()})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Frete"}),e.jsx("div",{className:"text-lg font-semibold",children:u(r.revenda.totalFrete)})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"FRANQUIA"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-9 gap-3",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Receita Liq + Imp"}),e.jsx("div",{className:"text-lg font-semibold text-green-600",children:u(r.franquia.totalLiquido)})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Receita Bruta"}),e.jsx("div",{className:"text-lg font-semibold text-blue-600",children:u(r.franquia.totalBruto)})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Devoluções"}),e.jsx("div",{className:"text-lg font-semibold text-red-600",children:u(r.franquia.totalDevolucoes)})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"CMV"}),e.jsx("div",{className:"text-lg font-semibold",children:u(r.franquia.totalCMV)})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"CMV %"}),e.jsx("div",{className:"text-lg font-semibold",children:(()=>{const t=Math.abs(r.franquia.totalLiquido)||0;return t?`${(r.franquia.totalCMV/t*100).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}%`:"0,00%"})()})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Margem %"}),e.jsx("div",{className:"text-lg font-semibold",children:(()=>{const t=Math.abs(r.franquia.totalLiquido)||0;return t?`${((r.franquia.totalLiquido-r.franquia.totalCMV)/t*100).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}%`:"0,00%"})()})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Markup"}),e.jsx("div",{className:"text-lg font-semibold",children:(()=>{const t=Math.abs(r.franquia.totalCMV)||0;return t?`${(r.franquia.totalLiquido/t).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}x`:"—"})()})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Frete"}),e.jsx("div",{className:"text-lg font-semibold",children:u(r.franquia.totalFrete)})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"MULTIMARCAS"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-9 gap-3",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Receita Liq + Imp"}),e.jsx("div",{className:"text-lg font-semibold text-green-600",children:u(r.multimarcas.totalLiquido)})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Receita Bruta"}),e.jsx("div",{className:"text-lg font-semibold text-blue-600",children:u(r.multimarcas.totalBruto)})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Devoluções"}),e.jsx("div",{className:"text-lg font-semibold text-red-600",children:u(r.multimarcas.totalDevolucoes)})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"CMV"}),e.jsx("div",{className:"text-lg font-semibold",children:u(r.multimarcas.totalCMV)})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"CMV %"}),e.jsx("div",{className:"text-lg font-semibold",children:(()=>{const t=Math.abs(r.multimarcas.totalLiquido)||0;return t?`${(r.multimarcas.totalCMV/t*100).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}%`:"0,00%"})()})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Margem %"}),e.jsx("div",{className:"text-lg font-semibold",children:(()=>{const t=Math.abs(r.multimarcas.totalLiquido)||0;return t?`${((r.multimarcas.totalLiquido-r.multimarcas.totalCMV)/t*100).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}%`:"0,00%"})()})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Markup"}),e.jsx("div",{className:"text-lg font-semibold",children:(()=>{const t=Math.abs(r.multimarcas.totalCMV)||0;return t?`${(r.multimarcas.totalLiquido/t).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}x`:"—"})()})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-3",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Frete"}),e.jsx("div",{className:"text-lg font-semibold",children:u(r.multimarcas.totalFrete)})]})]})]}),C()&&e.jsx(Ue,{isOpen:ce,onClose:()=>re(!1),performanceData:oe})]})};export{Ke as default};
