import{r as t,h as F,j as e,c as $,L as C,n as Z,k as w}from"./index-a2563983.js";import{M as k}from"./Modal-8500ef4b.js";import{u as z}from"./useApiClient-0bf86fc1.js";import{c as _}from"./ArrowDown.es-b2258871.js";import{s as E}from"./ArrowUp.es-3ccbaccd.js";import{m as I}from"./CurrencyDollar.es-0edca053.js";const R=new Map([["bold",t.createElement(t.Fragment,null,t.createElement("path",{d:"M228,144v64a12,12,0,0,1-12,12H40a12,12,0,0,1-12-12V144a12,12,0,0,1,24,0v52H204V144a12,12,0,0,1,24,0Zm-108.49,8.49a12,12,0,0,0,17,0l40-40a12,12,0,0,0-17-17L140,115V32a12,12,0,0,0-24,0v83L96.49,95.51a12,12,0,0,0-17,17Z"}))],["duotone",t.createElement(t.Fragment,null,t.createElement("path",{d:"M216,48V208H40V48A16,16,0,0,1,56,32H200A16,16,0,0,1,216,48Z",opacity:"0.2"}),t.createElement("path",{d:"M224,144v64a8,8,0,0,1-8,8H40a8,8,0,0,1-8-8V144a8,8,0,0,1,16,0v56H208V144a8,8,0,0,1,16,0Zm-101.66,5.66a8,8,0,0,0,11.32,0l40-40a8,8,0,0,0-11.32-11.32L136,124.69V32a8,8,0,0,0-16,0v92.69L93.66,98.34a8,8,0,0,0-11.32,11.32Z"}))],["fill",t.createElement(t.Fragment,null,t.createElement("path",{d:"M224,144v64a8,8,0,0,1-8,8H40a8,8,0,0,1-8-8V144a8,8,0,0,1,16,0v56H208V144a8,8,0,0,1,16,0Zm-101.66,5.66a8,8,0,0,0,11.32,0l40-40A8,8,0,0,0,168,96H136V32a8,8,0,0,0-16,0V96H88a8,8,0,0,0-5.66,13.66Z"}))],["light",t.createElement(t.Fragment,null,t.createElement("path",{d:"M222,144v64a6,6,0,0,1-6,6H40a6,6,0,0,1-6-6V144a6,6,0,0,1,12,0v58H210V144a6,6,0,0,1,12,0Zm-98.24,4.24a6,6,0,0,0,8.48,0l40-40a6,6,0,0,0-8.48-8.48L134,129.51V32a6,6,0,0,0-12,0v97.51L92.24,99.76a6,6,0,0,0-8.48,8.48Z"}))],["regular",t.createElement(t.Fragment,null,t.createElement("path",{d:"M224,144v64a8,8,0,0,1-8,8H40a8,8,0,0,1-8-8V144a8,8,0,0,1,16,0v56H208V144a8,8,0,0,1,16,0Zm-101.66,5.66a8,8,0,0,0,11.32,0l40-40a8,8,0,0,0-11.32-11.32L136,124.69V32a8,8,0,0,0-16,0v92.69L93.66,98.34a8,8,0,0,0-11.32,11.32Z"}))],["thin",t.createElement(t.Fragment,null,t.createElement("path",{d:"M220,144v64a4,4,0,0,1-4,4H40a4,4,0,0,1-4-4V144a4,4,0,0,1,8,0v60H212V144a4,4,0,0,1,8,0Zm-94.83,2.83a4,4,0,0,0,5.66,0l40-40a4,4,0,1,0-5.66-5.66L132,134.34V32a4,4,0,0,0-8,0V134.34L90.83,101.17a4,4,0,0,0-5.66,5.66Z"}))]]),V=t.forwardRef((x,p)=>t.createElement(F,{ref:p,...x,weights:R}));V.displayName="DownloadSimpleIcon";const P=V,Q=({isOpen:x,onClose:p,nrCtaPes:d,dataUltimoMovimento:B})=>{const D=z(),[m,g]=t.useState([]),[f,j]=t.useState(!1),[u,v]=t.useState(""),[i,M]=t.useState({}),H=()=>{const a=new Date,r=a.toISOString().split("T")[0];return{dataInicio:new Date(a.getTime()-90*24*60*60*1e3).toISOString().split("T")[0],dataFim:r}},L=async()=>{var a,r;if(d){j(!0),v("");try{const{dataInicio:s,dataFim:l}=H();console.log("🔍 Buscando dados de auditoria para conta:",d),console.log("📅 Período calculado:",s,"a",l),console.log("🌐 Chamando API auditor-credev...");let o;try{o=await D.financial.auditorCredev({nr_ctapes:d,dt_movim_ini:s,dt_movim_fim:l})}catch{console.log("⚠️ Erro no useApiClient, tentando fetch direto...");const c=await fetch(`/api/financial/auditor-credev?nr_ctapes=${d}&dt_movim_ini=${s}&dt_movim_fim=${l}`);if(!c.ok)throw new Error(`HTTP ${c.status}: ${c.statusText}`);const y=await c.json();o={success:!0,data:y.data,message:y.message}}if(console.log("📦 Resultado da API:",o),o.success){const h=((a=o.data)==null?void 0:a.data)||o.data||[],c=((r=o.data)==null?void 0:r.filtros)||o.filtros||{};console.log("✅ Dados recebidos:",{movimentacoes:h.length,filtros:c}),g(h),M(c)}else throw new Error(o.message||"Erro ao buscar dados de auditoria")}catch(s){console.error("❌ Erro ao buscar dados de auditoria:",s);let l="Erro ao carregar dados de auditoria do servidor.";s.message.includes("Unexpected token")?l="Erro no formato de resposta do servidor. Tente novamente.":s.message.includes("Failed to fetch")?l="Erro de conexão com o servidor. Verifique sua internet.":s.message.includes("HTTP")&&(l=`Erro do servidor: ${s.message}`),v(l),g([])}finally{j(!1)}}};t.useEffect(()=>{x&&d&&L()},[x,d]);const n=a=>{if(!a)return"-";const r=new Date(a);return isNaN(r)?"-":r.toLocaleDateString("pt-BR")},N=a=>a==null?"-":Number(a).toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),S=a=>a==="C"?e.jsx(E,{size:16,className:"text-green-600"}):a==="D"?e.jsx(_,{size:16,className:"text-red-600"}):e.jsx(w,{size:16,className:"text-gray-600"}),b=a=>a==="C"?"text-green-600":a==="D"?"text-red-600":"text-gray-600",A=a=>a==="C"?"Crédito":a==="D"?"Débito":a||"-",T=()=>i.dt_movim_ini&&i.dt_movim_fim?`Auditoria CREDEV - Conta ${d} (Últimos 90 dias: ${n(i.dt_movim_ini)} a ${n(i.dt_movim_fim)})`:`Auditoria CREDEV - Conta ${d}`;return e.jsx(k,{isOpen:x,onClose:p,title:T(),size:"6xl",className:"max-h-[90vh] overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[i&&Object.keys(i).length>0&&e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("h3",{className:"text-sm font-semibold text-blue-800 mb-2 flex items-center gap-2",children:[e.jsx($,{size:16}),"Filtros Aplicados"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-blue-700",children:"Conta:"}),e.jsx("span",{className:"ml-2 text-blue-600",children:i.nr_ctapes})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-blue-700",children:"Data Início:"}),e.jsx("span",{className:"ml-2 text-blue-600",children:n(i.dt_movim_ini)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-blue-700",children:"Data Fim:"}),e.jsx("span",{className:"ml-2 text-blue-600",children:n(i.dt_movim_fim)})]})]})]}),f&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(C,{size:"lg"}),e.jsx("span",{className:"mt-4 text-gray-600",children:"Carregando dados de auditoria..."})]}),u&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-800",children:[e.jsx(Z,{size:20}),e.jsx("span",{className:"font-medium",children:"Erro:"}),e.jsx("span",{children:u})]})}),!f&&!u&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 mb-2",children:[e.jsx(w,{size:16}),e.jsx("span",{className:"text-sm font-medium",children:"Total de Movimentações"})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:m.length})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600 mb-2",children:[e.jsx(E,{size:16}),e.jsx("span",{className:"text-sm font-medium",children:"Total Créditos"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-700",children:m.filter(a=>a.tp_operacao==="C").length})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600 mb-2",children:[e.jsx(_,{size:16}),e.jsx("span",{className:"text-sm font-medium",children:"Total Débitos"})]}),e.jsx("div",{className:"text-2xl font-bold text-red-700",children:m.filter(a=>a.tp_operacao==="D").length})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-600 mb-2",children:[e.jsx(I,{size:16}),e.jsx("span",{className:"text-sm font-medium",children:"Saldo Período"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-700",children:N(m.reduce((a,r)=>{const s=Number(r.vl_lancto)||0;return a+(r.tp_operacao==="C"?s:-s)},0))})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Movimentações Financeiras"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Período: Últimos 90 dias (",n(i.dt_movim_ini)," a ",n(i.dt_movim_fim),")"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data Movimento"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Documento"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descrição"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data Liquidação"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Operador"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estorno"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-4 py-8 text-center text-gray-500",children:"Nenhuma movimentação encontrada para o período selecionado"})}):m.map((a,r)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:n(a.dt_movim)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[S(a.tp_operacao),e.jsx("span",{className:`font-medium ${b(a.tp_operacao)}`,children:A(a.tp_operacao)})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:a.ds_doc||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 max-w-xs truncate",children:a.ds_aux||"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium",children:e.jsx("span",{className:b(a.tp_operacao),children:N(a.vl_lancto)})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:n(a.dt_liq)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:a.nm_usuario||a.cd_operador||"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:a.in_estorno==="S"?e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800",children:"Sim"}):e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800",children:"Não"})})]},r))})]})})]})]})]})})};export{Q as M,P as l};
