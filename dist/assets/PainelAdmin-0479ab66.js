import{r,j as e,n as A,d as L,u as z,w as N,L as R,U as $,x as w}from"./index-a2563983.js";import{f as O,c as P,u as _,a as q,d as D}from"./userProfiles-2dc3ab72.js";import{s as T}from"./XCircle.es-fcbde856.js";const B=({message:n,type:c="info",onClose:l,duration:d=5e3})=>{r.useEffect(()=>{if(d&&l){const a=setTimeout(l,d);return()=>clearTimeout(a)}},[d,l]);const x=()=>{switch(c){case"success":return e.jsx(L,{size:20,className:"text-green-500"});case"error":return e.jsx(T,{size:20,className:"text-red-500"});default:return null}},h=()=>{switch(c){case"success":return"bg-green-50 border-green-200 text-green-800";case"error":return"bg-red-50 border-red-200 text-red-800";default:return"bg-blue-50 border-blue-200 text-blue-800"}};return e.jsx("div",{className:`fixed top-4 right-4 z-50 p-4 border rounded-lg shadow-lg ${h()} max-w-sm`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[x(),e.jsx("p",{className:"flex-1",children:n}),l&&e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(A,{size:16})})]})})},v=B,I=Object.entries(w).map(([n,c])=>({value:n,label:c}));function H(){const{user:n}=z(),[c,l]=r.useState([]),[d,x]=r.useState(!0),[h,a]=r.useState(""),[f,g]=r.useState(""),[t,p]=r.useState({id:null,name:"",email:"",password:"",role:"user",active:!0}),[i,j]=r.useState(!1);if(!n||n.role!=="owner")return e.jsxs("div",{className:"p-8 text-red-600 font-bold text-center",children:[e.jsx(N,{size:48,className:"mx-auto mb-4 text-red-500"}),e.jsx("p",{children:"Acesso restrito ao Proprietário."}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Você não tem permissão para acessar esta página."})]});const b=async()=>{x(!0),a("");try{const s=await O();l(s)}catch(s){a(s.message)}x(!1)};r.useEffect(()=>{b()},[]);const m=s=>{const{name:o,value:u,type:U,checked:C}=s.target;p(k=>({...k,[o]:U==="checkbox"?C:u}))},y=async s=>{s.preventDefault(),a("");try{if(await P(t.email,i?t.id:null)){a("Este email já está em uso.");return}if(i){const u={...t};u.password||delete u.password,await _(t.id,u)}else{if(!t.password){a("Senha é obrigatória para novos usuários.");return}await q(t)}p({id:null,name:"",email:"",password:"",role:"user",active:!0}),j(!1),g(i?"Usuário atualizado com sucesso!":"Usuário criado com sucesso!"),b()}catch(o){a(o.message)}},E=s=>{p({...s,password:""}),j(!0)},S=async s=>{if(window.confirm("Tem certeza que deseja excluir este usuário?")){a("");try{await D(s),g("Usuário excluído com sucesso!"),b()}catch(o){a(o.message)}}};return e.jsxs("div",{className:"p-8 max-w-4xl mx-auto",children:[h&&e.jsx(v,{message:h,type:"error",onClose:()=>a("")}),f&&e.jsx(v,{message:f,type:"success",onClose:()=>g("")}),e.jsxs("div",{className:"flex items-center mb-6 gap-2",children:[e.jsx(N,{size:32,className:"text-blue-700"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Painel Admin"})]}),e.jsxs("form",{onSubmit:y,className:"mb-8 bg-gray-50 p-4 rounded-lg shadow",children:[e.jsxs("div",{className:"flex gap-4 mb-2",children:[e.jsx("input",{name:"name",value:t.name,onChange:m,placeholder:"Nome",className:"border p-2 rounded w-full",required:!0}),e.jsx("input",{name:"email",value:t.email,onChange:m,placeholder:"E-mail",className:"border p-2 rounded w-full",required:!0,type:"email"})]}),e.jsxs("div",{className:"flex gap-4 mb-2",children:[e.jsx("input",{name:"password",value:t.password,onChange:m,placeholder:i?"Nova senha (opcional)":"Senha",className:"border p-2 rounded w-full",type:"password",minLength:4}),e.jsx("select",{name:"role",value:t.role,onChange:m,className:"border p-2 rounded",children:I.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",name:"active",checked:t.active,onChange:m}),"Ativo"]})]}),e.jsx("button",{className:"bg-blue-700 text-white px-4 py-2 rounded hover:bg-blue-800",type:"submit",children:i?"Salvar":"Criar Usuário"}),i&&e.jsx("button",{type:"button",className:"ml-4 text-gray-600 underline",onClick:()=>{j(!1),p({id:null,name:"",email:"",password:"",role:"user",active:!0})},children:"Cancelar"})]}),e.jsx("h2",{className:"text-lg font-bold mb-2",children:"Usuários cadastrados"}),d?e.jsx(R,{text:"Carregando usuários..."}):e.jsxs("table",{className:"w-full border bg-white rounded shadow text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"p-2",children:"Nome"}),e.jsx("th",{className:"p-2",children:"E-mail"}),e.jsx("th",{className:"p-2",children:"Perfil"}),e.jsx("th",{className:"p-2",children:"Ativo"}),e.jsx("th",{className:"p-2",children:"Ações"})]})}),e.jsx("tbody",{children:c.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:s.name}),e.jsx("td",{className:"p-2",children:s.email}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${$[s.role]||"bg-gray-100 text-gray-800"}`,children:w[s.role]||s.role})}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.active?"Ativo":"Inativo"})}),e.jsxs("td",{className:"p-2 flex gap-2",children:[e.jsx("button",{className:"text-blue-700 underline",onClick:()=>E(s),children:"Editar"}),e.jsx("button",{className:"text-red-600 underline",onClick:()=>S(s.id),children:"Excluir"})]})]},s.id))})]})]})}export{H as default};
