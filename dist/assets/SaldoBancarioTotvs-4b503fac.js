import{r as a,j as t,s as U,E as K,b as Q}from"./index-a2563983.js";import{c as x,D as P}from"./contas-75c47386.js";import{m as ee}from"./ArrowsClockwise.es-cccb614c.js";import{s as z}from"./CaretUp.es-b369da07.js";import{c as M}from"./CaretUpDown.es-453a995a.js";import{p as te}from"./Spinner.es-3c850cda.js";import"./cards-fd94db0b.js";import{u as se}from"./useApiClient-0bf86fc1.js";const N=20,ge=()=>{const j=se(),[h,C]=a.useState([]),[re,T]=a.useState(0),[g,_]=a.useState(!1),[E,w]=a.useState(""),[oe,V]=a.useState(!1),[y,B]=a.useState([]),[ae,O]=a.useState(0),[ne,R]=a.useState(!1),[le,A]=a.useState("");a.useState(!0);const[i,I]=a.useState({nr_ctapes:[],dt_movim_ini:"2020-01-01",dt_movim_fim:""});a.useState(!0),a.useState(!1),a.useState({title:"",description:"",calculation:""});const[D,k]=a.useState(1),[ce,$]=a.useState(1),[l,G]=a.useState({campo:null,direcao:"asc"}),[ie,L]=a.useState(new Set);a.useEffect(()=>{const e=document.createElement("style");return e.textContent=`
      .table-container { overflow-x: auto; position: relative; max-width: 100%; }
      .extrato-table { border-collapse: collapse; width: 100%; }
      .extrato-table th, .extrato-table td { padding: 6px 8px !important; border-right: 1px solid #f3f4f6; word-wrap: break-word; white-space: normal; font-size: 11px; line-height: 1.3; }
      .extrato-table th:last-child, .extrato-table td:last-child { border-right: none; }
      .extrato-table th { background-color: #000638; color: white; font-weight: 600; text-transform: uppercase; font-size: 10px; letter-spacing: 0.05em; }
      .extrato-table tbody tr:nth-child(odd) { background-color: white; }
      .extrato-table tbody tr:nth-child(even) { background-color: #fafafa; }
      .extrato-table tbody tr:hover { background-color: #f0f9ff; transition: background-color 0.2s ease; }
      .extrato-table thead th:first-child, .extrato-table tbody td:first-child { position: sticky !important; left: 0 !important; z-index: 10 !important; border-right: 2px solid #e5e7eb !important; box-shadow: 2px 0 4px rgba(0,0,0,0.1) !important; }
      .extrato-table thead th:first-child { background: #000638 !important; z-index: 20 !important; border-right: 2px solid #374151 !important; }
      .extrato-table tbody tr:nth-child(even) td:first-child { background: #fafafa !important; }
      .extrato-table tbody tr:nth-child(odd) td:first-child { background: #ffffff !important; }
      .extrato-table tbody tr:hover td:first-child { background: #f0f9ff !important; }
      .extrato-table tbody tr.bg-blue-100 td:first-child { background: #dbeafe !important; }
      .extrato-table tbody tr.bg-blue-100:hover td:first-child { background: #bfdbfe !important; }
      .extrato-table th:first-child input[type="checkbox"], .extrato-table td:first-child input[type="checkbox"] { transform: scale(1.1); }
    `,document.head.appendChild(e),()=>{document.head.removeChild(e)}},[]),a.useCallback(e=>{G(s=>({campo:e,direcao:s.campo===e&&s.direcao==="asc"?"desc":"asc"}))},[]),a.useCallback(e=>l.campo!==e?t.jsx(M,{size:12,className:"opacity-50"}):l.direcao==="asc"?t.jsx(z,{size:12}):t.jsx(U,{size:12}),[l]),a.useCallback(e=>{L(s=>{const r=new Set(s);return r.has(e)?r.delete(e):r.add(e),r})},[]);const m=a.useMemo(()=>{let e=[...h];return l.campo&&e.sort((s,r)=>{let o=s[l.campo],n=r[l.campo];return l.campo.includes("dt_")&&(o=o?new Date(o):new Date(0),n=n?new Date(n):new Date(0)),l.campo==="vl_lancto"&&(o=parseFloat(o)||0,n=parseFloat(n)||0),typeof o=="string"&&(o=o.toLowerCase(),n=n.toLowerCase()),o<n?l.direcao==="asc"?-1:1:o>n?l.direcao==="asc"?1:-1:0}),e},[h,l]);a.useMemo(()=>{const e=(D-1)*N,s=e+N;return m.slice(e,s)},[m,D]),Math.ceil(m.length/N),a.useEffect(()=>{L(new Set)},[h]),a.useEffect(()=>{k(1)},[h]),a.useEffect(()=>{$(1)},[y]);const Y=async(e=i)=>{_(!0),w("");try{const r={nr_ctapes:Array.isArray(e.nr_ctapes)&&e.nr_ctapes.length>0?e.nr_ctapes:x.map(n=>n.numero),dt_movim_ini:e.dt_movim_ini,dt_movim_fim:e.dt_movim_fim,limit:1e6,offset:0},o=await j.financial.extrato(r);if(o.success)C(o.data||[]),T(o.total||0);else throw new Error(o.message||"Erro ao buscar dados")}catch(s){console.error("Erro ao buscar extrato:",s),w("Erro ao buscar dados do servidor."),C([]),T(0)}finally{_(!1),V(!0)}R(!0),A("");try{const r={nr_ctapes:Array.isArray(e.nr_ctapes)&&e.nr_ctapes.length>0?e.nr_ctapes:x.map(n=>n.numero),dt_movim_ini:e.dt_movim_ini,dt_movim_fim:e.dt_movim_fim,limit:1e6,offset:0},o=await j.financial.extratoTotvs(r);if(o.success)B(o.data||[]),O(o.total||0);else throw new Error(o.message||"Erro ao buscar dados TOTVS")}catch(s){console.error("Erro ao buscar extrato TOTVS:",s),A("Erro ao buscar dados do servidor TOTVS."),B([]),O(0)}finally{R(!1)}},X=e=>{I({...i,[e.target.name]:e.target.value})},W=e=>{e.preventDefault(),k(1),Y({...i,[e.target.name]:e.target.value})};function Z(e){return e?e.includes("CROSBY")?"text-blue-500":e.includes("FABIO")?"text-yellow-600":e.includes("IRMÃOS CR")?"text-orange-500":e.includes("FLAVIO")?"text-green-500":"":""}x.filter(e=>i.nr_ctapes.includes(e.numero));const F=a.useMemo(()=>{const e={};return m.forEach(s=>{var o;const r=String(s.nr_ctapes);e[r]||(e[r]={numero:r,nome:((o=x.find(n=>n.numero===r))==null?void 0:o.nome)||r,creditos:0,debitos:0,saldo:0,creditosTotvs:0,debitosTotvs:0,saldoExtrato:0}),s.tp_operbco==="C"?e[r].creditos+=parseFloat(s.vl_lancto)||0:s.tp_operbco==="D"&&(e[r].debitos+=parseFloat(s.vl_lancto)||0),e[r].saldo=e[r].creditos-e[r].debitos}),y.forEach(s=>{var o;const r=String(s.nr_ctapes);e[r]||(e[r]={numero:r,nome:((o=x.find(n=>n.numero===r))==null?void 0:o.nome)||r,creditos:0,debitos:0,saldo:0,creditosTotvs:0,debitosTotvs:0,saldoExtrato:0}),s.tp_operacao==="C"?e[r].creditosTotvs+=parseFloat(s.vl_lancto)||0:s.tp_operacao==="D"&&(e[r].debitosTotvs+=parseFloat(s.vl_lancto)||0),e[r].saldoExtrato=e[r].creditosTotvs-e[r].debitosTotvs}),x.forEach(s=>{const r=String(s.numero);e[r]||(e[r]={numero:r,nome:s.nome,creditos:0,debitos:0,saldo:0,creditosTotvs:0,debitosTotvs:0,saldoExtrato:0})}),Object.values(e).sort((s,r)=>s.numero.localeCompare(r.numero))},[m,y,x]),[d,q]=a.useState({campo:"nome",direcao:"asc"}),u=a.useCallback(e=>{q(s=>({campo:e,direcao:s.campo===e&&s.direcao==="asc"?"desc":"asc"}))},[]),p=a.useCallback(e=>d.campo!==e?t.jsx(M,{size:12,className:"opacity-50 inline-block ml-1"}):d.direcao==="asc"?t.jsx(z,{size:12,className:"inline-block ml-1"}):t.jsx(U,{size:12,className:"inline-block ml-1"}),[d]),S=a.useMemo(()=>{const e=[...F];return e.sort((s,r)=>{let o=s[d.campo],n=r[d.campo];return["creditos","debitos","saldo","saldoExtrato"].includes(d.campo)?(o=parseFloat(o)||0,n=parseFloat(n)||0):typeof o=="string"&&typeof n=="string"&&(o=o.toLowerCase(),n=n.toLowerCase()),d.direcao==="asc"?o>n?1:o<n?-1:0:o<n?1:o>n?-1:0}),e},[F,d]),[f,H]=a.useState("TODOS"),[b,J]=a.useState("TODOS"),v=a.useMemo(()=>{if(!f||f==="TODOS")return S;const e=f.toUpperCase();return S.filter(s=>{const r=(s.nome||"").toUpperCase();switch(e){case"CAIXA":return r.includes("CAIXA");case"BB":return r.includes("BB")||r.includes("BRASIL")||r.includes("BANCO DO BRASIL");case"SICREDI":return r.includes("SICREDI");case"SANT":return r.includes("SANTANDER")||r.includes("SANT");case"BNB":return r.includes("BNB")||r.includes("BANCO DO NORDESTE");case"BRADESCO":return r.includes("BRADESCO");case"ITAU":return r.includes("ITAU")||r.includes("ITAÚ");case"UNICRED":return r.includes("UNICRED");default:return r.includes(e)}})},[S,f]),c=a.useMemo(()=>{if(!b||b==="TODOS")return v;const e=b.toUpperCase();return v.filter(s=>{const r=(s.nome||"").toUpperCase();return e==="FABIO"?r.includes("FABIO"):e==="CROSBY"?r.includes("CROSBY"):e==="IRMAOS CR"||e==="IRMÃOS CR"?r.includes("IRMAOS CR")||r.includes("IRMÃOS CR"):e==="FLAVIO"?r.includes("FLAVIO"):!0})},[v,b]);return t.jsx(K,{message:"Erro ao carregar a página de Saldo Bancário TOTVS",onError:(e,s)=>{console.error("SaldoBancarioTotvs Error:",e,s)},children:t.jsxs("div",{className:"w-full max-w-6xl mx-auto flex flex-col items-stretch justify-start py-8",children:[t.jsx("h1",{className:"text-3xl font-bold mb-6 text-center text-[#000638]",children:"Saldo Bancário TOTVS"}),t.jsxs("div",{className:"mb-4",children:[t.jsxs("form",{onSubmit:W,className:"flex flex-col bg-white p-8 rounded-2xl shadow-lg w-full max-w-5xl mx-auto border border-[#000638]/10",children:[t.jsxs("div",{className:"mb-6",children:[t.jsxs("span",{className:"text-lg font-bold text-[#000638] flex items-center gap-2",children:[t.jsx(Q,{size:22,weight:"bold"}),"Filtros"]}),t.jsx("span",{className:"text-sm text-gray-500 mt-1",children:"Selecione o período e as contas para análise"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-x-3 gap-y-2 w-full mb-4",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("label",{className:"block text-xs font-semibold mb-1 text-[#000638]",children:"Contas"}),t.jsx(P,{contas:x,contasSelecionadas:Array.isArray(i.nr_ctapes)?i.nr_ctapes:[],setContasSelecionadas:e=>I(s=>({...s,nr_ctapes:typeof e=="function"?e(Array.isArray(s.nr_ctapes)?s.nr_ctapes:[]):e})),minWidth:200,maxWidth:400,placeholder:"Selecione as contas",hideLabel:!0,className:"!bg-[#f8f9fb] !text-[#000638] !placeholder:text-gray-400 !px-3 !py-2 !w-full !rounded-lg !border !border-[#000638]/30 focus:!outline-none focus:!ring-2 focus:!ring-[#000638] !h-[42px] !text-base"})]}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("label",{className:"block text-xs font-semibold mb-1 text-[#000638]",children:"Data Inicial"}),t.jsx("input",{type:"date",name:"dt_movim_ini",value:i.dt_movim_ini,readOnly:!0,disabled:!0,className:"border border-[#000638]/30 rounded-lg px-3 py-2 w-full bg-gray-100 text-[#000638] cursor-not-allowed"})]}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("label",{className:"block text-xs font-semibold mb-1 text-[#000638]",children:"Data Final"}),t.jsx("input",{type:"date",name:"dt_movim_fim",value:i.dt_movim_fim,onChange:X,className:"border border-[#000638]/30 rounded-lg px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] placeholder:text-gray-400"})]})]}),t.jsx("div",{className:"flex justify-end w-full mt-1",children:t.jsxs("button",{type:"submit",className:"flex items-center gap-1 bg-[#000638] text-white px-5 py-2 rounded-lg hover:bg-[#fe0000] transition h-9 text-sm font-bold shadow tracking-wide uppercase min-w-[90px] disabled:opacity-50 disabled:cursor-not-allowed",disabled:g,children:[g?t.jsx(te,{size:18,className:"animate-spin"}):t.jsx(ee,{size:18,weight:"bold"}),g?"Carregando...":"Filtrar"]})})]}),E&&t.jsx("div",{className:"mt-4 bg-red-100 border border-red-300 text-red-700 px-4 py-2 rounded text-center",children:E})]}),t.jsxs("div",{className:"rounded-2xl shadow-lg bg-white border border-[#000638]/10 mb-6",children:[t.jsxs("div",{className:"p-4 border-b border-[#000638]/10",children:[t.jsx("h2",{className:"text-xl font-bold text-[#000638]",children:"Saldo por Conta"}),t.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Resumo financeiro por conta (Créditos - Débitos) e Saldo do Extrato TOTVS"})]}),t.jsxs("div",{className:"px-4 pt-3",children:[t.jsx("div",{className:"flex items-center gap-2 mb-2",children:t.jsx("span",{className:"text-xs font-semibold text-[#000638]",children:"Filtrar por Banco"})}),t.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:["TODOS","CAIXA","BB","SICREDI","SANT","BNB","BRADESCO","ITAU","UNICRED"].map(e=>t.jsx("button",{onClick:()=>H(e),className:`px-3 py-1 text-xs font-medium rounded-md transition-colors ${f===e?"bg-[#000638] text-white":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-300"}`,children:e},e))}),t.jsx("div",{className:"flex items-center gap-2 mt-3 mb-2",children:t.jsx("span",{className:"text-xs font-semibold text-[#000638]",children:"Filtrar por Grupo"})}),t.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:["TODOS","FABIO","CROSBY","IRMAOS CR","FLAVIO"].map(e=>t.jsx("button",{onClick:()=>J(e),className:`px-3 py-1 text-xs font-medium rounded-md transition-colors ${b===e?"bg-[#000638] text-white":"bg-white text-gray-600 hover:bg-gray-100 border border-gray-300"}`,children:e},e))})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full border-collapse",children:[t.jsx("thead",{className:"bg-[#000638] text-white",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold cursor-pointer",onClick:()=>u("nome"),children:t.jsxs("span",{className:"inline-flex items-center",children:["Conta ",p("nome")]})}),t.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold cursor-pointer",onClick:()=>u("creditos"),children:t.jsxs("span",{className:"inline-flex items-center",children:["Créditos ",p("creditos")]})}),t.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold cursor-pointer",onClick:()=>u("debitos"),children:t.jsxs("span",{className:"inline-flex items-center",children:["Débitos ",p("debitos")]})}),t.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold cursor-pointer",onClick:()=>u("saldo"),children:t.jsxs("span",{className:"inline-flex items-center",children:["Saldo ",p("saldo")]})}),t.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold cursor-pointer",onClick:()=>u("saldoExtrato"),children:t.jsxs("span",{className:"inline-flex items-center",children:["Saldo Extrato ",p("saldoExtrato")]})})]})}),t.jsx("tbody",{children:c.map((e,s)=>t.jsxs("tr",{className:`border-b ${s%2===0?"bg-white":"bg-gray-50"} hover:bg-gray-100 transition-colors`,children:[t.jsx("td",{className:"px-4 py-3",children:t.jsxs("div",{className:`font-medium ${Z(e.nome)}`,children:[e.numero," - ",e.nome]})}),t.jsx("td",{className:"px-4 py-3 text-right font-medium text-green-600",children:e.creditos.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),t.jsx("td",{className:"px-4 py-3 text-right font-medium text-red-600",children:e.debitos.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),t.jsx("td",{className:`px-4 py-3 text-right font-bold ${e.saldo>0?"text-green-600":e.saldo<0?"text-red-600":"text-gray-600"}`,children:e.saldo.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),t.jsx("td",{className:`px-4 py-3 text-right font-bold ${e.saldoExtrato>0?"text-green-600":e.saldoExtrato<0?"text-red-600":"text-gray-600"}`,children:e.saldoExtrato.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})]},e.numero))}),t.jsxs("tfoot",{className:"bg-gray-100 border-t-2 border-[#000638]",children:[t.jsxs("tr",{children:[t.jsx("td",{className:"px-4 py-3 font-bold text-[#000638]",children:"TOTAL"}),t.jsx("td",{className:"px-4 py-3 text-right font-bold text-green-600",children:c.reduce((e,s)=>e+s.creditos,0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),t.jsx("td",{className:"px-4 py-3 text-right font-bold text-red-600",children:c.reduce((e,s)=>e+s.debitos,0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),t.jsx("td",{className:`px-4 py-3 text-right font-bold ${c.reduce((e,s)=>e+s.saldo,0)>0?"text-green-600":c.reduce((e,s)=>e+s.saldo,0)<0?"text-red-600":"text-gray-600"}`,children:c.reduce((e,s)=>e+s.saldo,0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),t.jsx("td",{className:`px-4 py-3 text-right font-bold ${c.reduce((e,s)=>e+s.saldoExtrato,0)>0?"text-green-600":c.reduce((e,s)=>e+s.saldoExtrato,0)<0?"text-red-600":"text-gray-600"}`,children:c.reduce((e,s)=>e+s.saldoExtrato,0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})]}),t.jsx("tr",{children:t.jsxs("td",{colSpan:5,className:"px-4 py-2 text-xs font-semibold text-[#000638]",children:["Total de contas exibidas: ",c.length]})})]})]})})]})]})})};export{ge as default};
