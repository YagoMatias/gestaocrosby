import{r as a,h as re,j as e,P as le,b as $,L as oe,a as ne,g as ie,v as ce}from"./index-a2563983.js";import{u as de}from"./useApiClient-0bf86fc1.js";import{C as m,a as p,b as u,c as h,d as g}from"./cards-fd94db0b.js";import{c as f}from"./ArrowDown.es-b2258871.js";import{s as j}from"./ArrowUp.es-3ccbaccd.js";import{s as I}from"./Funnel.es-cd3339ac.js";import{s as xe}from"./TrendDown.es-4f66c864.js";import{C as me,a as pe,L as ue,B as he,p as ge,b as be,c as fe,A as je,d as Ne,P as ve}from"./index-d0e9a633.js";import{p as ye}from"./chartjs-plugin-datalabels.esm-5b853c4b.js";const we=new Map([["bold",a.createElement(a.Fragment,null,a.createElement("path",{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20ZM79.57,196.57a60,60,0,0,1,96.86,0,83.72,83.72,0,0,1-96.86,0ZM100,120a28,28,0,1,1,28,28A28,28,0,0,1,100,120ZM194,179.94a83.48,83.48,0,0,0-29-23.42,52,52,0,1,0-74,0,83.48,83.48,0,0,0-29,23.42,84,84,0,1,1,131.9,0Z"}))],["duotone",a.createElement(a.Fragment,null,a.createElement("path",{d:"M224,128a95.76,95.76,0,0,1-31.8,71.37A72,72,0,0,0,128,160a40,40,0,1,0-40-40,40,40,0,0,0,40,40,72,72,0,0,0-64.2,39.37h0A96,96,0,1,1,224,128Z",opacity:"0.2"}),a.createElement("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24ZM74.08,197.5a64,64,0,0,1,107.84,0,87.83,87.83,0,0,1-107.84,0ZM96,120a32,32,0,1,1,32,32A32,32,0,0,1,96,120Zm97.76,66.41a79.66,79.66,0,0,0-36.06-28.75,48,48,0,1,0-59.4,0,79.66,79.66,0,0,0-36.06,28.75,88,88,0,1,1,131.52,0Z"}))],["fill",a.createElement(a.Fragment,null,a.createElement("path",{d:"M172,120a44,44,0,1,1-44-44A44.05,44.05,0,0,1,172,120Zm60,8A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88.09,88.09,0,0,0-91.47-87.93C77.43,41.89,39.87,81.12,40,128.25a87.65,87.65,0,0,0,22.24,58.16A79.71,79.71,0,0,1,84,165.1a4,4,0,0,1,4.83.32,59.83,59.83,0,0,0,78.28,0,4,4,0,0,1,4.83-.32,79.71,79.71,0,0,1,21.79,21.31A87.62,87.62,0,0,0,216,128Z"}))],["light",a.createElement(a.Fragment,null,a.createElement("path",{d:"M128,26A102,102,0,1,0,230,128,102.12,102.12,0,0,0,128,26ZM71.44,198a66,66,0,0,1,113.12,0,89.8,89.8,0,0,1-113.12,0ZM94,120a34,34,0,1,1,34,34A34,34,0,0,1,94,120Zm99.51,69.64a77.53,77.53,0,0,0-40-31.38,46,46,0,1,0-51,0,77.53,77.53,0,0,0-40,31.38,90,90,0,1,1,131,0Z"}))],["regular",a.createElement(a.Fragment,null,a.createElement("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24ZM74.08,197.5a64,64,0,0,1,107.84,0,87.83,87.83,0,0,1-107.84,0ZM96,120a32,32,0,1,1,32,32A32,32,0,0,1,96,120Zm97.76,66.41a79.66,79.66,0,0,0-36.06-28.75,48,48,0,1,0-59.4,0,79.66,79.66,0,0,0-36.06,28.75,88,88,0,1,1,131.52,0Z"}))],["thin",a.createElement(a.Fragment,null,a.createElement("path",{d:"M128,28A100,100,0,1,0,228,128,100.11,100.11,0,0,0,128,28ZM68.87,198.42a68,68,0,0,1,118.26,0,91.8,91.8,0,0,1-118.26,0Zm124.3-5.55a75.61,75.61,0,0,0-44.51-34,44,44,0,1,0-41.32,0,75.61,75.61,0,0,0-44.51,34,92,92,0,1,1,130.34,0ZM128,156a36,36,0,1,1,36-36A36,36,0,0,1,128,156Z"}))]]),V=a.forwardRef((_,N)=>a.createElement(re,{ref:N,..._,weights:we}));V.displayName="UserCircleIcon";const P=V;me.register(pe,ue,he,ge,be,fe,je,ye);const De=()=>{const _=de(),N=new Date,U=new Date(N.getFullYear(),N.getMonth(),1),[A,H]=a.useState(U.toISOString().split("T")[0]),[S,W]=a.useState(N.toISOString().split("T")[0]),[R,B]=a.useState(!1),[L,E]=a.useState(""),[_e,z]=a.useState([]),[x,Y]=a.useState([]),[i,G]=a.useState("nm_fantasia"),[c,T]=a.useState("asc"),d=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(s)||0),J=async()=>{var s;if(!A||!S){E("Selecione data início e fim");return}E(""),B(!0);try{const t=await _.sales.faturamentoFranquias({dataInicio:A,dataFim:S});let o=[];t?Array.isArray(t)?o=t:Array.isArray(t.data)?o=t.data:t.data&&Array.isArray(t.data.data)||Array.isArray((s=t.data)==null?void 0:s.data)?o=t.data.data:o=Object.values(t).find(n=>Array.isArray(n))||[]:o=[],z(o);try{const r=Array.from(new Set(o.map(n=>String(n.nr_transacao).trim()).filter(Boolean)));if(r.length>0){const n=r.join(","),v=await _.apiCall("/api/utils/nm-franquia",{nr_transacao:n}),C=v&&v.data?v.data:{},O=o.map(l=>({...l,nm_fantasia:C[l.nr_transacao]&&C[l.nr_transacao].nm_fantasia||l.nm_fantasia||null,consultor:C[l.nr_transacao]&&C[l.nr_transacao].consultor||l.consultor||"Sem consultor"}));z(O);const y={};O.forEach(l=>{const w=l.nm_fantasia||"CADASTRE O CONSULTOR NO TOTVS";y[w]||(y[w]={nm_fantasia:w,nm_grupoempresa:l.nm_grupoempresa||l.nm_grupo||"",total_devolucao:0,total_compras:0,consultor:l.consultor||"Sem consultor"});const te=Number(l.valor_com_desconto_entrada)||0,ae=Number(l.valor_com_desconto_saida)||0;y[w].total_devolucao+=te,y[w].total_compras+=ae});const se=Object.values(y).map(l=>({...l,total_liquido:l.total_compras-l.total_devolucao}));Y(se)}}catch(r){console.warn("Erro ao buscar nomes fantasia:",r)}}catch(t){console.error("Erro buscar ComprasFranquias",t),E("Erro ao buscar dados"),z([])}finally{B(!1)}},F=a.useMemo(()=>[...x].sort((t,o)=>{let r=t[i],n=o[i];return i==="total_devolucao"||i==="total_compras"||i==="total_liquido"?(r=Number(r)||0,n=Number(n)||0):(r=String(r||"").toLowerCase(),n=String(n||"").toLowerCase()),c==="asc"?r>n?1:r<n?-1:0:r<n?1:r>n?-1:0}),[x,i,c]),b=s=>{i===s?T(c==="asc"?"desc":"asc"):(G(s),T("asc"))},M=x.reduce((s,t)=>s+(Number(t.total_devolucao)||0),0),Z=x.reduce((s,t)=>s+(Number(t.total_compras)||0),0),q=x.reduce((s,t)=>s+(Number(t.total_liquido)||0),0),D=["IVANNA","ARTHUR","JHEMYSON"],k=D.map(s=>x.filter(t=>String(t.consultor).toUpperCase()===s).reduce((t,o)=>t+(Number(o.total_liquido)||0),0)),K=a.useMemo(()=>({labels:["Devoluções","Compras","Compras - Devoluções"],datasets:[{label:"Valores",data:[M,Z,q],backgroundColor:["#EF4444","#10B981","#3B82F6"],borderColor:["#DC2626","#059669","#2563EB"],borderWidth:2}]}),[M,Z,q]),Q=a.useMemo(()=>({labels:D,datasets:[{data:k,backgroundColor:["#8B5CF6","#F59E0B","#EC4899"],borderColor:"#fff",borderWidth:2}]}),[k]),X={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!1},datalabels:{color:"#fff",font:{weight:"bold",size:12},formatter:s=>d(s)}},scales:{y:{beginAtZero:!0,ticks:{callback:s=>d(s)}}}},ee={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"},datalabels:{color:"#fff",font:{weight:"bold",size:12},formatter:(s,t)=>{const o=t.chart.data.datasets[0].data.reduce((n,v)=>n+v,0);return`${(s/o*100).toFixed(1)}%`}}}};return e.jsxs("div",{className:"w-full max-w-[1400px] mx-auto py-6 px-4",children:[e.jsx(le,{title:"Compras Franquias",subtitle:"Análise de compras e devoluções por franquia",icon:$,iconColor:"text-purple-600"}),e.jsx("div",{className:"mb-4",children:e.jsxs("form",{onSubmit:s=>{s.preventDefault(),J()},className:"bg-white p-3 rounded-lg shadow-lg border border-[#000638]/10",children:[e.jsx("div",{className:"mb-2",children:e.jsxs("span",{className:"text-sm font-bold text-[#000638] flex items-center gap-1",children:[e.jsx(I,{size:16,weight:"bold"}),"Filtros"]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-0.5 text-[#000638]",children:"Data Início"}),e.jsx("input",{type:"date",value:A,onChange:s=>H(s.target.value),className:"border border-[#000638]/30 rounded-lg px-2 py-1.5 w-full focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] text-xs"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-0.5 text-[#000638]",children:"Data Fim"}),e.jsx("input",{type:"date",value:S,onChange:s=>W(s.target.value),className:"border border-[#000638]/30 rounded-lg px-2 py-1.5 w-full focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] text-xs"})]}),e.jsx("div",{className:"items-center hidden lg:flex",children:e.jsxs("button",{type:"submit",disabled:R,className:"flex items-center gap-1 bg-[#000638] text-white px-3 py-1.5 rounded-lg hover:bg-[#fe0000] disabled:opacity-50 disabled:cursor-not-allowed font-bold transition-colors shadow-md tracking-wide uppercase text-xs w-full justify-center",children:[e.jsx(I,{size:14,weight:"bold"}),"Buscar"]})})]})]})}),L&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md mb-6",children:L}),R?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(oe,{})}):x.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-4 mb-6",children:[e.jsxs(m,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl bg-white",children:[e.jsx(p,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{size:20,className:"text-red-600"}),e.jsx(u,{className:"text-sm font-bold text-red-700",children:"Devoluções"})]})}),e.jsxs(h,{className:"pt-0 px-4 pb-4",children:[e.jsx("div",{className:"text-lg font-extrabold text-red-600 mb-0.5",children:d(M)}),e.jsx(g,{className:"text-xs text-gray-500",children:"Total devolvido"})]})]}),e.jsxs(m,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl bg-white",children:[e.jsx(p,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{size:20,className:"text-green-600"}),e.jsx(u,{className:"text-sm font-bold text-green-700",children:"Compras"})]})}),e.jsxs(h,{className:"pt-0 px-4 pb-4",children:[e.jsx("div",{className:"text-lg font-extrabold text-green-600 mb-0.5",children:d(Z)}),e.jsx(g,{className:"text-xs text-gray-500",children:"Total comprado"})]})]}),e.jsxs(m,{className:"shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl bg-white",children:[e.jsx(p,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{size:20,className:"text-blue-600"}),e.jsx(u,{className:"text-sm font-bold text-blue-700",children:"Líquido"})]})}),e.jsxs(h,{className:"pt-0 px-4 pb-4",children:[e.jsx("div",{className:"text-lg font-extrabold text-blue-600 mb-0.5",children:d(q)}),e.jsx(g,{className:"text-xs text-gray-500",children:"Compras - Devoluções"})]})]}),D.map((s,t)=>{const r=[{bg:"bg-purple-50",text:"text-purple-700",icon:"text-purple-600"},{bg:"bg-orange-50",text:"text-orange-700",icon:"text-orange-600"},{bg:"bg-pink-50",text:"text-pink-700",icon:"text-pink-600"}][t];return e.jsxs(m,{className:`shadow-lg transition-all duration-200 hover:shadow-xl hover:-translate-y-1 rounded-xl ${r.bg} border-0`,children:[e.jsx(p,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{size:20,className:r.icon}),e.jsx(u,{className:`text-sm font-bold ${r.text}`,children:s})]})}),e.jsxs(h,{className:"pt-0 px-4 pb-4",children:[e.jsx("div",{className:`text-lg font-extrabold ${r.text} mb-0.5`,children:d(k[t]||0)}),e.jsxs(g,{className:"text-xs text-gray-600",children:["Consultor ",t+1]})]})]},s)})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs(m,{className:"shadow-lg rounded-xl bg-white",children:[e.jsxs(p,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{size:24,className:"text-indigo-600"}),e.jsx(u,{className:"text-lg font-bold text-[#000638]",children:"Análise de Valores"})]}),e.jsx(g,{className:"text-xs text-gray-500",children:"Comparativo de devoluções, compras e valor líquido"})]}),e.jsx(h,{children:e.jsx("div",{style:{height:"300px"},children:e.jsx(Ne,{data:K,options:X})})})]}),e.jsxs(m,{className:"shadow-lg rounded-xl bg-white",children:[e.jsxs(p,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{size:24,className:"text-purple-600"}),e.jsx(u,{className:"text-lg font-bold text-[#000638]",children:"Distribuição por Consultor"})]}),e.jsx(g,{className:"text-xs text-gray-500",children:"Percentual de vendas líquidas por consultor"})]}),e.jsx(h,{children:e.jsx("div",{style:{height:"300px"},children:e.jsx(ve,{data:Q,options:ee})})})]})]}),e.jsxs(m,{className:"shadow-lg rounded-xl bg-white",children:[e.jsxs(p,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{size:24,className:"text-indigo-600"}),e.jsx(u,{className:"text-lg font-bold text-[#000638]",children:"Detalhamento por Franquia"})]}),e.jsxs(g,{className:"text-xs text-gray-500",children:["Clique nos cabeçalhos para ordenar • Total de"," ",F.length," franquia(s)"]})]}),e.jsx(h,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"text-xs text-white uppercase bg-[#000638]",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left cursor-pointer hover:bg-[#fe0000] transition-colors",onClick:()=>b("nm_grupoempresa"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Empresa Fat",i==="nm_grupoempresa"&&e.jsx("span",{children:c==="asc"?e.jsx(j,{size:14,weight:"bold"}):e.jsx(f,{size:14,weight:"bold"})})]})}),e.jsx("th",{className:"px-4 py-3 text-left cursor-pointer hover:bg-[#fe0000] transition-colors",onClick:()=>b("nm_fantasia"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Nome Fantasia",i==="nm_fantasia"&&e.jsx("span",{children:c==="asc"?e.jsx(j,{size:14,weight:"bold"}):e.jsx(f,{size:14,weight:"bold"})})]})}),e.jsx("th",{className:"px-4 py-3 text-left cursor-pointer hover:bg-[#fe0000] transition-colors",onClick:()=>b("consultor"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Consultor",i==="consultor"&&e.jsx("span",{children:c==="asc"?e.jsx(j,{size:14,weight:"bold"}):e.jsx(f,{size:14,weight:"bold"})})]})}),e.jsx("th",{className:"px-4 py-3 text-right cursor-pointer hover:bg-[#fe0000] transition-colors",onClick:()=>b("total_devolucao"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["Devoluções",i==="total_devolucao"&&e.jsx("span",{children:c==="asc"?e.jsx(j,{size:14,weight:"bold"}):e.jsx(f,{size:14,weight:"bold"})})]})}),e.jsx("th",{className:"px-4 py-3 text-right cursor-pointer hover:bg-[#fe0000] transition-colors",onClick:()=>b("total_compras"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["Compras",i==="total_compras"&&e.jsx("span",{children:c==="asc"?e.jsx(j,{size:14,weight:"bold"}):e.jsx(f,{size:14,weight:"bold"})})]})}),e.jsx("th",{className:"px-4 py-3 text-right cursor-pointer hover:bg-[#fe0000] transition-colors",onClick:()=>b("total_liquido"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["Líquido",i==="total_liquido"&&e.jsx("span",{children:c==="asc"?e.jsx(j,{size:14,weight:"bold"}):e.jsx(f,{size:14,weight:"bold"})})]})})]})}),e.jsx("tbody",{children:F.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-8 text-center text-gray-500",children:"Nenhum registro encontrado"})}):F.map((s,t)=>e.jsxs("tr",{className:`border-b hover:bg-blue-50 transition-colors ${t%2===0?"bg-white":"bg-gray-50"}`,children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:s.nm_grupoempresa||"-"}),e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:s.nm_fantasia||"-"}),e.jsx("td",{className:"px-4 py-3 font-medium text-gray-700",children:s.consultor||"Sem consultor"}),e.jsx("td",{className:"px-4 py-3 text-right font-semibold text-red-600",children:d(s.total_devolucao)}),e.jsx("td",{className:"px-4 py-3 text-right font-semibold text-green-600",children:d(s.total_compras)}),e.jsx("td",{className:"px-4 py-3 text-right font-semibold text-blue-600",children:d(s.total_liquido)})]},t))})]})})})]})]}):null]})};export{De as default};
