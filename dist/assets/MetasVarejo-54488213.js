import{r as D,j as e,f as ue,u as fs,P as gs,l as ca,c as ys,g as ut}from"./index-a2563983.js";import{u as vs}from"./useApiClient-0bf86fc1.js";import{N as bs}from"./Notification-120d2688.js";import{L as js}from"./LoadingSpinner-2a48c1ee.js";import{E as ws}from"./jspdf.es.min-563825e3.js";import"./Info.es-1c589a57.js";import"./Warning.es-51a03ee6.js";import"./XCircle.es-fcbde856.js";const ma=({lojasSelecionadas:s=[],onSelectLojas:t,dadosLoja:r=[],tipoLoja:n="Todos"})=>{const[i,l]=D.useState(!1),[x,g]=D.useState(""),p=D.useRef(null),c=r.filter(w=>{var N,M,E,re,Z;if(n!=="Todos"){const ee=((N=w.nome_fantasia)==null?void 0:N.toUpperCase())||((M=w.nm_loja)==null?void 0:M.toUpperCase())||"";if(n==="Franquias")return ee.includes("F0");if(n==="Proprias")return!(ee.includes("-")||ee.includes("- CROSBY"))}return((E=w.cd_loja)==null?void 0:E.toString().toLowerCase().includes(x.toLowerCase()))||((re=w.nm_loja)==null?void 0:re.toLowerCase().includes(x.toLowerCase()))||((Z=w.nome_fantasia)==null?void 0:Z.toLowerCase().includes(x.toLowerCase()))}),m=w=>{let N;const M=w.cd_loja||w.id;s.some(E=>(E.cd_loja||E.id)===M)?N=s.filter(E=>(E.cd_loja||E.id)!==M):N=[...s,w],t&&t(N)};return D.useEffect(()=>{const w=N=>{p.current&&!p.current.contains(N.target)&&l(!1)};return document.addEventListener("mousedown",w),()=>{document.removeEventListener("mousedown",w)}},[]),e.jsxs("div",{className:"flex flex-col relative",ref:p,children:[e.jsx("label",{className:"block text-xs font-semibold mb-0.5 text-[#000638]",children:"Loja"}),e.jsxs("button",{type:"button",onClick:()=>l(!i),disabled:r.length===0,className:"border border-[#000638]/30 rounded-lg px-2 py-1.5 w-full focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] text-left flex items-center justify-between disabled:opacity-50 disabled:cursor-not-allowed text-xs",children:[e.jsx("span",{className:"truncate",children:r.length===0?"Nenhuma loja dispon√≠vel":s.length===0?"Selecione as lojas":`${s.length} loja(s) selecionada(s)`}),r.length===0?e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}):e.jsx("svg",{className:`w-4 h-4 transition-transform ${i?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),i&&e.jsxs("div",{className:"w-72 absolute top-full left-0 right-0 z-50 bg-white border border-gray-300 rounded-lg shadow-lg mt-1 max-h-100 overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-gray-200",children:e.jsx("input",{type:"text",placeholder:"Buscar loja...",value:x,onChange:w=>g(w.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#000638] text-sm"})}),e.jsxs("div",{className:"p-3 border-b border-gray-200 bg-gray-50 flex gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>{t&&t([...c])},className:"text-xs px-2 py-1 bg-[#000638] text-white rounded hover:bg-[#fe0000] transition-colors",children:["Selecionar ",n!=="Todos"?"Filtradas":"Todas"]}),e.jsx("button",{type:"button",onClick:()=>{t&&t([])},className:"text-xs px-2 py-1 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"Limpar"})]}),e.jsx("div",{className:"w-full max-h-48 overflow-y-auto",children:r.length===0?e.jsx("div",{className:"p-3 text-gray-500 text-sm text-center",children:"Nenhuma loja dispon√≠vel"}):c.length===0?e.jsx("div",{className:"p-3 text-gray-500 text-sm text-center",children:"Nenhuma loja encontrada"}):c.map(w=>{const N=w.cd_loja||w.id,M=s.some(E=>(E.cd_loja||E.id)===N);return e.jsxs("div",{className:`px-2 py-2 hover:bg-gray-50 cursor-pointer flex items-start mb-1 ${M?"bg-blue-50":""}`,onClick:()=>m(w),children:[e.jsx("div",{className:"flex flex-col flex-1",children:e.jsxs("span",{className:"text-xs font-medium text-gray-900",children:[w.cd_loja||w.id," -"," ",w.nome_fantasia||w.nm_loja||"Loja"]})}),e.jsx("input",{type:"checkbox",checked:M,readOnly:!0,className:"rounded border-gray-300 text-[#000638] focus:ring-[#000638] mr-1 w-4 h-4",onClick:E=>E.stopPropagation()})]},N)})})]})]})},ua=({vendedoresSelecionados:s=[],onSelectVendedores:t,dadosVendedor:r=[]})=>{const[n,i]=D.useState(!1),[l,x]=D.useState(""),g=D.useRef(null),p=(r||[]).filter(m=>{const w=(m.cd_vendedor||m.id||"").toString().toLowerCase(),N=(m.nome_vendedor||m.vendedor||m.nm_vendedor||m.nome||"").toLowerCase(),M=l.toLowerCase();return w.includes(M)||N.includes(M)}),c=m=>{const w=m.cd_vendedor||m.id||m.nome_vendedor||m.nome||m.vendedor;let N;s.some(M=>(M.cd_vendedor||M.id||M.nome_vendedor||M.nome||M.vendedor)===w)?N=s.filter(M=>(M.cd_vendedor||M.id||M.nome_vendedor||M.nome||M.vendedor)!==w):N=[...s,m],t&&t(N)};return D.useEffect(()=>{const m=w=>{g.current&&!g.current.contains(w.target)&&i(!1)};return document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[]),e.jsxs("div",{className:"flex flex-col relative",ref:g,children:[e.jsx("label",{className:"block text-xs font-semibold mb-0.5 text-[#000638]",children:"Vendedor"}),e.jsxs("button",{type:"button",onClick:()=>i(!n),disabled:(r||[]).length===0,className:"border border-[#000638]/30 rounded-lg px-2 py-1.5 w-full focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] text-left flex items-center justify-between disabled:opacity-50 disabled:cursor-not-allowed text-xs",children:[e.jsx("span",{className:"truncate",children:r.length===0?"Nenhum vendedor dispon√≠vel":s.length===0?"Selecione os vendedores":`${s.length} vendedor(es) selecionado(s)`}),e.jsx("svg",{className:`w-4 h-4 transition-transform ${n?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),n&&e.jsxs("div",{className:"w-72 absolute top-full left-0 right-0 z-50 bg-white border border-gray-300 rounded-lg shadow-lg mt-1 max-h-100 overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-gray-200",children:e.jsx("input",{type:"text",placeholder:"Buscar vendedor...",value:l,onChange:m=>x(m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#000638] text-sm"})}),e.jsxs("div",{className:"p-3 border-b border-gray-200 bg-gray-50 flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>t&&t([...r||[]]),className:"text-xs px-2 py-1 bg-[#000638] text-white rounded hover:bg-[#fe0000] transition-colors",children:"Selecionar Todos"}),e.jsx("button",{type:"button",onClick:()=>t&&t([]),className:"text-xs px-2 py-1 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"Limpar"})]}),e.jsx("div",{className:"w-full max-h-48 overflow-y-auto",children:r.length===0?e.jsx("div",{className:"p-3 text-gray-500 text-sm text-center",children:"Nenhum vendedor dispon√≠vel"}):p.length===0?e.jsx("div",{className:"p-3 text-gray-500 text-sm text-center",children:"Nenhum vendedor encontrado"}):p.map(m=>{const w=m.cd_vendedor||m.id||m.nome_vendedor||m.nome||m.vendedor,N=s.some(E=>(E.cd_vendedor||E.id||E.nome_vendedor||E.nome||E.vendedor)===w),M=m.nome_vendedor||m.vendedor||m.nm_vendedor||m.nome||"Vendedor";return e.jsxs("div",{className:`px-2 py-2 hover:bg-gray-50 cursor-pointer flex items-start mb-1 ${N?"bg-blue-50":""}`,onClick:()=>c(m),children:[e.jsx("div",{className:"flex flex-col flex-1",children:e.jsx("span",{className:"text-xs font-medium text-gray-900",children:M})}),e.jsx("input",{type:"checkbox",checked:N,readOnly:!0,className:"rounded border-gray-300 text-[#000638] focus:ring-[#000638] mr-1 w-4 h-4",onClick:E=>E.stopPropagation()})]},w)})})]})]})},Ns=()=>{const[s,t]=D.useState(!1),[r,n]=D.useState(null);return{loading:s,error:r,salvarMetas:async c=>{t(!0),n(null);try{const m=[];if(c.forEach(({tipo:M,nome:E,metas:re,mes:Z,usuario:ee})=>{Object.entries(re).forEach(([V,ce])=>{ce&&ce!=="R$ 0,00"&&m.push({tipo:M,nome:E,campo:V,valor:ce,mes:Z,usuario:ee,data_alteracao:new Date().toISOString()})})}),m.length===0)throw new Error("Nenhuma meta v√°lida para salvar");const{data:w,error:N}=await ue.from("metas_varejo").upsert(m,{onConflict:"tipo,nome,campo,mes",ignoreDuplicates:!1}).select();if(N)throw N;return{success:!0,data:w}}catch(m){return n(m.message),{success:!1,error:m.message}}finally{t(!1)}},buscarMetas:async(c,m,w=null)=>{t(!0),n(null);try{let N=ue.from("metas_varejo").select("*").gte("mes",c).lte("mes",m);w&&(N=N.eq("tipo",w));const{data:M,error:E}=await N.order("data_alteracao",{ascending:!1});if(E)throw E;return{success:!0,data:M||[]}}catch(N){return n(N.message),{success:!1,error:N.message}}finally{t(!1)}},buscarLogAlteracoes:async(c=null,m=null)=>{t(!0),n(null);try{let w=ue.from("metas_varejo").select("*").order("data_alteracao",{ascending:!1});c&&m&&(w=w.gte("mes",c).lte("mes",m));const{data:N,error:M}=await w.limit(100);if(M)throw M;return{success:!0,data:N||[]}}catch(w){return n(w.message),{success:!1,error:w.message}}finally{t(!1)}},deletarMeta:async c=>{t(!0),n(null);try{const{error:m}=await ue.from("metas_varejo").delete().eq("id",c);if(m)throw m;return{success:!0}}catch(m){return n(m.message),{success:!1,error:m.message}}finally{t(!1)}},deletarMetasPorCriterios:async c=>{t(!0),n(null);try{console.log("üóëÔ∏è Excluindo metas mensais com crit√©rios:",c);let m=ue.from("metas_varejo").delete();c.mes&&(m=m.eq("mes",c.mes)),c.tipo&&(m=m.eq("tipo",c.tipo)),c.nome&&(m=m.eq("nome",c.nome)),c.campo&&(m=m.eq("campo",c.campo));const{data:w,error:N}=await m;if(N)throw N;return{success:!0,data:w}}catch(m){return n(m.message),console.error("‚ùå Erro ao excluir metas mensais:",m),{success:!1,error:m.message}}finally{t(!1)}}}},Ss=()=>{const[s,t]=D.useState(!1),[r,n]=D.useState(null),i=D.useCallback(F=>{const S=new Date(F),A=S.getDay(),C=A===0?-6:1-A,$=new Date(S);return $.setDate(S.getDate()+C),$.toISOString().split("T")[0]},[]),l=D.useCallback(F=>{const S=new Date(F),A=S.getDay(),C=A===0?0:7-A,$=new Date(S);return $.setDate(S.getDate()+C),$.toISOString().split("T")[0]},[]),x=D.useCallback(F=>{const S=new Date(F),A=new Date(S.valueOf()),C=(S.getDay()+6)%7;A.setDate(A.getDate()-C+3);const $=A.valueOf();return A.setMonth(0,1),A.getDay()!==4&&A.setMonth(0,1+(4-A.getDay()+7)%7),1+Math.ceil(($-A)/6048e5)},[]),g=D.useCallback(F=>{const S=new Date(F),A=new Date(S.getFullYear(),S.getMonth(),1),C=new Date(i(A)),W=new Date(i(F))-C,H=Math.ceil(W/(7*24*60*60*1e3))+1;return Math.min(H,5)},[i]),p=D.useCallback(F=>{const[S,A]=F.split("-"),C=new Date(parseInt(S),parseInt(A)-1,1),$=new Date(parseInt(S),parseInt(A),0);console.log(`üîç [useMetasSemanais] Gerando semanas ISO 8601 para ${F}:`,{primeiroDia:C.toISOString().split("T")[0],ultimoDia:$.toISOString().split("T")[0],mesNum:A});const W=[];let H=new Date(i(C));H<C&&(H=new Date(C));let de=1;for(;H<=$;){const J=new Date(l(H));J>$&&J.setTime($.getTime());const se=x(H),je={numero:de,numeroAno:se,inicio:H.toISOString().split("T")[0],fim:J.toISOString().split("T")[0],label:`Semana ${de} (${se})`,periodo:`${H.toISOString().split("T")[0]} a ${J.toISOString().split("T")[0]}`,diasSemana:{segunda:H.toISOString().split("T")[0],terca:new Date(H.getTime()+24*60*60*1e3).toISOString().split("T")[0],quarta:new Date(H.getTime()+2*24*60*60*1e3).toISOString().split("T")[0],quinta:new Date(H.getTime()+3*24*60*60*1e3).toISOString().split("T")[0],sexta:new Date(H.getTime()+4*24*60*60*1e3).toISOString().split("T")[0],sabado:new Date(H.getTime()+5*24*60*60*1e3).toISOString().split("T")[0],domingo:J.toISOString().split("T")[0]}};W.push(je),console.log(`üìÖ [useMetasSemanais] Semana ${de} (${se}) gerada:`,je),H.setDate(H.getDate()+7),de++}return console.log(`‚úÖ [useMetasSemanais] Total de semanas geradas para ${F}:`,W.length,W),W},[i,l,x]),c=D.useCallback((F,S)=>{const A=F/S;return{bronze:Math.round(A*100)/100,prata:Math.round(A*100)/100,ouro:Math.round(A*100)/100,diamante:Math.round(A*100)/100}},[]),m=D.useCallback(F=>{const S=F.reduce((A,C)=>({bronze:A.bronze+(C.metas.bronze||0),prata:A.prata+(C.metas.prata||0),ouro:A.ouro+(C.metas.ouro||0),diamante:A.diamante+(C.metas.diamante||0)}),{bronze:0,prata:0,ouro:0,diamante:0});return{bronze:Math.round(S.bronze*100)/100,prata:Math.round(S.prata*100)/100,ouro:Math.round(S.ouro*100)/100,diamante:Math.round(S.diamante*100)/100}},[]),w=D.useCallback(async F=>{var S,A,C;t(!0),n(null);try{console.log("üîç Salvando meta semanal individual:",F);const{tipo:$,nome:W,mes:H,semana:de,nivel:J,valor:se,usuario:je}=F,be=p(H).find(De=>De.numero===de);if(!be)throw new Error(`Semana ${de} n√£o encontrada para o m√™s ${H}`);const le={tipo:$,nome:W,semana_inicio:be.inicio,semana_fim:be.fim,campo:J,valor:parseFloat(se),mes_referencia:H,numero_semana:de,usuario:je,data_alteracao:new Date().toISOString()};console.log("üîç Dados formatados para inser√ß√£o:",le);try{const{error:De}=await ue.from("metas_semanais_varejo").select("id").limit(1);if(De)throw new Error(`Erro de conectividade: ${De.message}`)}catch(De){throw new Error(`Falha na conex√£o com o banco de dados: ${De.message}`)}const{data:et,error:R}=await ue.from("metas_semanais_varejo").upsert([le],{onConflict:"tipo,nome,campo,semana_inicio",ignoreDuplicates:!1}).select();if(R)throw R;return console.log("üîç Meta semanal salva com sucesso:",et),{success:!0,data:et}}catch($){console.error("‚ùå Erro ao salvar meta semanal:",$);const H=((S=$.message)==null?void 0:S.includes("Failed to fetch"))||((A=$.message)==null?void 0:A.includes("ERR_NAME_NOT_RESOLVED"))||((C=$.message)==null?void 0:C.includes("NetworkError"))?"Erro de conex√£o. Verifique sua internet e tente novamente.":$.message||"Erro desconhecido ao salvar meta semanal";return n(H),{success:!1,error:H}}finally{t(!1)}},[p]),N=D.useCallback(async(F,S,A,C,$,W)=>{t(!0),n(null);try{console.log("üîç Salvando meta mensal e calculando metas semanais:",{tipo:F,nome:S,mes:A,nivel:C,valor:$});const H=p(A),de=H.length,J=c($,de);console.log("üîç Metas semanais calculadas:",J);const se=[];H.forEach(be=>{se.push({tipo:F,nome:S,semana_inicio:be.inicio,semana_fim:be.fim,campo:C,valor:J[C],mes_referencia:A,numero_semana:be.numero,usuario:W,data_alteracao:new Date().toISOString()})}),console.log("üîç Dados para inser√ß√£o:",se);const{data:je,error:ke}=await ue.from("metas_semanais_varejo").upsert(se,{onConflict:"tipo,nome,campo,semana_inicio",ignoreDuplicates:!1}).select();if(ke)throw ke;return console.log("üîç Metas semanais salvas com sucesso:",je),{success:!0,data:je,metasSemanais:J}}catch(H){return console.error("‚ùå Erro ao salvar meta mensal com c√°lculo semanal:",H),n(H.message),{success:!1,error:H.message}}finally{t(!1)}},[p,c]),M=D.useCallback(async F=>{t(!0),n(null);try{const S=[];if(F.forEach(({tipo:$,nome:W,semana_inicio:H,semana_fim:de,metas:J,mes_referencia:se,numero_semana:je,usuario:ke})=>{Object.entries(J).forEach(([be,le])=>{le&&le>0&&S.push({tipo:$,nome:W,semana_inicio:H,semana_fim:de,campo:be,valor:parseFloat(le),mes_referencia:se,numero_semana:je,usuario:ke,data_alteracao:new Date().toISOString()})})}),S.length===0)throw new Error("Nenhuma meta v√°lida para salvar");const{data:A,error:C}=await ue.from("metas_semanais_varejo").upsert(S,{onConflict:"tipo,nome,campo,semana_inicio",ignoreDuplicates:!1}).select();if(C)throw C;return{success:!0,data:A}}catch(S){return n(S.message),{success:!1,error:S.message}}finally{t(!1)}},[]),E=D.useCallback(async(F,S,A=null)=>{t(!0),n(null);try{let C=ue.from("metas_semanais_varejo").select("*").gte("mes_referencia",F).lte("mes_referencia",S).order("numero_semana",{ascending:!0}).order("tipo",{ascending:!0}).order("nome",{ascending:!0});A&&(C=C.eq("tipo",A));const{data:$,error:W}=await C;if(W)throw W;return{success:!0,data:$||[]}}catch(C){return n(C.message),{success:!1,error:C.message}}finally{t(!1)}},[]),re=D.useCallback(async(F,S,A=null)=>{t(!0),n(null);try{let C=ue.from("metas_mensais_calculadas").select("*").gte("mes",F).lte("mes",S).order("mes",{ascending:!0});A&&(C=C.eq("tipo",A));const{data:$,error:W}=await C;if(W)throw W;return{success:!0,data:$||[]}}catch(C){return n(C.message),{success:!1,error:C.message}}finally{t(!1)}},[]),Z=D.useCallback(async F=>{t(!0),n(null);try{const{data:S,error:A}=await ue.from("metas_semanais_varejo").select("*").eq("mes_referencia",F).order("numero_semana",{ascending:!0}).order("tipo",{ascending:!0}).order("nome",{ascending:!0});if(A)throw A;const C={};return(S||[]).forEach($=>{const W=`${$.tipo}-${$.nome}`;C[W]||(C[W]={tipo:$.tipo,nome:$.nome,semanas:{}}),C[W].semanas[$.numero_semana]||(C[W].semanas[$.numero_semana]={numero:$.numero_semana,inicio:$.semana_inicio,fim:$.semana_fim,metas:{}}),C[W].semanas[$.numero_semana].metas[$.campo]=$.valor}),{success:!0,data:C}}catch(S){return n(S.message),{success:!1,error:S.message}}finally{t(!1)}},[]),ee=D.useCallback(async F=>{t(!0),n(null);try{const{error:S}=await ue.from("metas_semanais_varejo").delete().eq("id",F);if(S)throw S;return{success:!0}}catch(S){return n(S.message),{success:!1,error:S.message}}finally{t(!1)}},[]),V=D.useCallback(async F=>{t(!0),n(null);try{console.log("üóëÔ∏è Excluindo metas mensais calculadas com crit√©rios:",F);let S=ue.from("metas_mensais_calculadas").delete();F.mes&&(S=S.eq("mes",F.mes)),F.tipo&&(S=S.eq("tipo",F.tipo)),F.nome&&(S=S.eq("nome",F.nome));const{data:A,error:C}=await S;if(C)throw C;return{success:!0,data:A}}catch(S){return n(S.message),console.error("‚ùå Erro ao excluir metas mensais calculadas:",S),{success:!1,error:S.message}}finally{t(!1)}},[]),ce=D.useCallback(async F=>{t(!0),n(null);try{if(console.log("üóëÔ∏è Tentando excluir metas semanais com crit√©rios:",F),!F.mes)throw new Error("M√™s √© obrigat√≥rio para excluir metas semanais");let S=ue.from("metas_semanais_varejo").delete();S=S.eq("mes_referencia",F.mes),F.tipo&&(S=S.eq("tipo",F.tipo)),F.nome&&(S=S.eq("nome",F.nome)),F.semana&&(S=S.eq("numero_semana",F.semana)),F.nivel&&(S=S.eq("campo",F.nivel));const{data:A,error:C}=await S;if(C)throw console.error("‚ùå Erro ao excluir metas semanais:",C),C;return console.log("‚úÖ Metas semanais exclu√≠das com sucesso:",{criterios:F,registrosExcluidos:(A==null?void 0:A.length)||0,data:A}),{success:!0,data:A}}catch(S){return console.error("‚ùå Erro ao excluir metas semanais:",S),n(S.message),{success:!1,error:S.message}}finally{t(!1)}},[]),ve=D.useCallback(async(F,S=null,A=null)=>{t(!0),n(null);try{let C=ue.from("metas_semanais_varejo").select("*").eq("mes_referencia",F);S&&(C=C.eq("tipo",S)),A&&(C=C.eq("nome",A));const{data:$,error:W}=await C;if(W)throw W;const H={};($||[]).forEach(J=>{const se=`${J.tipo}-${J.nome}`;H[se]||(H[se]={tipo:J.tipo,nome:J.nome,mes:J.mes_referencia,bronze:0,prata:0,ouro:0,diamante:0}),H[se][J.campo]+=parseFloat(J.valor||0)});const de=Object.values(H).map(J=>({...J,calculado_em:new Date().toISOString(),usuario:"Sistema"}));if(de.length>0){const{error:J}=await ue.from("metas_mensais_calculadas").upsert(de,{onConflict:"tipo,nome,mes",ignoreDuplicates:!1});if(J)throw J}return{success:!0,data:de}}catch(C){return n(C.message),{success:!1,error:C.message}}finally{t(!1)}},[]),Ie=D.useCallback(async(F=null,S=null)=>{t(!0),n(null);try{let A=ue.from("metas_semanais_varejo").select("*").order("data_alteracao",{ascending:!1});F&&S&&(A=A.gte("mes_referencia",F).lte("mes_referencia",S));const{data:C,error:$}=await A.limit(100);if($)throw $;return{success:!0,data:C||[]}}catch(A){return n(A.message),{success:!1,error:A.message}}finally{t(!1)}},[]);return{loading:s,error:r,obterInicioSemana:i,obterFimSemana:l,obterNumeroSemanaMes:g,obterSemanaAnoISO:x,gerarSemanasDoMes:p,calcularMetasSemanaisDeMensal:c,calcularMetaMensalDeSemanais:m,salvarMetaSemanalIndividual:w,salvarMetaMensalComCalculoSemanal:N,salvarMetasSemanais:M,buscarMetasSemanais:E,buscarMetasMensaisCalculadas:re,buscarMetasSemanaisAgrupadas:Z,deletarMetaSemanal:ee,deletarMetasSemanaisPorCriterios:ce,deletarMetasMensaisCalculadas:V,recalcularMetasMensais:ve,buscarLogAlteracoesSemanais:Ie}};function ba(s,t,r,n,i){n=n||{};var l=1.15,x=i.internal.scaleFactor,g=i.internal.getFontSize()/x,p=i.getLineHeightFactor?i.getLineHeightFactor():l,c=g*p,m=/\r\n|\r|\n/g,w="",N=1;if((n.valign==="middle"||n.valign==="bottom"||n.halign==="center"||n.halign==="right")&&(w=typeof s=="string"?s.split(m):s,N=w.length||1),r+=g*(2-l),n.valign==="middle"?r-=N/2*c:n.valign==="bottom"&&(r-=N*c),n.halign==="center"||n.halign==="right"){var M=g;if(n.halign==="center"&&(M*=.5),w&&N>=1){for(var E=0;E<w.length;E++)i.text(w[E],t-i.getStringUnitWidth(w[E])*M,r),r+=c;return i}t-=i.getStringUnitWidth(s)*M}return n.halign==="justify"?i.text(s,t,r,{maxWidth:n.maxWidth||100,align:"justify"}):i.text(s,t,r),i}var xa={},Ze=function(){function s(t){this.jsPDFDocument=t,this.userStyles={textColor:t.getTextColor?this.jsPDFDocument.getTextColor():0,fontSize:t.internal.getFontSize(),fontStyle:t.internal.getFont().fontStyle,font:t.internal.getFont().fontName,lineWidth:t.getLineWidth?this.jsPDFDocument.getLineWidth():0,lineColor:t.getDrawColor?this.jsPDFDocument.getDrawColor():0}}return s.setDefaults=function(t,r){r===void 0&&(r=null),r?r.__autoTableDocumentDefaults=t:xa=t},s.unifyColor=function(t){return Array.isArray(t)?t:typeof t=="number"?[t,t,t]:typeof t=="string"?[t]:null},s.prototype.applyStyles=function(t,r){var n,i,l;r===void 0&&(r=!1),t.fontStyle&&this.jsPDFDocument.setFontStyle&&this.jsPDFDocument.setFontStyle(t.fontStyle);var x=this.jsPDFDocument.internal.getFont(),g=x.fontStyle,p=x.fontName;if(t.font&&(p=t.font),t.fontStyle){g=t.fontStyle;var c=this.getFontList()[p];c&&c.indexOf(g)===-1&&this.jsPDFDocument.setFontStyle&&(this.jsPDFDocument.setFontStyle(c[0]),g=c[0])}if(this.jsPDFDocument.setFont(p,g),t.fontSize&&this.jsPDFDocument.setFontSize(t.fontSize),!r){var m=s.unifyColor(t.fillColor);m&&(n=this.jsPDFDocument).setFillColor.apply(n,m),m=s.unifyColor(t.textColor),m&&(i=this.jsPDFDocument).setTextColor.apply(i,m),m=s.unifyColor(t.lineColor),m&&(l=this.jsPDFDocument).setDrawColor.apply(l,m),typeof t.lineWidth=="number"&&this.jsPDFDocument.setLineWidth(t.lineWidth)}},s.prototype.splitTextToSize=function(t,r,n){return this.jsPDFDocument.splitTextToSize(t,r,n)},s.prototype.rect=function(t,r,n,i,l){return this.jsPDFDocument.rect(t,r,n,i,l)},s.prototype.getLastAutoTable=function(){return this.jsPDFDocument.lastAutoTable||null},s.prototype.getTextWidth=function(t){return this.jsPDFDocument.getTextWidth(t)},s.prototype.getDocument=function(){return this.jsPDFDocument},s.prototype.setPage=function(t){this.jsPDFDocument.setPage(t)},s.prototype.addPage=function(){return this.jsPDFDocument.addPage()},s.prototype.getFontList=function(){return this.jsPDFDocument.getFontList()},s.prototype.getGlobalOptions=function(){return xa||{}},s.prototype.getDocumentOptions=function(){return this.jsPDFDocument.__autoTableDocumentDefaults||{}},s.prototype.pageSize=function(){var t=this.jsPDFDocument.internal.pageSize;return t.width==null&&(t={width:t.getWidth(),height:t.getHeight()}),t},s.prototype.scaleFactor=function(){return this.jsPDFDocument.internal.scaleFactor},s.prototype.getLineHeightFactor=function(){var t=this.jsPDFDocument;return t.getLineHeightFactor?t.getLineHeightFactor():1.15},s.prototype.getLineHeight=function(t){return t/this.scaleFactor()*this.getLineHeightFactor()},s.prototype.pageNumber=function(){var t=this.jsPDFDocument.internal.getCurrentPageInfo();return t?t.pageNumber:this.jsPDFDocument.internal.getNumberOfPages()},s}(),Rt=function(s,t){return Rt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},Rt(s,t)};function ja(s,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Rt(s,t);function r(){this.constructor=s}s.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var wa=function(s){ja(t,s);function t(r){var n=s.call(this)||this;return n._element=r,n}return t}(Array);function Ms(s){return{font:"helvetica",fontStyle:"normal",overflow:"linebreak",fillColor:!1,textColor:20,halign:"left",valign:"top",fontSize:10,cellPadding:5/s,lineColor:200,lineWidth:0,cellWidth:"auto",minCellHeight:0,minCellWidth:0}}function Ds(s){var t={striped:{table:{fillColor:255,textColor:80,fontStyle:"normal"},head:{textColor:255,fillColor:[41,128,185],fontStyle:"bold"},body:{},foot:{textColor:255,fillColor:[41,128,185],fontStyle:"bold"},alternateRow:{fillColor:245}},grid:{table:{fillColor:255,textColor:80,fontStyle:"normal",lineWidth:.1},head:{textColor:255,fillColor:[26,188,156],fontStyle:"bold",lineWidth:0},body:{},foot:{textColor:255,fillColor:[26,188,156],fontStyle:"bold",lineWidth:0},alternateRow:{}},plain:{head:{fontStyle:"bold"},foot:{fontStyle:"bold"}}};return t[s]}function xt(s,t,r){r.applyStyles(t,!0);var n=Array.isArray(s)?s:[s],i=n.map(function(l){return r.getTextWidth(l)}).reduce(function(l,x){return Math.max(l,x)},0);return i}function Na(s,t,r,n){var i=t.settings.tableLineWidth,l=t.settings.tableLineColor;s.applyStyles({lineWidth:i,lineColor:l});var x=Sa(i,!1);x&&s.rect(r.x,r.y,t.getWidth(s.pageSize().width),n.y-r.y,x)}function Sa(s,t){var r=s>0,n=t||t===0;return r&&n?"DF":r?"S":n?"F":null}function pt(s,t){var r,n,i,l;if(s=s||t,Array.isArray(s)){if(s.length>=4)return{top:s[0],right:s[1],bottom:s[2],left:s[3]};if(s.length===3)return{top:s[0],right:s[1],bottom:s[2],left:s[1]};if(s.length===2)return{top:s[0],right:s[1],bottom:s[0],left:s[1]};s.length===1?s=s[0]:s=t}return typeof s=="object"?(typeof s.vertical=="number"&&(s.top=s.vertical,s.bottom=s.vertical),typeof s.horizontal=="number"&&(s.right=s.horizontal,s.left=s.horizontal),{left:(r=s.left)!==null&&r!==void 0?r:t,top:(n=s.top)!==null&&n!==void 0?n:t,right:(i=s.right)!==null&&i!==void 0?i:t,bottom:(l=s.bottom)!==null&&l!==void 0?l:t}):(typeof s!="number"&&(s=t),{top:s,right:s,bottom:s,left:s})}function Ma(s,t){var r=pt(t.settings.margin,0);return s.pageSize().width-(r.left+r.right)}function Cs(s,t,r,n,i){var l={},x=1.3333333333333333,g=Lt(t,function(ce){return i.getComputedStyle(ce).backgroundColor});g!=null&&(l.fillColor=g);var p=Lt(t,function(ce){return i.getComputedStyle(ce).color});p!=null&&(l.textColor=p);var c=As(n,r);c&&(l.cellPadding=c);var m="borderTopColor",w=x*r,N=n.borderTopWidth;if(n.borderBottomWidth===N&&n.borderRightWidth===N&&n.borderLeftWidth===N){var M=(parseFloat(N)||0)/w;M&&(l.lineWidth=M)}else l.lineWidth={top:(parseFloat(n.borderTopWidth)||0)/w,right:(parseFloat(n.borderRightWidth)||0)/w,bottom:(parseFloat(n.borderBottomWidth)||0)/w,left:(parseFloat(n.borderLeftWidth)||0)/w},l.lineWidth.top||(l.lineWidth.right?m="borderRightColor":l.lineWidth.bottom?m="borderBottomColor":l.lineWidth.left&&(m="borderLeftColor"));var E=Lt(t,function(ce){return i.getComputedStyle(ce)[m]});E!=null&&(l.lineColor=E);var re=["left","right","center","justify"];re.indexOf(n.textAlign)!==-1&&(l.halign=n.textAlign),re=["middle","bottom","top"],re.indexOf(n.verticalAlign)!==-1&&(l.valign=n.verticalAlign);var Z=parseInt(n.fontSize||"");isNaN(Z)||(l.fontSize=Z/x);var ee=_s(n);ee&&(l.fontStyle=ee);var V=(n.fontFamily||"").toLowerCase();return s.indexOf(V)!==-1&&(l.font=V),l}function _s(s){var t="";return(s.fontWeight==="bold"||s.fontWeight==="bolder"||parseInt(s.fontWeight)>=700)&&(t="bold"),(s.fontStyle==="italic"||s.fontStyle==="oblique")&&(t+="italic"),t}function Lt(s,t){var r=Da(s,t);if(!r)return null;var n=r.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d*\.?\d*))?\)$/);if(!n||!Array.isArray(n))return null;var i=[parseInt(n[1]),parseInt(n[2]),parseInt(n[3])],l=parseInt(n[4]);return l===0||isNaN(i[0])||isNaN(i[1])||isNaN(i[2])?null:i}function Da(s,t){var r=t(s);return r==="rgba(0, 0, 0, 0)"||r==="transparent"||r==="initial"||r==="inherit"?s.parentElement==null?null:Da(s.parentElement,t):r}function As(s,t){var r=[s.paddingTop,s.paddingRight,s.paddingBottom,s.paddingLeft],n=96/(72/t),i=(parseInt(s.lineHeight)-parseInt(s.fontSize))/t/2,l=r.map(function(g){return parseInt(g||"0")/n}),x=pt(l,0);return i>x.top&&(x.top=i),i>x.bottom&&(x.bottom=i),x}function Ca(s,t,r,n,i){var l,x;n===void 0&&(n=!1),i===void 0&&(i=!1);var g;typeof t=="string"?g=r.document.querySelector(t):g=t;var p=Object.keys(s.getFontList()),c=s.scaleFactor(),m=[],w=[],N=[];if(!g)return console.error("Html table could not be found with input: ",t),{head:m,body:w,foot:N};for(var M=0;M<g.rows.length;M++){var E=g.rows[M],re=(x=(l=E==null?void 0:E.parentElement)===null||l===void 0?void 0:l.tagName)===null||x===void 0?void 0:x.toLowerCase(),Z=Es(p,c,r,E,n,i);Z&&(re==="thead"?m.push(Z):re==="tfoot"?N.push(Z):w.push(Z))}return{head:m,body:w,foot:N}}function Es(s,t,r,n,i,l){for(var x=new wa(n),g=0;g<n.cells.length;g++){var p=n.cells[g],c=r.getComputedStyle(p);if(i||c.display!=="none"){var m=void 0;l&&(m=Cs(s,p,t,c,r)),x.push({rowSpan:p.rowSpan,colSpan:p.colSpan,styles:m,_element:p,content:ks(p)})}}var w=r.getComputedStyle(n);if(x.length>0&&(i||w.display!=="none"))return x}function ks(s){var t=s.cloneNode(!0);return t.innerHTML=t.innerHTML.replace(/\n/g,"").replace(/ +/g," "),t.innerHTML=t.innerHTML.split(/<br.*?>/).map(function(r){return r.trim()}).join(`
`),t.innerText||t.textContent||""}function Fs(s,t,r){for(var n=0,i=[s,t,r];n<i.length;n++){var l=i[n];l&&typeof l!="object"&&console.error("The options parameter should be of type object, is: "+typeof l),l.startY&&typeof l.startY!="number"&&(console.error("Invalid value for startY option",l.startY),delete l.startY)}}function Ae(s,t,r,n,i){if(s==null)throw new TypeError("Cannot convert undefined or null to object");for(var l=Object(s),x=1;x<arguments.length;x++){var g=arguments[x];if(g!=null)for(var p in g)Object.prototype.hasOwnProperty.call(g,p)&&(l[p]=g[p])}return l}function Ps(s,t){var r=new Ze(s),n=r.getDocumentOptions(),i=r.getGlobalOptions();Fs(i,n,t);var l=Ae({},i,n,t),x;typeof window<"u"&&(x=window);var g=Ls(i,n,t),p=$s(i,n,t),c=Ts(r,l),m=Rs(r,l,x);return{id:t.tableId,content:m,hooks:p,styles:g,settings:c}}function Ls(s,t,r){for(var n={styles:{},headStyles:{},bodyStyles:{},footStyles:{},alternateRowStyles:{},columnStyles:{}},i=function(p){if(p==="columnStyles"){var c=s[p],m=t[p],w=r[p];n.columnStyles=Ae({},c,m,w)}else{var N=[s,t,r],M=N.map(function(E){return E[p]||{}});n[p]=Ae({},M[0],M[1],M[2])}},l=0,x=Object.keys(n);l<x.length;l++){var g=x[l];i(g)}return n}function $s(s,t,r){for(var n=[s,t,r],i={didParseCell:[],willDrawCell:[],didDrawCell:[],willDrawPage:[],didDrawPage:[]},l=0,x=n;l<x.length;l++){var g=x[l];g.didParseCell&&i.didParseCell.push(g.didParseCell),g.willDrawCell&&i.willDrawCell.push(g.willDrawCell),g.didDrawCell&&i.didDrawCell.push(g.didDrawCell),g.willDrawPage&&i.willDrawPage.push(g.willDrawPage),g.didDrawPage&&i.didDrawPage.push(g.didDrawPage)}return i}function Ts(s,t){var r,n,i,l,x,g,p,c,m,w,N,M,E=pt(t.margin,40/s.scaleFactor()),re=(r=zs(s,t.startY))!==null&&r!==void 0?r:E.top,Z;t.showFoot===!0?Z="everyPage":t.showFoot===!1?Z="never":Z=(n=t.showFoot)!==null&&n!==void 0?n:"everyPage";var ee;t.showHead===!0?ee="everyPage":t.showHead===!1?ee="never":ee=(i=t.showHead)!==null&&i!==void 0?i:"everyPage";var V=(l=t.useCss)!==null&&l!==void 0?l:!1,ce=t.theme||(V?"plain":"striped"),ve=!!t.horizontalPageBreak,Ie=(x=t.horizontalPageBreakRepeat)!==null&&x!==void 0?x:null;return{includeHiddenHtml:(g=t.includeHiddenHtml)!==null&&g!==void 0?g:!1,useCss:V,theme:ce,startY:re,margin:E,pageBreak:(p=t.pageBreak)!==null&&p!==void 0?p:"auto",rowPageBreak:(c=t.rowPageBreak)!==null&&c!==void 0?c:"auto",tableWidth:(m=t.tableWidth)!==null&&m!==void 0?m:"auto",showHead:ee,showFoot:Z,tableLineWidth:(w=t.tableLineWidth)!==null&&w!==void 0?w:0,tableLineColor:(N=t.tableLineColor)!==null&&N!==void 0?N:200,horizontalPageBreak:ve,horizontalPageBreakRepeat:Ie,horizontalPageBreakBehaviour:(M=t.horizontalPageBreakBehaviour)!==null&&M!==void 0?M:"afterAllRows"}}function zs(s,t){var r=s.getLastAutoTable(),n=s.scaleFactor(),i=s.pageNumber(),l=!1;if(r&&r.startPageNumber){var x=r.startPageNumber+r.pageNumber-1;l=x===i}return typeof t=="number"?t:(t==null||t===!1)&&l&&(r==null?void 0:r.finalY)!=null?r.finalY+20/n:null}function Rs(s,t,r){var n=t.head||[],i=t.body||[],l=t.foot||[];if(t.html){var x=t.includeHiddenHtml;if(r){var g=Ca(s,t.html,r,x,t.useCss)||{};n=g.head||n,i=g.body||n,l=g.foot||n}else console.error("Cannot parse html in non browser environment")}var p=t.columns||Os(n,i,l);return{columns:p,head:n,body:i,foot:l}}function Os(s,t,r){var n=s[0]||t[0]||r[0]||[],i=[];return Object.keys(n).filter(function(l){return l!=="_element"}).forEach(function(l){var x=1,g;Array.isArray(n)?g=n[parseInt(l)]:g=n[l],typeof g=="object"&&!Array.isArray(g)&&(x=(g==null?void 0:g.colSpan)||1);for(var p=0;p<x;p++){var c=void 0;Array.isArray(n)?c=i.length:c=l+(p>0?"_".concat(p):"");var m={dataKey:c};i.push(m)}}),i}var Ot=function(){function s(t,r,n){this.table=r,this.pageNumber=r.pageNumber,this.settings=r.settings,this.cursor=n,this.doc=t.getDocument()}return s}(),Is=function(s){ja(t,s);function t(r,n,i,l,x,g){var p=s.call(this,r,n,g)||this;return p.cell=i,p.row=l,p.column=x,p.section=l.section,p}return t}(Ot),Hs=function(){function s(t,r){this.pageNumber=1,this.id=t.id,this.settings=t.settings,this.styles=t.styles,this.hooks=t.hooks,this.columns=r.columns,this.head=r.head,this.body=r.body,this.foot=r.foot}return s.prototype.getHeadHeight=function(t){return this.head.reduce(function(r,n){return r+n.getMaxCellHeight(t)},0)},s.prototype.getFootHeight=function(t){return this.foot.reduce(function(r,n){return r+n.getMaxCellHeight(t)},0)},s.prototype.allRows=function(){return this.head.concat(this.body).concat(this.foot)},s.prototype.callCellHooks=function(t,r,n,i,l,x){for(var g=0,p=r;g<p.length;g++){var c=p[g],m=new Is(t,this,n,i,l,x),w=c(m)===!1;if(n.text=Array.isArray(n.text)?n.text:[n.text],w)return!1}return!0},s.prototype.callEndPageHooks=function(t,r){t.applyStyles(t.userStyles);for(var n=0,i=this.hooks.didDrawPage;n<i.length;n++){var l=i[n];l(new Ot(t,this,r))}},s.prototype.callWillDrawPageHooks=function(t,r){for(var n=0,i=this.hooks.willDrawPage;n<i.length;n++){var l=i[n];l(new Ot(t,this,r))}},s.prototype.getWidth=function(t){if(typeof this.settings.tableWidth=="number")return this.settings.tableWidth;if(this.settings.tableWidth==="wrap"){var r=this.columns.reduce(function(i,l){return i+l.wrappedWidth},0);return r}else{var n=this.settings.margin;return t-n.left-n.right}},s}(),_a=function(){function s(t,r,n,i,l){l===void 0&&(l=!1),this.height=0,this.raw=t,t instanceof wa&&(this.raw=t._element,this.element=t._element),this.index=r,this.section=n,this.cells=i,this.spansMultiplePages=l}return s.prototype.getMaxCellHeight=function(t){var r=this;return t.reduce(function(n,i){var l;return Math.max(n,((l=r.cells[i.index])===null||l===void 0?void 0:l.height)||0)},0)},s.prototype.hasRowSpan=function(t){var r=this;return t.filter(function(n){var i=r.cells[n.index];return i?i.rowSpan>1:!1}).length>0},s.prototype.canEntireRowFit=function(t,r){return this.getMaxCellHeight(r)<=t},s.prototype.getMinimumRowHeight=function(t,r){var n=this;return t.reduce(function(i,l){var x=n.cells[l.index];if(!x)return 0;var g=r.getLineHeight(x.styles.fontSize),p=x.padding("vertical"),c=p+g;return c>i?c:i},0)},s}(),Aa=function(){function s(t,r,n){var i;this.contentHeight=0,this.contentWidth=0,this.wrappedWidth=0,this.minReadableWidth=0,this.minWidth=0,this.width=0,this.height=0,this.x=0,this.y=0,this.styles=r,this.section=n,this.raw=t;var l=t;t!=null&&typeof t=="object"&&!Array.isArray(t)?(this.rowSpan=t.rowSpan||1,this.colSpan=t.colSpan||1,l=(i=t.content)!==null&&i!==void 0?i:t,t._element&&(this.raw=t._element)):(this.rowSpan=1,this.colSpan=1);var x=l!=null?""+l:"",g=/\r\n|\r|\n/g;this.text=x.split(g)}return s.prototype.getTextPos=function(){var t;if(this.styles.valign==="top")t=this.y+this.padding("top");else if(this.styles.valign==="bottom")t=this.y+this.height-this.padding("bottom");else{var r=this.height-this.padding("vertical");t=this.y+r/2+this.padding("top")}var n;if(this.styles.halign==="right")n=this.x+this.width-this.padding("right");else if(this.styles.halign==="center"){var i=this.width-this.padding("horizontal");n=this.x+i/2+this.padding("left")}else n=this.x+this.padding("left");return{x:n,y:t}},s.prototype.getContentHeight=function(t,r){r===void 0&&(r=1.15);var n=Array.isArray(this.text)?this.text.length:1,i=this.styles.fontSize/t*r,l=n*i+this.padding("vertical");return Math.max(l,this.styles.minCellHeight)},s.prototype.padding=function(t){var r=pt(this.styles.cellPadding,0);return t==="vertical"?r.top+r.bottom:t==="horizontal"?r.left+r.right:r[t]},s}(),Ws=function(){function s(t,r,n){this.wrappedWidth=0,this.minReadableWidth=0,this.minWidth=0,this.width=0,this.dataKey=t,this.raw=r,this.index=n}return s.prototype.getMaxCustomCellWidth=function(t){for(var r=0,n=0,i=t.allRows();n<i.length;n++){var l=i[n],x=l.cells[this.index];x&&typeof x.styles.cellWidth=="number"&&(r=Math.max(r,x.styles.cellWidth))}return r},s}();function Bs(s,t){qs(s,t);var r=[],n=0;t.columns.forEach(function(l){var x=l.getMaxCustomCellWidth(t);x?l.width=x:(l.width=l.wrappedWidth,r.push(l)),n+=l.width});var i=t.getWidth(s.pageSize().width)-n;i&&(i=It(r,i,function(l){return Math.max(l.minReadableWidth,l.minWidth)})),i&&(i=It(r,i,function(l){return l.minWidth})),i=Math.abs(i),!t.settings.horizontalPageBreak&&i>.1/s.scaleFactor()&&(i=i<1?i:Math.round(i),console.warn("Of the table content, ".concat(i," units width could not fit page"))),Us(t),Ys(t,s),Vs(t)}function qs(s,t){var r=s.scaleFactor(),n=t.settings.horizontalPageBreak,i=Ma(s,t);t.allRows().forEach(function(l){for(var x=0,g=t.columns;x<g.length;x++){var p=g[x],c=l.cells[p.index];if(c){var m=t.hooks.didParseCell;t.callCellHooks(s,m,c,l,p,null);var w=c.padding("horizontal");c.contentWidth=xt(c.text,c.styles,s)+w;var N=xt(c.text.join(" ").split(/[^\S\u00A0]+/),c.styles,s);if(c.minReadableWidth=N+c.padding("horizontal"),typeof c.styles.cellWidth=="number")c.minWidth=c.styles.cellWidth,c.wrappedWidth=c.styles.cellWidth;else if(c.styles.cellWidth==="wrap"||n===!0)c.contentWidth>i?(c.minWidth=i,c.wrappedWidth=i):(c.minWidth=c.contentWidth,c.wrappedWidth=c.contentWidth);else{var M=10/r;c.minWidth=c.styles.minCellWidth||M,c.wrappedWidth=c.contentWidth,c.minWidth>c.wrappedWidth&&(c.wrappedWidth=c.minWidth)}}}}),t.allRows().forEach(function(l){for(var x=0,g=t.columns;x<g.length;x++){var p=g[x],c=l.cells[p.index];if(c&&c.colSpan===1)p.wrappedWidth=Math.max(p.wrappedWidth,c.wrappedWidth),p.minWidth=Math.max(p.minWidth,c.minWidth),p.minReadableWidth=Math.max(p.minReadableWidth,c.minReadableWidth);else{var m=t.styles.columnStyles[p.dataKey]||t.styles.columnStyles[p.index]||{},w=m.cellWidth||m.minCellWidth;w&&typeof w=="number"&&(p.minWidth=w,p.wrappedWidth=w)}c&&(c.colSpan>1&&!p.minWidth&&(p.minWidth=c.minWidth),c.colSpan>1&&!p.wrappedWidth&&(p.wrappedWidth=c.minWidth))}})}function It(s,t,r){for(var n=t,i=s.reduce(function(M,E){return M+E.wrappedWidth},0),l=0;l<s.length;l++){var x=s[l],g=x.wrappedWidth/i,p=n*g,c=x.width+p,m=r(x),w=c<m?m:c;t-=w-x.width,x.width=w}if(t=Math.round(t*1e10)/1e10,t){var N=s.filter(function(M){return t<0?M.width>r(M):!0});N.length&&(t=It(N,t,r))}return t}function Vs(s){for(var t={},r=1,n=s.allRows(),i=0;i<n.length;i++)for(var l=n[i],x=0,g=s.columns;x<g.length;x++){var p=g[x],c=t[p.index];if(r>1)r--,delete l.cells[p.index];else if(c)c.cell.height+=l.height,r=c.cell.colSpan,delete l.cells[p.index],c.left--,c.left<=1&&delete t[p.index];else{var m=l.cells[p.index];if(!m)continue;if(m.height=l.height,m.rowSpan>1){var w=n.length-i,N=m.rowSpan>w?w:m.rowSpan;t[p.index]={cell:m,left:N,row:l}}}}}function Us(s){for(var t=s.allRows(),r=0;r<t.length;r++)for(var n=t[r],i=null,l=0,x=0,g=0;g<s.columns.length;g++){var p=s.columns[g];if(x-=1,x>1&&s.columns[g+1])l+=p.width,delete n.cells[p.index];else if(i){var c=i;delete n.cells[p.index],i=null,c.width=p.width+l}else{var c=n.cells[p.index];if(!c)continue;if(x=c.colSpan,l=0,c.colSpan>1){i=c,l+=p.width;continue}c.width=p.width+l}}}function Ys(s,t){for(var r={count:0,height:0},n=0,i=s.allRows();n<i.length;n++){for(var l=i[n],x=0,g=s.columns;x<g.length;x++){var p=g[x],c=l.cells[p.index];if(c){t.applyStyles(c.styles,!0);var m=c.width-c.padding("horizontal");if(c.styles.overflow==="linebreak")c.text=t.splitTextToSize(c.text,m+1/t.scaleFactor(),{fontSize:c.styles.fontSize});else if(c.styles.overflow==="ellipsize")c.text=ha(c.text,m,c.styles,t,"...");else if(c.styles.overflow==="hidden")c.text=ha(c.text,m,c.styles,t,"");else if(typeof c.styles.overflow=="function"){var w=c.styles.overflow(c.text,m);typeof w=="string"?c.text=[w]:c.text=w}c.contentHeight=c.getContentHeight(t.scaleFactor(),t.getLineHeightFactor());var N=c.contentHeight/c.rowSpan;c.rowSpan>1&&r.count*r.height<N*c.rowSpan?r={height:N,count:c.rowSpan}:r&&r.count>0&&r.height>N&&(N=r.height),N>l.height&&(l.height=N)}}r.count--}}function ha(s,t,r,n,i){return s.map(function(l){return Zs(l,t,r,n,i)})}function Zs(s,t,r,n,i){var l=1e4*n.scaleFactor();if(t=Math.ceil(t*l)/l,t>=xt(s,r,n))return s;for(;t<xt(s+i,r,n)&&!(s.length<=1);)s=s.substring(0,s.length-1);return s.trim()+i}function Ks(s,t){var r=new Ze(s),n=Gs(t,r.scaleFactor()),i=new Hs(t,n);return Bs(r,i),r.applyStyles(r.userStyles),i}function Gs(s,t){var r=s.content,n=Xs(r.columns);if(r.head.length===0){var i=pa(n,"head");i&&r.head.push(i)}if(r.foot.length===0){var i=pa(n,"foot");i&&r.foot.push(i)}var l=s.settings.theme,x=s.styles;return{columns:n,head:$t("head",r.head,n,x,l,t),body:$t("body",r.body,n,x,l,t),foot:$t("foot",r.foot,n,x,l,t)}}function $t(s,t,r,n,i,l){var x={},g=t.map(function(p,c){for(var m=0,w={},N=0,M=0,E=0,re=r;E<re.length;E++){var Z=re[E];if(x[Z.index]==null||x[Z.index].left===0)if(M===0){var ee=void 0;Array.isArray(p)?ee=p[Z.index-N-m]:ee=p[Z.dataKey];var V={};typeof ee=="object"&&!Array.isArray(ee)&&(V=(ee==null?void 0:ee.styles)||{});var ce=Qs(s,Z,c,i,n,l,V),ve=new Aa(ee,ce,s);w[Z.dataKey]=ve,w[Z.index]=ve,M=ve.colSpan-1,x[Z.index]={left:ve.rowSpan-1,times:M}}else M--,N++;else x[Z.index].left--,M=x[Z.index].times,m++}return new _a(p,c,s,w)});return g}function pa(s,t){var r={};return s.forEach(function(n){if(n.raw!=null){var i=Js(t,n.raw);i!=null&&(r[n.dataKey]=i)}}),Object.keys(r).length>0?r:null}function Js(s,t){if(s==="head"){if(typeof t=="object")return t.header||null;if(typeof t=="string"||typeof t=="number")return t}else if(s==="foot"&&typeof t=="object")return t.footer;return null}function Xs(s){return s.map(function(t,r){var n,i;return typeof t=="object"?i=(n=t.dataKey)!==null&&n!==void 0?n:r:i=r,new Ws(i,t,r)})}function Qs(s,t,r,n,i,l,x){var g=Ds(n),p;s==="head"?p=i.headStyles:s==="body"?p=i.bodyStyles:s==="foot"&&(p=i.footStyles);var c=Ae({},g.table,g[s],i.styles,p),m=i.columnStyles[t.dataKey]||i.columnStyles[t.index]||{},w=s==="body"?m:{},N=s==="body"&&r%2===0?Ae({},g.alternateRow,i.alternateRowStyles):{},M=Ms(l),E=Ae({},M,c,N,w);return Ae(E,x)}function en(s,t,r){var n;r===void 0&&(r={});var i=Ma(s,t),l=new Map,x=[],g=[],p=[];Array.isArray(t.settings.horizontalPageBreakRepeat)?p=t.settings.horizontalPageBreakRepeat:(typeof t.settings.horizontalPageBreakRepeat=="string"||typeof t.settings.horizontalPageBreakRepeat=="number")&&(p=[t.settings.horizontalPageBreakRepeat]),p.forEach(function(N){var M=t.columns.find(function(E){return E.dataKey===N||E.index===N});M&&!l.has(M.index)&&(l.set(M.index,!0),x.push(M.index),g.push(t.columns[M.index]),i-=M.wrappedWidth)});for(var c=!0,m=(n=r==null?void 0:r.start)!==null&&n!==void 0?n:0;m<t.columns.length;){if(l.has(m)){m++;continue}var w=t.columns[m].wrappedWidth;if(c||i>=w)c=!1,x.push(m),g.push(t.columns[m]),i-=w;else break;m++}return{colIndexes:x,columns:g,lastIndex:m-1}}function tn(s,t){for(var r=[],n=0;n<t.columns.length;n++){var i=en(s,t,{start:n});i.columns.length&&(r.push(i),n=i.lastIndex)}return r}function an(s,t){var r=t.settings,n=r.startY,i=r.margin,l={x:i.left,y:n},x=t.getHeadHeight(t.columns)+t.getFootHeight(t.columns),g=n+i.bottom+x;if(r.pageBreak==="avoid"){var p=t.body,c=p.reduce(function(N,M){return N+M.height},0);g+=c}var m=new Ze(s);(r.pageBreak==="always"||r.startY!=null&&g>m.pageSize().height)&&(ka(m),l.y=i.top),t.callWillDrawPageHooks(m,l);var w=Ae({},l);t.startPageNumber=m.pageNumber(),r.horizontalPageBreak?sn(m,t,w,l):(m.applyStyles(m.userStyles),(r.showHead==="firstPage"||r.showHead==="everyPage")&&t.head.forEach(function(N){return Ee(m,t,N,l,t.columns)}),m.applyStyles(m.userStyles),t.body.forEach(function(N,M){var E=M===t.body.length-1;ht(m,t,N,E,w,l,t.columns)}),m.applyStyles(m.userStyles),(r.showFoot==="lastPage"||r.showFoot==="everyPage")&&t.foot.forEach(function(N){return Ee(m,t,N,l,t.columns)})),Na(m,t,w,l),t.callEndPageHooks(m,l),t.finalY=l.y,s.lastAutoTable=t,m.applyStyles(m.userStyles)}function sn(s,t,r,n){var i=tn(s,t),l=t.settings;if(l.horizontalPageBreakBehaviour==="afterAllRows")i.forEach(function(c,m){s.applyStyles(s.userStyles),m>0?Qe(s,t,r,n,c.columns,!0):fa(s,t,n,c.columns),nn(s,t,r,n,c.columns),Tt(s,t,n,c.columns)});else for(var x=-1,g=i[0],p=function(){var c=x;if(g){s.applyStyles(s.userStyles);var m=g.columns;x>=0?Qe(s,t,r,n,m,!0):fa(s,t,n,m),c=ga(s,t,x+1,n,m),Tt(s,t,n,m)}var w=c-x;i.slice(1).forEach(function(N){s.applyStyles(s.userStyles),Qe(s,t,r,n,N.columns,!0),ga(s,t,x+1,n,N.columns,w),Tt(s,t,n,N.columns)}),x=c};x<t.body.length-1;)p()}function fa(s,t,r,n){var i=t.settings;s.applyStyles(s.userStyles),(i.showHead==="firstPage"||i.showHead==="everyPage")&&t.head.forEach(function(l){return Ee(s,t,l,r,n)})}function nn(s,t,r,n,i){s.applyStyles(s.userStyles),t.body.forEach(function(l,x){var g=x===t.body.length-1;ht(s,t,l,g,r,n,i)})}function ga(s,t,r,n,i,l){s.applyStyles(s.userStyles),l=l??t.body.length;var x=Math.min(r+l,t.body.length),g=-1;return t.body.slice(r,x).forEach(function(p,c){var m=r+c===t.body.length-1,w=Ea(s,t,m,n);p.canEntireRowFit(w,i)&&(Ee(s,t,p,n,i),g=r+c)}),g}function Tt(s,t,r,n){var i=t.settings;s.applyStyles(s.userStyles),(i.showFoot==="lastPage"||i.showFoot==="everyPage")&&t.foot.forEach(function(l){return Ee(s,t,l,r,n)})}function rn(s,t,r){var n=r.getLineHeight(s.styles.fontSize),i=s.padding("vertical"),l=Math.floor((t-i)/n);return Math.max(0,l)}function on(s,t,r,n){var i={};s.spansMultiplePages=!0,s.height=0;for(var l=0,x=0,g=r.columns;x<g.length;x++){var p=g[x],c=s.cells[p.index];if(c){Array.isArray(c.text)||(c.text=[c.text]);var m=new Aa(c.raw,c.styles,c.section);m=Ae(m,c),m.text=[];var w=rn(c,t,n);c.text.length>w&&(m.text=c.text.splice(w,c.text.length));var N=n.scaleFactor(),M=n.getLineHeightFactor();c.contentHeight=c.getContentHeight(N,M),c.contentHeight>=t&&(c.contentHeight=t,m.styles.minCellHeight-=t),c.contentHeight>s.height&&(s.height=c.contentHeight),m.contentHeight=m.getContentHeight(N,M),m.contentHeight>l&&(l=m.contentHeight),i[p.index]=m}}var E=new _a(s.raw,-1,s.section,i,!0);E.height=l;for(var re=0,Z=r.columns;re<Z.length;re++){var p=Z[re],m=E.cells[p.index];m&&(m.height=E.height);var c=s.cells[p.index];c&&(c.height=s.height)}return E}function ln(s,t,r,n){var i=s.pageSize().height,l=n.settings.margin,x=l.top+l.bottom,g=i-x;t.section==="body"&&(g-=n.getHeadHeight(n.columns)+n.getFootHeight(n.columns));var p=t.getMinimumRowHeight(n.columns,s),c=p<r;if(p>g)return console.error("Will not be able to print row ".concat(t.index," correctly since it's minimum height is larger than page height")),!0;if(!c)return!1;var m=t.hasRowSpan(n.columns),w=t.getMaxCellHeight(n.columns)>g;return w?(m&&console.error("The content of row ".concat(t.index," will not be drawn correctly since drawing rows with a height larger than the page height and has cells with rowspans is not supported.")),!0):!(m||n.settings.rowPageBreak==="avoid")}function ht(s,t,r,n,i,l,x){var g=Ea(s,t,n,l);if(r.canEntireRowFit(g,x))Ee(s,t,r,l,x);else if(ln(s,r,g,t)){var p=on(r,g,t,s);Ee(s,t,r,l,x),Qe(s,t,i,l,x),ht(s,t,p,n,i,l,x)}else Qe(s,t,i,l,x),ht(s,t,r,n,i,l,x)}function Ee(s,t,r,n,i){n.x=t.settings.margin.left;for(var l=0,x=i;l<x.length;l++){var g=x[l],p=r.cells[g.index];if(!p){n.x+=g.width;continue}s.applyStyles(p.styles),p.x=n.x,p.y=n.y;var c=t.callCellHooks(s,t.hooks.willDrawCell,p,r,g,n);if(c===!1){n.x+=g.width;continue}dn(s,p,n);var m=p.getTextPos();ba(p.text,m.x,m.y,{halign:p.styles.halign,valign:p.styles.valign,maxWidth:Math.ceil(p.width-p.padding("left")-p.padding("right"))},s.getDocument()),t.callCellHooks(s,t.hooks.didDrawCell,p,r,g,n),n.x+=g.width}n.y+=r.height}function dn(s,t,r){var n=t.styles;if(s.getDocument().setFillColor(s.getDocument().getFillColor()),typeof n.lineWidth=="number"){var i=Sa(n.lineWidth,n.fillColor);i&&s.rect(t.x,r.y,t.width,t.height,i)}else typeof n.lineWidth=="object"&&(n.fillColor&&s.rect(t.x,r.y,t.width,t.height,"F"),cn(s,t,r,n.lineWidth))}function cn(s,t,r,n){var i,l,x,g;n.top&&(i=r.x,l=r.y,x=r.x+t.width,g=r.y,n.right&&(x+=.5*n.right),n.left&&(i-=.5*n.left),p(n.top,i,l,x,g)),n.bottom&&(i=r.x,l=r.y+t.height,x=r.x+t.width,g=r.y+t.height,n.right&&(x+=.5*n.right),n.left&&(i-=.5*n.left),p(n.bottom,i,l,x,g)),n.left&&(i=r.x,l=r.y,x=r.x,g=r.y+t.height,n.top&&(l-=.5*n.top),n.bottom&&(g+=.5*n.bottom),p(n.left,i,l,x,g)),n.right&&(i=r.x+t.width,l=r.y,x=r.x+t.width,g=r.y+t.height,n.top&&(l-=.5*n.top),n.bottom&&(g+=.5*n.bottom),p(n.right,i,l,x,g));function p(c,m,w,N,M){s.getDocument().setLineWidth(c),s.getDocument().line(m,w,N,M,"S")}}function Ea(s,t,r,n){var i=t.settings.margin.bottom,l=t.settings.showFoot;return(l==="everyPage"||l==="lastPage"&&r)&&(i+=t.getFootHeight(t.columns)),s.pageSize().height-n.y-i}function Qe(s,t,r,n,i,l){i===void 0&&(i=[]),l===void 0&&(l=!1),s.applyStyles(s.userStyles),t.settings.showFoot==="everyPage"&&!l&&t.foot.forEach(function(g){return Ee(s,t,g,n,i)}),t.callEndPageHooks(s,n);var x=t.settings.margin;Na(s,t,r,n),ka(s),t.pageNumber++,n.x=x.left,n.y=x.top,r.y=x.top,t.callWillDrawPageHooks(s,n),t.settings.showHead==="everyPage"&&(t.head.forEach(function(g){return Ee(s,t,g,n,i)}),s.applyStyles(s.userStyles))}function ka(s){var t=s.pageNumber();s.setPage(t+1);var r=s.pageNumber();return r===t?(s.addPage(),!0):!1}function mn(s){s.API.autoTable=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t[0],i=Ps(this,n),l=Ks(this,i);return an(this,l),this},s.API.lastAutoTable=!1,s.API.autoTableText=function(t,r,n,i){ba(t,r,n,i,this)},s.API.autoTableSetDefaults=function(t){return Ze.setDefaults(t,this),this},s.autoTableSetDefaults=function(t,r){Ze.setDefaults(t,r)},s.API.autoTableHtmlToJson=function(t,r){var n;if(r===void 0&&(r=!1),typeof window>"u")return console.error("Cannot run autoTableHtmlToJson in non browser environment"),null;var i=new Ze(this),l=Ca(i,t,window,r,!1),x=l.head,g=l.body,p=((n=x[0])===null||n===void 0?void 0:n.map(function(c){return c.content}))||[];return{columns:p,rows:g,data:g}}}var zt;try{if(typeof window<"u"&&window){var ya=window,va=ya.jsPDF||((zt=ya.jspdf)===null||zt===void 0?void 0:zt.jsPDF);va&&mn(va)}}catch(s){console.error("Could not apply autoTable plugin",s)}const Mn=()=>{const s=vs(),{salvarMetas:t,buscarMetas:r,buscarLogAlteracoes:n,deletarMetasPorCriterios:i}=Ns(),{gerarSemanasDoMes:l,obterSemanaAnoISO:x,buscarMetasSemanaisAgrupadas:g,buscarMetasMensaisCalculadas:p,salvarMetaSemanalIndividual:c,salvarMetaMensalComCalculoSemanal:m,salvarMetasSemanais:w,deletarMetasSemanaisPorCriterios:N,deletarMetasMensaisCalculadas:M,recalcularMetasMensais:E,calcularMetasSemanaisDeMensal:re,calcularMetaMensalDeSemanais:Z,buscarLogAlteracoesSemanais:ee}=Ss(),{user:V}=fs(),[ce,ve]=D.useState(!1),[Ie,F]=D.useState(!1),[S,A]=D.useState([]),[C,$]=D.useState([]),[W,H]=D.useState([]),[de,J]=D.useState([]),[se,je]=D.useState([]),[ke,be]=D.useState([]),[le,et]=D.useState("Todos"),[R,De]=D.useState("lojas"),[Ke,Fa]=D.useState("faturamento"),[tt,Ht]=D.useState("desc"),[O,ft]=D.useState({dt_inicio:"",dt_fim:""}),[un,Pa]=D.useState("SET"),[xn,La]=D.useState(new Date().getFullYear()),$a=(a,o)=>new Date(o,a,0).getDate(),Ta=(a,o)=>{if(!a||!o)return[];const d=y=>{if(typeof y=="string"){const[_,T,k]=y.split("-").map(L=>parseInt(L,10));return new Date(_,(T||1)-1,k||1)}const v=new Date(y);return new Date(v.getFullYear(),v.getMonth(),v.getDate())},h=d(a),u=d(o);if(h>u)return[];const j=[];let f=1,b=new Date(h);for(;b<=u;){const y=new Date(b),v=new Date(y);v.setDate(y.getDate()+6),v>u&&v.setTime(u.getTime()),j.push({numero:f,inicio:ea(y),fim:ea(v),numeroAno:typeof x=="function"?x(y):void 0}),b.setDate(b.getDate()+7),f+=1}return j},za=async a=>{var d,h,u,j,f,b;const o={};for(const y of a)try{console.log(`üîç Carregando dados para semana ${y.numero}: ${y.inicio} a ${y.fim}`);const v=await s.company.faturamentoLojas({dt_inicio:y.inicio,dt_fim:y.fim,cd_grupoempresa_ini:1,cd_grupoempresa_fim:9999});console.log(`üì° Resposta da API lojas para semana ${y.numero}:`,{success:v==null?void 0:v.success,dataLength:((d=v==null?void 0:v.data)==null?void 0:d.length)||0,error:v==null?void 0:v.error,fullResponse:v}),((h=v==null?void 0:v.data)==null?void 0:h.length)===0?console.warn(`‚ö†Ô∏è ATEN√á√ÉO: Semana ${y.numero} retornou 0 lojas!`):console.log(`‚úÖ Semana ${y.numero}: ${((u=v==null?void 0:v.data)==null?void 0:u.length)||0} lojas encontradas`);const _=await s.sales.rankingVendedores({inicio:y.inicio,fim:y.fim});console.log(`üì° Resposta da API vendedores para semana ${y.numero}:`,{success:_==null?void 0:_.success,dataLength:((j=_==null?void 0:_.data)==null?void 0:j.length)||0,error:_==null?void 0:_.error});const T=v!=null&&v.success?((f=v.data)==null?void 0:f.data)||v.data||[]:[],k=_!=null&&_.success?((b=_.data)==null?void 0:b.data)||_.data||[]:[];o[y.numero]={lojas:T,vendedores:k,periodo:y,timestamp:new Date().toISOString()},console.log(`üíæ Dados salvos para semana ${y.numero}:`,{lojasSalvas:o[y.numero].lojas.length,vendedoresSalvos:o[y.numero].vendedores.length,periodo:y,primeiraLoja:o[y.numero].lojas[0]||"Nenhuma loja"}),console.log(`‚úÖ Dados carregados para semana ${y.numero}:`,{lojas:o[y.numero].lojas.length,vendedores:o[y.numero].vendedores.length,periodo:y}),o[y.numero].lojas.length>0&&console.log(`üìä Amostra de lojas da semana ${y.numero}:`,o[y.numero].lojas.slice(0,3).map(L=>({nome:L.nome_fantasia||L.nm_loja||L.nome||L.loja,faturamento:L.faturamento})))}catch(v){console.error(`‚ùå Erro ao carregar dados da semana ${y.numero}:`,v),o[y.numero]={lojas:[],vendedores:[],periodo:y}}return console.log("üìä RESUMO FINAL - Dados por semana carregados:",{totalSemanas:Object.keys(o).length,semanas:Object.keys(o).map(y=>({semana:y,lojas:o[y].lojas.length,vendedores:o[y].vendedores.length,periodo:o[y].periodo}))}),o},[Fe,$e]=D.useState({}),[X,at]=D.useState({chave:null,campo:null}),[Ge,He]=D.useState(""),[gt,Wt]=D.useState(!1),[fe,yt]=D.useState([]),[We,Ra]=D.useState({}),[I,Oa]=D.useState([]),[ge,Bt]=D.useState([]),[he,Be]=D.useState({bronze:"",prata:"",ouro:"",diamante:""}),[Ce,qt]=D.useState("MENSAL"),[Ia,we]=D.useState(!1),[Ha,Vt]=D.useState(!1),[Je,Ut]=D.useState("Todos");D.useEffect(()=>{gt&&R==="lojas"&&yt([])},[Je,gt,R]);const[Wa,vt]=D.useState(!1),[Yt,Zt]=D.useState(!1),[bt,st]=D.useState(5),[jt,Ba]=D.useState([]),[wt,qa]=D.useState([]),[Kt,Xe]=D.useState(null),[qe,Gt]=D.useState("tabela"),[U,Jt]=D.useState({bronze:{lojas:0,vendedores:0},prata:{lojas:0,vendedores:0},ouro:{lojas:0,vendedores:0},diamante:{lojas:0,vendedores:0},lojaDetalhes:[],vendedorDetalhes:[]}),[Va,Nt]=D.useState(!1),[Ne,Ua]=D.useState({nivel:null,tipo:null,entidades:[]}),[Te,nt]=D.useState("lojas"),[G,Xt]=D.useState("MENSAL"),[Ya,Za]=D.useState([]),[_e,St]=D.useState({}),[hn,Ka]=D.useState({}),[pn,Ga]=D.useState(null),[fn,Ja]=D.useState(!1),Ve=15,[rt,Mt]=D.useState(0),[ot,Dt]=D.useState(0),[Ct,Pe]=D.useState({visible:!1,type:"success",message:""}),[Xa,it]=D.useState(!1),Qt=a=>{Ga(a),Ja(!0)},ze=(a,o,d=4e3)=>{Pe({visible:!0,type:a,message:o}),setTimeout(()=>{Pe(h=>({...h,visible:!1}))},d)},Qa=()=>{Pe(a=>({...a,visible:!1}))},B=a=>{const o=Number(a);return isNaN(o)?"R$ 0,00":o.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})},ea=a=>{const o=new Date(a),d=o.getFullYear(),h=String(o.getMonth()+1).padStart(2,"0"),u=String(o.getDate()).padStart(2,"0");return`${d}-${h}-${u}`},pe=a=>{if(!a||typeof a!="string")return"";const o=a.split("-");if(o.length!==3)return"";const[d,h,u]=o;return`${u.padStart(2,"0")}/${h.padStart(2,"0")}`},_t=a=>{const o=new Date,d=new Date(a),h=new Date(o.getFullYear(),o.getMonth(),o.getDate()),j=new Date(d.getFullYear(),d.getMonth(),d.getDate())-h,f=Math.ceil(j/(1e3*60*60*24))+1;return Math.max(0,f)},ta=(a,o)=>{const d=Number(a)||0,h=_t(o);return!h||h<=0||d<=0?0:d/h},Re=a=>String(a??"").replace(/[^0-9,\.]/g,""),Se=a=>{if(a===""||a===null||a===void 0)return 0;const d=String(a).replace(/R\$\s*/g,"").replace(/\./g,"").replace(",","."),h=parseFloat(d);return isNaN(h)?0:h},es=(a,o,d,h,u)=>{const j=`${o}-${d}`,f=_e[j];let b="";f&&f.semanas&&f.semanas[u]&&f.semanas[u].metas&&f.semanas[u].metas[h]&&(b=String(f.semanas[u].metas[h]).replace(/[^0-9,\.]/g,"").replace(/\./g,"").replace(",",".")),at({chave:a,campo:h,tipo:o,nome:d,numeroSemana:u}),He(b)},ts=a=>{const o=Fe[a]||"",d=String(o).replace(/[^0-9,\.]/g,"").replace(/\./g,"").replace(",",".");at({chave:a,campo:a.split("-").pop()}),He(d)},At=()=>{at({chave:null,campo:null}),He("")},as=async()=>{var u,j,f;if(!X.chave||!Ge)return;const a=Se(Ge);B(a),Xe(X.chave);const o=O.dt_inicio?O.dt_inicio.substring(0,7):new Date().toISOString().substring(0,7),d={tipo:X.tipo,nome:X.nome,mes:o,semana:X.numeroSemana,nivel:X.campo,valor:a,usuario:(V==null?void 0:V.name)||"Usu√°rio An√¥nimo"},h=await c(d);if(h&&h.success)St(b=>{const y=`${X.tipo}-${X.nome}`,v=b[y]||{};return v.semanas||(v.semanas={}),v.semanas[X.numeroSemana]||(v.semanas[X.numeroSemana]={numero:X.numeroSemana,metas:{}}),v.semanas[X.numeroSemana].metas||(v.semanas[X.numeroSemana].metas={}),{...b,[y]:{...v,semanas:{...v.semanas,[X.numeroSemana]:{...v.semanas[X.numeroSemana],metas:{...v.semanas[X.numeroSemana].metas,[X.campo]:a}}}}}}),await E(o,X.tipo,X.nome),await mt(o,X.tipo,X.nome);else{console.error("Erro ao salvar meta semanal:",h.error);const b=((u=h.error)==null?void 0:u.includes("conex√£o"))||((j=h.error)==null?void 0:j.includes("internet"))||((f=h.error)==null?void 0:f.includes("Failed to fetch"));alert(b?`‚ùå Erro de conex√£o!

Verifique sua internet e tente novamente.
Se o problema persistir, pode ser um problema tempor√°rio do servidor.`:`‚ùå Erro ao salvar meta semanal:

${h.error}

Tente novamente.`)}Xe(null),at({chave:null,campo:null}),He("")},ss=async()=>{if(!X.chave)return;const a=Se(Ge),o=B(a);Xe(X.chave),$e(b=>({...b,[X.chave]:o}));const d=X.chave.split("-"),h=d[0],u=d[d.length-1],j=d.slice(1,-1).join("-"),f=O.dt_inicio?O.dt_inicio.substring(0,7):new Date().toISOString().substring(0,7);if(G==="MENSAL"){const b=await m(h,j,f,u,a,(V==null?void 0:V.name)||"Usu√°rio An√¥nimo");b&&b.success?(await Oe(),await aa(X.chave,o)):(console.error("‚ùå Erro ao salvar meta mensal:",b.error),alert("Erro ao salvar meta mensal. Tente novamente."))}else await aa(X.chave,o);Xe(null),At()},aa=async(a,o)=>{try{const d=a.split("-"),h=d[0],u=d[d.length-1],j=d.slice(1,-1).join("-"),f=O.dt_inicio?O.dt_inicio.substring(0,7):new Date().toISOString().substring(0,7),b=[{tipo:h,nome:j,metas:{[u]:o},mes:f,usuario:(V==null?void 0:V.name)||"Usu√°rio An√¥nimo"}],y=await t(b);y&&y.success?await Ue():(console.error("Erro ao salvar meta individual:",y.error),$e(v=>({...v,[a]:Fe[a]})),ze("error","Erro ao salvar meta. Tente novamente."))}catch(d){console.error("Erro ao salvar meta individual:",d),$e(h=>({...h,[a]:Fe[a]})),d.message.includes("duplicate key value violates unique constraint")?alert("Esta meta j√° existe para este per√≠odo. A meta foi atualizada com sucesso!"):ze("error","Erro ao salvar meta. Tente novamente.")}finally{Xe(null)}},ns=()=>{Wt(!0)},Me=()=>{Wt(!1),yt([]),Bt([]),Be({bronze:"",prata:"",ouro:"",diamante:""}),we(!1),Ut("Todos")},rs=()=>{we(!0)},os=async()=>{it(!0);const a={},o={};if(["bronze","prata","ouro","diamante"].forEach(h=>{if(he[h]!==""){const u=Se(he[h]);a[h]=u,o[h]=B(u)}}),Ce==="MENSAL"&&Object.keys(a).length===0){we(!1),Me();return}const d=O.dt_inicio?O.dt_inicio.substring(0,7):new Date().toISOString().substring(0,7);try{if(Ce==="MENSAL"){const h=[];if(R==="lojas"){if(fe.length===0){we(!1),Me();return}fe.forEach(b=>{const y=(b.nome_fantasia||b.nm_loja||b.nome||b.loja||"").toUpperCase();Object.entries(a).forEach(([v,_])=>{h.push(m("lojas",y,d,v,_,(V==null?void 0:V.name)||"Usu√°rio An√¥nimo"))})})}else if(R==="vendedores"){if(ge.length===0){we(!1),Me();return}ge.forEach(b=>{const y=(b.nome_vendedor||b.vendedor||b.nm_vendedor||b.nome||"").toUpperCase();Object.entries(a).forEach(([v,_])=>{h.push(m("vendedores",y,d,v,_,(V==null?void 0:V.name)||"Usu√°rio An√¥nimo"))})})}const u=await Promise.all(h),j=u.filter(b=>b.success).length,f=u.filter(b=>!b.success).length;console.log(`üîç Resultado: ${j} sucessos, ${f} falhas`),j>0&&(await Oe(),$e(b=>{const y={...b};return R==="lojas"?fe.forEach(v=>{const _=(v.nome_fantasia||v.nm_loja||v.nome||v.loja||"").toUpperCase();Object.entries(o).forEach(([T,k])=>{const L=`lojas-${_}-${T}`;y[L]=k})}):R==="vendedores"&&ge.forEach(v=>{const _=(v.nome_vendedor||v.vendedor||v.nm_vendedor||v.nome||"").toUpperCase();Object.entries(o).forEach(([T,k])=>{const L=`vendedores-${_}-${T}`;y[L]=k})}),y}),await Ue()),f>0&&alert(`‚ùå ${f} metas falharam ao ser salvas. Verifique os logs.`)}else if(Ce==="SEMANAL"){const h={};if(Ya.forEach(v=>{h[v.numero]={},["bronze","prata","ouro","diamante"].forEach(_=>{const T=`${_}_semana_${v.numero}`;if(he[T]&&he[T]!==""){const k=Se(he[T]);h[v.numero][_]=k}})}),!Object.values(h).some(v=>Object.keys(v).length>0)){ze("warning","Nenhum valor foi preenchido para aplicar as metas semanais."),we(!1),Me(),it(!1);return}const j=[];if(R==="lojas"){if(fe.length===0){we(!1),Me();return}fe.forEach(v=>{const _=(v.nome_fantasia||v.nm_loja||v.nome||v.loja||"").toUpperCase();Object.entries(h).forEach(([T,k])=>{Object.entries(k).forEach(([L,P])=>{j.push(c({tipo:"lojas",nome:_,mes:d,semana:parseInt(T),nivel:L,valor:P,usuario:(V==null?void 0:V.name)||"Usu√°rio An√¥nimo"}))})})})}else if(R==="vendedores"){if(ge.length===0){we(!1),Me();return}ge.forEach(v=>{const _=(v.nome_vendedor||v.vendedor||v.nm_vendedor||v.nome||"").toUpperCase();Object.entries(h).forEach(([T,k])=>{Object.entries(k).forEach(([L,P])=>{j.push(c({tipo:"vendedores",nome:_,mes:d,semana:parseInt(T),nivel:L,valor:P,usuario:(V==null?void 0:V.name)||"Usu√°rio An√¥nimo"}))})})})}if(j.length===0){ze("warning","Nenhuma opera√ß√£o ser√° executada. Verifique se preencheu os campos e selecionou as lojas."),we(!1),Me(),it(!1);return}const f=await Promise.all(j),b=f.filter(v=>v.success).length,y=f.filter(v=>!v.success).length;b>0&&(await Oe(),await E(d,R),await mt(d,R),await Ue(),ze("success",`${b} metas semanais foram aplicadas com sucesso!`)),y>0&&ze("error",`${y} metas falharam ao ser salvas. Verifique os logs no console.`)}}catch(h){console.error("‚ùå Erro ao aplicar metas em lote:",h),ze("error","Erro ao aplicar metas em lote. Tente novamente.")}finally{it(!1)}we(!1),Me()},sa=()=>{we(!1)},is=()=>{st(5),vt(!0);const a=setInterval(()=>{st(o=>o<=1?(clearInterval(a),0):o-1)},1e3)},na=()=>{vt(!1),st(5)},ls=async()=>{Zt(!0);try{const a=O.dt_inicio?O.dt_inicio.substring(0,7):new Date().toISOString().substring(0,7);console.log("üîç Zerando metas do per√≠odo:",a);const o=[],d=[];if(Ce==="MENSAL"){const h=[];if(R==="lojas"){if(!fe||fe.length===0)throw new Error("Nenhuma loja selecionada para excluir metas.");fe.forEach(v=>{const _=v.nome_fantasia||v.nm_loja||v.nome||v.loja||"";if(!_){console.warn("Loja sem nome v√°lido:",v);return}h.push({tipo:"lojas",nome:_,mes:a})})}else{if(!ge||ge.length===0)throw new Error("Nenhum vendedor selecionado para excluir metas.");ge.forEach(v=>{const _=v.nome_vendedor||v.vendedor||v.nm_vendedor||v.nome||"";if(!_){console.warn("Vendedor sem nome v√°lido:",v);return}h.push({tipo:"vendedores",nome:_,mes:a})})}if(h.length===0)throw new Error("Nenhum crit√©rio v√°lido encontrado para exclus√£o. Verifique as sele√ß√µes.");console.log(`üóëÔ∏è Excluindo metas mensais para ${h.length} entidades...`);const u=h.map(v=>i(v)),j=h.map(v=>M(v)),f=[...u,...j],b=await Promise.all(f);if(console.log("üîç Resultados das opera√ß√µes de exclus√£o:",b),b.every(v=>v&&v.success))$e(v=>{const _={...v};return h.forEach(T=>{["bronze","prata","ouro","diamante"].forEach(k=>{const L=`${T.tipo}-${T.nome}-${k}`;delete _[L]})}),_}),await Et(),await Ue(),Pe({visible:!0,type:"success",message:"Metas mensais exclu√≠das com sucesso!"});else{const v=b.filter(_=>!_||!_.success).map(_=>(_==null?void 0:_.error)||"Erro desconhecido").join(", ");throw new Error(`Erro ao excluir metas mensais: ${v}`)}}else{if(!I||I.length===0)throw new Error("Nenhuma semana dispon√≠vel para excluir metas semanais. Verifique se o per√≠odo est√° correto.");if(R==="lojas"){if(!fe||fe.length===0)throw new Error("Nenhuma loja selecionada para excluir metas.");fe.forEach(f=>{const b=f.nome_fantasia||f.nm_loja||f.nome||f.loja||"";if(!b){console.warn("Loja sem nome v√°lido:",f);return}I.forEach(y=>{if(!y||!y.numero){console.warn("Semana inv√°lida:",y);return}d.push({mes:a,tipo:"lojas",nome:b,semana:y.numero})})})}else{if(!ge||ge.length===0)throw new Error("Nenhum vendedor selecionado para excluir metas.");ge.forEach(f=>{const b=f.nome_vendedor||f.vendedor||f.nm_vendedor||f.nome||"";if(!b){console.warn("Vendedor sem nome v√°lido:",f);return}I.forEach(y=>{if(!y||!y.numero){console.warn("Semana inv√°lida:",y);return}d.push({mes:a,tipo:"vendedores",nome:b,semana:y.numero})})})}if(d.length===0)throw new Error("Nenhum crit√©rio v√°lido encontrado para exclus√£o. Verifique as sele√ß√µes.");console.log(`üóëÔ∏è Excluindo ${d.length} metas semanais...`),console.log("üîç Crit√©rios de exclus√£o:",d),console.log(`üóëÔ∏è Iniciando exclus√£o de ${d.length} metas semanais...`);const h=d.map(f=>N(f)),u=await Promise.all(h);if(console.log("üîç Resultados das opera√ß√µes de exclus√£o de metas semanais:",u),u.every(f=>f&&f.success))St({}),await Et(),G==="SEMANAL"&&(console.log("üîÑ Recarregando dados semanais ap√≥s exclus√£o..."),await Oe(),console.log("‚úÖ Dados semanais recarregados")),await Ue(),Pe({visible:!0,type:"success",message:"Metas semanais exclu√≠das com sucesso!"});else{const f=u.filter(b=>!b||!b.success).map(b=>(b==null?void 0:b.error)||"Erro desconhecido").join(", ");throw new Error(`Erro ao excluir metas semanais: ${f}`)}}}catch(a){console.error("‚ùå Erro ao excluir metas:",a),Pe({visible:!0,type:"error",message:`Erro ao excluir metas: ${a.message}`})}finally{Zt(!1),vt(!1),st(5)}},Ue=async()=>{const a=await n();a&&a.success&&Ba(a.data);const o=await ee();o.success&&qa(o.data)},ds=async()=>{await Ue(),Vt(!0)},ra=()=>{Vt(!1)},lt=(a,o,d,h,u="text-amber-700")=>{const j=`${a}-${o}-${d}-semana-${h}`,f=X.chave===j,b=Kt===j,y=`${a}-${o}`,v=_e[y];let _="";return v&&v.semanas&&v.semanas[h]&&v.semanas[h].metas&&v.semanas[h].metas[d]&&(_=B(v.semanas[h].metas[d])),f?e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("input",{type:"text",inputMode:"numeric",className:"w-16 px-1 py-0.5 border border-blue-400 rounded text-[7px] text-center focus:outline-none focus:ring-1 focus:ring-blue-400 bg-blue-50",value:Ge,placeholder:"0,00",onChange:T=>He(Re(T.target.value)),onKeyDown:T=>{T.key==="Enter"&&(T.preventDefault(),as())},autoFocus:!0}),e.jsx("button",{type:"button",className:"text-[7px] bg-gray-500 text-white px-1 py-0.5 rounded",onClick:At,children:"X"})]}):e.jsx("span",{className:`${u} font-bold cursor-pointer select-none ${b?"opacity-50":""}`,onClick:()=>!b&&es(j,a,o,d,h),children:_||"-"})},dt=(a,o="text-amber-700")=>{const d=X.chave===a,h=Kt===a;if(d)return e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("input",{type:"text",inputMode:"numeric",className:"w-20 px-2 py-0.5 border border-blue-400 rounded text-[11px] text-center focus:outline-none focus:ring-1 focus:ring-blue-400 bg-blue-50",value:Ge,placeholder:"0,00",onChange:j=>He(Re(j.target.value)),onKeyDown:j=>{j.key==="Enter"&&(j.preventDefault(),ss())},autoFocus:!0}),e.jsx("button",{type:"button",className:"text-[11px] bg-gray-500 text-white px-2 py-0.5 rounded",onClick:At,children:"Cancelar"})]});const u=Fe[a]||"R$ 0,00";return e.jsx("span",{className:`${o} font-bold cursor-pointer select-none ${h?"opacity-50":""}`,onClick:()=>!h&&ts(a),children:h?"Salvando...":u})};D.useEffect(()=>{const a=new Date,o=a.getMonth()+1,d=a.getFullYear(),u={1:"JAN",2:"FEV",3:"MAR",4:"ABR",5:"MAI",6:"JUN",7:"JUL",8:"AGO",9:"SET",10:"OUT",11:"NOV",12:"DEZ"}[o];if(u){Pa(u),La(d);const j=`${d}-${String(o).padStart(2,"0")}-01`,f=$a(o,d),b=`${d}-${String(o).padStart(2,"0")}-${String(f).padStart(2,"0")}`;ft({dt_inicio:j,dt_fim:b})}},[]),D.useEffect(()=>{qe==="dashboard"&&(S.length>0||C.length>0)&&Pt()},[Fe,S,C,qe,le,se,W,G,I,_e]),D.useEffect(()=>{G==="SEMANAL"&&O.dt_inicio&&(console.log("üîç Carregando dados semanais - visualiza√ß√£o mudou para SEMANAL"),Oe())},[G,O.dt_inicio]),D.useEffect(()=>{O.dt_inicio&&(console.log("üîç Carregando dados semanais automaticamente na inicializa√ß√£o"),Oe())},[O.dt_inicio]);const ct=(a,o)=>{const h=(o==="lojas"?U.lojaDetalhes:U.vendedorDetalhes).filter(u=>{const j=u.metas[a]||0,f=G==="SEMANAL"?u.faturamentoSemanal:u.faturamento;return j>0&&f>=j}).map(u=>({nome:u.nome,meta:u.metas[a],faturamento:G==="SEMANAL"?u.faturamentoSemanal:u.faturamento,semana:`S${kt(O.dt_inicio?O.dt_inicio.substring(0,7):new Date().toISOString().substring(0,7))}`}));Ua({nivel:a,tipo:o,entidades:h}),Nt(!0)},cs=()=>{if(console.log("üîç Iniciando gera√ß√£o de relat√≥rio PDF..."),!We||Object.keys(We).length===0){alert("Nenhum dado dispon√≠vel para gerar relat√≥rio. Por favor, execute a busca primeiro.");return}const a=new ws;let o=15;const d=a.internal.pageSize.getHeight(),h=a.internal.pageSize.getWidth(),u=12,j=d-15,f={bronze:{color:[184,134,11],textColor:[139,101,8]},prata:{color:[192,192,192],textColor:[100,100,100]},ouro:{color:[255,215,0],textColor:[184,134,11]},diamante:{color:[30,144,255],textColor:[0,102,204]}},b={bronze:"ü•â",prata:"ü•à",ouro:"ü•á",diamante:"üíé"},y=k=>(k||"").toString().normalize("NFD").replace(/\p{Diacritic}/gu,"").toLowerCase().trim(),v={lojas:new Map,vendedores:new Map};Object.keys(_e||{}).forEach(k=>{const L=k.split("-"),P=L[0],K=L.slice(1).join("-"),oe=y(K);v[P]||(v[P]=new Map),v[P].set(oe,_e[k])}),a.setFillColor(6,6,56),a.rect(0,0,h,25,"F"),a.setTextColor(255,255,255),a.setFontSize(20),a.setFont(void 0,"bold"),a.text("RELAT√ìRIO DE METAS",u,12),a.setFontSize(10),a.setFont(void 0,"normal"),a.text(`Per√≠odo: ${O.dt_inicio} a ${O.dt_fim}`,u,20),a.setTextColor(0,0,0),o=30,Object.keys(We).sort((k,L)=>parseInt(k)-parseInt(L)).forEach((k,L)=>{const P=We[k],K=parseInt(k,10);o>j-60&&(a.addPage(),o=15),a.setFillColor(100,149,237),a.rect(u,o,h-u*2,7,"F"),a.setTextColor(255,255,255),a.setFontSize(12),a.setFont(void 0,"bold"),a.text(`SEMANA ${k}`,u+3,o+5),o+=10,a.setTextColor(0,0,0),["bronze","prata","ouro","diamante"].forEach(ne=>{var ae;const Y=[];if((ae=P.lojas)==null||ae.forEach(q=>{var Le,Ye,da;const ie=q.nome_fantasia||q.nome_loja||q.loja||q.nome||"",Q=y(ie),z=((Le=v.lojas)==null?void 0:Le.get(Q))||null,me=((da=(Ye=z==null?void 0:z.semanas)==null?void 0:Ye[K])==null?void 0:da.metas)||{},te=Se(me[ne])||0,xe=Number(q.faturamento)||0;if(te>0&&xe>=te){const ps=Math.round(xe/te*100);Y.push({loja:ie,meta:te,metaFormatada:B(te),faturamento:xe,faturamentoFormatado:B(xe),percentual:ps})}}),Y.length>0){o>j-40&&(a.addPage(),o=15);const q=f[ne];a.setFillColor(...q.color),a.rect(u,o,h-u*2,6,"F"),a.setTextColor(255,255,255),a.setFontSize(11),a.setFont(void 0,"bold"),a.text(`${b[ne]} ${ne.toUpperCase()} (${Y.length} lojas)`,u+3,o+4.5),o+=8,a.setTextColor(...q.textColor),a.setFontSize(8),a.setFont(void 0,"bold");const ie=u+2,Q=h-u-60,z=h-u-30,me=h-u-8;a.text("Loja",ie,o),a.text("Meta",Q,o),a.text("Faturamento",z,o),a.text("%",me,o),o+=3,a.setDrawColor(...q.textColor),a.setLineWidth(.3),a.line(u+2,o,h-u-2,o),o+=2,a.setTextColor(0,0,0),a.setFontSize(8),a.setFont(void 0,"normal"),Y.forEach((te,xe)=>{o>j-5&&(a.addPage(),o=15,a.setFillColor(...q.color),a.rect(u,o,h-u*2,6,"F"),a.setTextColor(255,255,255),a.setFontSize(11),a.setFont(void 0,"bold"),a.text(`${b[ne]} ${ne.toUpperCase()} (continua√ß√£o)`,u+3,o+4.5),o+=8,a.setTextColor(...q.textColor),a.setFontSize(8),a.setFont(void 0,"bold"),a.text("Loja",ie,o),a.text("Meta",Q,o),a.text("Faturamento",z,o),a.text("%",me,o),o+=3,a.setDrawColor(...q.textColor),a.setLineWidth(.3),a.line(u+2,o,h-u-2,o),o+=2,a.setTextColor(0,0,0),a.setFontSize(8),a.setFont(void 0,"normal")),xe%2===0&&(a.setFillColor(240,240,240),a.rect(u+1,o-1.5,h-u*2-2,3.5,"F"));const Le=te.loja.length>25?te.loja.substring(0,22)+"...":te.loja;a.text(Le,ie,o),a.text(te.metaFormatada,Q,o),a.text(te.faturamentoFormatado,z,o);const Ye=te.percentual>=100?[34,139,34]:te.percentual>=80?[255,140,0]:[220,20,60];a.setTextColor(...Ye),a.setFont(void 0,"bold"),a.text(`${te.percentual}%`,me,o),a.setTextColor(0,0,0),a.setFont(void 0,"normal"),o+=3.5}),o+=2}}),o+=5}),a.setFontSize(8),a.setTextColor(128,128,128);const T=new Date().toLocaleString("pt-BR");a.text(`Relat√≥rio gerado em: ${T}`,u,d-10),a.save(`relatorio-metas-${new Date().toISOString().slice(0,10)}.pdf`),console.log("‚úÖ PDF gerado com sucesso!")},ms=async()=>{var a,o;ve(!0),F(!0);try{const d=Ta(O.dt_inicio,O.dt_fim);Oa(d),console.log("üìÖ Per√≠odos de semanas gerados:",d);const h=await za(d);Ra(h),console.log("üìä Dados por semana carregados e salvos no estado:",{totalSemanas:Object.keys(h).length,semanas:Object.keys(h),detalhesSemanas:Object.keys(h).map(f=>({semana:f,lojas:h[f].lojas.length,vendedores:h[f].vendedores.length}))});const u=((a=d[0])==null?void 0:a.inicio)||O.dt_inicio,j=((o=d[d.length-1])==null?void 0:o.fim)||O.dt_fim;console.log("üìÖ Per√≠odo das semanas para busca de dados:",{periodoInicio:u,periodoFim:j,semanas:d.length,primeiraSemana:d[0],ultimaSemana:d[d.length-1]}),await Promise.all([xs(u,j),hs(u,j)]),await Et(),G==="SEMANAL"&&await Oe(),setTimeout(()=>{Pt(),ve(!1),F(!1)},1e3)}catch(d){console.error("Erro ao buscar dados:",d),ve(!1),F(!1)}},Oe=async()=>{if(!O.dt_inicio){console.log("‚ùå N√£o h√° data de in√≠cio para carregar dados semanais");return}const a=O.dt_inicio.substring(0,7);console.log("üîç Carregando dados semanais para o m√™s:",a);const o=l(a);console.log("üîç Semanas geradas:",o),Za(o);const d=await g(a);d.success?(console.log("üîç Metas semanais carregadas:",d.data),St(d.data)):console.log("‚ùå Erro ao carregar metas semanais:",d.error);const h=await p(a,a,R);if(h.success){const u={};h.data.forEach(j=>{const f=`${j.tipo}-${j.nome}`;u[f]=j}),console.log("üîç Metas mensais calculadas carregadas:",u),Ka(u)}else console.log("‚ùå Erro ao carregar metas mensais calculadas:",h.error);await mt(a)},Et=async()=>{if(!O.dt_inicio||!O.dt_fim)return;const a=O.dt_inicio.substring(0,7),o=O.dt_fim.substring(0,7),d=await r(a,o);if(d&&d.success){const h={};d.data.forEach(u=>{const j=`${u.tipo}-${u.nome}-${u.campo}`;h[j]=u.valor}),$e(h)}await mt(a)},mt=async(a,o=null,d=null)=>{console.log("üîÑ Atualizando metas mensais calculadas:",{mes:a,tipo:o,nome:d});try{const h=await p(a,o,d);if(h&&h.success){const u={};return h.data.forEach(j=>{["bronze","prata","ouro","diamante"].forEach(f=>{if(j[f]>0){const b=`${j.tipo}-${j.nome}-${f}`;u[b]=B(j[f])}})}),console.log("üìä Metas calculadas encontradas:",u),$e(j=>{const f={...j};return Object.keys(u).forEach(b=>{f[b]=u[b]}),f}),u}}catch(h){console.error("‚ùå Erro ao atualizar metas mensais calculadas:",h)}return{}},kt=a=>{const o=new Date,d=new Date(o.getFullYear(),o.getMonth(),1),h=Math.floor((o-d)/(1e3*60*60*24));return Math.ceil((h+1)/7)},Ft=(a,o)=>{const d=o==="lojas"?a.nome_fantasia||a.nm_loja||a.nome||a.loja||"":a.nome_vendedor||a.vendedor||a.nm_vendedor||a.nome||"",h=`${o}-${d}`,u=_e[h];return I.map(j=>{var Y,ae,q,ie;const f=We[j.numero];let b=0;if(console.log(`üîç Verificando dados da semana ${j.numero} para ${d}:`,{dadosSemanaExiste:!!f,dadosPorSemanaKeys:Object.keys(We),dadosSemanaConteudo:f?{lojas:((Y=f.lojas)==null?void 0:Y.length)||0,vendedores:((ae=f.vendedores)==null?void 0:ae.length)||0,periodo:f.periodo}:"Dados n√£o existem"}),console.log(`üîç Calculando semana ${j.numero} para ${d} (${o}):`,{dadosSemanaExiste:!!f,dadosEntidadeExiste:f&&!!f[o==="lojas"?"lojas":"vendedores"],totalEntidades:f&&((q=f[o==="lojas"?"lojas":"vendedores"])==null?void 0:q.length)||0}),f&&f[o==="lojas"?"lojas":"vendedores"]){const Q=f[o==="lojas"?"lojas":"vendedores"].find(z=>{const me=o==="lojas"?z.nome_fantasia||z.nm_loja||z.nome||z.loja||"":z.nome_vendedor||z.vendedor||z.nm_vendedor||z.nome||"",te=d.trim().toLowerCase(),xe=me.trim().toLowerCase();return te===xe});console.log(`üîç Buscando entidade "${d}" na semana ${j.numero}:`,{nomeBuscado:d,totalEntidades:f[o==="lojas"?"lojas":"vendedores"].length,nomesEncontrados:f[o==="lojas"?"lojas":"vendedores"].slice(0,5).map(z=>({nome:o==="lojas"?z.nome_fantasia||z.nm_loja||z.nome||z.loja||"":z.nome_vendedor||z.vendedor||z.nm_vendedor||z.nome||"",faturamento:z.faturamento,nomeComparacao:(o==="lojas"?z.nome_fantasia||z.nm_loja||z.nome||z.loja||"":z.nome_vendedor||z.vendedor||z.nm_vendedor||z.nome||"").trim().toLowerCase(),nomeBuscadoComparacao:d.trim().toLowerCase()})),entidadeEncontrada:!!Q}),Q?(b=parseFloat(Q.faturamento)||0,console.log(`‚úÖ Dados reais encontrados para ${d} na semana ${j.numero}:`,{faturamento:b,entidade:Q})):console.log(`‚ùå Entidade ${d} n√£o encontrada na semana ${j.numero}`)}else console.log(`‚ùå Dados da semana ${j.numero} n√£o dispon√≠veis`);b===0&&console.log(`üìä Sem faturamento para ${d} na semana ${j.numero} - usando 0`);const y=((ie=u==null?void 0:u.semanas)==null?void 0:ie[j.numero])||{metas:{}};console.log(`üéØ Metas semanais para ${d} - Semana ${j.numero}:`,{metasSemana:y,metasDisponiveis:Object.keys(y.metas||{}),valoresMetas:y.metas});const v=["bronze","prata","ouro","diamante"];let _=0,T=0,k="Abaixo de Bronze",L="",P="",K="sem-meta";for(const Q of v){const z=y.metas[Q]||0;if(z>0)if(K="com-meta",b>=z)_=z,k=Q.charAt(0).toUpperCase()+Q.slice(1),L=Q.charAt(0).toUpperCase()+Q.slice(1);else{T===0&&(T=z,P=Q.charAt(0).toUpperCase()+Q.slice(1));break}}const oe=T>0?Math.max(0,T-b):0,ne=T>0?Math.min(100,b/T*100):0;return{numero:j.numero,numeroAno:j.numeroAno,inicio:j.inicio,fim:j.fim,faturamento:b,metaAtingida:_,proximaMeta:T,faltante:oe,nivelAtingido:k,nomeMetaAtingida:L,nomeProximaMeta:P,progresso:Math.round(ne),status:K}})},ye=(a,o)=>{const d=Ft(a,o),h=kt(O.dt_inicio?O.dt_inicio.substring(0,7):new Date().toISOString().substring(0,7));if(d.length===0)return{semanaAtual:"-",metaSemanaAtual:0,metaAtingida:0,proximaMeta:0,faltanteProximaMeta:0,progressoPercentual:0,nivelAtual:"Abaixo de Bronze"};const u=d[h-1]||d[0],j=u.numeroAno||x(new Date);return{semanaAtual:h>0?`S${h}${j?` (${j})`:""}`:"-",metaSemanaAtual:u.metaAtingida||u.proximaMeta||0,metaAtingida:u.metaAtingida,proximaMeta:u.proximaMeta,faltanteProximaMeta:u.faltante,progressoPercentual:u.metaAtingida>0?100:0,nivelAtual:u.nivelAtingido,faturamentoSemanal:u.faturamento}},Pt=()=>{if(!O.dt_inicio||!O.dt_fim)return;console.log("üéØ calcularStatsDashboard chamada:",{visualizacaoTipo:G,filtrosDataInicio:O.dt_inicio,dadosLojasCount:S.length,dadosVendedoresCount:C.length,metaValoresCount:Object.keys(Fe||{}).length,metasSemanaisCount:Object.keys(_e||{}).length});const a=f=>(f||"").toString().normalize("NFD").replace(/\p{Diacritic}/gu,"").toLowerCase().trim(),o={lojas:new Map,vendedores:new Map};Object.keys(Fe||{}).forEach(f=>{const b=f.split("-"),y=b[0],v=b[b.length-1],_=b.slice(1,b.length-1).join("-"),T=a(_);o[y]||(o[y]=new Map);const k=o[y];k.has(T)||k.set(T,{}),k.get(T)[v]=Se(Fe[f])});const d={lojas:new Map,vendedores:new Map};Object.keys(_e||{}).forEach(f=>{const b=f.split("-"),y=b[0],v=b.slice(1).join("-"),_=a(v);d[y]||(d[y]=new Map),d[y].set(_,_e[f])});const h=kt(O.dt_inicio?O.dt_inicio.substring(0,7):new Date().toISOString().substring(0,7)),u={bronze:{lojas:0,vendedores:0},prata:{lojas:0,vendedores:0},ouro:{lojas:0,vendedores:0},diamante:{lojas:0,vendedores:0},lojaDetalhes:[],vendedorDetalhes:[]},j=(f,b)=>{const y=b==="lojas"?f.nome_fantasia||f.nome_loja||f.loja||f.nm_loja||f.nome||"":f.nome_vendedor||f.vendedor||f.nm_vendedor||f.nome||"",v=Number(f.faturamento)||0,_=a(y),T=o[b]&&o[b].get(_)||{},k=d[b]&&d[b].get(_)||null,L=k&&k.semanas&&k.semanas[h]?k.semanas[h].metas||{}:{};let P=v;if(G==="SEMANAL")try{P=ye(f,b).faturamentoSemanal||0}catch{P=v}["bronze","prata","ouro","diamante"].forEach(me=>{const te=G==="SEMANAL"?Se(L[me])||0:T[me]||0;te>0&&P>=te&&(u[me][b]=(u[me][b]||0)+1)});const K=G==="SEMANAL"?Se(L.bronze)||0:T.bronze||0,oe=G==="SEMANAL"?Se(L.prata)||0:T.prata||0,ne=G==="SEMANAL"?Se(L.ouro)||0:T.ouro||0,Y=G==="SEMANAL"?Se(L.diamante)||0:T.diamante||0;let ae="Abaixo de Bronze",q="Bronze",ie=K,Q=0,z=0;return Y>0&&P>=Y?(ae="Diamante",q="Meta m√°xima atingida",ie=0,Q=100,z=0):ne>0&&P>=ne?(ae="Ouro",q="Diamante",ie=Y,Q=Y>0?Math.min(100,Math.round(P/Y*100)):0,z=Y>0?Math.max(0,Y-P):0):oe>0&&P>=oe?(ae="Prata",q="Ouro",ie=ne,Q=ne>0?Math.min(100,Math.round(P/ne*100)):0,z=ne>0?Math.max(0,ne-P):0):K>0&&P>=K?(ae="Bronze",q="Prata",ie=oe,Q=oe>0?Math.min(100,Math.round(P/oe*100)):0,z=oe>0?Math.max(0,oe-P):0):(ae="Abaixo de Bronze",q="Bronze",ie=K,Q=K>0?Math.min(100,Math.round(P/K*100)):0,z=K>0?Math.max(0,K-P):0),{nome:y,faturamento:v,faturamentoSemanal:P,metaAtual:ae,proximaMeta:q,valorProximaMeta:ie,percentualAtingido:Q,valorFaltante:z,metas:{bronze:K,prata:oe,ouro:ne,diamante:Y}}};S.forEach(f=>{const b=j(f,"lojas");u.lojaDetalhes.push(b)}),C.forEach(f=>{const b=j(f,"vendedores");u.vendedorDetalhes.push(b)}),console.log("‚úÖ calcularStatsDashboard resultado final:",{visualizacaoTipo:G,lojasPorMeta:{bronze:u.bronze.lojas,prata:u.prata.lojas,ouro:u.ouro.lojas,diamante:u.diamante.lojas},vendedoresPorMeta:{bronze:u.bronze.vendedores,prata:u.prata.vendedores,ouro:u.ouro.vendedores,diamante:u.diamante.vendedores},totalLojasDetalhes:u.lojaDetalhes.length,totalVendedoresDetalhes:u.vendedorDetalhes.length}),Jt(u)},oa=async()=>{var h,u,j,f;const a=new Date,o=a.getMonth()+1,d=a.getFullYear();for(let b=0;b<6;b++){const y=new Date(d,o-1-b,1),v=y.getMonth()+1,_=y.getFullYear(),T=`${_}-${v.toString().padStart(2,"0")}-01`,k=new Date(_,v,0).toISOString().split("T")[0];try{console.log(`üîç Testando m√™s ${v}/${_} para encontrar dados...`);const L={dt_inicio:T,dt_fim:k,cd_grupoempresa_ini:1,cd_grupoempresa_fim:9999},P=await s.company.faturamentoLojas(L);console.log(`üîç Estrutura dos dados para ${v}/${_}:`,{success:P.success,hasData:!!P.data,hasDataData:!!((h=P.data)!=null&&h.data),dataDataLength:(j=(u=P.data)==null?void 0:u.data)==null?void 0:j.length,dataKeys:P.data?Object.keys(P.data):[],fullStructure:P.data});const K=((f=P.data)==null?void 0:f.data)||P.data||[],oe=Array.isArray(K)&&K.length>0;if(P.success&&oe)return console.log(`‚úÖ Encontrado dados para ${v}/${_} - ${K.length} lojas`),{mes:v,ano:_,primeiroDia:T,ultimoDia:k,dadosLojas:K}}catch(L){console.log(`‚ùå Erro ao testar ${v}/${_}:`,L.message)}}return console.log("‚ö†Ô∏è Nenhum m√™s com dados encontrado nos √∫ltimos 6 meses"),null},us=()=>{if(!I||I.length===0)return;const a={bronze:{lojas:0,vendedores:0},prata:{lojas:0,vendedores:0},ouro:{lojas:0,vendedores:0},diamante:{lojas:0,vendedores:0}};U.lojaDetalhes&&U.lojaDetalhes.length>0&&U.lojaDetalhes.forEach(o=>{var d;if(o.semanas&&o.semanas.length>0){const h=o.semanas[o.semanas.length-1];if(h&&h.metaAtingida>0){const u=(d=h.nomeMetaAtingida)==null?void 0:d.toLowerCase();u&&(u.includes("bronze")?a.bronze.lojas++:u.includes("prata")?a.prata.lojas++:u.includes("ouro")?a.ouro.lojas++:u.includes("diamante")&&a.diamante.lojas++)}}}),U.vendedorDetalhes&&U.vendedorDetalhes.length>0&&U.vendedorDetalhes.forEach(o=>{var d;if(o.semanas&&o.semanas.length>0){const h=o.semanas[o.semanas.length-1];if(h&&h.metaAtingida>0){const u=(d=h.nomeMetaAtingida)==null?void 0:d.toLowerCase();u&&(u.includes("bronze")?a.bronze.vendedores++:u.includes("prata")?a.prata.vendedores++:u.includes("ouro")?a.ouro.vendedores++:u.includes("diamante")&&a.diamante.vendedores++)}}}),Jt(o=>({...o,bronze:a.bronze,prata:a.prata,ouro:a.ouro,diamante:a.diamante}))},xs=async(a,o)=>{var d,h,u,j;if(!(!a||!o))try{const f={dt_inicio:a,dt_fim:o,cd_grupoempresa_ini:1,cd_grupoempresa_fim:9999};console.log("üîç Buscando dados de lojas para:",{inicio:a,fim:o,params:f});const b=await s.company.faturamentoLojas(f);if(console.log("üîç Resultado da API:",{success:b.success,dataLength:((h=(d=b.data)==null?void 0:d.data)==null?void 0:h.length)||((u=b.data)==null?void 0:u.length)||0}),b.success){const y=((j=b.data)==null?void 0:j.data)||b.data||[];if(console.log("üîç Dados de lojas recebidos:",y.slice(0,2)),console.log("üîç Total de lojas encontradas:",y.length),console.log("üîç Exemplo de item completo:",y[0]),y.length===0){console.log("‚ö†Ô∏è Nenhuma loja encontrada para o per√≠odo selecionado. Buscando √∫ltimo m√™s com dados...");const k=await oa();if(k){console.log(`üìã Usando dados de refer√™ncia de ${k.mes}/${k.ano}`);const L=k.dadosLojas.reverse().map((K,oe)=>({...K,rank:oe+1,faturamento:0,ticket_medio:0,pa:0,pa_saida:0,pa_entrada:0,transacoes_saida:0,nome_fantasia:K.nome_fantasia,nm_loja:K.nm_loja||K.nome_fantasia,isDadosReferencia:!0,mesReferencia:k.mes,anoReferencia:k.ano}));A(L);const P=k.dadosLojas.reduce((K,oe)=>{const ne=oe.nome_fantasia;return ne&&!K.find(Y=>Y.nome_fantasia===ne)&&K.push({cd_loja:oe.cd_grupoempresa||oe.pessoa_empresa,nome_fantasia:ne,nm_loja:ne}),K},[]);be(P),console.log("üîç Lojas para filtro atualizadas:",{totalLojas:P.length,primeiraLoja:P[0]});return}else{console.log("‚ùå N√£o foi poss√≠vel encontrar dados de refer√™ncia"),A([]),Pe({type:"warning",title:"Sem Dados",message:"Nenhuma loja encontrada para o per√≠odo selecionado e n√£o h√° dados de refer√™ncia dispon√≠veis."});return}}const _=[...y].sort((k,L)=>parseFloat(L.faturamento||0)-parseFloat(k.faturamento||0)).map((k,L)=>({...k,rank:L+1,faturamento:parseFloat(k.faturamento||0),isDadosReferencia:!1}));A(_);const T=y.reduce((k,L)=>{const P=L.nome_fantasia;return P&&!k.find(K=>K.nome_fantasia===P)&&k.push({cd_loja:L.cd_grupoempresa||L.pessoa_empresa,nome_fantasia:P,nm_loja:P}),k},[]);be(T)}else throw new Error(b.message||"Erro ao buscar dados de lojas")}catch(f){console.error("Erro ao buscar dados de lojas:",f)}},hs=async(a,o)=>{var d,h,u,j,f,b,y,v,_,T;if(!(!a||!o))try{const k={inicio:a,fim:o};console.log("üîç Buscando dados de vendedores para:",{inicio:a,fim:o,params:k});const L=await s.sales.rankingVendedores(k);if(console.log("üîç Resultado da API vendedores:",{success:L.success,dataLength:((h=(d=L.data)==null?void 0:d.data)==null?void 0:h.length)||((u=L.data)==null?void 0:u.length)||0}),L.success){const P=((j=L.data)==null?void 0:j.data)||L.data||[];if(console.log("üîç Dados de vendedores recebidos:",P.slice(0,2)),console.log("üîç Total de vendedores encontrados:",P.length),P.length===0){console.log("‚ö†Ô∏è Nenhum vendedor encontrado para o per√≠odo selecionado. Buscando √∫ltimo m√™s com dados...");const Y=await oa();if(Y){console.log(`üìã Usando dados de refer√™ncia de vendedores de ${Y.mes}/${Y.ano}`);const ae={inicio:Y.primeiroDia,fim:Y.ultimoDia},q=await s.sales.rankingVendedores(ae);console.log("üîç Estrutura dos dados de vendedores:",{success:q.success,hasData:!!q.data,hasDataData:!!((f=q.data)!=null&&f.data),dataDataLength:(y=(b=q.data)==null?void 0:b.data)==null?void 0:y.length,dataLength:(v=q.data)==null?void 0:v.length,dataKeys:q.data?Object.keys(q.data):[]});const ie=((_=q.data)==null?void 0:_.data)||q.data||[],Q=Array.isArray(ie)&&ie.length>0;if(q.success&&Q){const z=ie.reverse().map((te,xe)=>({...te,rank:xe+1,faturamento:0,ticket_medio:0,pa:0,pa_saida:0,pa_entrada:0,transacoes_saida:0,nome_vendedor:te.nome_vendedor,isDadosReferencia:!0,mesReferencia:Y.mes,anoReferencia:Y.ano}));console.log("üîç Vendedores processados:",{totalVendedores:z.length,primeiroVendedor:z[0],isDadosReferencia:(T=z[0])==null?void 0:T.isDadosReferencia}),$(z);const me=ie.reduce((te,xe)=>{const Le=xe.nome_vendedor||xe.vendedor||xe.nm_vendedor||xe.nome;return Le&&!te.find(Ye=>Ye.nome_vendedor===Le)&&te.push({id:xe.cd_vendedor||xe.id,nome_vendedor:Le}),te},[]);J(me),console.log("üîç Vendedores para filtro atualizados:",{totalVendedores:me.length,primeiroVendedor:me[0]});return}}console.log("‚ùå N√£o foi poss√≠vel encontrar dados de vendedores de refer√™ncia"),$([]),J([]),Pe({type:"warning",title:"Sem Dados",message:"Nenhum vendedor encontrado para o per√≠odo selecionado e n√£o h√° dados de refer√™ncia dispon√≠veis."});return}const oe=[...P].sort((Y,ae)=>parseFloat(ae.faturamento||0)-parseFloat(Y.faturamento||0)).map((Y,ae)=>({...Y,rank:ae+1,faturamento:parseFloat(Y.faturamento||0),isDadosReferencia:!1}));$(oe);const ne=(P||[]).reduce((Y,ae)=>{const q=ae.nome_vendedor||ae.vendedor||ae.nm_vendedor||ae.nome;return q&&!Y.find(ie=>ie.nome_vendedor===q)&&Y.push({id:ae.cd_vendedor||ae.id,nome_vendedor:q}),Y},[]);J(ne)}else throw new Error(L.message||"Erro ao buscar dados de vendedores")}catch(k){console.error("Erro ao buscar dados de vendedores:",k)}},ia=a=>{a===Ke?Ht(tt==="asc"?"desc":"asc"):(Fa(a),Ht("asc"))},la=()=>{let a=R==="lojas"?S:C;if(R==="lojas"&&(a=a.filter(o=>{var h;const d=((h=o.nome_fantasia)==null?void 0:h.toUpperCase())||"";return le==="Franquias"?d.includes("F0"):le==="Proprias"?!(d.includes("-")||d.includes("- CROSBY")):!0})),R==="vendedores"&&(a=a.filter(o=>{var d,h;return le==="Franquias"?!((d=o.nome_vendedor)!=null&&d.includes("- INT")):le==="Proprias"?(h=o.nome_vendedor)==null?void 0:h.includes("- INT"):!0}).filter(o=>o.isDadosReferencia?!0:o.faturamento>0),W.length>0)){const o=W.map(d=>d.nome_vendedor||d.vendedor||d.nm_vendedor||d.nome);a=a.filter(d=>o.includes(d.nome_vendedor||d.vendedor||d.nm_vendedor||d.nome))}if(R==="lojas"&&se.length>0){const o=se.map(d=>d.nome_fantasia);console.log("üîç Lojas selecionadas:",o),console.log("üîç Dados antes do filtro:",a.length),a=a.filter(d=>{const h=d.nome_fantasia,u=o.includes(h);return console.log(`üîç Item: ${h} - Inclu√≠do: ${u}`),u}),console.log("üîç Dados ap√≥s filtro:",a.length)}return[...a].sort((o,d)=>{let h,u;return Ke==="faturamento"?(h=parseFloat(o.faturamento||0),u=parseFloat(d.faturamento||0)):Ke==="nome"&&(h=(R==="lojas"?o.nome_fantasia||o.nome_loja||o.loja||o.nm_loja||o.nome||"":o.nome_vendedor||o.vendedor||o.nm_vendedor||o.nome||"").toLowerCase(),u=(R==="lojas"?d.nome_fantasia||d.nome_loja||d.loja||d.nm_loja||d.nome||"":d.nome_vendedor||d.vendedor||d.nm_vendedor||d.nome||"").toLowerCase()),tt==="asc"?h>u?1:-1:h<u?1:-1})};return e.jsxs("div",{className:"w-full max-w-4xl mx-auto flex flex-col items-stretch justify-start py-3 px-2",children:[e.jsx(gs,{title:"Metas Varejo",subtitle:"Acompanhamento de metas e objetivos do canal varejo",icon:ca,iconColor:"text-orange-600"}),e.jsx("div",{className:"mb-4",children:e.jsxs("form",{onSubmit:a=>{a.preventDefault(),ms()},className:"bg-white p-3 rounded-lg shadow-md border border-[#000638]/10",children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("span",{className:"text-xs font-bold text-[#000638] flex items-center gap-1",children:[e.jsx(ys,{size:10,weight:"bold"})," Filtros"]}),e.jsx("span",{className:"text-xs text-gray-500 mt-1",children:"Selecione as empresas e per√≠odo para an√°lise das metas"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",style:{overflow:"visible"},children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx(ma,{lojasSelecionadas:se,onSelectLojas:a=>{console.log("üîç Lojas selecionadas alteradas:",a),je(a)},dadosLoja:ke})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(ua,{vendedoresSelecionados:W,onSelectVendedores:H,dadosVendedor:de})}),e.jsxs("div",{className:"mb-2 lg:col-span-1",children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-600",children:"Data Inicial"}),e.jsx("input",{type:"date",value:O.dt_inicio,onChange:a=>ft(o=>({...o,dt_inicio:a.target.value})),className:"border border-[#000638]/30 rounded-lg px-2 py-1.5 w-full focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] text-xs"})]}),e.jsxs("div",{className:"mb-2 lg:col-span-1",children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-600",children:"Data Final"}),e.jsx("input",{type:"date",value:O.dt_fim,onChange:a=>ft(o=>({...o,dt_fim:a.target.value})),className:"border border-[#000638]/30 rounded-lg px-2 py-1.5 w-full focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] text-xs"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-xs font-semibold mb-0.5 text-[#000638]",children:"Tipo de Loja"}),e.jsxs("select",{value:le,onChange:a=>et(a.target.value),className:"border border-[#000638]/30 rounded-lg px-2 py-1.5 w-full focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] text-xs",children:[e.jsx("option",{value:"Todos",children:"Todos"}),e.jsx("option",{value:"Proprias",children:"Pr√≥prias"}),e.jsx("option",{value:"Franquias",children:"Franquias"})]})]}),e.jsx("div",{className:"flex items-center",children:e.jsx("button",{type:"submit",disabled:ce||!O.dt_inicio||!O.dt_fim,className:"flex items-center gap-1 bg-[#000638] text-white px-3 py-1 rounded-lg hover:bg-[#fe0000] disabled:opacity-50 disabled:cursor-not-allowed font-medium transition-colors h-7 text-xs font-bold shadow-md tracking-wide uppercase w-full justify-center",children:ce?"Buscando...":"Buscar"})})]})]})}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>Gt("tabela"),className:`flex items-center gap-2 px-4 py-2 rounded-lg border transition-colors text-sm font-medium ${qe==="tabela"?"bg-[#000638] border-[#000638] text-white":"bg-white border-gray-300 text-gray-600 hover:bg-gray-50"}`,children:[e.jsx(ut,{size:16}),"Tabela"]}),e.jsxs("button",{type:"button",onClick:()=>Gt("dashboard"),className:`flex items-center gap-2 px-4 py-2 rounded-lg border transition-colors text-sm font-medium ${qe==="dashboard"?"bg-[#000638] border-[#000638] text-white":"bg-white border-gray-300 text-gray-600 hover:bg-gray-50"}`,children:[e.jsx(ca,{size:16}),"Dashboard"]})]})}),qe==="tabela"&&e.jsxs(e.Fragment,{children:[(S.length>0||C.length>0)&&e.jsxs("div",{className:"bg-white p-3 rounded-lg shadow-md border border-[#000638]/10",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-xs font-bold text-[#000638] flex items-center gap-1",children:[e.jsx(ut,{size:10,weight:"bold"})," Ranking de Faturamento"]}),e.jsxs("span",{className:"block text-xs text-gray-500 mt-1",children:["Ranking de"," ",R==="lojas"?"lojas":"vendedores"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex flex-col",children:e.jsxs("select",{value:G,onChange:a=>Xt(a.target.value),className:"border border-[#000638]/30 rounded-lg px-2 py-1.5 w-full focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] text-xs min-w-[100px]",children:[e.jsx("option",{value:"MENSAL",children:"Mensal"}),e.jsx("option",{value:"SEMANAL",children:"Semanal"})]})}),e.jsx("button",{type:"button",onClick:ns,className:"text-xs bg-[#000638] text-white px-3 py-1 rounded-lg hover:bg-[#fe0000] transition-colors",children:R==="lojas"?"+ Metas Lojas":"+ Metas Vendedores"}),e.jsx("button",{type:"button",onClick:ds,className:"text-xs bg-gray-400 text-white px-2 py-1 rounded-lg hover:bg-gray-500 transition-colors opacity-70",title:"Log de Altera√ß√µes",children:"Log"})]})]}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>De("lojas"),className:`flex items-center justify-center px-3 py-1 rounded-lg border transition-colors text-xs ${R==="lojas"?"bg-[#000638] border-[#000638] text-white":"bg-white border-gray-300 text-gray-600 hover:bg-gray-50"}`,children:[e.jsx(ut,{size:12,className:"mr-1"}),"Lojas"]}),e.jsxs("button",{onClick:()=>De("vendedores"),className:`flex items-center justify-center px-3 py-1 rounded-lg border transition-colors text-xs ${R==="vendedores"?"bg-[#000638] border-[#000638] text-white":"bg-white border-gray-300 text-gray-600 hover:bg-gray-50"}`,children:[e.jsx(ut,{size:12,className:"mr-1"}),"Vendedores"]})]})}),e.jsx("div",{className:"overflow-auto max-h-96",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-1 py-0.5 text-center text-[11px] whitespace-nowrap",children:"#"}),e.jsx("th",{className:"px-1 py-0.5 text-center text-[11px] cursor-pointer hover:bg-gray-100 transition-colors whitespace-nowrap",onClick:()=>ia("nome"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[R==="lojas"?"Loja":"Vendedor",Ke==="nome"&&e.jsx("span",{className:"text-xs",children:tt==="asc"?"‚Üë":"‚Üì"})]})}),e.jsx("th",{className:"px-1 py-0.5 text-center text-[11px] cursor-pointer hover:bg-gray-100 transition-colors whitespace-nowrap",onClick:()=>ia("faturamento"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Faturamento",Ke==="faturamento"&&e.jsx("span",{className:"text-xs",children:tt==="asc"?"‚Üë":"‚Üì"})]})}),e.jsx("th",{className:"px-1 py-0.5 text-center text-[11px] whitespace-nowrap",children:"Ticket M√©dio"}),e.jsx("th",{className:"px-1 py-0.5 text-center text-[11px] whitespace-nowrap",children:"PA"}),G==="MENSAL"?e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-1 py-0.5 text-center text-[11px] whitespace-nowrap",children:e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-800",children:"Bronze"})}),e.jsx("th",{className:"px-1 py-0.5 text-center text-[11px] whitespace-nowrap",children:e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:"Prata"})}),e.jsx("th",{className:"px-1 py-0.5 text-center text-[11px] whitespace-nowrap",children:e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:"Ouro"})}),e.jsx("th",{className:"px-1 py-0.5 text-center text-[11px] whitespace-nowrap",children:e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Diamante"})})]}):e.jsxs(e.Fragment,{children:[I&&I.length>0?I.map(a=>e.jsx("th",{className:"px-1 py-0.5 text-center text-[11px] whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"inline-flex items-center px-1 py-0.5 rounded text-xs font-medium bg-amber-100 text-amber-800",children:"Bronze"}),e.jsxs("span",{className:"text-[7px] text-gray-600 mt-0.5",children:["S",a.numero,a.numeroAno&&e.jsxs("span",{className:"text-[9px] text-blue-600 ml-1",children:["(",a.numeroAno,")"]}),e.jsxs("span",{className:"text-[9px] text-gray-400 ml-1",children:[pe(a.inicio)," -"," ",pe(a.fim)]})]})]})},`bronze-${a.numero}`)):e.jsx("th",{className:"px-1 py-0.5 text-center text-[11px] whitespace-nowrap",children:e.jsx("span",{className:"text-red-500 text-xs",children:"Sem semanas"})}),I&&I.length>0?I.map(a=>e.jsx("th",{className:"px-1 py-0.5 text-center text-[11px] whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"inline-flex items-center px-1 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800",children:"Prata"}),e.jsxs("span",{className:"text-[7px] text-gray-600 mt-0.5",children:["S",a.numero,a.numeroAno&&e.jsxs("span",{className:"text-[9px] text-blue-600 ml-1",children:["(",a.numeroAno,")"]}),e.jsxs("span",{className:"text-[9px] text-gray-400 ml-1",children:[pe(a.inicio)," -"," ",pe(a.fim)]})]})]})},`prata-${a.numero}`)):e.jsx("th",{className:"px-1 py-0.5 text-center text-[11px] whitespace-nowrap",children:e.jsx("span",{className:"text-red-500 text-xs",children:"Sem semanas"})}),I&&I.length>0?I.map(a=>e.jsx("th",{className:"px-1 py-0.5 text-center text-[11px] whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"inline-flex items-center px-1 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800",children:"Ouro"}),e.jsxs("span",{className:"text-[7px] text-gray-600 mt-0.5",children:["S",a.numero,a.numeroAno&&e.jsxs("span",{className:"text-[9px] text-blue-600 ml-1",children:["(",a.numeroAno,")"]}),e.jsxs("span",{className:"text-[9px] text-gray-400 ml-1",children:[pe(a.inicio)," -"," ",pe(a.fim)]})]})]})},`ouro-${a.numero}`)):e.jsx("th",{className:"px-1 py-0.5 text-center text-[11px] whitespace-nowrap",children:e.jsx("span",{className:"text-red-500 text-xs",children:"Sem semanas"})}),I&&I.length>0?I.map(a=>e.jsx("th",{className:"px-1 py-0.5 text-center text-[11px] whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"inline-flex items-center px-1 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:"Diamante"}),e.jsxs("span",{className:"text-[7px] text-gray-600 mt-0.5",children:["S",a.numero,a.numeroAno&&e.jsxs("span",{className:"text-[9px] text-blue-600 ml-1",children:["(",a.numeroAno,")"]}),e.jsxs("span",{className:"text-[9px] text-gray-400 ml-1",children:[pe(a.inicio)," -"," ",pe(a.fim)]})]})]})},`diamante-${a.numero}`)):e.jsx("th",{className:"px-1 py-0.5 text-center text-[11px] whitespace-nowrap",children:e.jsx("span",{className:"text-red-500 text-xs",children:"Sem semanas"})})]})]})}),e.jsxs("tbody",{children:[Ie?e.jsx("tr",{children:e.jsx("td",{colSpan:G==="MENSAL"?9:5+I.length*4,className:"px-1 py-2 text-center text-[11px] text-gray-500",children:"Carregando dados..."})}):la().map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-1 py-1 text-center text-[11px] font-medium whitespace-nowrap",children:a.rank}),e.jsx("td",{className:"px-1 py-1 text-center text-[11px] whitespace-nowrap",children:R==="lojas"?a.nome_fantasia||a.nome_loja||a.loja||a.nm_loja||a.nome||"N/A":a.nome_vendedor||a.vendedor||a.nm_vendedor||a.nome||"N/A"}),e.jsxs("td",{className:"px-1 py-1 text-center text-[11px] font-semibold text-green-600 whitespace-nowrap",children:["R$ ",a.faturamento.toLocaleString("pt-BR")]}),e.jsx("td",{className:"px-1 py-1 text-center text-[11px] whitespace-nowrap",children:(()=>{const o=Number(a.transacoes_saida);return o>0?`R$ ${(a.faturamento/o).toLocaleString("pt-BR",{minimumFractionDigits:2})}`:"-"})()}),e.jsx("td",{className:"px-1 py-1 text-center text-[11px] whitespace-nowrap",children:(()=>{if(a.isDadosReferencia)return"0,00";const o=Number(a.transacoes_saida)||0;if(o===0)return"-";const d=Number(a.pa_saida)||0,h=Number(a.pa_entrada)||0;return((d-h)/o).toFixed(2)})()}),G==="MENSAL"?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-1 py-1 text-center text-[11px] whitespace-nowrap",children:dt(`${R}-${a.nome_fantasia||a.nome_vendedor||a.nome}-bronze`,"text-amber-700")}),e.jsx("td",{className:"px-1 py-1 text-center text-[11px] whitespace-nowrap",children:dt(`${R}-${a.nome_fantasia||a.nome_vendedor||a.nome}-prata`,"text-gray-700")}),e.jsx("td",{className:"px-1 py-1 text-center text-[11px] whitespace-nowrap",children:dt(`${R}-${a.nome_fantasia||a.nome_vendedor||a.nome}-ouro`,"text-yellow-700")}),e.jsx("td",{className:"px-1 py-1 text-center text-[11px] whitespace-nowrap",children:dt(`${R}-${a.nome_fantasia||a.nome_vendedor||a.nome}-diamante`,"text-blue-700")})]}):e.jsxs(e.Fragment,{children:[I&&I.length>0?I.map(o=>e.jsx("td",{className:"px-1 py-1 text-center text-[11px] whitespace-nowrap",children:lt(R,a.nome_fantasia||a.nome_vendedor||a.nome,"bronze",o.numero,"text-amber-700")},`bronze-${o.numero}`)):e.jsx("td",{className:"px-1 py-1 text-center text-[11px] whitespace-nowrap",children:e.jsx("span",{className:"text-red-500 text-xs",children:"-"})}),I&&I.length>0?I.map(o=>e.jsx("td",{className:"px-1 py-1 text-center text-[11px] whitespace-nowrap",children:lt(R,a.nome_fantasia||a.nome_vendedor||a.nome,"prata",o.numero,"text-gray-700")},`prata-${o.numero}`)):e.jsx("td",{className:"px-1 py-1 text-center text-[11px] whitespace-nowrap",children:e.jsx("span",{className:"text-red-500 text-xs",children:"-"})}),I&&I.length>0?I.map(o=>e.jsx("td",{className:"px-1 py-1 text-center text-[11px] whitespace-nowrap",children:lt(R,a.nome_fantasia||a.nome_vendedor||a.nome,"ouro",o.numero,"text-yellow-700")},`ouro-${o.numero}`)):e.jsx("td",{className:"px-1 py-1 text-center text-[11px] whitespace-nowrap",children:e.jsx("span",{className:"text-red-500 text-xs",children:"-"})}),I&&I.length>0?I.map(o=>e.jsx("td",{className:"px-1 py-1 text-center text-[11px] whitespace-nowrap",children:lt(R,a.nome_fantasia||a.nome_vendedor||a.nome,"diamante",o.numero,"text-blue-700")},`diamante-${o.numero}`)):e.jsx("td",{className:"px-1 py-1 text-center text-[11px] whitespace-nowrap",children:e.jsx("span",{className:"text-red-500 text-xs",children:"-"})})]})]},a.rank)),la().length===0&&!Ie&&e.jsx("tr",{children:e.jsxs("td",{colSpan:G==="MENSAL"?9:5+I.length*4,className:"px-1 py-2 text-center text-[11px] text-gray-500",children:["Nenhum ",R==="lojas"?"loja":"vendedor"," ","encontrado"]})})]})]})})]}),gt&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30",onClick:Me}),e.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg border border-gray-200 w-full max-w-md p-4",children:[e.jsxs("h3",{className:"text-sm font-bold text-[#000638] mb-3",children:["Adicionar Metas"," ",R==="lojas"?"Lojas":"Vendedores"," (em lote)"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs font-semibold mb-2 text-[#000638]",children:"Tipo de Meta"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>qt("MENSAL"),className:`flex items-center justify-center px-3 py-2 rounded-lg border transition-colors text-xs ${Ce==="MENSAL"?"bg-[#000638] border-[#000638] text-white":"bg-white border-gray-300 text-gray-600 hover:bg-gray-50"}`,children:["üìÖ Mensal",e.jsx("span",{className:"ml-1 text-[10px] opacity-75",children:"(divide automaticamente)"})]}),e.jsxs("button",{type:"button",onClick:()=>qt("SEMANAL"),className:`flex items-center justify-center px-3 py-2 rounded-lg border transition-colors text-xs ${Ce==="SEMANAL"?"bg-[#000638] border-[#000638] text-white":"bg-white border-gray-300 text-gray-600 hover:bg-gray-50"}`,children:["üìä Semanal",e.jsx("span",{className:"ml-1 text-[10px] opacity-75",children:"(aplica em todas)"})]})]})]}),R==="lojas"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs font-semibold mb-2 text-[#000638]",children:"Tipo de Loja"}),e.jsxs("select",{value:Je,onChange:a=>Ut(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-xs bg-white focus:outline-none focus:ring-2 focus:ring-[#000638]",children:[e.jsx("option",{value:"Todos",children:"üè™ Todas as Lojas"}),e.jsx("option",{value:"Proprias",children:"üè¢ Lojas Pr√≥prias"}),e.jsx("option",{value:"Franquias",children:"üè¨ Franquias"})]})]}),e.jsxs("div",{className:"space-y-3",children:[R==="lojas"?e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-semibold mb-1 text-[#000638]",children:["Selecionar Lojas",Je!=="Todos"&&e.jsxs("span",{className:"text-gray-500 font-normal ml-1",children:["(",Je==="Proprias"?"Pr√≥prias":"Franquias",")"]})]}),e.jsx(ma,{lojasSelecionadas:fe,onSelectLojas:yt,dadosLoja:ke,tipoLoja:Je})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1 text-[#000638]",children:"Selecionar Vendedores"}),e.jsx(ua,{vendedoresSelecionados:ge,onSelectVendedores:Bt,dadosVendedor:de})]}),Ce==="MENSAL"?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-semibold text-amber-700 mb-1",children:"Bronze"}),e.jsx("input",{type:"text",inputMode:"numeric",className:"w-full px-2 py-1 border border-blue-200 rounded text-[12px] bg-blue-50 focus:outline-none focus:ring-1 focus:ring-blue-400",placeholder:"0,00",value:he.bronze,onChange:a=>Be({...he,bronze:Re(a.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-semibold text-gray-700 mb-1",children:"Prata"}),e.jsx("input",{type:"text",inputMode:"numeric",className:"w-full px-2 py-1 border border-blue-200 rounded text-[12px] bg-blue-50 focus:outline-none focus:ring-1 focus:ring-blue-400",placeholder:"0,00",value:he.prata,onChange:a=>Be({...he,prata:Re(a.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-semibold text-yellow-700 mb-1",children:"Ouro"}),e.jsx("input",{type:"text",inputMode:"numeric",className:"w-full px-2 py-1 border border-blue-200 rounded text-[12px] bg-blue-50 focus:outline-none focus:ring-1 focus:ring-blue-400",placeholder:"0,00",value:he.ouro,onChange:a=>Be({...he,ouro:Re(a.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-semibold text-blue-700 mb-1",children:"Diamante"}),e.jsx("input",{type:"text",inputMode:"numeric",className:"w-full px-2 py-1 border border-blue-200 rounded text-[12px] bg-blue-50 focus:outline-none focus:ring-1 focus:ring-blue-400",placeholder:"0,00",value:he.diamante,onChange:a=>Be({...he,diamante:Re(a.target.value)})})]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs border border-gray-200 rounded-lg",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"px-2 py-1 text-left font-semibold text-gray-700 border-b",children:"N√≠vel"}),I&&I.length>0?I.map(a=>e.jsxs("th",{className:"px-1 py-1 text-center font-semibold text-gray-700 border-b border-l",children:["S",a.numero,a.numeroAno&&e.jsxs("span",{className:"text-[9px] text-blue-600 ml-1",children:["(",a.numeroAno,")"]}),e.jsxs("span",{className:"block text-[9px] text-gray-400 mt-0.5",children:[pe(a.inicio)," -"," ",pe(a.fim)]})]},a.numero)):e.jsx("th",{className:"px-1 py-1 text-center font-semibold text-gray-700 border-b border-l",children:"Semanas"})]})}),e.jsx("tbody",{children:[{nivel:"bronze",label:"Bronze",color:"amber"},{nivel:"prata",label:"Prata",color:"gray"},{nivel:"ouro",label:"Ouro",color:"yellow"},{nivel:"diamante",label:"Diamante",color:"blue"}].map(({nivel:a,label:o,color:d})=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-1 border-b border-r",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded text-[10px] font-medium bg-${d}-100 text-${d}-800`,children:o})}),I&&I.length>0?I.map(h=>e.jsx("td",{className:"px-1 py-1 border-b border-l",children:e.jsx("input",{type:"text",inputMode:"numeric",className:`w-full px-1 py-0.5 border border-${d}-200 rounded text-[10px] bg-${d}-50 focus:outline-none focus:ring-1 focus:ring-${d}-400 text-center`,placeholder:"0,00",value:he[`${a}_semana_${h.numero}`]||"",onChange:u=>Be({...he,[`${a}_semana_${h.numero}`]:Re(u.target.value)})})},`${a}-${h.numero}`)):e.jsx("td",{className:"px-1 py-1 border-b border-l text-center text-gray-500",children:"Carregando..."})]},a))})]})}),e.jsx("div",{className:"mt-3 p-2 bg-gray-50 rounded-lg",children:e.jsx("p",{className:"text-xs text-gray-600",children:Ce==="MENSAL"?e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"üìÖ Meta Mensal:"})," O valor ser√° dividido automaticamente pelas ",I.length," ","semanas do m√™s. Exemplo: R$ 10.000 √∑"," ",I.length," semanas = R$"," ",Math.round(1e4/I.length).toLocaleString("pt-BR")," ","por semana."]}):e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"üìä Meta Semanal:"})," Configure valores espec√≠ficos para cada semana de cada n√≠vel. Exemplo: Bronze S1=2000, S2=3000, S3=4000, etc."]})})}),e.jsx("div",{className:"flex items-center justify-end gap-2 mt-2",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("button",{type:"button",onClick:is,className:"text-xs bg-red-500 text-white px-3 py-1 rounded-lg hover:bg-red-600 transition-colors",title:"Excluir todas as metas do per√≠odo selecionado",children:"üóëÔ∏è Excluir Metas"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:Me,className:"text-xs bg-gray-500 text-white px-3 py-1 rounded-lg",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:rs,className:"text-xs bg-[#000638] text-white px-3 py-1 rounded-lg",children:"Aplicar"})]})]})})]})]})]}),Ia&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30",onClick:sa}),e.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg border border-gray-200 w-full max-w-sm p-4",children:[e.jsx("h3",{className:"text-sm font-bold text-[#000638] mb-3 text-center",children:"Confirma√ß√£o"}),e.jsx("p",{className:"text-xs text-gray-600 text-center mb-4",children:"Deseja realmente adicionar as metas?"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{type:"button",onClick:sa,className:"text-xs bg-gray-500 text-white px-4 py-1 rounded-lg hover:bg-gray-600 transition-colors",children:"N√£o"}),e.jsx("button",{type:"button",onClick:os,className:"text-xs bg-[#000638] text-white px-4 py-1 rounded-lg hover:bg-[#fe0000] transition-colors",children:"Sim"})]})]})]}),Wa&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30",onClick:na}),e.jsx("div",{className:"relative bg-white rounded-lg shadow-lg border border-red-200 w-full max-w-md p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"‚ö†Ô∏è"}),e.jsx("h3",{className:"text-lg font-bold text-red-600 mb-3",children:"ATEN√á√ÉO: Excluir Metas"}),e.jsxs("p",{className:"text-sm text-gray-700 mb-4",children:["Voc√™ est√° prestes a ",e.jsx("strong",{children:"EXCLUIR TODAS AS METAS"})," ","do per√≠odo selecionado."]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-4",children:[e.jsxs("p",{className:"text-sm text-red-800 font-semibold",children:["‚ö†Ô∏è Esta a√ß√£o ",e.jsx("strong",{children:"N√ÉO PODE SER DESFEITA"}),"!"]}),e.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Todas as metas ser√£o exclu√≠das permanentemente."})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 mb-4",children:e.jsxs("p",{className:"text-xs text-gray-600",children:[e.jsx("strong",{children:"Per√≠odo:"})," ",O.dt_inicio," a"," ",O.dt_fim,e.jsx("br",{}),e.jsx("strong",{children:"Tipo:"})," ",Ce,e.jsx("br",{}),e.jsx("strong",{children:"Entidades:"})," ",R==="lojas"?fe.length:ge.length," ",R==="lojas"?"lojas":"vendedores"," ","selecionadas"]})}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{type:"button",onClick:na,className:"text-sm bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:ls,disabled:Yt||bt>0,className:"text-sm bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:Yt?"Excluindo...":bt>0?`Confirmar (${bt}s)`:"SIM, EXCLUIR METAS"})]})]})})]}),Ha&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30",onClick:ra}),e.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg border border-gray-200 w-full max-w-4xl p-4 max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-bold text-[#000638]",children:"Log de Altera√ß√µes de Metas"}),e.jsx("button",{type:"button",onClick:ra,className:"text-gray-500 hover:text-gray-700 text-lg font-bold",children:"√ó"})]}),e.jsx("div",{className:"overflow-auto max-h-[60vh]",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 text-left font-semibold text-gray-700",children:"Tipo"}),e.jsx("th",{className:"px-2 py-2 text-left font-semibold text-gray-700",children:"Nome"}),e.jsx("th",{className:"px-2 py-2 text-left font-semibold text-gray-700",children:"Campo"}),e.jsx("th",{className:"px-2 py-2 text-left font-semibold text-gray-700",children:"Valor"}),e.jsx("th",{className:"px-2 py-2 text-left font-semibold text-gray-700",children:"M√™s"}),e.jsx("th",{className:"px-2 py-2 text-left font-semibold text-gray-700",children:"Semana"}),e.jsx("th",{className:"px-2 py-2 text-left font-semibold text-gray-700",children:"Usu√°rio"}),e.jsx("th",{className:"px-2 py-2 text-left font-semibold text-gray-700",children:"Data/Hora"})]})}),e.jsx("tbody",{children:(()=>{const a=[];return jt.forEach(o=>{a.push({...o,tipo_log:"mensal",semana:"-"})}),wt.forEach(o=>{a.push({...o,tipo_log:"semanal",mes:o.mes_referencia,nome:o.nome,campo:o.campo,valor:`R$ ${o.valor.toLocaleString("pt-BR",{minimumFractionDigits:2})}`,usuario:o.usuario,data_alteracao:o.data_alteracao,semana:`S${o.numero_semana}`})}),a.sort((o,d)=>new Date(d.data_alteracao)-new Date(o.data_alteracao)),a.length>0?a.map((o,d)=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-2 py-2",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:`px-2 py-1 rounded text-[10px] font-medium ${o.tipo==="lojas"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:o.tipo==="lojas"?"Loja":"Vendedor"}),e.jsx("span",{className:`px-1 py-0.5 rounded text-[11px] font-medium ${o.tipo_log==="mensal"?"bg-purple-100 text-purple-700":"bg-orange-100 text-orange-700"}`,children:o.tipo_log==="mensal"?"Mensal":"Semanal"})]})}),e.jsx("td",{className:"px-2 py-2 font-medium text-gray-900",children:o.nome}),e.jsx("td",{className:"px-2 py-2",children:e.jsx("span",{className:`px-2 py-1 rounded text-[10px] font-medium ${o.campo==="bronze"?"bg-amber-100 text-amber-700":o.campo==="prata"?"bg-gray-100 text-gray-700":o.campo==="ouro"?"bg-yellow-100 text-yellow-700":"bg-blue-100 text-blue-700"}`,children:o.campo.charAt(0).toUpperCase()+o.campo.slice(1)})}),e.jsx("td",{className:"px-2 py-2 font-medium text-green-600",children:o.valor}),e.jsx("td",{className:"px-2 py-2 text-gray-700",children:o.mes}),e.jsx("td",{className:"px-2 py-2 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-[10px] font-medium ${o.semana==="-"?"bg-gray-100 text-gray-600":"bg-cyan-100 text-cyan-700"}`,children:o.semana})}),e.jsx("td",{className:"px-2 py-2 text-gray-700",children:o.usuario}),e.jsx("td",{className:"px-2 py-2 text-gray-500",children:new Date(o.data_alteracao).toLocaleString("pt-BR")})]},`${o.tipo_log}-${d}`)):e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-2 py-4 text-center text-gray-500",children:"Nenhuma altera√ß√£o registrada ainda"})})})()})]})}),e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-200",children:e.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["Total de"," ",jt.length+wt.length," ","altera√ß√µes registradas (",jt.length," mensais +"," ",wt.length," semanais)"]})})]})]})]}),qe==="dashboard"&&e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md border border-[#000638]/10",children:[e.jsxs("div",{className:"mb-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-[#000638] mb-2",children:["Dashboard de Metas"," ",G==="SEMANAL"?"- Semanal":""]}),e.jsx("p",{className:"text-sm text-gray-600",children:G==="SEMANAL"?`Acompanhamento detalhado de metas por semana para cada ${R==="lojas"?"loja":"vendedor"}`:"Acompanhamento de metas atingidas por lojas e vendedores"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex flex-col",children:e.jsxs("select",{value:G,onChange:a=>Xt(a.target.value),className:"border border-[#000638]/30 rounded-lg px-2 py-1.5 w-full focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] text-xs min-w-[100px]",children:[e.jsx("option",{value:"MENSAL",children:"Mensal"}),e.jsx("option",{value:"SEMANAL",children:"Semanal"})]})}),e.jsx("button",{type:"button",onClick:()=>{G==="SEMANAL"?us():Pt()},className:"text-xs bg-[#000638] text-white px-3 py-1 rounded-lg hover:bg-[#fe0000] transition-colors",children:"Recalcular Estat√≠sticas"}),e.jsx("button",{type:"button",onClick:cs,className:"text-xs bg-green-600 text-white px-3 py-1 rounded-lg hover:bg-green-700 transition-colors",children:"Baixar Relat√≥rio"})]})]}),G==="SEMANAL"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow border border-amber-200 cursor-pointer hover:shadow-lg hover:border-amber-400 transition-all",onClick:()=>ct("bronze","lojas"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-amber-700",children:"Meta Bronze Semanal"}),e.jsx("p",{className:"text-xs text-amber-600",children:"Clique para detalhes"})]}),e.jsx("div",{className:"text-2xl",children:"ü•â"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-700",children:[e.jsx("span",{children:"Lojas:"}),e.jsx("span",{className:"font-bold text-amber-700",children:U.bronze.lojas})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-700",children:[e.jsx("span",{children:"Vendedores:"}),e.jsx("span",{className:"font-bold text-amber-700",children:U.bronze.vendedores})]})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow border border-gray-200 cursor-pointer hover:shadow-lg hover:border-gray-400 transition-all",onClick:()=>ct("prata","lojas"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-gray-700",children:"Meta Prata Semanal"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Clique para detalhes"})]}),e.jsx("div",{className:"text-2xl",children:"ü•à"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-700",children:[e.jsx("span",{children:"Lojas:"}),e.jsx("span",{className:"font-bold text-gray-700",children:U.prata.lojas})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-700",children:[e.jsx("span",{children:"Vendedores:"}),e.jsx("span",{className:"font-bold text-gray-700",children:U.prata.vendedores})]})]})]}),e.jsxs("div",{onClick:()=>ct("ouro","lojas"),className:"bg-white p-4 rounded-lg shadow border border-yellow-200 cursor-pointer hover:shadow-lg hover:border-yellow-400 transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-yellow-700",children:"Meta Ouro"}),e.jsx("p",{className:"text-xs text-yellow-600",children:"Clique para detalhes"})]}),e.jsx("div",{className:"text-2xl",children:"ü•á"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-700",children:[e.jsx("span",{children:"Lojas:"}),e.jsx("span",{className:"font-bold text-yellow-700",children:U.ouro.lojas})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-700",children:[e.jsx("span",{children:"Vendedores:"}),e.jsx("span",{className:"font-bold text-yellow-700",children:U.ouro.vendedores})]})]})]}),e.jsxs("div",{onClick:()=>ct("diamante","lojas"),className:"bg-white p-4 rounded-lg shadow border border-blue-200 cursor-pointer hover:shadow-lg hover:border-blue-400 transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-blue-700",children:"Meta Diamante"}),e.jsx("p",{className:"text-xs text-blue-600",children:"Clique para detalhes"})]}),e.jsx("div",{className:"text-2xl",children:"üíé"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-700",children:[e.jsx("span",{children:"Lojas:"}),e.jsx("span",{className:"font-bold text-blue-700",children:U.diamante.lojas})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-700",children:[e.jsx("span",{children:"Vendedores:"}),e.jsx("span",{className:"font-bold text-blue-700",children:U.diamante.vendedores})]})]})]})]}),Va&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-3xl w-full max-h-96 overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-gray-50 to-gray-100 px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:[Ne.nivel==="bronze"&&"ü•â Detalhes Meta Bronze",Ne.nivel==="prata"&&"ü•à Detalhes Meta Prata",Ne.nivel==="ouro"&&"ü•á Detalhes Meta Ouro",Ne.nivel==="diamante"&&"üíé Detalhes Meta Diamante"]}),e.jsx("button",{onClick:()=>Nt(!1),className:"text-gray-500 hover:text-gray-700 text-2xl leading-none",children:"√ó"})]}),e.jsx("div",{className:"p-6",children:Ne.entidades&&Ne.entidades.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 border-b border-gray-200",children:[e.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-700",children:Ne.tipo==="lojas"?"Loja":"Vendedor"}),e.jsx("th",{className:"px-4 py-2 text-right font-semibold text-gray-700",children:"Meta"}),e.jsx("th",{className:"px-4 py-2 text-right font-semibold text-gray-700",children:"Faturamento"}),e.jsx("th",{className:"px-4 py-2 text-right font-semibold text-gray-700",children:"% Atingido"}),Ne.tipo==="lojas"&&e.jsx("th",{className:"px-4 py-2 text-center font-semibold text-gray-700",children:"Semana"})]})}),e.jsx("tbody",{children:Ne.entidades.map((a,o)=>{const d=a.faturamento&&a.meta?Math.round(a.faturamento/a.meta*100):0;return e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-gray-800",children:a.nome}),e.jsx("td",{className:"px-4 py-3 text-right text-gray-700",children:B(a.meta)}),e.jsx("td",{className:"px-4 py-3 text-right font-semibold text-gray-800",children:B(a.faturamento)}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("span",{className:`font-bold ${d>=100?"text-green-600":d>=80?"text-blue-600":"text-orange-600"}`,children:[d,"%"]})}),Ne.tipo==="lojas"&&e.jsx("td",{className:"px-4 py-3 text-center text-gray-600",children:a.semana||"‚Äî"})]},o)})})]})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:["Nenhum"," ",Ne.tipo==="lojas"?"loja":"vendedor"," ","encontrado neste n√≠vel de meta."]})}),e.jsx("div",{className:"px-6 py-3 bg-gray-50 border-t border-gray-200 text-right",children:e.jsx("button",{onClick:()=>Nt(!1),className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors",children:"Fechar"})})]})}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>nt("lojas"),className:`flex items-center gap-2 px-4 py-2 rounded-lg border transition-colors text-sm font-medium ${Te==="lojas"?"bg-[#000638] border-[#000638] text-white":"bg-white border-gray-300 text-gray-600 hover:bg-gray-50"}`,children:"Lojas"}),e.jsx("button",{type:"button",onClick:()=>nt("vendedores"),className:`flex items-center gap-2 px-4 py-2 rounded-lg border transition-colors text-sm font-medium ${Te==="vendedores"?"bg-[#000638] border-[#000638] text-white":"bg-white border-gray-300 text-gray-600 hover:bg-gray-50"}`,children:"Vendedores"})]})}),e.jsx("div",{className:"space-y-6",children:Te==="lojas"?U.lojaDetalhes&&U.lojaDetalhes.length>0?(()=>{const a=U.lojaDetalhes.filter(j=>se.length>0?se.some(f=>(f.nome_fantasia||f.nome_loja||f.loja||f.nm_loja||f.nome||"").includes(j.nome)):!0).filter(j=>{const f=j.nome;if(le==="Franquias"){const b=f.includes("F0");return console.log("√â franquia?",b),b}if(le==="Proprias"){const b=f.includes("-")||f.includes("- CROSBY");return console.log("√â pr√≥pria?",!b),!b}return!0}).sort((j,f)=>f.faturamento-j.faturamento),o=Math.max(1,Math.ceil(a.length/Ve)),d=rt*Ve,u=a.slice(d,d+Ve).map((j,f)=>{const b=Ft(j,"lojas");return e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-[#000638]",children:j.nome}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Faturamento Total:"," ",B(j.faturamento)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:B(j.faturamento)}),e.jsx("div",{className:"text-xs text-gray-500",children:"Faturamento Mensal"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Semana"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Faturamento Semanal"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Meta Atual"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pr√≥xima Meta"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Progresso"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Falta"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.map((y,v)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-sm font-medium bg-cyan-100 text-cyan-800",children:["S",y.numero,y.numeroAno&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-[10px] text-blue-600 ml-1",children:["(",y.numeroAno,")"]}),e.jsxs("span",{className:"text-[10px] text-gray-500 ml-1",children:[pe(y.inicio)," -"," ",pe(y.fim)]})]})]})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-sm font-semibold text-green-600",children:B(y.faturamento)})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:y.metaAtingida>0?e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800",children:y.nomeMetaAtingida}):e.jsx("span",{className:"text-sm text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:y.proximaMeta>0?e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-800",children:y.nomeProximaMeta}),e.jsx("div",{className:"text-sm text-gray-600",children:B(y.proximaMeta)})]}):e.jsx("span",{className:"text-sm text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:y.proximaMeta>0?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2 w-20",children:e.jsx("div",{className:"bg-yellow-500 h-2 rounded-full transition-all duration-300",style:{width:`${y.progresso}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-gray-800",children:[y.progresso,"%"]})]}):e.jsx("span",{className:"text-sm text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col",children:[y.faltante>0?e.jsx("span",{className:"text-sm font-semibold text-gray-800",children:B(y.faltante)}):y.metaAtingida>0?e.jsx("span",{className:"text-sm font-medium text-green-600",children:"‚úì Atingida"}):e.jsx("span",{className:"text-sm text-gray-400",children:"-"}),e.jsxs("span",{className:"text-[10px] text-blue-600 mt-1",children:[_t(y.fim)," ","dias restantes"]}),y.faltante>0&&e.jsxs("span",{className:"text-[11px] text-gray-600",children:["‚âà"," ",B(ta(y.faltante,y.fim))," ","por dia"]})]})})]},v))})]})})]},f)});return e.jsxs(e.Fragment,{children:[u,e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsx("button",{type:"button",className:"px-2 py-1 text-xs rounded border border-gray-300 disabled:opacity-50",onClick:()=>Mt(j=>Math.max(0,j-1)),disabled:rt===0,children:"Anterior"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:o},(j,f)=>e.jsx("button",{type:"button",onClick:()=>Mt(f),className:`px-2 py-1 text-xs rounded border ${f===rt?"bg-[#000638] text-white border-[#000638]":"border-gray-300"}`,children:f+1},f))}),e.jsx("button",{type:"button",className:"px-2 py-1 text-xs rounded border border-gray-300 disabled:opacity-50",onClick:()=>Mt(j=>Math.min(o-1,j+1)),disabled:rt>=o-1,children:"Pr√≥xima"})]})]})})():e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"Nenhuma loja encontrada com dados dispon√≠veis."})}):U.vendedorDetalhes&&U.vendedorDetalhes.length>0?(()=>{const a=U.vendedorDetalhes.filter(j=>W.length>0?W.some(f=>(f.nome_vendedor||f.vendedor||f.nm_vendedor||f.nome||"").includes(j.nome)):!0).filter(j=>{const f=j.nome;return le==="Franquias"?!f.includes("- INT"):le==="Proprias"?f.includes("- INT"):!0}).sort((j,f)=>f.faturamento-j.faturamento),o=Math.max(1,Math.ceil(a.length/Ve)),d=ot*Ve,u=a.slice(d,d+Ve).map((j,f)=>{const b=Ft(j,"vendedores");return e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-[#000638]",children:j.nome}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Faturamento Total:"," ",B(j.faturamento)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:B(j.faturamento)}),e.jsx("div",{className:"text-xs text-gray-500",children:"Faturamento Mensal"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Semana"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Faturamento Semanal"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Meta Atual"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pr√≥xima Meta"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Progresso"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Falta"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.map((y,v)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-sm font-medium bg-cyan-100 text-cyan-800",children:["S",y.numero,y.numeroAno&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-[10px] text-blue-600 ml-1",children:["(",y.numeroAno,")"]}),e.jsxs("span",{className:"text-[10px] text-gray-500 ml-1",children:[pe(y.inicio)," -"," ",pe(y.fim)]})]})]})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-sm font-semibold text-green-600",children:B(y.faturamento)})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:y.metaAtingida>0?e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800",children:y.nomeMetaAtingida}):e.jsx("span",{className:"text-sm text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:y.proximaMeta>0?e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-800",children:y.nomeProximaMeta}),e.jsx("div",{className:"text-sm text-gray-600",children:B(y.proximaMeta)})]}):e.jsx("span",{className:"text-sm text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:y.proximaMeta>0?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2 w-20",children:e.jsx("div",{className:"bg-yellow-500 h-2 rounded-full transition-all duration-300",style:{width:`${y.progresso}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-gray-800",children:[y.progresso,"%"]})]}):e.jsx("span",{className:"text-sm text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col",children:[y.faltante>0?e.jsx("span",{className:"text-sm font-semibold text-gray-800",children:B(y.faltante)}):y.metaAtingida>0?e.jsx("span",{className:"text-sm font-medium text-green-600",children:"‚úì Atingida"}):e.jsx("span",{className:"text-sm text-gray-400",children:"-"}),e.jsxs("span",{className:"text-[10px] text-blue-600 mt-1",children:[_t(y.fim)," ","dias restantes"]}),y.faltante>0&&e.jsxs("span",{className:"text-[10px] text-gray-600",children:["‚âà"," ",B(ta(y.faltante,y.fim))," ","por dia"]})]})})]},v))})]})})]},f)});return e.jsxs(e.Fragment,{children:[u,e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsx("button",{type:"button",className:"px-2 py-1 text-xs rounded border border-gray-300 disabled:opacity-50",onClick:()=>Dt(j=>Math.max(0,j-1)),disabled:ot===0,children:"Anterior"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:o},(j,f)=>e.jsx("button",{type:"button",onClick:()=>Dt(f),className:`px-2 py-1 text-xs rounded border ${f===ot?"bg-[#000638] text-white border-[#000638]":"border-gray-300"}`,children:f+1},f))}),e.jsx("button",{type:"button",className:"px-2 py-1 text-xs rounded border border-gray-300 disabled:opacity-50",onClick:()=>Dt(j=>Math.min(o-1,j+1)),disabled:ot>=o-1,children:"Pr√≥xima"})]})]})})():e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"Nenhum vendedor encontrado com dados dispon√≠veis."})})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow border border-amber-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-amber-700",children:"Meta Bronze"}),e.jsx("p",{className:"text-xs text-amber-600",children:"Faturamento atingido"})]}),e.jsx("div",{className:"text-2xl",children:"ü•â"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-700",children:[e.jsx("span",{children:"Lojas:"}),e.jsx("span",{className:"font-bold text-amber-700",children:U.bronze.lojas})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-700",children:[e.jsx("span",{children:"Vendedores:"}),e.jsx("span",{className:"font-bold text-amber-700",children:U.bronze.vendedores})]})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-gray-700",children:"Meta Prata"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Faturamento atingido"})]}),e.jsx("div",{className:"text-2xl",children:"ü•à"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-700",children:[e.jsx("span",{children:"Lojas:"}),e.jsx("span",{className:"font-bold text-gray-700",children:U.prata.lojas})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-700",children:[e.jsx("span",{children:"Vendedores:"}),e.jsx("span",{className:"font-bold text-gray-700",children:U.prata.vendedores})]})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow border border-yellow-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-yellow-700",children:"Meta Ouro"}),e.jsx("p",{className:"text-xs text-yellow-600",children:"Faturamento atingido"})]}),e.jsx("div",{className:"text-2xl",children:"ü•á"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-700",children:[e.jsx("span",{children:"Lojas:"}),e.jsx("span",{className:"font-bold text-yellow-700",children:U.ouro.lojas})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-700",children:[e.jsx("span",{children:"Vendedores:"}),e.jsx("span",{className:"font-bold text-yellow-700",children:U.ouro.vendedores})]})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow border border-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-blue-700",children:"Meta Diamante"}),e.jsx("p",{className:"text-xs text-blue-600",children:"Faturamento atingido"})]}),e.jsx("div",{className:"text-2xl",children:"üíé"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-700",children:[e.jsx("span",{children:"Lojas:"}),e.jsx("span",{className:"font-bold text-blue-700",children:U.diamante.lojas})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-700",children:[e.jsx("span",{children:"Vendedores:"}),e.jsx("span",{className:"font-bold text-blue-700",children:U.diamante.vendedores})]})]})]})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>nt("lojas"),className:`flex items-center gap-2 px-4 py-2 rounded-lg border transition-colors text-sm font-medium ${Te==="lojas"?"bg-[#000638] border-[#000638] text-white":"bg-white border-gray-300 text-gray-600 hover:bg-gray-50"}`,children:"Lojas"}),e.jsx("button",{type:"button",onClick:()=>nt("vendedores"),className:`flex items-center gap-2 px-4 py-2 rounded-lg border transition-colors text-sm font-medium ${Te==="vendedores"?"bg-[#000638] border-[#000638] text-white":"bg-white border-gray-300 text-gray-600 hover:bg-gray-50"}`,children:"Vendedores"})]})}),Te==="lojas"&&e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow border border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-[#000638]",children:"Progresso de Metas por Loja"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Acompanhamento detalhado do progresso para a pr√≥xima meta"})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Loja"}),G==="SEMANAL"?e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Semana Atual"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Faturamento Semanal"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Meta da Semana"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Meta Atingida"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pr√≥xima Meta"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Falta para Pr√≥xima"})]}):e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Faturamento"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Meta Atual"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pr√≥xima Meta"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Progresso"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Falta"})]})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:U.lojaDetalhes&&U.lojaDetalhes.length>0?U.lojaDetalhes.filter(a=>se.length>0?se.some(o=>(o.nome_fantasia||o.nome_loja||o.loja||o.nm_loja||o.nome||"").includes(a.nome)):!0).filter(a=>{const o=a.nome;if(le==="Franquias"){const d=o.includes("F0");return console.log("√â franquia?",d),d}if(le==="Proprias"){const d=o.includes("-")||o.includes("- CROSBY");return console.log("√â pr√≥pria?",!d),!d}return!0}).sort((a,o)=>o.faturamento-a.faturamento).map((a,o)=>e.jsxs("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>{console.log("Clique na linha da loja:",a.nome);const d=S.find(u=>(u.nome_fantasia||u.nome_loja||u.loja||u.nm_loja||u.nome||"")===a.nome);console.log("Dados completos da loja:",d);const h={...a,tipo:"loja",dadosCompletos:d||{}};console.log("Detalhes a serem enviados:",h),Qt(h)},children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-xs",children:a.nome}),G==="SEMANAL"?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:(()=>{const d=ye(a,"lojas");return e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-cyan-100 text-cyan-800",children:d.semanaAtual})})()}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-xs font-medium text-green-600",children:(()=>{const d=ye(a,"lojas");return B(d.faturamentoSemanal)})()}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-xs",children:(()=>{const d=ye(a,"lojas");return d.metaSemanaAtual>0?B(d.metaSemanaAtual):"-"})()}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:(()=>{const d=ye(a,"lojas");return d.metaAtingida>0?e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:B(d.metaAtingida)}):"-"})()}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:(()=>{const d=ye(a,"lojas");return d.proximaMeta>0?e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"text-xs font-medium text-orange-600",children:B(d.proximaMeta)})}):"-"})()}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-xs",children:(()=>{const d=ye(a,"lojas");return d.faltanteProximaMeta>0?e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:B(d.faltanteProximaMeta)}):d.proximaMeta>0?e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"‚úì Atingida"}):"-"})()})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-xs font-medium text-green-600",children:B(a.faturamento)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium
                                      ${a.metaAtual==="Diamante"?"bg-blue-100 text-blue-800":a.metaAtual==="Ouro"?"bg-yellow-100 text-yellow-800":a.metaAtual==="Prata"?"bg-gray-100 text-gray-800":a.metaAtual==="Bronze"?"bg-amber-100 text-amber-800":"bg-gray-100 text-gray-800"}`,children:a.metaAtual})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-medium",children:a.proximaMeta}),a.valorProximaMeta>0&&e.jsx("span",{className:"text-xs text-gray-500",children:B(a.valorProximaMeta)})]})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mr-2",children:e.jsx("div",{className:`h-2.5 rounded-full ${a.metaAtual==="Diamante"?"bg-blue-600":a.metaAtual==="Ouro"?"bg-yellow-500":a.metaAtual==="Prata"?"bg-gray-500":a.metaAtual==="Bronze"?"bg-amber-500":"bg-blue-600"}`,style:{width:`${a.percentualAtingido}%`}})}),e.jsxs("span",{className:"text-xs font-medium",children:[a.percentualAtingido,"%"]})]})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-xs",children:a.valorFaltante>0?B(a.valorFaltante):"Meta atingida"})]})]},o)):e.jsx("tr",{children:e.jsx("td",{colSpan:G==="SEMANAL"?7:6,className:"px-3 py-4 text-center text-sm text-gray-500",children:"Nenhum dado dispon√≠vel. Verifique se existem metas cadastradas e faturamento no per√≠odo."})})})]})})]})}),Te==="vendedores"&&e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow border border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-[#000638]",children:"Progresso de Metas por Vendedor"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Acompanhamento detalhado do progresso para a pr√≥xima meta"})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Vendedor"}),G==="SEMANAL"?e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Semana Atual"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Faturamento Semanal"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Meta da Semana"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Meta Atingida"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pr√≥xima Meta"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Falta para Pr√≥xima"})]}):e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Faturamento"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Meta Atual"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pr√≥xima Meta"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Progresso"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Falta"})]})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:U.vendedorDetalhes&&U.vendedorDetalhes.length>0?U.vendedorDetalhes.filter(a=>W.length>0?W.some(o=>(o.nome_vendedor||o.vendedor||o.nm_vendedor||o.nome||"").includes(a.nome)):!0).filter(a=>{const o=a.nome;return le==="Franquias"?!o.includes("- INT"):le==="Proprias"?o.includes("- INT"):!0}).sort((a,o)=>o.faturamento-a.faturamento).map((a,o)=>e.jsxs("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>{console.log("Clique na linha do vendedor:",a.nome);const d=C.find(u=>(u.nome_vendedor||u.vendedor||u.nm_vendedor||u.nome||"")===a.nome);console.log("Dados completos do vendedor:",d);const h={...a,tipo:"vendedor",dadosCompletos:d||{}};console.log("Detalhes a serem enviados:",h),Qt(h)},children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-xs",children:a.nome}),G==="SEMANAL"?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:(()=>{const d=ye(a,"vendedores");return e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-cyan-100 text-cyan-800",children:d.semanaAtual})})()}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-xs font-medium text-green-600",children:(()=>{const d=ye(a,"vendedores");return B(d.faturamentoSemanal)})()}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-xs",children:(()=>{const d=ye(a,"vendedores");return d.metaSemanaAtual>0?B(d.metaSemanaAtual):"-"})()}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:(()=>{const d=ye(a,"vendedores");return d.metaAtingida>0?e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:B(d.metaAtingida)}):"-"})()}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:(()=>{const d=ye(a,"vendedores");return d.proximaMeta>0?e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"text-xs font-medium text-orange-600",children:B(d.proximaMeta)})}):"-"})()}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-xs",children:(()=>{const d=ye(a,"vendedores");return d.faltanteProximaMeta>0?e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:B(d.faltanteProximaMeta)}):d.proximaMeta>0?e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"‚úì Atingida"}):"-"})()})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-xs font-medium text-green-600",children:B(a.faturamento)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium
                                      ${a.metaAtual==="Diamante"?"bg-blue-100 text-blue-800":a.metaAtual==="Ouro"?"bg-yellow-100 text-yellow-800":a.metaAtual==="Prata"?"bg-gray-100 text-gray-800":a.metaAtual==="Bronze"?"bg-amber-100 text-amber-800":"bg-gray-100 text-gray-800"}`,children:a.metaAtual})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-medium",children:a.proximaMeta}),a.valorProximaMeta>0&&e.jsx("span",{className:"text-xs text-gray-500",children:B(a.valorProximaMeta)})]})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mr-2",children:e.jsx("div",{className:`h-2.5 rounded-full ${a.metaAtual==="Diamante"?"bg-blue-600":a.metaAtual==="Ouro"?"bg-yellow-500":a.metaAtual==="Prata"?"bg-gray-500":a.metaAtual==="Bronze"?"bg-amber-500":"bg-blue-600"}`,style:{width:`${a.percentualAtingido}%`}})}),e.jsxs("span",{className:"text-xs font-medium",children:[a.percentualAtingido,"%"]})]})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-xs",children:a.valorFaltante>0?B(a.valorFaltante):"Meta atingida"})]})]},o)):e.jsx("tr",{children:e.jsx("td",{colSpan:G==="SEMANAL"?7:6,className:"px-3 py-4 text-center text-sm text-gray-500",children:"Nenhum dado dispon√≠vel. Verifique se existem metas cadastradas e faturamento no per√≠odo."})})})]})})]})}),e.jsx("div",{className:"p-4 bg-gray-50 rounded-lg",children:e.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["* Dados baseados nas metas definidas e faturamento do per√≠odo selecionado (",O.dt_inicio," a ",O.dt_fim,")"]})})]})]}),Xa&&e.jsx(js,{overlay:!0,size:"lg",color:"blue",text:"Aplicando metas..."}),e.jsx(bs,{visible:Ct.visible,type:Ct.type,message:Ct.message,onClose:Qa,duration:4e3})]})};export{Mn as default};
