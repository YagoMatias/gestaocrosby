import{r as o,h as we,j as e,R as ne,L as ie,v as ee,C as Ce,u as Ee,P as Se,a1 as H,q as K,s as Ae,e as ke,n as Le}from"./index-a2563983.js";import{B as J}from"./Button-3b4dd265.js";import{M as ce}from"./Modal-8500ef4b.js";import{u as Te,W as De,a as ze,b as Me,c as Ve}from"./useWidgets-a4a8bd6c.js";import{n as Z}from"./Check.es-43d438e4.js";import{s as Fe}from"./Funnel.es-cd3339ac.js";import{n as de}from"./Plus.es-81fa0dc9.js";import{n as se}from"./Trash.es-c4902777.js";import{a as le}from"./PencilSimple.es-519f784a.js";import"./PieChart-2e5dc4ea.js";import"./LineChart-570f6699.js";const Oe=new Map([["bold",o.createElement(o.Fragment,null,o.createElement("path",{d:"M196,35.52C177.62,25.51,153.48,20,128,20S78.38,25.51,60,35.52C39.37,46.79,28,62.58,28,80v96c0,17.42,11.37,33.21,32,44.48,18.35,10,42.49,15.52,68,15.52s49.62-5.51,68-15.52c20.66-11.27,32-27.06,32-44.48V80C228,62.58,216.63,46.79,196,35.52ZM204,128c0,17-31.21,36-76,36s-76-19-76-36v-8.46a88.9,88.9,0,0,0,8,4.94c18.35,10,42.49,15.52,68,15.52s49.62-5.51,68-15.52a88.9,88.9,0,0,0,8-4.94ZM128,44c44.79,0,76,19,76,36s-31.21,36-76,36S52,97,52,80,83.21,44,128,44Zm0,168c-44.79,0-76-19-76-36v-8.46a88.9,88.9,0,0,0,8,4.94c18.35,10,42.49,15.52,68,15.52s49.62-5.51,68-15.52a88.9,88.9,0,0,0,8-4.94V176C204,193,172.79,212,128,212Z"}))],["duotone",o.createElement(o.Fragment,null,o.createElement("path",{d:"M216,80c0,26.51-39.4,48-88,48S40,106.51,40,80s39.4-48,88-48S216,53.49,216,80Z",opacity:"0.2"}),o.createElement("path",{d:"M128,24C74.17,24,32,48.6,32,80v96c0,31.4,42.17,56,96,56s96-24.6,96-56V80C224,48.6,181.83,24,128,24Zm80,104c0,9.62-7.88,19.43-21.61,26.92C170.93,163.35,150.19,168,128,168s-42.93-4.65-58.39-13.08C55.88,147.43,48,137.62,48,128V111.36c17.06,15,46.23,24.64,80,24.64s62.94-9.68,80-24.64ZM69.61,53.08C85.07,44.65,105.81,40,128,40s42.93,4.65,58.39,13.08C200.12,60.57,208,70.38,208,80s-7.88,19.43-21.61,26.92C170.93,115.35,150.19,120,128,120s-42.93-4.65-58.39-13.08C55.88,99.43,48,89.62,48,80S55.88,60.57,69.61,53.08ZM186.39,202.92C170.93,211.35,150.19,216,128,216s-42.93-4.65-58.39-13.08C55.88,195.43,48,185.62,48,176V159.36c17.06,15,46.23,24.64,80,24.64s62.94-9.68,80-24.64V176C208,185.62,200.12,195.43,186.39,202.92Z"}))],["fill",o.createElement(o.Fragment,null,o.createElement("path",{d:"M128,24C74.17,24,32,48.6,32,80v96c0,31.4,42.17,56,96,56s96-24.6,96-56V80C224,48.6,181.83,24,128,24Zm80,104c0,9.62-7.88,19.43-21.61,26.92C170.93,163.35,150.19,168,128,168s-42.93-4.65-58.39-13.08C55.88,147.43,48,137.62,48,128V111.36c17.06,15,46.23,24.64,80,24.64s62.94-9.68,80-24.64Zm-21.61,74.92C170.93,211.35,150.19,216,128,216s-42.93-4.65-58.39-13.08C55.88,195.43,48,185.62,48,176V159.36c17.06,15,46.23,24.64,80,24.64s62.94-9.68,80-24.64V176C208,185.62,200.12,195.43,186.39,202.92Z"}))],["light",o.createElement(o.Fragment,null,o.createElement("path",{d:"M128,26C75.29,26,34,49.72,34,80v96c0,30.28,41.29,54,94,54s94-23.72,94-54V80C222,49.72,180.71,26,128,26Zm0,12c44.45,0,82,19.23,82,42s-37.55,42-82,42S46,102.77,46,80,83.55,38,128,38Zm82,138c0,22.77-37.55,42-82,42s-82-19.23-82-42V154.79C62,171.16,92.37,182,128,182s66-10.84,82-27.21Zm0-48c0,22.77-37.55,42-82,42s-82-19.23-82-42V106.79C62,123.16,92.37,134,128,134s66-10.84,82-27.21Z"}))],["regular",o.createElement(o.Fragment,null,o.createElement("path",{d:"M128,24C74.17,24,32,48.6,32,80v96c0,31.4,42.17,56,96,56s96-24.6,96-56V80C224,48.6,181.83,24,128,24Zm80,104c0,9.62-7.88,19.43-21.61,26.92C170.93,163.35,150.19,168,128,168s-42.93-4.65-58.39-13.08C55.88,147.43,48,137.62,48,128V111.36c17.06,15,46.23,24.64,80,24.64s62.94-9.68,80-24.64ZM69.61,53.08C85.07,44.65,105.81,40,128,40s42.93,4.65,58.39,13.08C200.12,60.57,208,70.38,208,80s-7.88,19.43-21.61,26.92C170.93,115.35,150.19,120,128,120s-42.93-4.65-58.39-13.08C55.88,99.43,48,89.62,48,80S55.88,60.57,69.61,53.08ZM186.39,202.92C170.93,211.35,150.19,216,128,216s-42.93-4.65-58.39-13.08C55.88,195.43,48,185.62,48,176V159.36c17.06,15,46.23,24.64,80,24.64s62.94-9.68,80-24.64V176C208,185.62,200.12,195.43,186.39,202.92Z"}))],["thin",o.createElement(o.Fragment,null,o.createElement("path",{d:"M192.14,42.55C174.94,33.17,152.16,28,128,28S81.06,33.17,63.86,42.55C45.89,52.35,36,65.65,36,80v96c0,14.35,9.89,27.65,27.86,37.45,17.2,9.38,40,14.55,64.14,14.55s46.94-5.17,64.14-14.55c18-9.8,27.86-23.1,27.86-37.45V80C220,65.65,210.11,52.35,192.14,42.55ZM212,176c0,11.29-8.41,22.1-23.69,30.43C172.27,215.18,150.85,220,128,220s-44.27-4.82-60.31-13.57C52.41,198.1,44,187.29,44,176V149.48c4.69,5.93,11.37,11.34,19.86,16,17.2,9.38,40,14.55,64.14,14.55s46.94-5.17,64.14-14.55c8.49-4.63,15.17-10,19.86-16Zm0-48c0,11.29-8.41,22.1-23.69,30.43C172.27,167.18,150.85,172,128,172s-44.27-4.82-60.31-13.57C52.41,150.1,44,139.29,44,128V101.48c4.69,5.93,11.37,11.34,19.86,16,17.2,9.38,40,14.55,64.14,14.55s46.94-5.17,64.14-14.55c8.49-4.63,15.17-10,19.86-16Zm-23.69-17.57C172.27,119.18,150.85,124,128,124s-44.27-4.82-60.31-13.57C52.41,102.1,44,91.29,44,80s8.41-22.1,23.69-30.43C83.73,40.82,105.15,36,128,36s44.27,4.82,60.31,13.57C203.59,57.9,212,68.71,212,80S203.59,102.1,188.31,110.43Z"}))]]),xe=o.forwardRef((l,g)=>o.createElement(we,{ref:g,...l,weights:Oe}));xe.displayName="DatabaseIcon";const Be=xe,N={EQUAL:{value:"=",label:"Igual a",symbol:"="},NOT_EQUAL:{value:"<>",label:"Diferente de",symbol:"≠"},GREATER:{value:">",label:"Maior que",symbol:">"},GREATER_EQUAL:{value:">=",label:"Maior ou igual",symbol:"≥"},LESS:{value:"<",label:"Menor que",symbol:"<"},LESS_EQUAL:{value:"<=",label:"Menor ou igual",symbol:"≤"},LIKE:{value:"LIKE",label:"Contém",symbol:"~"},NOT_LIKE:{value:"NOT LIKE",label:"Não contém",symbol:"≁"},BETWEEN:{value:"BETWEEN",label:"Entre",symbol:"⇔"},IN:{value:"IN",label:"Em (lista)",symbol:"∈"},IS_NULL:{value:"IS NULL",label:"É nulo",symbol:"∅"},IS_NOT_NULL:{value:"IS NOT NULL",label:"Não é nulo",symbol:"∃"}},me=Object.values(N),Ie={SUM:{value:"SUM",label:"Soma"},COUNT:{value:"COUNT",label:"Contar"},AVG:{value:"AVG",label:"Média"},MIN:{value:"MIN",label:"Mínimo"},MAX:{value:"MAX",label:"Máximo"}},_e=Object.values(Ie),$e={TABLE:{value:"table",label:"Tabela",icon:"📊"},BAR_CHART:{value:"bar",label:"Gráfico de Barras",icon:"📊"},PIE_CHART:{value:"pie",label:"Gráfico de Pizza",icon:"🥧"},LINE_CHART:{value:"line",label:"Gráfico de Linha",icon:"📈"}},oe=Object.values($e),ue=l=>![N.IS_NULL.value,N.IS_NOT_NULL.value].includes(l),he=l=>l===N.BETWEEN.value,Pe=l=>l===N.IN.value,Ze=l=>{const g=me.find(T=>T.value===l.operator);return g?l.operator===N.BETWEEN.value?`${l.column} ${g.label} ${l.value} e ${l.value2}`:l.operator===N.IN.value?`${l.column} ${g.label} (${l.values.join(", ")})`:[N.IS_NULL.value,N.IS_NOT_NULL.value].includes(l.operator)?`${l.column} ${g.label}`:`${l.column} ${g.symbol} ${l.value}`:""},Ue=l=>{if(!l.column)return{valid:!1,error:"Selecione uma coluna"};if(!l.operator)return{valid:!1,error:"Selecione um operador"};if(ue(l.operator)){if(he(l.operator)){if(!l.value||!l.value2)return{valid:!1,error:"Preencha ambos os valores para BETWEEN"}}else if(Pe(l.operator)){if(!l.values||l.values.length===0)return{valid:!1,error:"Adicione pelo menos um valor"}}else if(!l.value&&l.value!==0)return{valid:!1,error:"Preencha o valor do filtro"}}return{valid:!0,error:null}},Ge=({isOpen:l,onClose:g,onSave:T,editingWidget:x=null})=>{var S;const{fetchViews:O,fetchViewColumns:Y,executeQuery:U,validateQuery:te}=Te(),[h,D]=o.useState(1),[z,y]=o.useState(!1),[G,R]=o.useState([]),[M,B]=o.useState([]),[r,d]=o.useState({nome:"",name:"",viewName:"",selectedColumns:[],filters:[],aggregations:[],orderBy:{column:"",direction:"ASC"},type:"table",chartConfig:{title:"",subtitle:"",xAxis:"",yAxis:[],groupBy:"",colorScheme:"default",showLegend:!0,showDataLabels:!1,showGrid:!0,chartType:"bar",stacked:!1,horizontal:!1,calculations:[],customColors:{}}}),[b,w]=o.useState({column:"",operator:"",value:"",value2:"",values:[]}),[V,f]=o.useState([]),[I,C]=o.useState(null);o.useEffect(()=>{(async()=>{if(l){y(!0);try{const t=await O();R(t)}catch(t){console.error("Erro ao carregar views:",t),R([{name:"vw_vendas",label:"View de Vendas"},{name:"vw_financeiro",label:"View Financeira"},{name:"vw_estoque",label:"View de Estoque"}])}finally{y(!1)}}})()},[l,O]),o.useEffect(()=>{x?(d({nome:x.config.nome||"",name:x.config.name||"",viewName:x.config.viewName||"",selectedColumns:x.config.selectedColumns||[],filters:x.config.filters||[],aggregations:x.config.aggregations||[],orderBy:x.config.orderBy||{column:"",direction:"ASC"},type:x.config.type||"table",chartConfig:x.config.chartConfig||{title:"",subtitle:"",xAxis:"",yAxis:[],groupBy:"",colorScheme:"default",showLegend:!0,showDataLabels:!1,showGrid:!0,chartType:"bar",stacked:!1,horizontal:!1,calculations:[],customColors:{}}}),v(x.config)):A()},[x,l]);const A=()=>{d({nome:"",name:"",viewName:"",selectedColumns:[],filters:[],aggregations:[],orderBy:{column:"",direction:"ASC"},type:"table",chartConfig:{title:"",subtitle:"",xAxis:"",yAxis:[],groupBy:"",colorScheme:"default",showLegend:!0,showDataLabels:!1,showGrid:!0,chartType:"bar",stacked:!1,horizontal:!1,calculations:[],customColors:{}}}),D(1),f([]),C(null),B([])},u=async s=>{d(t=>({...t,viewName:s,selectedColumns:[],filters:[],aggregations:[]})),y(!0);try{const t=await Y(s);B(t)}catch(t){console.error("Erro ao carregar colunas:",t),B([])}finally{y(!1)}},E=s=>{d(t=>{const i=t.selectedColumns.includes(s);return{...t,selectedColumns:i?t.selectedColumns.filter(p=>p!==s):[...t.selectedColumns,s]}})},W=()=>{const s=Ue(b);if(!s.valid){alert(s.error);return}d(t=>({...t,filters:[...t.filters,{...b,id:Date.now()}]})),w({column:"",operator:"",value:"",value2:"",values:[]})},_=s=>{d(t=>({...t,filters:t.filters.filter(i=>i.id!==s)}))},q=(s,t)=>{d(i=>i.aggregations.find(j=>j.column===s)?{...i,aggregations:i.aggregations.map(j=>j.column===s?{...j,function:t}:j)}:{...i,aggregations:[...i.aggregations,{column:s,function:t}]})},X=s=>{d(t=>({...t,aggregations:t.aggregations.filter(i=>i.column!==s)}))},v=async(s=r)=>{var t;if(s.selectedColumns.length===0||!s.viewName){f([]),C(null);return}y(!0),C(null);try{const i=s.filters.filter(j=>j.column&&j.operator),p=await U({viewName:s.viewName,columns:s.selectedColumns,filters:i,aggregations:s.aggregations,orderBy:s.orderBy});console.log("📊 Preview gerado com chartConfig:",{chartType:s.chartConfig.chartType,xAxis:s.chartConfig.xAxis,yAxis:s.chartConfig.yAxis,dataLength:(t=p.data)==null?void 0:t.length}),f(p.data||[])}catch(i){console.error("Erro ao gerar preview:",i),C("Erro ao carregar dados de preview"),f([])}finally{y(!1)}},Q=()=>{if(!r.nome.trim()){alert("Digite um nome para o widget");return}if(!r.viewName){alert("Selecione uma view");return}if(r.selectedColumns.length===0){alert("Selecione pelo menos uma coluna");return}const s=r.filters.filter(i=>i.column&&i.operator),t={id:(x==null?void 0:x.id)||Date.now(),config:{...r,filters:s},createdAt:(x==null?void 0:x.createdAt)||new Date().toISOString(),updatedAt:new Date().toISOString()};T(t),g(),A()},k=G.find(s=>s.name===r.viewName),$=[{number:1,title:"View & Colunas"},{number:2,title:"Filtros"},{number:3,title:"Agregações & Ordem"},{number:4,title:"Visualização"},{number:5,title:"Preview & Salvar"}];return e.jsx(ce,{isOpen:l,onClose:()=>{g(),A()},title:x?"Editar Widget":"Novo Widget",size:"6xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:$.map((s,t)=>e.jsxs(ne.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("button",{type:"button",onClick:()=>D(s.number),className:`w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold transition-all ${h===s.number?"bg-[#000638] text-white shadow-md":h>s.number?"bg-green-500 text-white":"bg-gray-200 text-gray-500"}`,children:h>s.number?e.jsx(Z,{size:14,weight:"bold"}):s.number}),e.jsx("span",{className:`text-[10px] mt-0.5 ${h===s.number?"font-bold text-[#000638]":"text-gray-500"}`,children:s.title})]}),t<$.length-1&&e.jsx("div",{className:`flex-1 h-0.5 mx-1 ${h>s.number?"bg-green-500":"bg-gray-200"}`})]},s.number))}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1 text-[#000638]",children:"Nome do Widget *"}),e.jsx("input",{type:"text",value:r.nome,onChange:s=>d(t=>({...t,nome:s.target.value})),className:"w-full border border-[#000638]/30 rounded-lg px-2 py-1.5 focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] placeholder:text-gray-400 text-xs",placeholder:"Ex: Vendas por Produto"})]}),h===1&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-semibold mb-1.5 text-[#000638] flex items-center gap-1.5",children:[e.jsx(Be,{size:14}),"Selecione a View *"]}),z?e.jsx("div",{className:"flex justify-center py-6",children:e.jsx(ie,{})}):e.jsx("div",{className:"grid grid-cols-2 gap-2",children:G.map(s=>e.jsxs("button",{type:"button",onClick:()=>u(s.name),className:`p-2.5 border-2 rounded-lg text-left transition-all ${r.viewName===s.name?"border-[#000638] bg-[#000638]/5":"border-gray-200 hover:border-[#000638]/30"}`,children:[e.jsx("p",{className:"font-semibold text-xs text-[#000638]",children:s.label||s.name}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-0.5",children:s.name})]},s.name))})]}),r.viewName&&M.length>0&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-semibold mb-1.5 text-[#000638]",children:["Selecione as Colunas * (",r.selectedColumns.length," ","selecionadas)"]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 max-h-48 overflow-y-auto p-2 border border-[#000638]/20 rounded-lg bg-[#f8f9fb]",children:M.map(s=>e.jsx("button",{type:"button",onClick:()=>E(s.name),className:`p-1.5 border-2 rounded-lg text-xs transition-all ${r.selectedColumns.includes(s.name)?"border-[#000638] bg-[#000638]/5 text-[#000638] font-semibold":"border-gray-200 hover:border-[#000638]/30 bg-white"}`,children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:`w-3 h-3 rounded border-2 flex items-center justify-center ${r.selectedColumns.includes(s.name)?"bg-[#000638] border-[#000638]":"border-gray-300"}`,children:r.selectedColumns.includes(s.name)&&e.jsx(Z,{size:10,className:"text-white",weight:"bold"})}),e.jsx("span",{className:"truncate",children:s.name})]})},s.name))})]})]}),h===2&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx(Fe,{size:12}),e.jsx("h3",{className:"text-xs font-semibold text-[#000638]",children:"Adicionar Filtros WHERE"})]}),r.filters.length>0&&e.jsxs("div",{className:"space-y-1.5 mb-3",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700",children:"Filtros Aplicados:"}),r.filters.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-[#000638]/5 border border-[#000638]/20 rounded-lg",children:[e.jsx("span",{className:"text-[10px] text-[#000638] font-mono",children:Ze(s)}),e.jsx("button",{type:"button",onClick:()=>_(s.id),className:"text-red-600 hover:text-red-800 p-0.5",children:e.jsx(se,{size:14})})]},s.id))]}),r.viewName&&M.length>0&&e.jsxs("div",{className:"grid  border border-[#000638]/20 rounded-lg p-2.5 bg-[#f8f9fb] ",children:[e.jsx("p",{className:"text-[10px] mb-2 font-semibold text-gray-600",children:"Novo Filtro:"}),e.jsxs("div",{className:"grid grid-cols-12 gap-2 p-2.5 border-2 rounded-lg text-left transition-all",children:[e.jsxs("select",{value:b.column,onChange:s=>w(t=>({...t,column:s.target.value})),className:"w-30 h-7 col-span-3 border border-[#000638]/30 rounded-lg  focus:outline-none focus:ring-2 focus:ring-[#000638] bg-white text-[#000638] text-xs",children:[e.jsx("option",{value:"",children:"Coluna..."}),M.map(s=>e.jsx("option",{value:s.name,children:s.name},s.name))]}),e.jsxs("select",{value:b.operator,onChange:s=>w(t=>({...t,operator:s.target.value})),className:"w-30 h-7 col-span-3 border border-[#000638]/30 rounded-lg  focus:outline-none focus:ring-2 focus:ring-[#000638] bg-white text-[#000638] text-xs",children:[e.jsx("option",{value:"",children:"Operador..."}),me.map(s=>e.jsxs("option",{value:s.value,children:[s.label," (",s.symbol,")"]},s.value))]}),ue(b.operator)&&e.jsx(e.Fragment,{children:he(b.operator)?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:b.value,onChange:s=>w(t=>({...t,value:s.target.value})),placeholder:"Valor 1",className:"col-span-3 border border-[#000638]/30 rounded-lg  focus:outline-none focus:ring-2 focus:ring-[#000638] bg-white text-[#000638] text-xs"}),e.jsx("input",{type:"text",value:b.value2,onChange:s=>w(t=>({...t,value2:s.target.value})),placeholder:"Valor 2",className:"col-span-2 border border-[#000638]/30 rounded-lg px-2 py-1.5 focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] placeholder:text-gray-400 text-xs"})]}):e.jsx("input",{type:"text",value:b.value,onChange:s=>w(t=>({...t,value:s.target.value})),placeholder:"Valor",className:"col-span-4 border border-[#000638]/30 rounded-lg px-2 py-1.5 focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] placeholder:text-gray-400 text-xs"})}),e.jsxs("button",{type:"button",onClick:W,className:"col-span-2 px-3 py-1 bg-[#000638] text-white rounded-lg hover:bg-[#fe0000] transition-colors flex items-center justify-center gap-1.5 text-xs font-semibold h-7",children:[e.jsx(de,{size:14,weight:"bold"}),"Adicionar"]})]})]})]}),h===3&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-semibold mb-2 text-[#000638]",children:"Funções de Agregação (Opcional)"}),e.jsx("div",{className:"space-y-1.5",children:r.selectedColumns.map(s=>{const t=r.aggregations.find(i=>i.column===s);return e.jsxs("div",{className:"flex items-center gap-2 p-1.5 border border-[#000638]/20 rounded-lg",children:[e.jsx("span",{className:"text-xs font-medium w-28 truncate text-[#000638]",children:s}),e.jsxs("select",{value:(t==null?void 0:t.function)||"",onChange:i=>{i.target.value?q(s,i.target.value):X(s)},className:"flex-1 border border-[#000638]/30 rounded-lg px-2 py-1 focus:outline-none focus:ring-2 focus:ring-[#000638] bg-white text-[#000638] text-xs",children:[e.jsx("option",{value:"",children:"Sem agregação"}),_e.map(i=>e.jsxs("option",{value:i.value,children:[i.label," (",i.value,")"]},i.value))]})]},s)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-semibold mb-2 text-[#000638]",children:"Ordenação (Opcional)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:r.orderBy.column,onChange:s=>d(t=>({...t,orderBy:{...t.orderBy,column:s.target.value}})),className:"flex-1 border border-[#000638]/30 rounded-lg px-2 py-1.5 focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] text-xs",children:[e.jsx("option",{value:"",children:"Selecione uma coluna..."}),r.selectedColumns.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:r.orderBy.direction,onChange:s=>d(t=>({...t,orderBy:{...t.orderBy,direction:s.target.value}})),className:"w-32 border border-[#000638]/30 rounded-lg px-2 py-1.5 focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] text-xs",children:[e.jsx("option",{value:"ASC",children:"Crescente (A-Z)"}),e.jsx("option",{value:"DESC",children:"Decrescente (Z-A)"})]})]})]})]}),h===4&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx(ee,{size:14}),e.jsx("h3",{className:"text-xs font-semibold text-[#000638]",children:"Escolha o Tipo de Visualização *"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:oe.map(s=>e.jsxs("button",{type:"button",onClick:()=>d(t=>({...t,type:s.value})),className:`p-3 border-2 rounded-lg transition-all ${r.type===s.value?"border-[#000638] bg-[#000638]/5":"border-gray-200 hover:border-[#000638]/30"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:s.icon}),e.jsx("p",{className:"font-semibold text-xs text-[#000638]",children:s.label})]},s.value))})]}),r.type!=="table"&&e.jsxs("div",{className:"border-t border-gray-200 pt-3 space-y-3",children:[e.jsxs("h3",{className:"text-xs font-semibold text-[#000638] flex items-center gap-1.5",children:[e.jsx(ee,{size:14,className:"text-[#000638]"}),"Configurações do Gráfico"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1 text-[#000638]",children:"Título do Gráfico"}),e.jsx("input",{type:"text",value:r.chartConfig.title,onChange:s=>{d(t=>({...t,chartConfig:{...t.chartConfig,title:s.target.value}}))},placeholder:"Ex: Vendas por Mês",className:"w-full border border-[#000638]/30 rounded-lg px-2 py-1.5 focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] placeholder:text-gray-400 text-xs"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1 text-[#000638]",children:"Subtítulo (Opcional)"}),e.jsx("input",{type:"text",value:r.chartConfig.subtitle,onChange:s=>{d(t=>({...t,chartConfig:{...t.chartConfig,subtitle:s.target.value}}))},placeholder:"Ex: Janeiro - Dezembro 2024",className:"w-full border border-[#000638]/30 rounded-lg px-2 py-1.5 focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] placeholder:text-gray-400 text-xs"})]})]}),(r.type==="chart"||r.type==="graph")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Tipo de Gráfico *"}),e.jsx("div",{className:"grid grid-cols-5 gap-3",children:[{value:"bar",label:"Barras",icon:"📊",description:"Comparar valores entre categorias",example:e.jsxs("div",{className:"flex items-end justify-around h-12 gap-1",children:[e.jsx("div",{className:"w-full bg-blue-500 rounded-t",style:{height:"70%"}}),e.jsx("div",{className:"w-full bg-blue-500 rounded-t",style:{height:"45%"}}),e.jsx("div",{className:"w-full bg-blue-500 rounded-t",style:{height:"90%"}}),e.jsx("div",{className:"w-full bg-blue-500 rounded-t",style:{height:"60%"}})]})},{value:"line",label:"Linhas",icon:"📈",description:"Mostrar tendências ao longo do tempo",example:e.jsxs("svg",{className:"w-full h-12",viewBox:"0 0 100 40",children:[e.jsx("polyline",{points:"0,35 25,25 50,15 75,20 100,10",fill:"none",stroke:"#3b82f6",strokeWidth:"2"}),e.jsx("circle",{cx:"0",cy:"35",r:"2",fill:"#3b82f6"}),e.jsx("circle",{cx:"25",cy:"25",r:"2",fill:"#3b82f6"}),e.jsx("circle",{cx:"50",cy:"15",r:"2",fill:"#3b82f6"}),e.jsx("circle",{cx:"75",cy:"20",r:"2",fill:"#3b82f6"}),e.jsx("circle",{cx:"100",cy:"10",r:"2",fill:"#3b82f6"})]})},{value:"area",label:"Área",icon:"🏔️",description:"Destacar volume acumulado",example:e.jsx("svg",{className:"w-full h-12",viewBox:"0 0 100 40",children:e.jsx("path",{d:"M 0,35 L 25,25 L 50,15 L 75,20 L 100,10 L 100,40 L 0,40 Z",fill:"#3b82f6",fillOpacity:"0.3",stroke:"#3b82f6",strokeWidth:"2"})})},{value:"pie",label:"Pizza",icon:"🥧",description:"Mostrar proporções de um todo",example:e.jsxs("svg",{className:"w-full h-12",viewBox:"0 0 40 40",children:[e.jsx("circle",{cx:"20",cy:"20",r:"18",fill:"#3b82f6",opacity:"0.3"}),e.jsx("path",{d:"M 20,20 L 20,2 A 18,18 0 0,1 35,28 Z",fill:"#3b82f6"}),e.jsx("path",{d:"M 20,20 L 35,28 A 18,18 0 0,1 10,35 Z",fill:"#8b5cf6"})]})},{value:"scatter",label:"Dispersão",icon:"⚪",description:"Correlação entre duas variáveis",example:e.jsxs("svg",{className:"w-full h-12",viewBox:"0 0 100 40",children:[e.jsx("circle",{cx:"10",cy:"30",r:"2",fill:"#3b82f6"}),e.jsx("circle",{cx:"25",cy:"20",r:"2",fill:"#3b82f6"}),e.jsx("circle",{cx:"40",cy:"25",r:"2",fill:"#3b82f6"}),e.jsx("circle",{cx:"55",cy:"15",r:"2",fill:"#3b82f6"}),e.jsx("circle",{cx:"70",cy:"18",r:"2",fill:"#3b82f6"}),e.jsx("circle",{cx:"85",cy:"10",r:"2",fill:"#3b82f6"}),e.jsx("circle",{cx:"30",cy:"35",r:"2",fill:"#3b82f6"}),e.jsx("circle",{cx:"60",cy:"28",r:"2",fill:"#3b82f6"})]})}].map(s=>e.jsxs("button",{type:"button",onClick:()=>{d(t=>({...t,chartConfig:{...t.chartConfig,chartType:s.value}}))},className:`p-2.5 border-2 rounded-lg transition-all hover:shadow-md ${r.chartConfig.chartType===s.value?"border-[#000638] bg-[#000638]/5 shadow-lg":"border-gray-200 hover:border-[#000638]/30"}`,children:[e.jsx("div",{className:"text-xl mb-1.5",children:s.icon}),e.jsx("div",{className:"mb-1.5",children:s.example}),e.jsx("p",{className:"text-xs font-bold mb-0.5 text-[#000638]",children:s.label}),e.jsx("p",{className:"text-[10px] text-gray-500 leading-tight",children:s.description})]},s.value))})]}),r.chartConfig.chartType!=="pie"&&e.jsxs("div",{className:"bg-[#f8f9fb] border border-[#000638]/20 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-[#000638] mb-3 flex items-center gap-1.5 text-sm",children:[e.jsx("span",{className:"bg-[#000638] text-white rounded-full w-5 h-5 flex items-center justify-center text-xs",children:"?"}),"Entenda os Eixos do Gráfico"]}),e.jsx("div",{className:"bg-white rounded-lg p-3 mb-3 border border-[#000638]/10",children:e.jsxs("div",{className:"relative",style:{height:"150px"},children:[e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 flex items-end justify-around gap-1.5 px-6",style:{height:"120px"},children:[e.jsxs("div",{className:"flex flex-col items-center flex-1",children:[e.jsx("div",{className:"w-full bg-gradient-to-t from-[#000638] to-[#000638]/80 rounded-t flex items-center justify-center text-white text-[10px] font-bold",style:{height:"70%"},children:"100"}),e.jsx("p",{className:"text-[10px] mt-1 font-medium text-gray-700",children:"Jan"})]}),e.jsxs("div",{className:"flex flex-col items-center flex-1",children:[e.jsx("div",{className:"w-full bg-gradient-to-t from-[#000638] to-[#000638]/80 rounded-t flex items-center justify-center text-white text-[10px] font-bold",style:{height:"45%"},children:"70"}),e.jsx("p",{className:"text-[10px] mt-1 font-medium text-gray-700",children:"Fev"})]}),e.jsxs("div",{className:"flex flex-col items-center flex-1",children:[e.jsx("div",{className:"w-full bg-gradient-to-t from-[#000638] to-[#000638]/80 rounded-t flex items-center justify-center text-white text-[10px] font-bold",style:{height:"90%"},children:"150"}),e.jsx("p",{className:"text-[10px] mt-1 font-medium text-gray-700",children:"Mar"})]}),e.jsxs("div",{className:"flex flex-col items-center flex-1",children:[e.jsx("div",{className:"w-full bg-gradient-to-t from-[#000638] to-[#000638]/80 rounded-t flex items-center justify-center text-white text-[10px] font-bold",style:{height:"60%"},children:"90"}),e.jsx("p",{className:"text-[10px] mt-1 font-medium text-gray-700",children:"Abr"})]})]}),e.jsx("div",{className:"absolute left-0 top-0 bottom-10 flex items-center",children:e.jsxs("div",{className:"bg-green-600 text-white px-1.5 py-0.5 rounded text-[10px] font-bold shadow-md",children:["← EIXO Y",e.jsx("br",{}),"(Valores)"]})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 flex justify-center",children:e.jsx("div",{className:"bg-orange-600 text-white px-2 py-0.5 rounded text-[10px] font-bold shadow-md",children:"EIXO X (Categorias) →"})})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg p-3 border border-orange-300",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx("span",{className:"bg-orange-600 text-white rounded px-1.5 py-0.5 text-[10px] font-bold",children:"EIXO X"}),e.jsx("span",{className:"text-xs font-semibold text-gray-900",children:"Horizontal (Categorias)"})]}),e.jsxs("p",{className:"text-[10px] text-gray-600 mb-2",children:["Os ",e.jsx("strong",{children:"rótulos"})," que aparecem na base do gráfico (ex: meses, produtos, regiões)"]}),e.jsxs("select",{value:r.chartConfig.xAxis,onChange:s=>{d(t=>({...t,chartConfig:{...t.chartConfig,xAxis:s.target.value}})),setTimeout(()=>v(),100)},className:"w-full border border-[#000638]/30 rounded-lg px-2 py-1.5 focus:outline-none focus:ring-2 focus:ring-[#000638] bg-white text-[#000638] text-xs font-medium",children:[e.jsx("option",{value:"",children:"❌ Selecione uma coluna..."}),r.selectedColumns.map(s=>e.jsxs("option",{value:s,children:["📌 ",s]},s))]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-3 border border-green-300",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx("span",{className:"bg-green-600 text-white rounded px-1.5 py-0.5 text-[10px] font-bold",children:"EIXO Y"}),e.jsx("span",{className:"text-xs font-semibold text-gray-900",children:"Vertical (Valores)"})]}),e.jsxs("p",{className:"text-[10px] text-gray-600 mb-2",children:["Os ",e.jsx("strong",{children:"números/valores"})," que serão exibidos (ex: vendas, quantidade, preço)"]}),e.jsx("div",{className:"border border-green-300 rounded-lg p-1.5 max-h-24 overflow-y-auto bg-white",children:r.selectedColumns.length===0?e.jsx("p",{className:"text-[10px] text-gray-400 text-center py-1",children:"Nenhuma coluna disponível"}):r.selectedColumns.map(s=>e.jsxs("label",{className:"flex items-center gap-1.5 p-1 hover:bg-green-50 rounded cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:r.chartConfig.yAxis.includes(s),onChange:t=>{const i=t.target.checked?[...r.chartConfig.yAxis,s]:r.chartConfig.yAxis.filter(p=>p!==s);d(p=>({...p,chartConfig:{...p.chartConfig,yAxis:i}})),setTimeout(()=>v(),100)},className:"rounded border-green-400 text-green-600 focus:ring-green-500 w-3 h-3"}),e.jsxs("span",{className:"text-[10px] font-medium",children:["📊 ",s]})]},s))}),r.chartConfig.yAxis.length>0&&e.jsxs("p",{className:"text-[10px] text-green-700 mt-1 font-medium",children:["✓ ",r.chartConfig.yAxis.length," série(s) selecionada(s)"]})]})]})]}),r.chartConfig.chartType==="pie"&&e.jsxs("div",{className:"bg-purple-50 border border-purple-300 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-[#000638] mb-3 flex items-center gap-1.5 text-sm",children:[e.jsx("span",{className:"text-lg",children:"🥧"}),"Como Configurar Gráfico de Pizza"]}),e.jsx("div",{className:"bg-white rounded-lg p-3 mb-3 border border-purple-200",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 120 120",children:[e.jsx("circle",{cx:"60",cy:"60",r:"55",fill:"#ec4899",opacity:"0.3"}),e.jsx("path",{d:"M 60,60 L 60,5 A 55,55 0 0,1 110,80 Z",fill:"#ec4899"}),e.jsx("path",{d:"M 60,60 L 110,80 A 55,55 0 0,1 15,85 Z",fill:"#8b5cf6"}),e.jsx("path",{d:"M 60,60 L 15,85 A 55,55 0 0,1 60,5 Z",fill:"#3b82f6"})]})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-start gap-1.5",children:[e.jsx("span",{className:"text-sm",children:"🏷️"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-xs text-[#000638]",children:"Nome das Fatias (Eixo X)"}),e.jsx("p",{className:"text-[10px] text-gray-600",children:"Ex: Nome Fantasia, Produto, Região"})]})]}),e.jsxs("div",{className:"flex items-start gap-1.5",children:[e.jsx("span",{className:"text-sm",children:"📊"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-xs text-[#000638]",children:"Tamanho das Fatias (Eixo Y)"}),e.jsx("p",{className:"text-[10px] text-gray-600",children:"Ex: Faturamento, Quantidade, Total"})]})]})]})})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-3 border border-purple-300",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx("span",{className:"text-sm",children:"🏷️"}),e.jsx("span",{className:"text-xs font-semibold text-gray-900",children:"Nome das Fatias"})]}),e.jsxs("p",{className:"text-[10px] text-gray-600 mb-2",children:["O que identifica cada fatia da pizza (ex:"," ",e.jsx("strong",{children:"nome_fantasia"}),")"]}),e.jsxs("select",{value:r.chartConfig.xAxis,onChange:s=>{d(t=>({...t,chartConfig:{...t.chartConfig,xAxis:s.target.value}})),setTimeout(()=>v(),100)},className:"w-full border border-[#000638]/30 rounded-lg px-2 py-1.5 focus:outline-none focus:ring-2 focus:ring-[#000638] bg-white text-[#000638] text-xs font-medium",children:[e.jsx("option",{value:"",children:"❌ Selecione..."}),r.selectedColumns.map(s=>e.jsxs("option",{value:s,children:["🏷️ ",s]},s))]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-pink-50 to-pink-100 rounded-lg p-3 border border-pink-300",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx("span",{className:"text-sm",children:"📊"}),e.jsx("span",{className:"text-xs font-semibold text-gray-900",children:"Tamanho das Fatias"})]}),e.jsxs("p",{className:"text-[10px] text-gray-600 mb-2",children:["O valor numérico de cada fatia (ex:"," ",e.jsx("strong",{children:"faturamento"}),")"]}),e.jsx("div",{className:"border border-pink-300 rounded-lg p-1.5 max-h-24 overflow-y-auto bg-white",children:r.selectedColumns.length===0?e.jsx("p",{className:"text-[10px] text-gray-400 text-center py-1",children:"Nenhuma coluna disponível"}):r.selectedColumns.map(s=>e.jsxs("label",{className:"flex items-center gap-1.5 p-1 hover:bg-pink-50 rounded cursor-pointer transition-colors",children:[e.jsx("input",{type:"radio",name:"pieValue",checked:r.chartConfig.yAxis[0]===s,onChange:()=>{d(t=>({...t,chartConfig:{...t.chartConfig,yAxis:[s]}})),setTimeout(()=>v(),100)},className:"border-pink-400 text-pink-600 focus:ring-pink-500 w-3 h-3"}),e.jsxs("span",{className:"text-sm font-medium",children:["📊 ",s]})]},s))}),r.chartConfig.yAxis.length>0&&e.jsxs("p",{className:"text-xs text-pink-700 mt-2 font-medium",children:["✓ Usando: ",r.chartConfig.yAxis[0]]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Agrupar/Dividir Por (Opcional)"}),e.jsxs("select",{value:r.chartConfig.groupBy,onChange:s=>d(t=>({...t,chartConfig:{...t.chartConfig,groupBy:s.target.value}})),className:"w-full border border-[#000638]/30 rounded-lg px-2 py-1.5 focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] text-xs",children:[e.jsx("option",{value:"",children:"Sem agrupamento"}),r.selectedColumns.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-0.5",children:"Cria séries separadas no gráfico (ex: por categoria, região, etc)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Esquema de Cores"}),e.jsx("div",{className:"grid grid-cols-4 gap-3",children:[{value:"default",label:"Padrão",colors:["#3b82f6","#8b5cf6","#ec4899"]},{value:"business",label:"Negócios",colors:["#1e40af","#0891b2","#059669"]},{value:"warm",label:"Quente",colors:["#dc2626","#ea580c","#f59e0b"]},{value:"cool",label:"Frio",colors:["#0284c7","#0891b2","#06b6d4"]}].map(s=>e.jsxs("button",{type:"button",onClick:()=>d(t=>({...t,chartConfig:{...t.chartConfig,colorScheme:s.value}})),className:`p-3 border-2 rounded-lg transition-all ${r.chartConfig.colorScheme===s.value?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:"flex gap-1 mb-2 justify-center",children:s.colors.map((t,i)=>e.jsx("div",{className:"w-4 h-4 rounded",style:{backgroundColor:t}},i))}),e.jsx("p",{className:"text-xs font-medium",children:s.label})]},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-2 text-[#000638]",children:"Opções de Exibição"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2 p-2 border border-[#000638]/20 rounded-lg hover:bg-[#f8f9fb] cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.chartConfig.showLegend,onChange:s=>d(t=>({...t,chartConfig:{...t.chartConfig,showLegend:s.target.checked}})),className:"rounded border-gray-300 w-3 h-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-xs text-[#000638]",children:"Mostrar Legenda"}),e.jsx("p",{className:"text-[10px] text-gray-500",children:"Exibe os rótulos das séries"})]})]}),e.jsxs("label",{className:"flex items-center gap-2 p-2 border border-[#000638]/20 rounded-lg hover:bg-[#f8f9fb] cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.chartConfig.showDataLabels,onChange:s=>d(t=>({...t,chartConfig:{...t.chartConfig,showDataLabels:s.target.checked}})),className:"rounded border-gray-300 w-3 h-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-xs text-[#000638]",children:"Rótulos de Dados"}),e.jsx("p",{className:"text-[10px] text-gray-500",children:"Mostra valores nos pontos"})]})]}),e.jsxs("label",{className:"flex items-center gap-2 p-2 border border-[#000638]/20 rounded-lg hover:bg-[#f8f9fb] cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.chartConfig.showGrid,onChange:s=>d(t=>({...t,chartConfig:{...t.chartConfig,showGrid:s.target.checked}})),className:"rounded border-gray-300 w-3 h-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-xs text-[#000638]",children:"Mostrar Grade"}),e.jsx("p",{className:"text-[10px] text-gray-500",children:"Linhas de referência no fundo"})]})]}),r.chartConfig.chartType==="bar"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"flex items-center gap-2 p-2 border border-[#000638]/20 rounded-lg hover:bg-[#f8f9fb] cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.chartConfig.stacked,onChange:s=>d(t=>({...t,chartConfig:{...t.chartConfig,stacked:s.target.checked}})),className:"rounded border-gray-300 w-3 h-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-xs text-[#000638]",children:"Empilhado"}),e.jsx("p",{className:"text-[10px] text-gray-500",children:"Barras uma sobre a outra"})]})]}),e.jsxs("label",{className:"flex items-center gap-2 p-2 border border-[#000638]/20 rounded-lg hover:bg-[#f8f9fb] cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.chartConfig.horizontal,onChange:s=>d(t=>({...t,chartConfig:{...t.chartConfig,horizontal:s.target.checked}})),className:"rounded border-gray-300 w-3 h-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-xs text-[#000638]",children:"Horizontal"}),e.jsx("p",{className:"text-[10px] text-gray-500",children:"Barras na horizontal"})]})]})]})]})]})]})]}),h===5&&e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-xs font-semibold flex items-center gap-1.5 text-[#000638]",children:[e.jsx(Ce,{size:14}),"Preview do Widget"]}),e.jsx("button",{type:"button",onClick:()=>v(),className:"px-2.5 py-1 rounded-lg text-xs font-semibold border border-[#000638]/30 text-[#000638] hover:bg-[#000638]/10 transition-colors h-6",children:"Atualizar Preview"})]}),e.jsx("div",{className:"border border-[#000638]/20 rounded-lg p-3",children:e.jsx(De,{type:r.type,data:V,config:r})}),e.jsxs("div",{className:"bg-[#f8f9fb] p-2.5 rounded-lg border border-[#000638]/20",children:[e.jsx("p",{className:"font-semibold mb-1.5 text-xs text-[#000638]",children:"Resumo da Configuração:"}),e.jsxs("ul",{className:"text-[10px] space-y-0.5 text-gray-700",children:[e.jsxs("li",{children:[e.jsx("strong",{className:"text-[#000638]",children:"View:"})," ",k==null?void 0:k.label]}),e.jsxs("li",{children:[e.jsx("strong",{className:"text-[#000638]",children:"Colunas:"})," ",r.selectedColumns.join(", ")]}),e.jsxs("li",{children:[e.jsx("strong",{className:"text-[#000638]",children:"Filtros:"})," ",r.filters.length," aplicado(s)"]}),e.jsxs("li",{children:[e.jsx("strong",{className:"text-[#000638]",children:"Agregações:"})," ",r.aggregations.length," aplicada(s)"]}),e.jsxs("li",{children:[e.jsx("strong",{className:"text-[#000638]",children:"Tipo:"})," ",(S=oe.find(s=>s.value===r.type))==null?void 0:S.label]})]})]})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:()=>D(s=>Math.max(1,s-1)),disabled:h===1,className:"px-3 py-1 rounded-lg text-xs font-semibold border-2 border-gray-300 text-gray-600 hover:bg-gray-50 disabled:opacity-40 disabled:cursor-not-allowed transition-colors h-7",children:"Anterior"}),e.jsx("div",{className:"flex gap-2",children:h<5?e.jsx("button",{type:"button",onClick:()=>D(s=>Math.min(5,s+1)),className:"px-3 py-1 rounded-lg text-xs font-bold bg-[#000638] text-white hover:bg-[#fe0000] transition-colors h-7 shadow-md",children:"Próximo"}):e.jsx("button",{type:"button",onClick:Q,className:"px-3 py-1 rounded-lg text-xs font-bold bg-[#000638] text-white hover:bg-[#fe0000] transition-colors h-7 shadow-md",children:x?"Salvar Alterações":"Criar Widget"})})]})]})})},ts=()=>{const{user:l}=Ee(),{supabase:g}=ze(),[T,x]=o.useState([]),{dashboards:O,loading:Y,error:U,createDashboard:te,updateDashboard:h,deleteDashboard:D,fetchDashboardsWithWidgetCount:z}=Me(l==null?void 0:l.id),{createWidget:y,fetchWidgets:G,updateWidget:R,deleteWidget:M}=Ve(),[B,r]=o.useState(!1),[d,b]=o.useState(!1),[w,V]=o.useState(!1),[f,I]=o.useState(null),[C,A]=o.useState(null),[u,E]=o.useState({nome:"",descricao:"",usuarios:[]}),[W,_]=o.useState(null),[q,X]=o.useState(!1),[v,Q]=o.useState(""),[k,$]=o.useState(null),[S,s]=o.useState({});o.useEffect(()=>{(async()=>{try{const{data:n,error:c}=await g.from("users").select("id, name, email").order("name");if(c)throw c;x(n.map(m=>({id:m.id,nome:m.name,email:m.email})))}catch(n){console.error("Erro ao buscar usuários:",n)}})()},[g]);const t=()=>{b(!1),_(null),E({nome:"",descricao:"",usuarios:[]}),r(!0)},i=()=>{r(!1),E({nome:"",descricao:"",usuarios:[]}),_(null),b(!1),Q("")},p=a=>{const{name:n,value:c}=a.target;E(m=>({...m,[n]:c}))},j=a=>{E(n=>{const c=n.usuarios.includes(a)?n.usuarios.filter(m=>m!==a):[...n.usuarios,a];return{...n,usuarios:c}})},ge=async a=>{if(a.preventDefault(),!u.nome.trim()){alert("Por favor, insira um nome para o dashboard.");return}if(u.usuarios.length===0){alert("Por favor, selecione pelo menos um usuário.");return}X(!0);try{d&&W?await h(W.id,{nome:u.nome,descricao:u.descricao,usuarios:u.usuarios}):await te({nome:u.nome,descricao:u.descricao,usuarios:u.usuarios}),await z(),i()}catch(n){console.error("Erro ao salvar dashboard:",n),alert("Erro ao salvar dashboard. Tente novamente.")}finally{X(!1)}},be=a=>{b(!0),_(a),E({nome:a.nome||a.name||"",descricao:a.descricao||a.description||"",usuarios:a.usuarios||a.user_ids||[]}),r(!0)},pe=async a=>{if(window.confirm("Tem certeza que deseja apagar este dashboard?"))try{await D(a),await z()}catch(n){console.error("Erro ao deletar dashboard:",n),alert("Erro ao deletar dashboard. Tente novamente.")}},fe=a=>{I(a),A(null),V(!0)},je=(a,n)=>{I(a),A(n),V(!0)},ve=async a=>{if(k===a)$(null);else if($(a),!S[a]){const n=await G(a);s(c=>({...c,[a]:n}))}},Ne=async(a,n)=>{if(window.confirm("Tem certeza que deseja excluir este widget?"))try{await M(a),s(c=>({...c,[n]:c[n].filter(m=>m.id!==a)})),await z()}catch(c){console.error("Erro ao deletar widget:",c),alert("Erro ao deletar widget. Tente novamente.")}},ye=async a=>{var n,c,m,P;try{if(console.log("💾 Salvando widget com config:",a),C)await R(C.id,{nome:((n=a.config)==null?void 0:n.nome)||a.nome,view_name:((c=a.config)==null?void 0:c.viewName)||a.viewName,config:a.config||a}),S[f.id]&&s(L=>({...L,[f.id]:L[f.id].map(F=>{var ae,re;return F.id===C.id?{...F,nome:((ae=a.config)==null?void 0:ae.nome)||a.nome,view_name:((re=a.config)==null?void 0:re.viewName)||a.viewName,config:a.config||a}:F})}));else{const L=await y({dashboard_id:f.id,name:((m=a.config)==null?void 0:m.nome)||a.nome,view_name:((P=a.config)==null?void 0:P.viewName)||a.viewName,config:a.config||a},l==null?void 0:l.id);L.success&&S[f.id]&&s(F=>({...F,[f.id]:[L.data,...F[f.id]||[]]}))}await z(),V(!1),I(null),A(null)}catch(L){console.error("Erro ao salvar widget:",L),alert("Erro ao salvar widget. Tente novamente.")}};return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(Se,{title:"Gerenciador de Dashboards",icon:H}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Crie e gerencie dashboards personalizados para os usuários"})]}),e.jsx("div",{className:"mb-6 flex justify-end",children:e.jsx(J,{variant:"primary",size:"md",leftIcon:e.jsx(de,{size:20,weight:"bold"}),onClick:t,children:"Novo Dashboard"})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:Y?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(ie,{})}):U?e.jsxs("div",{className:"px-6 py-12 text-center text-red-500",children:[e.jsx("p",{className:"text-lg font-medium",children:"Erro ao carregar dashboards"}),e.jsx("p",{className:"text-sm mt-1",children:U.message})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nome"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descrição"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(K,{size:16}),e.jsx("span",{children:"Usuários"})]})}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(Z,{size:16}),e.jsx("span",{children:"Widgets"})]})}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ações"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:O.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:"6",className:"px-6 py-12 text-center text-gray-500",children:[e.jsx(H,{size:48,className:"mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium",children:"Nenhum dashboard criado"}),e.jsx("p",{className:"text-sm mt-1",children:'Clique em "Novo Dashboard" para começar'})]})}):O.map(a=>{var n,c;return e.jsxs(ne.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.jsxs("button",{type:"button",onClick:()=>ve(a.id),className:"flex text-xs items-center gap-2 text-gray-600 hover:text-blue-600",children:[k===a.id?e.jsx(Ae,{size:16,weight:"bold"}):e.jsx(ke,{size:16,weight:"bold"}),e.jsxs("span",{children:["#",a.id]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(H,{size:20,className:"text-blue-600 mr-2",weight:"duotone"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:a.nome||a.name||"Sem nome"})]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:a.descricao||a.description||"Sem descrição"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold bg-[#000638]/10 text-[#000638]",children:((n=a.usuarios)==null?void 0:n.length)||0})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold bg-green-100 text-green-800",children:a.widget_count||0})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>be(a),className:"inline-flex items-center p-1.5 text-[#000638] hover:bg-[#000638]/10 rounded-lg transition-colors",title:"Editar",children:e.jsx(le,{size:16,weight:"bold"})}),e.jsx("button",{type:"button",onClick:()=>fe(a),className:"inline-flex items-center p-1.5 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Adicionar Widget",children:e.jsx(H,{size:16,weight:"bold"})}),e.jsx("button",{onClick:()=>pe(a.id),className:"inline-flex items-center p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Excluir",children:e.jsx(se,{size:18,weight:"bold"})})]})})]}),k===a.id&&e.jsx("tr",{className:"bg-gray-50",children:e.jsx("td",{colSpan:"6",className:"px-6 py-4",children:e.jsxs("div",{className:"ml-8",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(ee,{size:18,className:"text-blue-600"}),"Widgets deste Dashboard"]}),((c=S[a.id])==null?void 0:c.length)>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:S[a.id].map(m=>{var P;return e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-3 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-gray-900",children:m.nome||"Widget sem nome"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["View: ",m.view_name]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Tipo:"," ",((P=m.config)==null?void 0:P.type)||"table"]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{type:"button",onClick:()=>je(a,m),className:"p-1 text-[#000638] hover:bg-[#000638]/10 rounded transition-colors",title:"Editar Widget",children:e.jsx(le,{size:14,weight:"bold"})}),e.jsx("button",{type:"button",onClick:()=>Ne(m.id,a.id),className:"p-1 text-red-600 hover:bg-red-50 rounded transition-colors",title:"Excluir Widget",children:e.jsx(se,{size:16,weight:"bold"})})]})]})},m.id)})}):e.jsx("p",{className:"text-sm text-gray-500 italic",children:'Nenhum widget criado ainda. Clique em "Adicionar Widget" para começar.'})]})})})]},a.id)})})]})})}),e.jsx(ce,{isOpen:B,onClose:i,title:d?"Editar Dashboard":"Novo Dashboard",size:"2xl",children:e.jsxs("form",{onSubmit:ge,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"nome",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome do Dashboard *"}),e.jsx("input",{type:"text",id:"nome",name:"nome",value:u.nome,onChange:p,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: Dashboard Financeiro"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"descricao",className:"block text-sm font-medium text-gray-700 mb-1",children:"Descrição *"}),e.jsx("textarea",{id:"descricao",name:"descricao",value:u.descricao,onChange:p,required:!0,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",placeholder:"Descreva o propósito deste dashboard..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selecione os Usuários que Visualizarão este Dashboard *"}),u.usuarios.length>0&&e.jsx("div",{className:"mb-2 flex flex-wrap gap-1.5",children:u.usuarios.map(a=>{const n=T.find(c=>c.id===a);return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-[#000638]/10 text-[#000638] rounded-full text-xs font-semibold",children:[e.jsx(K,{size:12,weight:"bold"}),e.jsx("span",{children:(n==null?void 0:n.nome)||"Usuário"}),e.jsx("button",{type:"button",onClick:c=>{c.stopPropagation(),j(a)},className:"ml-0.5 hover:bg-[#000638]/20 rounded-full p-0.5 transition-colors",children:e.jsx(Le,{size:12,weight:"bold"})})]},a)})}),e.jsx("div",{className:"mb-2",children:e.jsx("input",{type:"text",value:v,onChange:a=>{a.stopPropagation(),Q(a.target.value)},onClick:a=>a.stopPropagation(),placeholder:"🔍 Buscar por nome ou email...",className:"w-full border border-[#000638]/30 rounded-lg px-2 py-1.5 focus:outline-none focus:ring-2 focus:ring-[#000638] bg-[#f8f9fb] text-[#000638] placeholder:text-gray-400 text-xs"})}),e.jsx("div",{className:"relative",children:e.jsx("div",{className:"border border-[#000638]/20 rounded-lg overflow-hidden focus-within:border-[#000638] transition-colors",children:e.jsx("div",{className:"bg-white max-h-40 overflow-y-auto",children:(()=>{const a=T.filter(n=>{const c=v.toLowerCase();return n.nome.toLowerCase().includes(c)||n.email.toLowerCase().includes(c)});return a.length===0?e.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[e.jsx(K,{size:32,className:"mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"Nenhum usuário encontrado"}),e.jsx("p",{className:"text-xs mt-1",children:"Tente buscar por outro nome ou email"})]}):a.map(n=>{const c=u.usuarios.includes(n.id);return e.jsxs("button",{type:"button",onClick:m=>{m.stopPropagation(),j(n.id)},className:`w-full flex items-center gap-2 px-3 py-2 transition-all border-b border-gray-100 last:border-b-0 text-xs ${c?"bg-[#000638]/5 hover:bg-[#000638]/10":"bg-white hover:bg-gray-50"}`,children:[e.jsx("div",{className:`flex-shrink-0 w-4 h-4 rounded border-2 flex items-center justify-center transition-all ${c?"bg-[#000638] border-[#000638]":"border-gray-300"}`,children:c&&e.jsx(Z,{size:12,className:"text-white",weight:"bold"})}),e.jsx("div",{className:"flex-shrink-0 w-7 h-7 rounded-full bg-gradient-to-br from-[#000638] to-[#000638]/80 flex items-center justify-center text-white font-bold text-xs",children:n.nome.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:`font-semibold text-xs ${c?"text-[#000638]":"text-gray-900"}`,children:n.nome}),e.jsx("p",{className:"text-[10px] text-gray-500",children:n.email})]}),c&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Z,{size:20,className:"text-blue-600",weight:"bold"})})]},n.id)})})()})})}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-600",children:u.usuarios.length>0?e.jsxs("span",{className:"font-medium text-blue-600",children:[u.usuarios.length," usuário(s) selecionado(s)"]}):e.jsx("span",{className:"text-red-600",children:"Selecione pelo menos um usuário"})}),u.usuarios.length>0&&e.jsx("button",{type:"button",onClick:()=>E(a=>({...a,usuarios:[]})),className:"text-sm text-red-600 hover:text-red-700 font-medium",children:"Limpar todos"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(J,{type:"button",variant:"secondary",onClick:i,children:"Cancelar"}),e.jsx(J,{type:"submit",variant:"primary",disabled:u.usuarios.length===0||q,children:q?"Salvando...":d?"Salvar Alterações":"Criar Dashboard"})]})]})}),e.jsx(Ge,{isOpen:w,onClose:()=>{V(!1),I(null)},onSave:ye})]})};export{ts as default};
